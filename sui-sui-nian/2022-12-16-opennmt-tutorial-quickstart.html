<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹ - Leoâ€™s blog</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="https://leonis.cc/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html" rel="canonical" />
  <!-- Feed -->
  <link href="https://leonis.cc/feed.xml" type="application/atom+xml" rel="alternate"
    title="Leoâ€™s blog Full Atom Feed" />

  <link href="https://leonis.cc/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- CSS specified by the user -->


  <link href="https://leonis.cc/theme/css/customize.css" type="text/css" rel="stylesheet" />


  <link href="https://leonis.cc/theme/css/plugins.css" type="text/css" rel="stylesheet" />


  <link href="https://leonis.cc/theme/css/lightgallery.min.css" type="text/css" rel="stylesheet" />


  <link href="https://leonis.cc/theme/css/bookshelf.css" type="text/css" rel="stylesheet" />


  <!-- font-awesome icons -->
  <link href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <!-- Custom fonts -->
  <link href="https://ik.imagekit.io/leonis/ChiuKongGothic-CL-w4/result.css?updatedAt=1700222744424" rel="stylesheet" />
  <link href="https://ik.imagekit.io/leonis/ChiuKongGothic-CL-w5/result.css?updatedAt=1700275749020" rel="stylesheet" />
  <link href="https://ik.imagekit.io/leonis/ChiuKongGothic-CL-w7/result.css?updatedAt=1700275854743" rel="stylesheet" />
  <link href="https://cdnjs.loli.net/ajax/libs/fontsource-fira-sans/5.0.19/400.min.css" rel="stylesheet" />
  <link href="https://cdnjs.loli.net/ajax/libs/fontsource-fira-sans/5.0.19/400-italic.min.css" rel="stylesheet" />
  <link href="https://cdnjs.loli.net/ajax/libs/fontsource-fira-sans/5.0.19/500.min.css" rel="stylesheet" />
  <link href="https://cdnjs.loli.net/ajax/libs/fontsource-fira-sans/5.0.19/500-italic.min.css" rel="stylesheet" />
  <link href="https://cdnjs.loli.net/ajax/libs/fontsource-fira-sans/5.0.19/700.min.css" rel="stylesheet" />
  <link href="https://cdnjs.loli.net/ajax/libs/fontsource-fira-sans/5.0.19/700-italic.min.css" rel="stylesheet" />
  <link href="https://cdnjs.loli.net/ajax/libs/fontsource-lato/5.0.19/400.min.css" rel="stylesheet" />
  <link href="https://ik.imagekit.io/leonis/AdvocateAncientSerifSC-Bold/result.css?updatedAt=1700289637334" rel="stylesheet" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    var siteUrl = 'https://leonis.cc';
  </script>

  <script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>







    <meta name="description" content="æ‹†è§£é¡¹ç›®ä»£ç çš„æ—¶å€™å‘ç°ä½¿ç”¨åˆ°äº† onmt è¿™ä¸ªå¤æ€ªä¸œè¥¿ï¼ŒæŸ¥é˜…èµ„æ–™åæ‰çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè‡ªç„¶æœºå™¨ç¿»è¯‘çš„æ¡†æ¶ï¼Œæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ä¸­å¸¸ç”¨çš„å·¥å…·ã€‚ä½†æ˜¯ç›¸å…³èµ„æ–™åˆå¤ªå°‘ï¼Œäºæ˜¯ä¸å¾—ä¸ç…§ç€æ–‡æ¡£ä¸€ç‚¹ä¸€ç‚¹å•ƒï¼Œæœ€åç•™ä¸‹äº†è¿™ç¯‡ç¬”è®°ã€‚">

    <meta name="author" content="Leo">

    <meta name="tags" content="OpenNMT">
    <meta name="tags" content="NLP">
    <meta name="tags" content="Python">




<!-- Open Graph -->
<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="Leoâ€™s blog"/>
<meta prefix="og: http://ogp.me/ns#" property="og:title" content="æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹"/>
<meta prefix="og: http://ogp.me/ns#" property="og:description" content="æ‹†è§£é¡¹ç›®ä»£ç çš„æ—¶å€™å‘ç°ä½¿ç”¨åˆ°äº† onmt è¿™ä¸ªå¤æ€ªä¸œè¥¿ï¼ŒæŸ¥é˜…èµ„æ–™åæ‰çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè‡ªç„¶æœºå™¨ç¿»è¯‘çš„æ¡†æ¶ï¼Œæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ä¸­å¸¸ç”¨çš„å·¥å…·ã€‚ä½†æ˜¯ç›¸å…³èµ„æ–™åˆå¤ªå°‘ï¼Œäºæ˜¯ä¸å¾—ä¸ç…§ç€æ–‡æ¡£ä¸€ç‚¹ä¸€ç‚¹å•ƒï¼Œæœ€åç•™ä¸‹äº†è¿™ç¯‡ç¬”è®°ã€‚"/>
<meta prefix="og: http://ogp.me/ns#" property="og:locale" content="en_US"/>
<meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://leonis.cc/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html"/>
<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"/>
<meta prefix="og: http://ogp.me/ns#" property="article:published_time" content="2022-12-16 00:00:00+08:00"/>
<meta prefix="og: http://ogp.me/ns#" property="article:modified_time" content=""/>
<meta prefix="og: http://ogp.me/ns#" property="article:author" content="https://leonis.cc/author/leo.html">
<meta prefix="og: http://ogp.me/ns#" property="article:section" content="ç¢ç¢å¿µ"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="OpenNMT"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="NLP"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="Python"/>
<meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://img.leonis.cc/bg/header.webp">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹",
  "headline": "æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹",
  "datePublished": "2022-12-16 00:00:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Leo",
    "url": "https://leonis.cc/author/leo.html"
  },
  "image": "https://leonis.cc/https://img.leonis.cc/bg/header.webp",
  "url": "https://leonis.cc/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html",
  "description": "æ‹†è§£é¡¹ç›®ä»£ç çš„æ—¶å€™å‘ç°ä½¿ç”¨åˆ°äº† onmt è¿™ä¸ªå¤æ€ªä¸œè¥¿ï¼ŒæŸ¥é˜…èµ„æ–™åæ‰çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè‡ªç„¶æœºå™¨ç¿»è¯‘çš„æ¡†æ¶ï¼Œæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ä¸­å¸¸ç”¨çš„å·¥å…·ã€‚ä½†æ˜¯ç›¸å…³èµ„æ–™åˆå¤ªå°‘ï¼Œäºæ˜¯ä¸å¾—ä¸ç…§ç€æ–‡æ¡£ä¸€ç‚¹ä¸€ç‚¹å•ƒï¼Œæœ€åç•™ä¸‹äº†è¿™ç¯‡ç¬”è®°ã€‚"
}
</script>

<link href="https://npm.elemecdn.com/@waline/client@2.14.9/dist/waline.css" rel="stylesheet" />
<script src="https://npm.elemecdn.com/@waline/client@2.14.9/dist/waline.js"></script>

</head>









<body class="category-template">

<div class="nav-header">
  <nav class="nav-wrapper" aria-label="Main">
<ul>

    <li class="nav-Home " role="presentation"><a href="/"><span>Home</span></a></li>
    <li class="nav-ç¢ç¢å”¸ active" role="presentation"><a href="/category/sui-sui-nian.html"><span>ç¢ç¢å”¸</span></a></li>
    <li class="nav-æ•…ç´™å † " role="presentation"><a href="/category/gu-zhi-dui.html"><span>æ•…ç´™å †</span></a></li>
    <li class="nav-åœ¨è·¯ä¸Š " role="presentation"><a href="/category/zai-lu-shang.html"><span>åœ¨è·¯ä¸Š</span></a></li>
    <li class="nav-å±±ç‰†é‚Š " role="presentation"><a href="/pages/shan-qiang-bian.html"><span>å±±ç‰†é‚Š</span></a></li>
    <li class="nav-ç ´æ«¥ç° " role="presentation"><a href="https://neodb.social/users/Leo/"><span>ç ´æ«¥ç°</span></a></li>
    <li class="nav-Archives " role="presentation"><a href="/archives.html"><span>Archives</span></a></li>
    <li class="nav-Tags " role="presentation"><a href="/tags.html"><span>Tags</span></a></li>
    <li class="nav-About " role="presentation"><a href="/about.html"><span>About</span></a></li>

</ul>
<ul class="nav-meta">
    <li class="nav-search">
      <a aria-label="Search" href="/search.html" target="_blank">
        <i class="icon icon-search" aria-hidden="true"></i>
    <span>search</span></a></li>
    <li class="nav-foreverblog">
      <a aria-label="Foreverblog" href="https://www.foreverblog.cn/go.html" target="_blank">
        <i aria-hidden="true"><img src="https://img.foreverblog.cn/wormhole_2_tp.gif" alt="foreverblog" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢"></i>
    <span>foreverblog</span></a></li>
    <li class="nav-travellings">
      <a aria-label="Travellings" href="https://www.travellings.cn/go.html" target="_blank">
        <i aria-hidden="true"><img src="https://www.travellings.cn/assets/w.png" alt="travellings" title="å¼€å¾€-å‹é“¾æ¥åŠ›" aria-hidden="true"></i>
    <span>travellings</span></a></li>
  <li class="nav-search" style="display: none;">
    <a title="Search">
      <i class="icon icon-search" aria-hidden="true"></i>
      <span>Search</span>
    </a>
  </li>
</ul>  </nav>

  <div class="nav-wrapper-control">
    <div class="inner">
      <a class="nav-menu" role="button"><i class="icon icon-menu" aria-hidden="true"></i>Menu</a>
      <a class="nav-search" title="Search" role="button" style="display: none;"><i class="icon icon-search" aria-hidden="true"></i></a>
    </div>
  </div>
</div>
<div class="nav-close" role="button" aria-label="Close"></div>
  <section id="wrapper" class="page-wrapper">
    <!-- Progressbar -->
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="post-header  has-cover ">
      <div class="inner">
        <span class="post-info">
          <span class="post-type">Article</span>
          <span class="post-count">ç¢ç¢å¿µ</span>
        </span>
        <h1 class="post-title">æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹</h1>
        <div class="post-meta">
          <div class="post-meta-avatars">


            <figure class="post-meta-avatar avatar">
              <a class="author-avatar" href="https://leonis.cc/author/leo.html">
                <img class="author-profile-image" src="https://cravatar.cn/avatar/95e31f6808fafa1f8ef3313b6f0b10e6?s=800" alt="Leo" />
              </a>
            </figure>
          </div>

          <h4 class="post-meta-author">
            Leo
          </h4>
          <time datetime="2022å¹´ 12æœˆ16æ—¥">2022å¹´ 12æœˆ16æ—¥</time>
        </div>
          <div class="post-cover cover">
            <img src="https://img.leonis.cc/bg/header.webp" alt="Category ç¢ç¢å¿µ" />
          </div>
      </div>
    </header>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
          <div class="toc-nav">
            <div id="toc"><ul><li><a class="toc-href" href="#zhun-bei-gong-zuo" title="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</a></li><li><a class="toc-href" href="#kuai-su-shang-shou" title="å¿«é€Ÿä¸Šæ‰‹">å¿«é€Ÿä¸Šæ‰‹</a><ul><li><a class="toc-href" href="#an-zhuang-opennmt" title="å®‰è£… OpenNMT">å®‰è£… OpenNMT</a></li><li><a class="toc-href" href="#zhun-bei-shu-ju" title="å‡†å¤‡æ•°æ®">å‡†å¤‡æ•°æ®</a></li><li><a class="toc-href" href="#xun-lian-mo-xing" title="è®­ç»ƒæ¨¡å‹">è®­ç»ƒæ¨¡å‹</a></li><li><a class="toc-href" href="#mo-xing-yu-ce" title="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</a></li></ul></li><li><a class="toc-href" href="#wen-yan-fan-yi_1" title="æ–‡è¨€ç¿»è¯‘">æ–‡è¨€ç¿»è¯‘</a><ul><li><a class="toc-href" href="#zhun-bei-shu-ju_1" title="å‡†å¤‡æ•°æ®">å‡†å¤‡æ•°æ®</a></li><li><a class="toc-href" href="#gou-jian-ci-ku" title="æ„å»ºè¯åº“">æ„å»ºè¯åº“</a></li><li><a class="toc-href" href="#xun-lian-mo-xing_1" title="è®­ç»ƒæ¨¡å‹">è®­ç»ƒæ¨¡å‹</a></li><li><a class="toc-href" href="#mo-xing-yu-ce_1" title="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</a></li></ul></li><li><a class="toc-href" href="#references_1" title="References">References</a></li></ul></div>
          </div>
        <div class="inner">
          <section class="post-content">
            <p>æ‹†è§£é¡¹ç›®ä»£ç çš„æ—¶å€™å‘ç°ä½¿ç”¨åˆ°äº† <code>onmt</code> è¿™ä¸ªå¤æ€ªä¸œè¥¿ï¼ŒæŸ¥é˜…èµ„æ–™åæ‰çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè‡ªç„¶æœºå™¨ç¿»è¯‘çš„æ¡†æ¶ï¼Œæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ä¸­å¸¸ç”¨çš„å·¥å…·ã€‚ä½†æ˜¯ç›¸å…³èµ„æ–™åˆå¤ªå°‘ï¼Œäºæ˜¯ä¸å¾—ä¸ç…§ç€æ–‡æ¡£ä¸€ç‚¹ä¸€ç‚¹å•ƒï¼Œæœ€åç•™ä¸‹äº†è¿™ç¯‡ç¬”è®°ã€‚</p>
<p>OpenNMT å®˜æ–¹æè¿°è¯¥æ¡†æ¶ä¸º an open source neural machine translation systemï¼Œç‚¹è¿› <a href="https://opennmt.net/" rel="noopener" target="_blank">OpenNMT çš„å®˜ç½‘</a>å¯ä»¥çœ‹åˆ°æ›´å¤šèµ„æ–™ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦æˆ‘å¤šæè¿°ã€‚æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼ŒOpenNMT æ˜¯æ­å»ºè‡ªç„¶è¯­è¨€å¤„ç†æ¨¡å‹çš„å¼€æºæ¡†æ¶ï¼Œå…¶ä¸­è‡ªç„¶åŒ…æ‹¬å¸¸è§çš„ RNN å’Œ Transformer ç­‰æ¨¡å‹ã€‚å¦‚æœåœ¨è‡ªç„¶è¯­è¨€å¤„ç†æ–¹é¢æœ‰éœ€è¦ï¼ŒOpenNMT ç»å¯¹æ˜¯ä¸€ä¸ªè½»é‡æœ‰æ•ˆçš„æ¡†æ¶ã€‚</p>
<p>OpenNMT çš„ä¸­æ–‡å­¦ä¹ èµ„æ–™è¾ƒå°‘ï¼Œäºæ˜¯æˆ‘åªèƒ½å‚è€ƒ<a href="https://opennmt.net/OpenNMT-py/main.html" rel="noopener" target="_blank">å®˜æ–¹æ–‡æ¡£</a>å­¦ä¹ ã€‚åœ¨è¿™ç¯‡ç¬”è®°ä¸­ï¼Œæˆ‘ä¼šæŠŠæ–‡æ¡£ä¸­çš„æ¨¡å‹éƒ½è¯•éªŒä¸€éï¼ˆå¸Œæœ›åˆ«ğŸ•Šï¸ï¼‰ï¼Œè®°å½•ä¸‹æ•´ä¸ªè¿‡ç¨‹æˆ–è®¸èƒ½å¸®åŠ©åˆ°éœ€è¦çš„äººã€‚</p>
<h2 id="zhun-bei-gong-zuo">å‡†å¤‡å·¥ä½œ</h2>
<p>é¦–å…ˆä»‹ç»ä¸€ä¸‹æˆ‘çš„è¿è¡Œç¯å¢ƒï¼Œæˆ‘çš„è®¾å¤‡æ­è½½ä¸€å— <code>GTX 1080</code> GPUï¼Œç³»ç»Ÿä¸º <code>Ubuntu 20.04</code>ï¼Œéœ€è¦æå‰åœ¨è®¾å¤‡ä¸Šå®‰è£…å¥½ CUDAï¼Œæˆ‘ä½¿ç”¨ Anaconda é…ç½® Python ç¯å¢ƒã€‚</p>
<p><div class="note-info"><p><span><i class="fa-solid fa-note-sticky"></i>&ensp;Note</span>&emsp;OpenNMT ä¸æ”¯æŒè¿‡æ—§çš„ GPUï¼Œä¹‹å‰åœ¨ <code>GTX 970</code> çš„è®¾å¤‡ä¸Šå°±æ— æ³•è®­ç»ƒæ¨¡å‹ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½é™¤äº†æ¢è®¾å¤‡æ— è§£ğŸ˜­</p></div></p>
<h2 id="kuai-su-shang-shou">å¿«é€Ÿä¸Šæ‰‹</h2>
<h3 id="an-zhuang-opennmt">å®‰è£… OpenNMT</h3>
<p>OpenNMT æœ‰ PyTorch ä¸ TensorFlow ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒPyTorch åœ¨ç¯å¢ƒæ­å»ºä¸Šæ–¹ä¾¿å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘é€‰æ‹© PyTorch ç‰ˆæœ¬ã€‚å…ˆåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå†ç›´æ¥é€šè¿‡ <code>pip</code> å®‰è£… OpenNMT-pyï¼ŒPython ç‰ˆæœ¬ä¸º <code>3.9</code>ï¼ŒOpenNMT-py ä¸º <code>3.0.2</code>ã€‚</p>
<pre><code class="language-sh"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
conda create -n nlp python==3.9
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
conda activate nlp
# å®‰è£… OpenNMT
pip install OpenNMT-py==3.0.2
</code></pre>
<p><div class="note-info"><p><span><i class="fa-solid fa-note-sticky"></i>&ensp;Note</span>&emsp;å›½å†…ç›´è¿ PyPI çš„é€Ÿåº¦å¯èƒ½å¾ˆæ…¢ï¼Œå¯ä»¥ä½¿ç”¨æ¸…åæºï¼Œå‘½ä»¤ä¸º <code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple {some-package}</code>ï¼Œå°†å…¶ä¸­çš„ <code>{some-package}</code> æ›¿æ¢ä¸ºéœ€è¦å®‰è£…çš„åŒ…åç§°ã€‚</p></div></p>
<p>ç›´æ¥å®‰è£… <code>OpenNMT-py</code> å¾ˆæœ‰å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯ Pytorch ä¸ CUDA ç‰ˆæœ¬ä¸åŒ¹é…ã€‚å¯ä»¥ç”¨ <code>nvcc -V</code> æŸ¥è¯¢ CUDA ç‰ˆæœ¬ï¼Œå†åœ¨ <a href="https://pytorch.org/get-started/previous-versions/" rel="noopener" target="_blank">Pytorch å®˜ç½‘</a>æ‰¾åˆ°ç›¸åº”çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚æˆ‘çš„ CUDA ç‰ˆæœ¬ä¸º <code>11.4</code>ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°å®‰è£…ä»¥ä¸‹ç‰ˆæœ¬çš„åŒ…è§£å†³ä¾èµ–é—®é¢˜ï¼š</p>
<pre><code class="language-sh">pip install torch==1.12.1+cu113 torchvision==0.13.1+cu113 torchaudio==0.12.1 --extra-index-url https://download.pytorch.org/whl/cu113
</code></pre>
<h3 id="zhun-bei-shu-ju">å‡†å¤‡æ•°æ®</h3>
<p>å¿«é€Ÿä¸Šæ‰‹ä¸€èŠ‚æ­å»ºçš„æ˜¯ä¸€ä¸ªç®€å•çš„åŒè¯­ç¿»è¯‘æ¨¡å‹ï¼Œå› æ­¤éœ€è¦å‡†å¤‡ä¸¤ç§è¯­è¨€çš„æ•°æ®ï¼Œåˆ†åˆ«ä¸ºæºè¯­è¨€<code>src</code> å’Œç›®æ ‡è¯­è¨€ <code>tgt</code>ï¼Œæ•°æ®æ–‡ä»¶ä¸­æ¯è¡ŒåŒ…å«ä¸€å¥è¯ï¼Œä»¥ç©ºæ ¼åˆ†éš”ä¸åŒçš„è¯ã€‚å†è€ƒè™‘åˆ°è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œé‚£ä¹ˆä¸€å…±éœ€è¦ 4 ç§æ•°æ®æ–‡ä»¶ï¼š</p>
<ul>
<li><code>src-train.txt</code></li>
<li><code>tgt-train.txt</code></li>
<li><code>src-val.txt</code></li>
<li><code>tgt-val.txt</code></li>
</ul>
<p><div class="note-info"><p><span><i class="fa-solid fa-note-sticky"></i>&ensp;Note</span>&emsp;å¯ä»¥æƒ³è±¡åˆ°ï¼Œå¦‚æœå¤„ç†çš„æ˜¯è‹±è¯­ã€æ³•è¯­ç­‰ä»¥ç©ºæ ¼åˆ†éš”å•è¯çš„è¯­è¨€ï¼Œåªéœ€è¦å°†æ–‡æœ¬æ•°æ®å¤„ç†ä¸ºæ¯è¡Œä¸€å¥è¯çš„æ ¼å¼å³å¯ã€‚ä½†å¯¹äºæ±‰è¯­ã€æ—¥è¯­ç­‰ä¸ä»¥ç‰¹æ®Šæ ‡è®°åˆ†éš”è¯è¯­çš„è¯­è¨€ï¼Œæ•°æ®éœ€è¦ç»è¿‡é¢å¤–çš„åˆ†è¯æ­¥éª¤åæ‰å¯ä»¥ä½¿ç”¨ã€‚</p></div></p>
<p>å®˜æ–¹æä¾›äº†è‹±è¯­-å¾·è¯­çš„æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ï¼š</p>
<pre><code class="language-sh">wget https://s3.amazonaws.com/opennmt-trainingdata/toy-ende.tar.gz
tar xf toy-ende.tar.gz
</code></pre>
<p>ä¹Ÿå¯ä»¥åˆ° <a href="https://github.com/OpenNMT/OpenNMT-py/tree/master/data" rel="noopener" target="_blank"><i class="fa-brands fa-github"></i> OpenNMT-py/data/</a> åœ¨çº¿æŸ¥çœ‹æ•°æ®é•¿ä»€ä¹ˆæ ·å­ã€‚</p>
<p>æ¥ç€é€šè¿‡ <code>vim toy_en_de.yaml</code> åœ¨ç›®å½•ä¸‹åˆ›å»º <code>.yaml</code> é…ç½®æ–‡ä»¶ï¼Œå†…å®¹ä¸º</p>
<pre><code class="language-yaml"># toy_en_de.yaml

## Where the samples will be written
save_data: toy-ende/run/example
## Where the vocab(s) will be written
src_vocab: toy-ende/run/example.vocab.src
tgt_vocab: toy-ende/run/example.vocab.tgt
# Prevent overwriting existing files in the folder
overwrite: False

# Corpus opts:
data:
    corpus_1:
        path_src: toy-ende/src-train.txt
        path_tgt: toy-ende/tgt-train.txt
    valid:
        path_src: toy-ende/src-val.txt
        path_tgt: toy-ende/tgt-val.txt
</code></pre>
<p>åˆ›å»ºæ–‡ä»¶åçš„æ–‡ä»¶ç»“æ„ä¸º</p>
<pre><code class="language-sh">.
&boxvr;&boxh;&boxh; toy-ende
&boxv;   &boxvr;&boxh;&boxh; src-test.txt
&boxv;   &boxvr;&boxh;&boxh; src-train.txt
&boxv;   &boxvr;&boxh;&boxh; src-val.txt
&boxv;   &boxvr;&boxh;&boxh; tgt-test.txt
&boxv;   &boxvr;&boxh;&boxh; tgt-train.txt
&boxv;   &boxur;&boxh;&boxh; tgt-val.txt
&boxur;&boxh;&boxh; toy_en_de.yaml
</code></pre>
<p>è®¾ç½®å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹æ„å»ºè¯åº“ï¼š</p>
<pre><code class="language-sh">onmt_build_vocab -config toy_en_de.yaml -n_sample 10000
</code></pre>
<p>å…¶ä¸­ <code>n_sample</code> è®¾å®šäº†ä»è¯­æ–™ä¸­è·å–å¤šå°‘è¡Œçš„æ•°æ®ç”¨äºæ„å»ºè¯åº“ã€‚</p>
<p><div class="note-info"><p><span><i class="fa-solid fa-note-sticky"></i>&ensp;Note</span>&emsp;è‹¥ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œéœ€è¦è¿›å…¥è™šæ‹Ÿç¯å¢ƒåæ‰èƒ½è¿è¡Œä¸Šè¿°å‘½ä»¤ï¼Œè‹¥ä½¿ç”¨ Anacondaï¼Œä¹Ÿéœ€è¦å…ˆæ¿€æ´»ç¯å¢ƒã€‚Pytorch ä¸ CUDA ç‰ˆæœ¬ä¸åŒ¹é…ä¼šå¯¼è‡´ <code>undefined symbol: cublasLtGetStatusString, version libcublasLt.so</code> é”™è¯¯ã€‚</p></div></p>
<h3 id="xun-lian-mo-xing">è®­ç»ƒæ¨¡å‹</h3>
<p>è®­ç»ƒæ¨¡å‹ä¹Ÿååˆ†ç®€å•ï¼Œåœ¨ <code>.yaml</code> æ–‡ä»¶ä¸­è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-yaml"># Vocabulary files that were just created
src_vocab: toy-ende/run/example.vocab.src
tgt_vocab: toy-ende/run/example.vocab.tgt

# Train on a single GPU
world_size: 1
gpu_ranks: [0]

# Where to save the checkpoints
save_model: toy-ende/run/model
save_checkpoint_steps: 500
train_steps: 1000
valid_steps: 500
</code></pre>
<p>ä½¿ç”¨ <code>onmt_train -config toy_en_de.yaml</code> å¼€å§‹è®­ç»ƒï¼Œè¯¥é…ç½®ä¼šç”Ÿæˆé»˜è®¤çš„ 2 å±‚å…·æœ‰ 500 ä¸ªéšè—å•å…ƒçš„ LSTM æ¨¡å‹ã€‚</p>
<h3 id="mo-xing-yu-ce">æ¨¡å‹é¢„æµ‹</h3>
<p>ä½¿ç”¨ç±»ä¼¼çš„å‘½ä»¤è¿›è¡Œæ¨¡å‹é¢„æµ‹ï¼Œæ¨¡å‹é¢„æµ‹èƒ½å¤Ÿå°†æ–‡æœ¬æ–‡ä»¶ä¸­çš„å†…å®¹ç¿»è¯‘å¹¶ä¿å­˜åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ï¼š</p>
<pre><code>onmt_translate -model toy-ende/run/model_step_1000.pt -src toy-ende/src-test.txt -output toy-ende/pred_1000.txt -gpu 0 -verbose
</code></pre>
<ul>
<li>ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨äº†è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹ <code>toy-ende/run/model_step_1000.pt</code></li>
<li>é¢„æµ‹ <code>toy-ende/src-test.txt</code> æµ‹è¯•é›†æ•°æ®</li>
<li>å°†ç»“æœè¾“å‡ºåˆ° <code>toy-ende/pred_1000.txt</code>ï¼Œ</li>
<li><code>-gpu</code> æŒ‡å®šäº†ä½¿ç”¨çš„ GPU</li>
<li><code>-verbose</code> æŒ‡å®šåœ¨ç»ˆç«¯ä¸­è¾“å‡ºæ¯ä¸ªæ­¥éª¤çš„è¯¦ç»†ç»“æœ</li>
</ul>
<p>ä½¿ç”¨ <code>head -n 2 toy-ende/src-test.txt</code> å’Œ <code>head -n 2 toy-ende/pred_1000.txt</code> æŸ¥çœ‹ä¸€ä¸‹é¢„æµ‹ç»“æœï¼š</p>
<pre><code class="language-txt"># test
Orlando Bloom and Miranda Kerr still love each other
Actors Orlando Bloom and Model Miranda Kerr want to go their separate ways .

# pred
Die &lt;unk&gt; der &lt;unk&gt; der &lt;unk&gt; , die die &lt;unk&gt; der &lt;unk&gt; &hellip;&hellip;
</code></pre>
<p>ç”±äºè®­ç»ƒæ—¶é—´å¾ˆçŸ­ï¼Œæ•°æ®é›†å¾ˆå°ï¼Œé¢„æµ‹ç»“æœä¸ä¼šå¥½ï¼Œå†åŠ ä¸Šä¸è®¤è¯†å¾·è¯­ï¼Œä¹Ÿæ— æ³•åˆ¤æ–­ç»“æœçš„ä¼˜åŠ£ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°è¯•åœ¨æ›´å¤§çš„ä¸­æ–‡è¯­æ–™ä¸Šè¿›è¡Œç¿»è¯‘ä»»åŠ¡ã€‚</p>
<h2 id="wen-yan-fan-yi_1">æ–‡è¨€ç¿»è¯‘</h2>
<p>B ç«™ä¸Šæœ‰ä¸€ä¸ªå±•ç¤º OpenNMT çš„<a href="https://www.bilibili.com/video/BV1NL4y1t73c/?spm_id_from=333.337.search-card.all.click&amp;vd_source=a5a1b5dd5c760997f9e16b7806d64651" rel="noopener" target="_blank">è§†é¢‘</a>ï¼Œå®åœ¨å¾ˆä¸é”™ã€‚è§†é¢‘ä¸­å±•ç¤ºçš„ç¿»è¯‘ä»»åŠ¡æ˜¯å°†ç™½è¯è¯‘ä¸ºæ–‡è¨€ï¼Œä¸ä»…ç›´è§‚è€Œä¸”ååˆ†æœ‰è¶£ï¼Œæˆ‘è§‰å¾—ç‰¹åˆ«é€‚åˆç”¨æ¥å…¥é—¨ï¼Œä½œè€…çš„ä»£ç ä¹Ÿå…¬å¼€åœ¨ <a href="https://github.com/qhduan/notebook_gist/blob/master/%E7%BF%BB%E8%AF%91%E5%8F%A4%E6%96%87.ipynb" rel="noopener" target="_blank">GitHub</a> ä¸Šï¼Œå¯ä»¥å’Œæœ¬æ–‡ç›¸äº’å‚ç…§ï¼Œæœ¬æ–‡ä¸­çš„ä»£ç ä¹Ÿå¯ä»¥åœ¨ <a href="https://github.com/Tseing/OpenNMT-wenyan" rel="noopener" target="_blank"><i class="fa-brands fa-github"></i> Tseing/OpenNMT-wenyan </a> æ‰¾åˆ°ã€‚</p>
<h3 id="zhun-bei-shu-ju_1">å‡†å¤‡æ•°æ®</h3>
<p>ç™½è¯æ–‡ä¸æ–‡è¨€æ–‡çš„å¹³è¡Œè¯­æ–™æ¥è‡ªäº <a href="https://github.com/NiuTrans/Classical-Modern" rel="noopener" target="_blank"><i class="fa-brands fa-github"></i> NiuTrans/Classical-Modern</a>ï¼ŒåŒ…å«äº†å¤§é‡å†…å®¹ï¼š</p>
<pre><code class="language-txt"># Classical-Modern/source/
å…ƒå²  åŒ—é½ä¹¦  å—é½ä¹¦  åæ±‰ä¹¦  å¤ªå¹³å¹¿è®°  å®‹å²    æ–°äº”ä»£å²  æ—§äº”ä»£å²  æ˜å²  æ¢ä¹¦      æ±‰ä¹¦              è¾½å²  é™ˆä¹¦  é­ä¹¦
åŒ—å²  å—å²    å²è®°    å‘¨ä¹¦    å®‹ä¹¦      å¾éœå®¢  æ–°å”ä¹¦    æ—§å”ä¹¦    æ™‹ä¹¦  æ°´ç»æ³¨å…¨  çŸ­ç¯‡ç« å’Œèµ„æ²»é€šé‰´  é‡‘å²  éš‹ä¹¦
</code></pre>
<p>ä¸‹è½½æ•°æ®åå¯ä»¥å…ˆç”¨ <code>head Classical-Modern/source/å²è®°</code> ä¸ <code>head Classical-Modern/target/å²è®°ç¿»è¯‘</code> æŸ¥çœ‹ä¸€ä¸‹è¯­æ–™ï¼š</p>
<pre><code class="language-txt"># å²è®°
å¾Œä¸ºå¤ªå¸¸ï¼Œåæ³•å½“æ­»ï¼Œèµå…ä¸ºåº¶äººã€‚
ä¸Šæ›°ï¼šå‰‘ï¼Œäººä¹‹æ‰€æ–½æ˜“ï¼Œç‹¬è‡³ä»Šä¹ï¼Ÿ
ç„¶ç»ˆä¸è‡ªæ˜ä¹Ÿã€‚
ç„¶äº¦æ— æ‰€æ¯ã€‚

# å²è®°ç¿»è¯‘
å› ä¸ºè§¦çŠ¯æ³•å¾‹åˆ¤å¤„æ­»åˆ‘ï¼Œçº³ç±³ç²Ÿå…¥å®˜èµç½ªåæˆäº†å¹³æ°‘ã€‚
æ™¯å¸è¯´ï¼šå‰‘æ˜¯äººä»¬æ‰€å–œçˆ±ä¹‹ç‰©ï¼Œå¾€å¾€ç”¨æ¥é€äººæˆ–äº¤æ¢ä»–ç‰©ï¼Œéš¾é“ä½ èƒ½ä¿å­˜åˆ°ç°åœ¨å—ï¼Ÿ
è¯´è¿‡åä»–ç»ˆç©¶ä¸å†åšå…¶ä»–è¾©è§£ã€‚
ç„¶åä¹Ÿæ²¡æœ‰è®²åˆ«äººçš„ä»€ä¹ˆåè¯ã€‚
</code></pre>
<p>åŸå§‹è¯­æ–™æ˜¯å°†æ–‡è¨€ç¿»è¯‘ä¸ºç™½è¯ï¼Œå› æ­¤ <code>source</code> ä¸­å­˜å‚¨äº†åŸæ–‡ï¼Œ<code>target</code> ä¸­å­˜å‚¨äº†ç¿»è¯‘ï¼Œæ¯è¡Œä¸€å¥è¯ï¼Œä¸¤ä¸ªæ–‡ä»¶ä¸€ä¸€å¯¹åº”ã€‚æˆ‘ä»¬éœ€è¦é¢„å¤„ç†æ•°æ®ï¼Œå°†æ‰€æœ‰æ–‡æœ¬éƒ½ä½œä¸ºæ•°æ®é›†ã€‚</p>
<pre><code class="language-py">import os

source_root = 'Classical-Modern/source'
target_root = 'Classical-Modern/target'

for f in os.listdir(source_root):
    print("processing " + f)
    source_file = os.path.join(source_root, f)
    target_file = os.path.join(target_root, f + 'ç¿»è¯‘')

    # ç»Ÿè®¡å„æ–‡æœ¬ä¸­è¡Œæ•°
    with open(source_file, "r", encoding="utf-8") as source_f:
        source_len = sum(1 for _ in source_f)
    with open(target_file, "r", encoding="utf-8") as target_f:
        target_len = sum(1 for _ in target_f)

    # å¯¹æ¯”å¹³è¡Œè¯­æ–™è¡Œæ•°ï¼Œç¡®ä¿ä¸€è‡´
    assert source_len == target_len
    try:
        with open('dataset/source_raw.txt', "a+", encoding="utf-8") as source_f:
            source_f.write(open(source_file, "r", encoding="utf-8").read())
        with open('dataset/target_raw.txt', "a+", encoding="utf-8") as target_f:
            target_f.write(open(target_file, "r", encoding="utf-8").read())
    except FileNotFoundError:
        os.mkdir('dataset')
</code></pre>
<p>æ£€æŸ¥ä¸€ä¸‹å¤„ç†çš„ç»“æœï¼š</p>
<pre><code class="language-txt"># dataset/source_raw.txt
å¯†è®¡ä¸è¡Œã€‚
ä½¿è€…åˆ©é‡‘ï¼Œé‚ç›¸è®¸ã€‚
é£è¯´è¯¸å°è´¼ï¼Œæ‰€è‡³è¾„é™ï¼Œè®©å§‹æ•¬ç„‰ï¼Œå¬ä¸è®¡äº‹ã€‚
å®‡æ–‡æ¸©æ¯è°“å¯†æ›°ï¼šä¸æ€å…ƒçœŸï¼Œå…¬éš¾æœªå·²ã€‚

# dataset/target_raw.txt
æå¯†çš„æ„è§æ²¡æœ‰è¢«é‡‡çº³ã€‚
æŠ¼é€çš„äººè´ªå›¾é‡‘é’±ï¼Œä¾¿æ»¡å£ç­”åº”ã€‚
æ´¾äººæ¸¸è¯´å°è‚¡ä¹‰å†›ï¼Œè¢«åŠè¯´çš„äººéƒ½å½’é¡ºäº†ç¿Ÿè®©ï¼Œç¿Ÿè®©å¼€å§‹çœ‹é‡äº†ä»–ï¼Œå«ä»–åŒè‡ªå·±ä¸€èµ·è®¨è®ºé‡å¤§é—®é¢˜ã€‚
å®‡æ–‡æ¸©å¸¸å¯¹æå¯†è¯´ï¼šä¸æ€é‚´å…ƒçœŸï¼Œæ‚¨çš„ç¥¸å®³å°±ä¸ä¼šæ’é™¤ã€‚
</code></pre>
<p>æ¥ä¸‹æ¥è¦å¯¹æ–‡æœ¬åˆ†è¯ï¼Œå¯¹äºæ–‡è¨€æ–‡æ¥è¯´ï¼Œå•å­—è¯çš„å æ¯”éå¸¸é«˜ï¼Œå°†æ¯ä¸ªå•å­—ä½œä¸ºä¸€ä¸ªè¯å°±æ˜¯ä¸€ç§æ¯”è¾ƒæ–¹ä¾¿çš„åˆ†è¯æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªå­—ç¬¦åæ’å…¥ç©ºæ ¼å³å¯ã€‚è€Œç™½è¯æ–‡ä¸­æœ‰å¤§é‡çš„åŒå­—è¯ï¼Œç”šè‡³ä¸‰å­—è¯ã€å››å­—è¯ï¼Œå¿…é¡»ä½¿ç”¨ä¸“é—¨çš„åˆ†è¯å¼•æ“ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº† <a href="http://thulac.thunlp.org/" rel="noopener" target="_blank">THULAC</a>ï¼Œç›´æ¥é€šè¿‡ <code>pip install thualac</code> å°±èƒ½å®‰è£…ã€‚</p>
<pre><code class="language-py">import thulac

# å¯¹æ–‡è¨€æ–‡æœ¬åˆ†è¯
with open('dataset/source_raw.txt', 'r', encoding='utf-8') as f:
    # ç›®æ ‡æ˜¯ ç™½è¯-&gt;æ–‡è¨€ï¼Œå› æ­¤å°†æ–‡è¨€ä½œä¸ºç›®æ ‡ target.txt
    with open('dataset/target.txt', 'w+', encoding='utf-8') as s:
        print("separating wenyan text...")
        while True:
            line = f.readline()
            if line:
                line_seq = " ".join([char for char in line])
                s.write(line_seq)
            else:
                break

# å¯¹ç™½è¯æ–‡æœ¬åˆ†è¯ï¼Œå°†ç™½è¯ä½œä¸ºæºè¯­è¨€ source.txt
print("separating modern text...")
sep_model = thulac.thulac(seg_only=True)
sep_model.cut_f('dataset/target_raw.txt', 'dataset/source.txt')
</code></pre>
<ul>
<li>ä½¿ç”¨ <code>thulac</code> é¦–å…ˆè¦åŠ è½½åˆ†è¯æ¨¡å‹ï¼Œ<code>seg_only</code> æŒ‡å®šåªåˆ†è¯ï¼Œä¸è¾“å‡ºè¯æ€§</li>
<li><code>cut_f(input, output)</code> ç”¨äºå¯¹æ–‡ä»¶ <code>input</code> åˆ†è¯ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>output</code></li>
</ul>
<p><div class="note-info"><p><span><i class="fa-solid fa-note-sticky"></i>&ensp;Note</span>&emsp;ä½¿ç”¨ thulac å¤„ç†æ–‡ä»¶æ—¶ä¸€èˆ¬ä¼šè¾“å‡º <code>UnicodeDecodeError</code> é”™è¯¯ï¼Œä¸»è¦æ˜¯è¯»å–æ–‡ä»¶æ—¶çš„ç¼–ç é”™è¯¯ï¼Œæ˜¯ thulac æœ¬èº«çš„ä¸€ä¸ª bugï¼Œè¯·çœ‹ä¸‹æ–‡çš„è§£å†³æ–¹æ³•<del>ï¼ˆä¹Ÿå¯èƒ½å®˜æ–¹ä¿®å¥½äº†ï¼‰</del>ã€‚</p>
<p>æ‰¾åˆ°é”™è¯¯ä¿¡æ¯ä¸­çš„ <code>site-packages\thulac\__init__.py</code> æ–‡ä»¶ï¼Œç¬¬ 187 è¡Œä¸ç¬¬ 188 è¡Œçš„ä»£ç ä¸º</p>
<pre><code class="language-py">input_f = open(input_file, 'r')
output_f = open(output_file, 'w')
</code></pre>
<p>å°†å…¶ä¿®æ”¹ä¸º</p>
<pre><code class="language-py">input_f = open(input_file, 'r', encoding='utf-8')
output_f = open(output_file, 'w', encoding='utf-8')
</code></pre>
<p></p></div></p>
<p>åŒæ ·å†æ£€æŸ¥ä¸€ä¸‹å¤„ç†çš„ç»“æœï¼š</p>
<pre><code class="language-txt"># dataset/source.txt
æå¯† çš„ æ„è§ æ²¡æœ‰ è¢« é‡‡çº³ ã€‚
æŠ¼é€ çš„ äºº è´ªå›¾ é‡‘é’± ï¼Œ ä¾¿ æ»¡å£ç­”åº” ã€‚
æ´¾ äºº æ¸¸è¯´ å° è‚¡ä¹‰å†› ï¼Œ è¢« åŠè¯´ çš„ äºº éƒ½ å½’é¡º äº† ç¿Ÿè®© ï¼Œ ç¿Ÿè®© å¼€å§‹ çœ‹é‡ äº† ä»– ï¼Œ å« ä»– åŒ è‡ªå·± ä¸€èµ· è®¨è®º é‡å¤§ é—®é¢˜ ã€‚
å®‡æ–‡ æ¸©å¸¸ å¯¹ æå¯† è¯´ ï¼š ä¸ æ€ é‚´å…ƒçœŸ ï¼Œ æ‚¨ çš„ ç¥¸å®³ å°± ä¸ ä¼š æ’é™¤ ã€‚

# dataset/target.txt
å¯† è®¡ ä¸ è¡Œ ã€‚
ä½¿ è€… åˆ© é‡‘ ï¼Œ é‚ ç›¸ è®¸ ã€‚
é£ è¯´ è¯¸ å° è´¼ ï¼Œ æ‰€ è‡³ è¾„ é™ ï¼Œ è®© å§‹ æ•¬ ç„‰ ï¼Œ å¬ ä¸ è®¡ äº‹ ã€‚
å®‡ æ–‡ æ¸© æ¯ è°“ å¯† æ›° ï¼š ä¸ æ€ å…ƒ çœŸ ï¼Œ å…¬ éš¾ æœª å·² ã€‚
</code></pre>
<p>åˆ†è¯ç»“æœè™½ç„¶æœ‰é”™è¯¯ï¼Œä½†æ€»ä½“æ•ˆæœè¿˜å¯ä»¥ï¼Œæœ€åå°†å…¨éƒ¨æ–‡æœ¬åˆ’åˆ†ä¸ºè®­ç»ƒé›†ä¸éªŒè¯é›†ã€‚ç”±äºæ–‡æœ¬æ•°æ®éå¸¸å¤§ï¼Œä¸é€‚åˆè¯»å–åè½¬æ¢ä¸ºåˆ—è¡¨è¿›è¡Œæ“ä½œï¼Œæˆ‘å†™äº†ä¸€ä¸ªåˆ’åˆ† <code>.txt</code> æ–‡æœ¬çš„è„šæœ¬ï¼Œå¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°ï¼Œä»£ç ä¸å¤æ‚ï¼Œå°±ä¸å±•å¼€ä»‹ç»äº†ã€‚åˆ’åˆ†æ•°æ®é›†åçš„æ–‡ä»¶ç»“æ„ä¸ OpenNMT è¦æ±‚çš„æ•°æ®ä¸€è‡´ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚</p>
<pre><code class="language-sh">dataset
&boxvr;&boxh;&boxh; src-train.txt
&boxvr;&boxh;&boxh; src-val.txt
&boxvr;&boxh;&boxh; source.txt
&boxvr;&boxh;&boxh; source_raw.txt
&boxvr;&boxh;&boxh; target.txt
&boxvr;&boxh;&boxh; target_raw.txt
&boxvr;&boxh;&boxh; tgt-train.txt
&boxur;&boxh;&boxh; tgt-val.txt
</code></pre>
<h3 id="gou-jian-ci-ku">æ„å»ºè¯åº“</h3>
<p>åŒæ ·åˆ›å»º <code>.yaml</code> é…ç½®æ–‡ä»¶ï¼Œå†…å®¹ä¸º</p>
<pre><code class="language-yaml"># wenyan.yaml

## Where the samples will be written
save_data: run/wenyan
## Where the vocab(s) will be written
src_vocab: run/wenyan.vocab.src
tgt_vocab: run/wenyan.vocab.tgt
src_vocab_size: 200000
tgt_vocab_size: 200000
overwrite: True

# Corpus opts:
data:
    corpus_1:
        path_src: dataset/src-train.txt
        path_tgt: dataset/tgt-train.txt
    valid:
        path_src: dataset/src-val.txt
        path_tgt: dataset/tgt-val.txt

# Train on a single GPU
world_size: 1
gpu_ranks: [0]
queue_size: 100
bucket_size: 2048

# Train batch
batch_size: 32
# Validation batch
valid_batch_size: 16

# Where to save the checkpoints
save_model: run/model
save_checkpoint_steps: 10000
train_steps: 1000000
valid_steps: 10000
</code></pre>
<ul>
<li><code>queue_size</code> ä¸ºè¯»å–æ•°æ®çš„æ¶ˆæ¯é˜Ÿåˆ—å¤§å°</li>
<li><code>bucket_size</code> ä¸ºè¯»å–æ•°æ®çš„ç¼“å†²åŒºå¤§å°ï¼Œç”¨äºé¿å…æ— æ³•å®æ—¶è¯»å–æ•°æ®</li>
<li><code>batch_size</code> ä¸ºè®­ç»ƒè¿‡ç¨‹ä¸­å¤„ç†çš„æ‰¹å¤§å°</li>
<li><code>valid_batch_size</code> ä¸ºéªŒè¯è¿‡ç¨‹ä¸­å¤„ç†çš„æ‰¹å¤§å°</li>
</ul>
<pre><code class="language-sh">onmt_build_vocab -config wenyan.yaml -n_sample -1
</code></pre>
<p>åŒæ ·ä½¿ç”¨è¯¥å‘½ä»¤å¼€å§‹æ„å»ºè¯åº“ï¼Œå°† <code>-n_sample</code> æŒ‡å®šä¸º <code>-1</code> èƒ½è®©æ¨¡å‹ä½¿ç”¨æ•´ä¸ªæ•°æ®é›†çš„æ•°æ®æ„å»ºè¯åº“ã€‚å¯ä»¥ä½¿ç”¨ <code>head run/wenyan.vocab.src</code> æŸ¥çœ‹ä¸€ä¸‹æ„å»ºçš„è¯åº“ï¼š</p>
<pre><code class="language-txt">ï¼Œ      2041007
ã€‚      920182
çš„      700401
ä¸      279935
ã€      224914
äº†      195770
æ˜¯      176242
ä»–      175822
åœ¨      156216
è¯´      143227
</code></pre>
<h3 id="xun-lian-mo-xing_1">è®­ç»ƒæ¨¡å‹</h3>
<p>ä½¿ç”¨ <code>onmt_train -config wenyan.yaml</code> å¼€å§‹è®­ç»ƒæ¨¡å‹ã€‚</p>
<p>ç”±äºæ•°æ®é›†å¾ˆå¤§ï¼Œè®­ç»ƒæ¨¡å‹éœ€è¦éå¸¸é•¿çš„æ—¶é—´ï¼Œä¸­é€”å¯èƒ½è®­ç»ƒä¸­æ–­æˆ–å¡æ­»ã€‚ç”±äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜äº† <code>checkpoints</code>ï¼Œä¹Ÿä¸éœ€è¦é‡å¤´è®­ç»ƒï¼Œå¯ä»¥ä»ä¿å­˜çš„æ–­ç‚¹ç»§ç»­è®­ç»ƒã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå°†å…¶ä¿å­˜ä¸º <code>train.py</code>ï¼Œå°±å¯ä»¥é€šè¿‡ <code>python train.py</code> è‡ªåŠ¨ç»§ç»­è®­ç»ƒã€‚</p>
<pre><code class="language-py">import os

model_root = 'run/wenyan'
try:
    checkpoints = [x for x in os.listdir(model_root) if x.endswith('.pt')]
except FileNotFoundError:
    os.mkdir(model_root)
    checkpoints = [x for x in os.listdir(model_root) if x.endswith('.pt')]

last_checkpoint = None
if len(checkpoints) &gt; 0:
    checkpoints = sorted(checkpoints, key=lambda x: int(x[:-3].split('_')[-1]))
    last_checkpoint = checkpoints[-1]
    last_checkpoint = os.path.join(model_root, last_checkpoint)

if last_checkpoint is not None:
    print('last_checkpoint', last_checkpoint, os.path.exists(last_checkpoint))
    if isinstance(last_checkpoint, str) and os.path.exists(last_checkpoint):
        # ä¸­æ–­åç»§ç»­è®­ç»ƒä½¿ç”¨
        os.system('onmt_train -config wenyan.yaml --train_from="%s"' % last_checkpoint)
    else:
        os.system('onmt_train -config wenyan.yaml')
else:
    os.system('onmt_train -config wenyan.yaml')
</code></pre>
<p>åœ¨ <code>.yaml</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>log_file</code> å¯ä»¥å°†æ—¥å¿—æ–‡ä»¶ä¿å­˜åˆ°ç›¸åº”ç›®å½•ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰æ·»åŠ ï¼Œç›´æ¥ç”¨ç»ˆç«¯ä¸­çš„è¾“å‡ºæ•°æ®åˆ†æã€‚</p>
<p><div class="lightgallery"><a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8277?authkey=ALYpzW-ZQ_VBXTU" rel="noopener" target="_blank"><img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8277?authkey=ALYpzW-ZQ_VBXTU"/></a></div></p>
<p>ACC å’Œ PPL æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ä¸­å¸¸ç”¨çš„æŒ‡æ ‡ï¼Œå½“ç„¶è¿˜æœ‰æ›´å¥½ç”¨çš„ BELU ç­‰æŒ‡æ ‡ã€‚å¯ä»¥çœ‹å‡ºè®­ç»ƒè¿‡ç¨‹æ”¶æ•›å¾—éå¸¸å¿«ï¼ŒPPL è¿…é€Ÿä¸‹é™ï¼ŒACC ä¹Ÿåœ¨ç¬¬ 20 ä¸ªæ¨¡å‹åä¿æŒç¨³å®šäº†ï¼Œæ£€æŸ¥ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶å‘ç°æœç„¶åœ¨ç¬¬ 23 ä¸ªæ¨¡å‹åå­¦ä¹ ç‡å˜æˆ 0 äº†ã€‚è¿™å°±è¯´æ˜ä¸éœ€è¦æŒ‡å®šé‚£ä¹ˆå¤šçš„è®­ç»ƒæ­¥éª¤ï¼Œé™ä½åˆ° 300000 å¯èƒ½æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚</p>
<h3 id="mo-xing-yu-ce_1">æ¨¡å‹é¢„æµ‹</h3>
<p>é‚£ä¹ˆå°±é€‰æœ€åä¸€ä¸ªæ¨¡å‹ä½œä¸ºæœ€ç»ˆç”¨äºé¢„æµ‹çš„æ¨¡å‹ï¼Œå°†å…¶ä»–æ¨¡å‹å…¨éƒ¨åˆ é™¤ã€‚</p>
<p><div class="note-info"><p><span><i class="fa-solid fa-note-sticky"></i>&ensp;Note</span>&emsp;å¯ä»¥åœ¨ <code>.yaml</code> æ–‡ä»¶ä¸­é€šè¿‡å‚æ•° <code>keep_checkpoint</code> æŒ‡å®šéœ€è¦ä¿å­˜çš„æ¨¡å‹æ•°é‡ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨åˆ å»å¤šä½™çš„æ¨¡å‹ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p></div></p>
<p>åœ¨ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªæ–‡æœ¬ <code>input.txt</code>ï¼Œå†™å…¥éœ€è¦ç¿»è¯‘çš„è¯­å¥ï¼Œæ¯è¡Œä¸€å¥è¯ï¼š</p>
<pre><code class="language-txt">è¿™æ ·çš„äº‹æƒ…æ˜¯å¾ˆéš¾ä»¤äººç›¸ä¿¡çš„ã€‚
ä¼ è¯´è¥¿åŒ—æ–¹æœ‰ä¸€åº§æµ·å²›ï¼Œå±…ä½ç€ç¥ä»™ï¼Œç•™ä¸‹è¿™éƒ¨ä¹¦ã€‚
å¯æƒœè¿™æœ¬ä¹¦çš„å­—å·²ç»çœ‹ä¸æ¸…äº†ã€‚
åæ¥çš‡å¸ä¸‹æ—¨æ‰¾éäº†å¤©ä¸‹å…·æœ‰æ™ºè¯†çš„å„’ç”Ÿã€‚
å‘½ä»¤å¤§è‡£åœ¨å‡ åå¹´é‡Œç¿»éäº†æ‰€æœ‰çš„è—ä¹¦ã€‚
æœ€åç¡®å®šå°é¢ä¸Šå†™ç€ã€Šç®—æ³•ï¼šCè¯­è¨€å®ç°ã€‹ã€‚
</code></pre>
<p><div class="warn-info"><p><span><i class="fa-solid fa-circle-exclamation"></i>&ensp;Warning</span>&emsp;æ¯å¥è¯ä»¥æ¢è¡Œï¼ˆ<code>\n</code>ï¼‰åˆ†éš”ï¼Œæ³¨æ„æœ€åä¸€è¡Œä¸èƒ½æœ‰ç©ºè¡Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p></div></p>
<p>æ¥ç€éœ€è¦å¯¹è¾“å…¥æ–‡æœ¬åˆ†è¯ï¼ŒåŒæ ·ä½¿ç”¨ <code>thulac</code>ï¼Œæ–°å»ºä¸€ä¸ª <code>input_sep.py</code>ï¼š</p>
<pre><code class="language-py">import thulac

sep_model = thulac.thulac(seg_only=True)
sep_model.cut_f('input.txt', 'input_sep.txt')
</code></pre>
<p>è¿è¡Œ <code>python input_sep.py</code> å®Œæˆåˆ†è¯åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹ç¿»è¯‘ï¼š</p>
<pre><code class="language-sh">onmt_translate --model 'run/model_final.pt' --src input_sep.txt --output output.txt
</code></pre>
<p>ä½¿ç”¨ <code>cat output.txt</code> å°±å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†ï¼Œç»“æœéå¸¸ç”Ÿè‰ğŸ¤£</p>
<pre><code class="language-txt">å¦‚ æ­¤ è€… ï¼Œ éš¾ ä¿¡ ä¹Ÿ ã€‚
ä¼  è¥¿ åŒ— æœ‰ ä¸€ æµ· å²› ï¼Œ å±… ç¥ ä»™ ï¼Œ ç•™ æ­¤ ä¹¦ ã€‚
æƒœ æ­¤ ä¹¦ å·² ä¸ æ˜ çŸ£ ã€‚
å è¯ é é å¤© ä¸‹ æœ‰ çŸ¥ å„’ ç”Ÿ ã€‚
å‘½ å¤§ è‡£ æ•° å å¹´ ï¼Œ å°½ æœ‰ ä¹¦ è— ã€‚
æœ€ å å®š ä¸Š ä¹¦ ã€Š æ³• æœ¯ æ³• ã€‹ ã€‚
</code></pre>
<hr/>
<h2 id="references_1">References</h2>
<ul>
<li><a href="https://opennmt.net/OpenNMT-py/main.html" rel="noopener" target="_blank">OpenNMT-py Documentation</a></li>
<li><a href="https://arabelatso.github.io/2021/01/03/OpenNMT-Doc/" rel="noopener" target="_blank">OpenNMT 2.0.0rc1 ä½¿ç”¨æ‰‹å†Œ - Arabela's Blog</a></li>
<li><a href="https://www.bilibili.com/video/BV1NL4y1t73c/" rel="noopener" target="_blank">å¼€æºç¥ç»æœºå™¨ç¿»è¯‘-OpenNMTä½¿ç”¨ä»‹ç» - å“”å“©å“”å“©</a></li>
</ul>
          </section>


          <section class="post-footer" style="margin: 12rem 0 0;">
            <div class="post-share">
              <span class="post-info-label">Share</span>
                <a title="å¤åˆ¶æ–‡ç« é“¾æ¥" aria-label="Share-link" class="share-link"
                  href="#" onclick='copyURL(event, "æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹ - Leoâ€™s blog https://leonis.cc/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html");return false;'>
                  <i class="icon icon-link"
                  aria-hidden="true"></i><span class="hidden">Share-link</span>
                </a>
                <a title="å˜Ÿå˜Ÿåˆ° Mastodon" aria-label="Mastodon" class="mastodon"
                  href="https://tootpick.org/#text=æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹ - Leoâ€™s blog https://leonis.cc/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html" target="_blank" rel="noopener noreferrer">
                  <i class="fa-brands fa-mastodon"
                  aria-hidden="true"></i><span class="hidden">Mastodon</span>
                </a>
                <a title="åˆ†äº«åˆ°å¾®åš" aria-label="Weibo" class="weibo"
                  href="http://service.weibo.com/share/share.php?url=https://leonis.cc/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html&title=æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹&nbsp;-&nbsp;Leoâ€™s blog"
                  target="_blank" rel="noopener noreferrer">
                  <i class="fa-brands fa-weibo"
                  aria-hidden="true"></i><span class="hidden">Weibo</span>
                </a>
                <a title="é€šè¿‡ Email è½¬å‘" aria-label="Email" class="email"
                  href="mailto:?subject=æœºå™¨ç¿»è¯‘æ¡†æ¶ OpenNMT å…¥é—¨ï¼šå¿«é€Ÿä¸Šæ‰‹&amp;body=https://leonis.cc/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html">
                  <i class="icon icon-mail"
                  aria-hidden="true"></i><span class="hidden">Email</span>
                </a>
              <div class="clear"></div>
            </div>

            <aside class="post-tags">
<a href="https://leonis.cc/tag/opennmt.html"># OpenNMT</a><a href="https://leonis.cc/tag/nlp.html"># NLP</a><a href="https://leonis.cc/tag/python.html"># Python</a>            </aside>

            <div class="clear"></div>

            <aside class="post-author">


                <figure class="post-author-avatar">
                  <img src="https://cravatar.cn/avatar/95e31f6808fafa1f8ef3313b6f0b10e6?s=800" alt="Leo" />
                </figure>
                <div class="post-author-bio">
                  <h4 class="post-author-name"><a href="https://leonis.cc/author/leo.html">Leo</a></h4>
                    <p class="post-author-about">A chemist who doesnâ€™t know about classical literature isnâ€™t a good programmer. Cool, huh?</p>
                    <span class="post-author-location">
                      <a rel="noopener" target="_blank" href="https://www.bing.com/maps?cp=39.116572%7E117.361669&lvl=10.1"
                      title="Tientsin">
                      <i class="fa-solid fa-earth-asia fa-fw"></i></a>
                    </span>
                  <!-- Social linkes in alphabet order. -->
                    <span class="post-author-mastodon">
                      <a rel="noopener" target="_blank" href="https://mast.dragon-fly.club/@leonis"
                      title="@leonis@dragon-fly.club">
                        <i class="fa-brands fa-mastodon fa-fw"></i></a>
                    </span>
                    <span class="post-author-github">
                      <a rel="noopener" target="_blank" href="https://github.com/Tseing"
                      title="@Tseing">
                        <i class="fa-brands fa-github fa-fw"></i></a>
                    </span>
                    <span class="post-author-email">
                      <a rel="noopener" target="_blank" href="mailto:im.yczeng@outlook.com"
                      title="im.yczeng@outlook.com">
                        <i class="fa-solid fa-envelope fa-fw"></i></a>
                    </span>
                    <span class="post-author-rss">
                      <a rel="noopener" target="_blank" href="/feed.xml"
                      title="RSS Feed">
                        <i class="fa-solid fa-rss fa-fw"></i></a>
                    </span>
                </div>
                <div class="clear"></div>
            </aside>

          </section>


          <aside class="post-nav">
            <a class="post-nav-next" href="https://leonis.cc/sui-sui-nian/2022-12-18-summary-doi.org/10.1021/acs.jcim.2c00982.html">
              <section class="post-nav-teaser">
                <i class="icon icon-arrow-left"></i>
                  <h2 class="post-nav-title">æ–‡çŒ®æ€»ç»“ï½œDRlinkerï¼šä½¿ç”¨æ·±åº¦å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–è¿æ¥ç‰‡æ®µè®¾è®¡</h2>
                <p class="post-nav-excerpt">æœ¬æ–‡ä»‹ç»äº 2022 å¹´å‘è¡¨åœ¨ Journal of Chemical Information and Modeling ä¸Šçš„ä¸€ç¯‡æ–‡ç« ï¼Œæ–‡ç« åŸæ ‡é¢˜ä¸º DRlinker:...</p>
                <p class="post-nav-meta"><time datetime="2022å¹´ 12æœˆ18æ—¥">2022å¹´ 12æœˆ18æ—¥</time></p>
              </section>
            </a>
            <a class="post-nav-prev" href="https://leonis.cc/sui-sui-nian/2022-12-11-summary-doi.org/10.1186/s13321-020-00441-8.html">
              <section class="post-nav-teaser">
                <i class="icon icon-arrow-right"></i>
                  <h2 class="post-nav-title">æ–‡çŒ®æ€»ç»“ï½œåŸºäºSMILESç”¨äºä»å¤´è¯ç‰©è®¾è®¡çš„æ·±åº¦åˆ†å­éª¨æ¶æ”¹é€ æ¨¡å‹</h2>
                <p class="post-nav-excerpt">æœ¬æ–‡ä»‹ç»äº 2020 å¹´å‘è¡¨åœ¨ Journal of Cheminformatics ä¸Šçš„ä¸€ç¯‡æ–‡ç« ï¼Œæ–‡ç« åŸæ ‡é¢˜ä¸º SMILESâ€‘based deep generative...</p>
                <p class="post-nav-meta"><time datetime="2022å¹´ 12æœˆ11æ—¥">2022å¹´ 12æœˆ11æ—¥</time></p>
              </section>
            </a>
            <div class="clear"></div>
          </aside>

<div id="waline"></div>
        </div>
      </article>
    </main>
    <div class="nav-footer">
      <nav class="nav-wrapper" aria-label="Footer">
        <span class="nav-copy">Leoâ€™s blog &copy; 2024
        </span>
        <span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> &bull; Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> &bull;
          <a class="menu-item js-theme" href="#" data-system="System theme" data-dark="Dark theme" data-light="Light theme">
            <span class="theme-icon"></span><span class="theme-text">System theme</span>
          </a>
        </span>
      </nav>
    </div>

  </section>

  <script src="https://cdnjs.loli.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <!-- code highlight -->
  <script src="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/languages/django.min.js"></script>
  <script src="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/languages/dockerfile.min.js"></script>
  <script src="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/languages/markdown.min.js"></script>
  <script src="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/languages/nginx.min.js"></script>
  <script src="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/languages/pgsql.min.js"></script>
  <script type="text/javascript" src="https://leonis.cc/theme/js/jquery.fitvids.js"></script>
  <script type="text/javascript" src="https://leonis.cc/theme/js/script.js"></script>

  <!-- lightbox -->
  <script type="text/javascript" src="https://leonis.cc/theme/js/lightgallery.min.js"></script>
  <script type="text/javascript" src="https://leonis.cc/theme/js/lg-zoom.min.js"></script>
  <script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
  </script>
    <!-- umami analytics -->
    <script async defer src="https://analytics.umami.is/script.js" data-website-id="b508982a-f7bf-4c24-a948-8de93b0cb81d"></script>


  <!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->

<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    var mdSelector="pre code";
    var rstSelector="pre code";
    var selector=mdSelector;
    // Format code blocks and add line numbers
    function codestyling() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
        // No lines for plain text blocks
        if (!$(this).hasClass('language-text')) {
          var code = $(this);
          // Calculate amount of lines
          var lines = code.html().split(/\n(?!$)/g).length;
          var numbers = [];
          if (lines > 1) {
            lines++;
          }
          for (i = 1; i < lines; i++) {
            numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
          }
          code.parent().append('<div class="lines">' + numbers + '</div>');
        }
      });
    }

    // Format code blocks only
    function codestylingWithoutLineNumbers() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
      });
    }

    codestylingWithoutLineNumbers();
    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });

  Waline.init({
      el: '#waline',
      serverURL: "https://waline-1-d9689975.deta.app/",
      emoji: false,
      search: false,
      imageUploader: false,
      locale: {placeholder: "æ¬¢è¿è¯„è®ºï¼Œå¡«å†™é‚®ç®±å¯ä»¥è·å–å¤´åƒå’Œæ”¶åˆ°å›å¤é€šçŸ¥ï½"},
  });
</script>
</body>

</html>