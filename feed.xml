<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Leo's blog</title><link href="https://tseing.github.io/" rel="alternate"></link><link href="https://tseing.github.io/feed.xml" rel="self"></link><id>https://tseing.github.io/</id><updated>2023-02-04T00:00:00+08:00</updated><subtitle>A nook to hoard my manuscripts.</subtitle><entry><title>文献总结｜匹配分子对以外基于 Transformer 的分子优化</title><link href="https://tseing.github.io/sui-sui-nian/2023-02-04-summary-doi.org/10.1186/s13321-022-00599-3.html" rel="alternate"></link><published>2023-02-04T00:00:00+08:00</published><updated>2023-02-04T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2023-02-04:/sui-sui-nian/2023-02-04-summary-doi.org/10.1186/s13321-022-00599-3.html</id><summary type="html">&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Journal of Cheminformatics&lt;/em&gt; 上的一篇文章，文章原标题为 Transformer‑based molecular optimization beyond matched molecular pairs，目前已经出现许多使用 MMP 的 Transformer 模型，针对这种现状，文章评估了除 MMP 以外其他分子匹配方式对 Transformer 模型表现的影响。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1186/s13321-022-00599-3"&gt;doi.org/10.1186/s13321-022-00599-3&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Journal of Cheminformatics&lt;/em&gt; 上的一篇文章，文章原标题为 Transformer‑based molecular optimization beyond matched molecular pairs，目前已经出现许多使用匹配分子对（matched molecular pairs, MMP）的 Transformer 模型，针对这种现状，文章评估了除 MMP 以外其他分子匹配方式对 Transformer 模型表现的影响。&lt;/p&gt;
&lt;p&gt;尽管 MMP 已经广泛应用在多种分子生成模型中，但 MMP 也存在一定的局限性，例如 MMP 在分子单键处匹配的特点决定了每次只能修改分子中单一部分的结构，这与实际中对分子多部分结构进行改造的方法有所差别。除此以外，化学家改造分子的目的是使其满足一定的性质，目前少有研究关注在模型上以此为目标进行直接的分子优化。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8500?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8500?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;因此文章从分子的结构与性质两个方面考量模型的表现，如图所示，输入序列由性质约束与分子 SMILES 构成，Transformer 生成优化后的分子，评估生成分子是否满足结构与性质两种约束。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="gou-zao-fen-zi-dui"&gt;构造分子对&lt;/h3&gt;
&lt;p&gt;分子的 SMILES 数据来自于 ChEMBL，经过筛选、去重等数据清洗步骤后，需要将以往文献中改造前后的分子组合为分子对，文章使用了 3 种构造分子对的方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;MMP：对比分子的结构，将仅具有单一部分结构差异的两个分子作为分子对，这种方法获取的分子改造仅改变了分子中单一部分。&lt;/li&gt;
&lt;li&gt;谷本相似度：通过摩根指纹计算两个不同分子的谷本相似度，相似度在相应阈值内的两个分子视为分子对，这种方法获取的两个分子可能具有多部分结构差异，文章中使用的阈值包括&lt;/li&gt;
&lt;li&gt;Similarity (&amp;ge;0.5)&lt;/li&gt;
&lt;li&gt;Similarity ([0.5,0.7))&lt;/li&gt;
&lt;li&gt;Similarity (&amp;ge;0.7)&lt;/li&gt;
&lt;li&gt;分子骨架匹配：同一系列分子中，将具有相同分子骨架的两个分子作为分子对，generic scaffold 则是将骨架中的所有原子转化为碳、所有化学键转化为单键后进行行匹配。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="fen-zi-xing-zhi-you-hua"&gt;分子性质优化&lt;/h3&gt;
&lt;p&gt;收集到大量分子改造的分子对后，根据源分子与目标分子间性质的变化定义了不同的性质描述符，例如 &lt;code&gt;LogD_change_(&amp;minus; inf, &amp;minus; 6.9]&lt;/code&gt;、&lt;code&gt;Solubility_highlow&lt;/code&gt; 和 &lt;code&gt;Clearance_no_change&lt;/code&gt; 等，这些描述符放置在原始分子 SMILES 前，通过 Transformer 的 self-attention 机制决定对分子的结构改造。&lt;/p&gt;
&lt;p&gt;对于缺少相关性质数据的分子，文章使用性质预测模型确定性质的变化并指定性质描述符。&lt;/p&gt;
&lt;h3 id="ping-gu-zhi-biao"&gt;评估指标&lt;/h3&gt;
&lt;h4&gt;性质约束&lt;/h4&gt;
&lt;p&gt;满足以下条件的生成分子视作满足性质约束：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class="math"&gt;\(|\log D_\mathrm{generated}-\log D_\mathrm{target}|\leq 0.4\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\mathrm{solubility_{low}}\leq 2.3\ \mathrm{or}\ \mathrm{solubility_{high}}\geq 1.1\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\mathrm{clearance}=1.3\pm0.35\)&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;结构约束&lt;/h4&gt;
&lt;p&gt;若生成分子通过了相应算法（例如 MMP）的检查，则可以认为分子满足了结构约束。&lt;/p&gt;
&lt;h3 id="ji-xian"&gt;基线&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Transformer-U：不具有特征约束的 Transformer 模型。&lt;/li&gt;
&lt;li&gt;Random：从测试集中随机选取 10 个具有相同结构约束的分子。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="jie-guo-yu-tao-lun_1"&gt;结果与讨论&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8501?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8501?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;结果表明，Transformer 具有最好的效果，由于 Transformer-U 没有学习到分子的性质特征，所生成分子中满足性质约束的占比很低。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8502?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8502?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;对比不同分子对算法模型生成分子与训练集的分布，可以发现，在使用谷本相似度的三种模型中，尽管生成分子与训练集的分布吻合程度稍低，但模型生成的满足性质约束的分子并未被结构约束限制住（超出红色范围的淡绿色），这说明使用谷本相似度的模型具有一定探索化学空间的能力。&lt;/p&gt;
&lt;p&gt;使用 MMP、分子骨架的模型中，生成分子与训练集的分布十分吻合，模型学习到了数据特征并在结构约束中生成具有目标性质的分子。对比 MMP 与分子骨架的模型，MMP 模型两种分布的吻合程度更高，对分子的结构改变更小，而分子骨架模型偏向于产生谷本相似度更高的分子。&lt;/p&gt;
&lt;p&gt;结合表中的数据，相比于基于谷本相似度的模型，MMP 和分子骨架模型更容易生成满足结构约束的分子，这是因为于谷本相似度训练集中的分子差异较大，这使得 Transformer 更难获取其中的特征。另一方面，由于分子差异较大，模型更倾向于探索化学空间，能够得到了更多满足性质约束的分子（Similarity (&amp;ge;0.7)），但在探索的化学空间太大时，寻找同时满足性质约束与结构约束的分子就会变得困难，因此较恰当的 Similarity (&amp;ge;0.7) 与 MMP 两组模型表现最好。&lt;/p&gt;
&lt;p&gt;根据分子对匹配方法原理不同，可以将文章中的模型分为 3 类：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;单一部分改造：MMP&lt;/li&gt;
&lt;li&gt;多部分改造但不改变骨架：Scaffold 与 Scaffold generic&lt;/li&gt;
&lt;li&gt;多部分改造且改变骨架：Similarity (&amp;ge;0.5)、Similarity ([0.5,0.7)) 与 Similarity (&amp;ge;0.7)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;从生成分子中也可以看出不同模型的分子改造方式：&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8503?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8503?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8504?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8504?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h2 id="jie-lun"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章评估了包括 MMP 在内的多种分子对匹配方法，虽然 MMP 是目前广泛应用的一种方法，并且在文章的评估中也表现良好，但必须考虑到 MMP 的原理使其对分子做的是单一部分改造，这就会影响分子多样性等指标。在实际应用中，应当根据模型目的考虑多种分子对匹配方法，或者参考该文章的方法评估不同分子对匹配方法对模型表现的影响。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Review"></category></entry><entry><title>文献总结｜Molecular Sets (MOSES)：分子生成模型的评估平台</title><link href="https://tseing.github.io/sui-sui-nian/2023-01-08-summary-doi.org/10.48550/arXiv.1811.12823.html" rel="alternate"></link><published>2023-01-08T00:00:00+08:00</published><updated>2023-01-08T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2023-01-08:/sui-sui-nian/2023-01-08-summary-doi.org/10.48550/arXiv.1811.12823.html</id><summary type="html">&lt;p&gt;本文介绍于 2020 年发布在 arXiv 上的一篇文章，文章原标题为 Molecular Sets (MOSES): A Benchmarking Platform for Molecular Generation Models，文章介绍了目前在评估分子生成模型方面存在的问题，并且设计了用于衡量模型表现的一套标准指标，目前 MOSES 已经广泛应用于各类分子生成任务。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.48550/arXiv.1811.12823"&gt;doi.org/10.48550/arXiv.1811.12823&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2020 年发布在 arXiv 上的一篇文章，文章原标题为 Molecular Sets (MOSES): A Benchmarking Platform for Molecular Generation Models，文章介绍了目前在评估分子生成模型方面存在的问题，并且设计了用于衡量模型表现的一套标准指标，目前 MOSES 已经广泛应用于各类分子生成任务。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8452?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8452?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;随着深度学习技术的发展，也产生了大量分子生成模型，但由于缺乏统一的评估指标，难以对比不同分子生成模型间的表现差异。此外，由于在分子生成模型中需要考虑化合物的的物理性质、生物活性、可合成性等不同方面的约束，不同的评估指标带来了混乱的同时也让模型更难泛化推广。&lt;/p&gt;
&lt;p&gt;文章提供了用于分子生成模型的工具套件 Molecular Sets (MOSES)，其中包括标准数据集、数据预处理工具、评估指标和分子生成模型。&lt;/p&gt;
&lt;h2 id="fen-bu-xue-xi"&gt;分布学习&lt;/h2&gt;
&lt;p&gt;MOSES 主要用于评估基于分布学习的模型，例如，训练集数据 &lt;span class="math"&gt;\(X_\mathrm{tr}=\{x^\mathrm{tr}_1,\cdots,x^\mathrm{tr}_N\}\)&lt;/span&gt; 满足未知的概率分布 &lt;span class="math"&gt;\(p(x)\)&lt;/span&gt;，分布学习模型最终用概率分布 &lt;span class="math"&gt;\(q(x)\)&lt;/span&gt; 逼近 &lt;span class="math"&gt;\(p(x)\)&lt;/span&gt;，从而产生与训练集具有相同特征的数据。&lt;/p&gt;
&lt;p&gt;评估分布学习模型的方法就是计算概率分布 &lt;span class="math"&gt;\(p(x)\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(q(x)\)&lt;/span&gt; 间的差值。对于显式模型而言，可以计算得到 &lt;span class="math"&gt;\(q(x)\)&lt;/span&gt;，通常直接评估概率质量函数。而包括神经网络在内的隐式模型只能从 &lt;span class="math"&gt;\(q(x)\)&lt;/span&gt; 中取样，但无法计算出 &lt;span class="math"&gt;\(q(x)\)&lt;/span&gt;。对于这一类模型，MOSES 主要对其生成数据进行评估。&lt;/p&gt;
&lt;h2 id="ping-gu-zhi-biao"&gt;评估指标&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Valid&lt;/strong&gt; 和 &lt;strong&gt;Unique@k&lt;/strong&gt; 用于评估生成 SMILES 序列的合法性与独特性。使用 RDKit 检查生成分子是否满足 SMILES 规则，合法分子比例即为 Valid，用于确定模型是否学习到化学约束。Unique@k 表示在 k 个合法分子中不同分了比例，用于确定模型是否陷入局部最优点。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Novelty&lt;/strong&gt; 表示生成分子中未出现在训练集中分子的比例，Novelty 较低就意味着模型过拟合。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Filters&lt;/strong&gt; 表示生成分子中通过过滤器的分子比例。在构建训练集时，过滤器用于排除非目标的结构，Filters 用于评估模型是否学习到过滤器约束。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fragment similarity (Frag)&lt;/strong&gt; 用于比较生成分子与测试集分子的片段相似性。首先将分子切割为 BRICS 片段，接着对比片段的余弦相似度：
    &lt;div class="math"&gt;$$
    \mathrm{Frag}(G,R)=\frac{\sum_{f\in F}\left[c_f(G)\cdot c_f(R)\right]}{\sqrt{\sum_{f\in F}c^2_f(G)}\sqrt{\sum_{f\in F}c^2_f(R)}}
    $$&lt;/div&gt;
    其中 &lt;span class="math"&gt;\(c_f(A)\)&lt;/span&gt; 表示片段 &lt;span class="math"&gt;\(f\)&lt;/span&gt; 在数据集 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 中出现的次数，&lt;span class="math"&gt;\(G\)&lt;/span&gt; 表示生成分子，&lt;span class="math"&gt;\(R\)&lt;/span&gt; 表示测试集分子。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Scaffold similarity (Scaff)&lt;/strong&gt; 与片段相似性类似，但是是使用 RDKit 的 Bemis&amp;ndash;Murcko 分子架算法将分子分割为分子骨架，计算分子骨架的相似性：
    &lt;div class="math"&gt;$$
    \mathrm{Scaff}(G,R)=\frac{\sum_{s\in S}\left[c_s(G)\cdot c_s(R)\right]}{\sqrt{\sum_{s\in S}c^2_s(G)}\sqrt{\sum_{s\in S}c^2_s(R)}}
    $$&lt;/div&gt;
    Scaff 用于表示出现在生成分子与测试数据中的分子骨架相似程度。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Similarity to a nearest neighbor (SNN)&lt;/strong&gt; 计算了生成分子 &lt;span class="math"&gt;\(m_G\)&lt;/span&gt; 分子指纹与其在测试数据中最近邻分子 &lt;span class="math"&gt;\(m_R\)&lt;/span&gt; 的来均谷本相似性 &lt;span class="math"&gt;\(T(m_G,m_R)\)&lt;/span&gt;：
    &lt;div class="math"&gt;$$
    \mathrm{SNN}(G,R)=\frac{1}{|G|}\sum_{m_g\in G}\max_{m_R\in R}T(m_G,m_R)
    $$&lt;/div&gt;
    SNN 使用分子的摩根指纹计算生成分子与测试数据中分子的相似程度。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Internal diversity (IntDiv&lt;sub&gt;p&lt;/sub&gt;)&lt;/strong&gt; 在生成分子数据中评估化学多样性：
    &lt;div class="math"&gt;$$
    \mathrm{IntDiv}_p(G)=1-\sqrt[p]{\frac{1}{|G|^2}\sum_{m_1,m_2\in G}T(m_1,m_2)^p}
    $$&lt;/div&gt;
    若 IntDiv&lt;sub&gt;p&lt;/sub&gt; 较小，内部多样性低，表明可能模型发生了模式崩塌。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fr&amp;eacute;chet ChemNet Distance (FCD)&lt;/strong&gt; 定义为
    &lt;div class="math"&gt;$$
    \mathrm{FCD}(G,R)=||\mu_G-\mu_R||^2+\mathrm{Tr}\left[\Sigma_G+\Sigma_R-2(\Sigma_G\Sigma_R)^{1/2}\right]
    $$&lt;/div&gt;
    其中 &lt;span class="math"&gt;\(\mu\)&lt;/span&gt; 是相应数据集的平均向量，&lt;span class="math"&gt;\(\Sigma\)&lt;/span&gt; 是相应的协方差矩阵。FCD 同时考虑了生成分子的化学和生物性质，FCD 也与其他指标相关，主要用于调试模型的超参数，FCD 越小时模型表现越好。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Properties distribution&lt;/strong&gt; 使用 RDKit 计算了分子的分子量、LogP、SA 分数和 QED，生成相应的特征分布（如下图），通过计算生成分子各特征分布与目标特征分布间的 Wasserstein 距离，就够评估模型是否有效学习到了训练集中的特征。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8453?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8453?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h2 id="jie-lun"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章提出了一套评估分布学习模型的标准指标 MOSES，使用相同训练数据训练了目前已经提出多种分子生成模型，利用 MOSES 评估不同分子生成模型，测试结果表明 MOSES 能够全面评估不同分子生成模型表现，发现分子生成任务中存在的问题。MOSES 提供了大量指标满足了分子生成任务的需求，目前是分子生成研究中的标准工具。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Review"></category></entry><entry><title>RDKit 入门：修改分子与搜索子结构</title><link href="https://tseing.github.io/sui-sui-nian/2023-01-03-rdkit-modify-search-molecule.html" rel="alternate"></link><published>2023-01-03T00:00:00+08:00</published><updated>2023-01-03T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2023-01-03:/sui-sui-nian/2023-01-03-rdkit-modify-search-molecule.html</id><summary type="html">&lt;p&gt;介绍使用 RDKit 修改分子以及在分子中搜索 SMARTS 子结构并高亮绘制子结构的方法。&lt;/p&gt;</summary><content type="html">&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="修改分子"&gt;修改分子&lt;a class="anchor-link" href="#修改分子"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[1]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rdkit&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="加氢与去氢"&gt;加氢与去氢&lt;a class="anchor-link" href="#加氢与去氢"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;RDKit 默认隐藏了分子中的氢原子，但在优化分子的 3D 构象时，通常又需要在分子中加氢。实现加氢操作可以使用 &lt;code&gt;AddHs()&lt;/code&gt;，去氢可以使用 &lt;code&gt;RemoveHs()&lt;/code&gt;。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[2]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Cc1ccccc1'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetNumAtoms&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;m2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AddHs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetNumAtoms&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;m3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RemoveHs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetNumAtoms&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;7
15
7
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="凯库勒式的转化"&gt;凯库勒式的转化&lt;a class="anchor-link" href="#凯库勒式的转化"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;RDKit 能将芳环中的化学键以芳香键的形式存储下来，使用 &lt;code&gt;GetBondType()&lt;/code&gt; 查询化学键类型，化学键将显示为 &lt;code&gt;AROMATIC&lt;/code&gt; 类型。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[3]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Cc1ccccc1'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondType&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[3]:&lt;/div&gt;
&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;rdkit.Chem.rdchem.BondType.AROMATIC&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;使用 &lt;code&gt;Kekulize()&lt;/code&gt; 可以将分子转化为凯库勒式，那么芳香键就会表示为单键或双键形式。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[4]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Kekulize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondType&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondType&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;DOUBLE
SINGLE
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;虽然显示为单键与双键，使用 &lt;code&gt;GetIsAromatic()&lt;/code&gt; 查询化学键是否具有芳香性，可以发现化学键仍具有芳香性，这与化学定义一致。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[5]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetIsAromatic&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[5]:&lt;/div&gt;
&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;True&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;若要将分子转化为凯库勒式的同时去除分子化学键的芳香性，可以使用 &lt;code&gt;Kekulize(clearAromaticFlags=True)&lt;/code&gt; 修改分子，分子中的芳香键标记就会被去除。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[6]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Kekulize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clearAromaticFlags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetIsAromatic&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[6]:&lt;/div&gt;
&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;False&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;使用 &lt;code&gt;SanitizeMol()&lt;/code&gt; 可以将凯库勒式形式的分子转化为原始形式，化学键类型也将以芳香键标记。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[7]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SanitizeMol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondType&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondType&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;AROMATIC
AROMATIC
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="Atom-类与-Bond-类"&gt;Atom 类与 Bond 类&lt;a class="anchor-link" href="#Atom-类与-Bond-类"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;RDKit &lt;code&gt;Chem.rdchem&lt;/code&gt; 模块中定义了 &lt;code&gt;Atom&lt;/code&gt; 类与 &lt;code&gt;Bond&lt;/code&gt; 类，其中以 Get 为前缀的方法是查询相应的属性，而以 Set 为前缀的方法就是修改分子的原子和化学键，以下列举了一部分修改操作。&lt;/p&gt;
&lt;h4 id="Atom-类"&gt;Atom 类&lt;a class="anchor-link" href="#Atom-类"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SetAtomicNum(int)&lt;/code&gt;：通过原子序数改变指定原子。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetChiralTag(Chem.rdchem.ChiralType)&lt;/code&gt;：设定指定原子的手性。例如&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Chem.rdchem.ChiralType.CHI_TETRAHEDRAL_CCW&lt;/code&gt; 为 S 构型；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Chem.rdchem.ChiralType.CHI_TETRAHEDRAL_CW&lt;/code&gt; 为 R 构型。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetFormalCharge(int)&lt;/code&gt;：设定原子携带电荷数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetHybridization(Chem.rdchem.HybridizationType)&lt;/code&gt;：设定原子杂化类型。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetIsAromatic(bool)&lt;/code&gt;：设定原子是否具有芳香性。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetIsotope(int)&lt;/code&gt;：设定原子的同位素。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetNoImplicit(bool)&lt;/code&gt;：设定原子是否带隐式氢。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetNumExplicitHs(int)&lt;/code&gt;：设定原子固定显示氢的数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetNumRadicalElectrons(int)&lt;/code&gt;：设定指定原子未成对电子数量。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[8]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'OC(N)C'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetAtomWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetAtomicNum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetAtomWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetChiralTag&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rdchem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ChiralType&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CHI_TETRAHEDRAL_CW&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetAtomWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetIsotope&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetAtomWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetFormalCharge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[8]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;在修改分子后通常还需要检查步骤，避免出错，还可以输出修改后分子的 SMILES。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[9]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SanitizeMol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[9]:&lt;/div&gt;
&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;'N[7C@H]([OH2+])S'&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h4 id="Bond-类"&gt;Bond 类&lt;a class="anchor-link" href="#Bond-类"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SetBondDir(Chem.rdchem.BondDir)&lt;/code&gt;：设定化学键显示形式。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetBondType(Chem.rdchem.BondType)&lt;/code&gt;：设定化学键类型。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetIsAromatic(bool)&lt;/code&gt;：设定化学键是否为芳香键。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetIsConjugated(bool)&lt;/code&gt;：设定化学键是否共轭。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SetStereo(Chem.rdchem.BondStereo)&lt;/code&gt;：设定双键的几何构型，例如&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Chem.rdchem.BondStereo.STEREOCIS&lt;/code&gt; 为 cis 构型；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Chem.rdchem.BondStereo.STEREOTRANS&lt;/code&gt; 为 trans 构型。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[10]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'N[7C@H]([OH2+])S'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetBondType&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rdchem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BondType&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DOUBLE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[10]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="RWMol-类"&gt;RWMol 类&lt;a class="anchor-link" href="#RWMol-类"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;RDKit 的 &lt;code&gt;Chem.rdchem.RWMol&lt;/code&gt; 类用于读取与写入分子，定义了更复杂的修改分子的功能，用于修改分子的操作包括&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;AddAtom(atom)&lt;/code&gt;：在分子中添加原子。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;AddBond(beginAtomIdx, endAtomIdx)&lt;/code&gt;：在指定的始末位置间添加化学键。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;InsertMol(mol)&lt;/code&gt;：在分子中添加现成分子。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RemoveAtom(int)&lt;/code&gt;：移除分子中指定位置的原子。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RemoveBond(int, int)&lt;/code&gt;：移除分子中指定始末位置间的化学键。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ReplaceAtom(index, atom)&lt;/code&gt;：使用指定原子替换索引位置上的原子。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ReplaceBond(index, bond)&lt;/code&gt;：使用指定化学键替换索引位置上的化学键。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;使用 RWMol 中修改分子的操作，首先要创建 &lt;code&gt;RWMol&lt;/code&gt; 类。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[11]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'CC(=O)C=CC=C'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mw&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RWMol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mw&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[11]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;使用 &lt;code&gt;AddAtom()&lt;/code&gt;添加原子后，所添加的原子不会与原来分子相连，通常需要搭配 &lt;code&gt;AddBond()&lt;/code&gt; 方法。使用 &lt;code&gt;AddBond()&lt;/code&gt; 添加化学键时，还可以设定参数 &lt;code&gt;order&lt;/code&gt;，设置为 &lt;code&gt;Chem.rdchem.BondType&lt;/code&gt; 类型，可以指定化学键类型。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[12]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AddAtom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AddBond&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rdchem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BondType&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;UNSPECIFIED&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mw&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[12]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;与 &lt;code&gt;Atom&lt;/code&gt; 类不同，由于在 Python 中无法实例化 &lt;code&gt;Bond&lt;/code&gt; 类，必须通过 &lt;code&gt;GetBonds()&lt;/code&gt; 等方法从分子其他部分复制化学键后再用于替换。&lt;code&gt;ReplaceBond()&lt;/code&gt; 中需要指定化学键的索引，可以通过以下方式得到。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[13]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ReplaceAtom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ReplaceBond&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondBetweenAtoms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetIdx&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondBetweenAtoms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;mw&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[13]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;其他操作也大同小异，需要注意在原始分子中增删原子后，可能导致原子索引发生变化。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[14]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;InsertMol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'OC(N)C'&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;mw&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[14]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;修改完成后，需要将 &lt;code&gt;RWMol&lt;/code&gt; 类转换为 &lt;code&gt;Mol&lt;/code&gt; 对象。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[15]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m_edit&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetMol&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m_edit&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[15]:&lt;/div&gt;
&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;rdkit.Chem.rdchem.Mol&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="搜索子结构_1"&gt;搜索子结构&lt;a class="anchor-link" href="#搜索子结构"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;&lt;h3 id="搜索单个分子"&gt;搜索单个分子&lt;a class="anchor-link" href="#搜索单个分子"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HasSubstructMatch(pattern)&lt;/code&gt;：指定分子结构中是否具有 pattern 目标结构。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;GetSubstructMatch(pattern)&lt;/code&gt;：给出分子中 pattern 目标结构的原子索引。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;GetSubstructMatches(pattern)&lt;/code&gt;：给出分子中所有 pattern 目标结构的原子索引。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在搜索子结构时，即使在 pattern 中具有立体化学标记，也不考虑分子立体化学的匹配。若要考虑立体化学，需要指定参数 &lt;code&gt;useChirality=True&lt;/code&gt;。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[16]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rdkit.Chem.Draw&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;IPython.display&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SVG&lt;/span&gt;


&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'c1ccccc1O'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;patt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmarts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'ccO'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DSVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;do&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;drawOptions&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;addAtomIndices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DrawMolecule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;SVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetDrawingText&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[16]:&lt;/div&gt;
&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg baseprofile="full" height="150px" version="1.1" viewbox="0 0 450 150" width="450px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
&lt;!-- END OF HEADER --&gt;
&lt;rect height="150.0" style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" x="0.0" y="0.0"&gt; &lt;/rect&gt;
&lt;path class="bond-0 atom-0 atom-1" d="M 220.0,129.5 L 157.1,129.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-0 atom-1" d="M 210.6,116.9 L 166.5,116.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 157.1,129.5 L 125.6,74.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-2 atom-3" d="M 125.6,74.9 L 157.1,20.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-2 atom-3" d="M 141.2,73.1 L 163.3,34.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 157.1,20.4 L 220.0,20.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 220.0,20.4 L 251.5,74.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 213.9,34.9 L 235.9,73.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 251.5,74.9 L 277.9,74.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 277.9,74.9 L 304.2,74.9" style="fill:none;fill-rule:evenodd;stroke:#FF0000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-6 atom-5 atom-0" d="M 251.5,74.9 L 220.0,129.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="atom-6" d="M 306.3 75.0 Q 306.3 70.7, 308.4 68.3 Q 310.6 65.9, 314.5 65.9 Q 318.5 65.9, 320.6 68.3 Q 322.7 70.7, 322.7 75.0 Q 322.7 79.3, 320.5 81.8 Q 318.4 84.2, 314.5 84.2 Q 310.6 84.2, 308.4 81.8 Q 306.3 79.4, 306.3 75.0 M 314.5 82.2 Q 317.2 82.2, 318.7 80.4 Q 320.2 78.6, 320.2 75.0 Q 320.2 71.5, 318.7 69.7 Q 317.2 67.9, 314.5 67.9 Q 311.8 67.9, 310.3 69.7 Q 308.8 71.5, 308.8 75.0 Q 308.8 78.6, 310.3 80.4 Q 311.8 82.2, 314.5 82.2 " fill="#FF0000"&gt;&lt;/path&gt;
&lt;path class="atom-6" d="M 324.0 66.1 L 326.4 66.1 L 326.4 73.7 L 335.5 73.7 L 335.5 66.1 L 337.9 66.1 L 337.9 84.0 L 335.5 84.0 L 335.5 75.7 L 326.4 75.7 L 326.4 84.0 L 324.0 84.0 L 324.0 66.1 " fill="#FF0000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 225.3 143.2 Q 223.7 143.2, 222.8 142.0 Q 222.0 140.8, 222.0 138.6 Q 222.0 136.5, 222.8 135.3 Q 223.6 134.1, 225.3 134.1 Q 226.9 134.1, 227.8 135.3 Q 228.6 136.5, 228.6 138.6 Q 228.6 140.8, 227.7 142.0 Q 226.9 143.2, 225.3 143.2 M 225.3 142.2 Q 226.3 142.2, 226.8 141.3 Q 227.3 140.4, 227.3 138.6 Q 227.3 136.9, 226.8 136.0 Q 226.3 135.1, 225.3 135.1 Q 224.3 135.1, 223.8 136.0 Q 223.3 136.9, 223.3 138.6 Q 223.3 140.4, 223.8 141.3 Q 224.3 142.2, 225.3 142.2 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 149.6 142.0 L 151.6 142.0 L 151.6 135.4 L 149.4 136.1 L 149.1 135.3 L 151.9 134.1 L 152.8 134.2 L 152.8 142.0 L 154.5 142.0 L 154.5 143.1 L 149.6 143.1 L 149.6 142.0 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 112.1 72.2 Q 112.4 71.4, 113.2 70.9 Q 114.0 70.4, 115.1 70.4 Q 116.4 70.4, 117.2 71.2 Q 118.0 71.9, 118.0 73.2 Q 118.0 74.5, 117.0 75.8 Q 116.0 77.0, 114.0 78.5 L 118.1 78.5 L 118.1 79.5 L 112.1 79.5 L 112.1 78.6 Q 113.8 77.4, 114.7 76.5 Q 115.7 75.7, 116.2 74.9 Q 116.7 74.1, 116.7 73.3 Q 116.7 72.4, 116.3 71.9 Q 115.8 71.4, 115.1 71.4 Q 114.4 71.4, 113.9 71.7 Q 113.4 72.0, 113.1 72.7 L 112.1 72.2 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 153.1 11.1 Q 154.0 11.4, 154.4 12.0 Q 154.8 12.5, 154.8 13.4 Q 154.8 14.1, 154.5 14.7 Q 154.1 15.3, 153.4 15.6 Q 152.7 16.0, 151.8 16.0 Q 150.8 16.0, 150.1 15.6 Q 149.4 15.3, 148.8 14.6 L 149.6 13.9 Q 150.1 14.5, 150.6 14.7 Q 151.0 15.0, 151.8 15.0 Q 152.6 15.0, 153.1 14.5 Q 153.6 14.1, 153.6 13.4 Q 153.6 12.5, 153.1 12.1 Q 152.5 11.7, 151.5 11.7 L 150.8 11.7 L 150.8 10.7 L 151.4 10.7 Q 152.3 10.7, 152.9 10.3 Q 153.4 9.9, 153.4 9.1 Q 153.4 8.5, 153.0 8.2 Q 152.5 7.8, 151.8 7.8 Q 151.1 7.8, 150.6 8.1 Q 150.1 8.4, 149.8 9.0 L 148.9 8.6 Q 149.2 7.8, 150.0 7.3 Q 150.7 6.8, 151.8 6.8 Q 153.1 6.8, 153.9 7.4 Q 154.6 8.1, 154.6 9.1 Q 154.6 9.8, 154.2 10.3 Q 153.9 10.8, 153.1 11.1 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 227.7 12.7 L 228.7 12.7 L 228.7 13.7 L 227.7 13.7 L 227.7 15.8 L 226.5 15.8 L 226.5 13.7 L 221.9 13.7 L 221.9 12.9 L 225.8 6.9 L 227.7 6.9 L 227.7 12.7 M 223.3 12.7 L 226.5 12.7 L 226.5 7.7 L 223.3 12.7 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 257.0 64.7 Q 257.8 64.7, 258.4 65.1 Q 259.1 65.4, 259.4 66.0 Q 259.8 66.7, 259.8 67.5 Q 259.8 68.4, 259.3 69.1 Q 258.9 69.7, 258.2 70.1 Q 257.4 70.4, 256.6 70.4 Q 255.8 70.4, 255.0 70.1 Q 254.3 69.8, 253.8 69.2 L 254.5 68.5 Q 254.9 68.9, 255.5 69.2 Q 256.1 69.4, 256.6 69.4 Q 257.4 69.4, 258.0 68.9 Q 258.5 68.4, 258.5 67.5 Q 258.5 66.6, 258.0 66.1 Q 257.4 65.7, 256.6 65.7 Q 255.8 65.7, 254.9 66.0 L 254.2 65.7 L 254.7 61.4 L 259.2 61.4 L 259.1 62.4 L 255.7 62.4 L 255.4 65.1 Q 256.2 64.7, 257.0 64.7 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 325.4 92.1 Q 326.2 92.1, 326.8 92.4 Q 327.4 92.7, 327.8 93.4 Q 328.1 94.0, 328.1 94.8 Q 328.1 95.6, 327.7 96.3 Q 327.3 97.0, 326.6 97.4 Q 326.0 97.7, 325.1 97.7 Q 323.5 97.7, 322.7 96.7 Q 321.9 95.6, 321.9 93.4 Q 321.9 91.1, 322.9 89.9 Q 323.9 88.6, 325.8 88.6 Q 326.3 88.6, 326.8 88.7 Q 327.3 88.9, 327.7 89.1 L 327.2 90.0 Q 326.6 89.6, 325.8 89.6 Q 324.5 89.6, 323.9 90.4 Q 323.3 91.3, 323.2 92.9 Q 323.6 92.5, 324.2 92.3 Q 324.8 92.1, 325.4 92.1 M 325.1 96.7 Q 325.6 96.7, 326.0 96.5 Q 326.4 96.2, 326.6 95.8 Q 326.8 95.3, 326.8 94.8 Q 326.8 94.0, 326.4 93.5 Q 326.0 93.1, 325.2 93.1 Q 324.6 93.1, 324.1 93.3 Q 323.6 93.5, 323.2 93.9 Q 323.2 95.4, 323.7 96.0 Q 324.2 96.7, 325.1 96.7 " fill="#000000"&gt;&lt;/path&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[17]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HasSubstructMatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;patt&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetSubstructMatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;patt&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetSubstructMatches&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;patt&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;True
(0, 5, 6)
((0, 5, 6), (4, 5, 6))
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;也可以通过 &lt;code&gt;MolFragmentToSmiles()&lt;/code&gt; 输出匹配子结构的 SMILES。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[18]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFragmentToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;atomsToUse&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetSubstructMatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;patt&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;rootedAtAtom&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;ccO
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="搜索多个分子"&gt;搜索多个分子&lt;a class="anchor-link" href="#搜索多个分子"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;利用 &lt;code&gt;HasSubstructMatch()&lt;/code&gt; 的特性，可以轻松地搜索多个分子并将相应分子加入列表。pattern 子结构也可以使用 SMILES 表示，但 SMILES 的功能较 SMARTS 有限，许多结构无法表示出来。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[19]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;patt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'c1ccccc1'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SDMolSupplier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./mols.sdf"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;suppl&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;matches&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;suppl&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HasSubstructMatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;patt&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;matches&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[19]:&lt;/div&gt;
&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;1&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="为子结构着色"&gt;为子结构着色&lt;a class="anchor-link" href="#为子结构着色"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;由于 &lt;code&gt;GetSubstructMatch()&lt;/code&gt; 得到的是原子索引，还需要迭代获取子匹配子结构的化学键索引。首先通过 &lt;code&gt;patt.GetBonds()&lt;/code&gt; 遍历子结构中的化学键，再通过 &lt;code&gt;hit_atom&lt;/code&gt; 将化学键首末端原子映射为完整分子中的索引。因为 &lt;code&gt;hit_atom&lt;/code&gt; 是元组，元组中元素的位置即子结构中的索引，而元素的值就是完整分子中的索引，所以可以像字典一样使用。再通过 &lt;code&gt;GetBondBetweenAtoms(begin, end)&lt;/code&gt; 获取首末原子间的化学键，使用 &lt;code&gt;GetIdx()&lt;/code&gt; 获筛键索引，即可高亮绘制出子结构。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[20]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rdkit.Chem&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Draw&lt;/span&gt;


&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Cc1cccc(C)c1C(C)=NC'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;patt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmarts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s1"&gt;'[cH0:1][c:2]([cH0])!@[CX3!r:3]=[NX2!r:4]'&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;hit_atom&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetSubstructMatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;patt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;hit_bond&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;bond&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;patt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBonds&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;begin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hit_atom&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bond&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBeginAtomIdx&lt;/span&gt;&lt;span class="p"&gt;()]&lt;/span&gt;
    &lt;span class="n"&gt;end&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hit_atom&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;bond&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetEndAtomIdx&lt;/span&gt;&lt;span class="p"&gt;()]&lt;/span&gt;
    &lt;span class="n"&gt;hit_bond&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondBetweenAtoms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;begin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetIdx&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

&lt;span class="n"&gt;Draw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToImage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;highlightAtoms&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;hit_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;highlightBonds&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;hit_bond&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[20]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;hr/&gt;
&lt;h2 id="Reference_1"&gt;Reference&lt;a class="anchor-link" href="#Reference"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.rdkit.org/docs/GettingStartedInPython.html"&gt;Getting Started with the RDKit in Python - RDKit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/dreadlesss/rdkit_summary/blob/master/modifying_molecules.ipynb"&gt;@dreadlesss/rdkit_summary/modifying_molecules - Github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/dreadlesss/rdkit_summary/blob/master/substructure_search_and_highlight.ipynb"&gt;@dreadlesss/rdkit_summary/substructure_search_and_highlight - Github&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;
</content><category term="碎碎念"></category><category term="RDKit"></category><category term="Python"></category></entry><entry><title>文献总结｜从头药物设计和生成模型</title><link href="https://tseing.github.io/sui-sui-nian/2022-12-25-summary-doi.org/10.1016/j.drudis.2021.05.019.html" rel="alternate"></link><published>2022-12-25T00:00:00+08:00</published><updated>2022-12-25T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-12-25:/sui-sui-nian/2022-12-25-summary-doi.org/10.1016/j.drudis.2021.05.019.html</id><summary type="html">&lt;p&gt;本文介绍于 2021 年发表在 Drug Discovery Today 上的一篇综述，文章原标题为 De novo molecular design and generative models，文章综述了分子生成模型在药物分子设计中的应用，特别介绍了用于从头药物设计的不同分子生成方法以及未来的前景。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1016/j.drudis.2021.05.019"&gt;doi.org/10.1016/j.drudis.2021.05.019&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2021 年发表在 &lt;em&gt;Drug Discovery Today&lt;/em&gt; 上的一篇综述，文章原标题为 De novo molecular design and generative models，文章综述了分子生成模型在药物分子设计中的应用，特别介绍了用于从头药物设计的不同分子生成方法以及未来的前景。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8417?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8417?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;传统的虚拟筛选方法是对已经获得到化学分子进行评估，确定具有活性的分子。而分子生成的目标与此不同，分子生成是需要在从头药物设计中生成用于虚拟筛选的化学结构。&lt;/p&gt;
&lt;p&gt;在化学空间中分散着大量的目标分子，分子生成模型需要利用算法通过化学空间，在具有最优目标特征的目标化学空间上生成需要的化学结构。由于在化学空间中具有许多目标化学空间，分子生成模型的一个关键问题就是如何去平衡探索更多化学空间而生成更多新分子和利用已有的局部最优化学空间。&lt;/p&gt;
&lt;h2 id="ping-gu-zhi-biao"&gt;评估指标&lt;/h2&gt;
&lt;p&gt;分子生成模型常常使用优化分子的特定性质作为生成任务的目标，例如优化分子的类药性（QED）和脂水分配系数等，但这样的指标不能用于全面评估分子生成的结果。针对于分子生成任务，目前有两种标准的评估指标：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Molecular Sets（MOSES）评估：用于评估生成分子的分布以及合法性、独特性、分子片段多样性等，可以用于将生成分子的化学空间与已知化学空间进行对比，适用于多种分子生成任务；&lt;/li&gt;
&lt;li&gt;GuacaMol 评估：除了具有针对生成分子分布的评估，还可以用于评估目标导向的分子生成任务。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="fen-zi-miao-shu-yu-sheng-cheng"&gt;分子描述与生成&lt;/h2&gt;
&lt;p&gt;分子生成任务中的分子通常可以以 SMILES 和基于图的表示两种类型方式描述。SMILES 将分子描述为文本序列，虽然有利于使用自然语言处理中的许多方法进行处理，但将分子转化为文本序列时丢失了许多几何信息，而且使用 SMILES 数据训练模型时，生成模型还学习到了 SMILES 语法和语义这一类信息，而没有学习到更为基本的分子结构信息。基于图的分子描述形式在本质上更接近分子的化学结构，但处理这种描述形式的分子需要更大算法且处理方法有限。&lt;/p&gt;
&lt;p&gt;除上述分子描述形式的不同，分子生成的方法还可以细分为基于原子、基于片段和基于反应三种形式。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8418?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8418?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="ji-yu-yuan-zi"&gt;基于原子&lt;/h3&gt;
&lt;p&gt;基于原子的生成方法逐个原子生成分子，除了 SMILES 语法等约束以外几乎没有额外的分子知识，是一种较为简单的分子生成方法。&lt;/p&gt;
&lt;p&gt;例如在遗传算法中，可以交叉两种分子中的若干个原子生成新分子。或是在 RNN 中，通过模型训练过程中学习到的权重，指定原子后得到后续原子，再将后续原子作为输入，直至生成整个分子。由于这种方法是通过学习隐藏的特征生成分子，随机性很大，常常会使用强化学习的方法使生成分子更有专一性。&lt;/p&gt;
&lt;h3 id="ji-yu-pian-duan"&gt;基于片段&lt;/h3&gt;
&lt;p&gt;使用一定的规则将分子分割为分子片段，基于片段的分子生成将分子视作片段的集合，这种方法在探索化学空间时利用了分子片段的约束，能够更好地保留训练数据中的子结构。&lt;/p&gt;
&lt;p&gt;例如在遗传算法或 RNN 模型中，模型生成分子的原理没有改变，但遗传算法在交叉两种分子时交叉的是属于某片段的若干原子，RNN 模型除了具有基于原子方法中的权重以外，还学习到了通过片段结构组织若干原子的权重，在获取分子特征上更具优势。&lt;/p&gt;
&lt;h3 id="ji-yu-fan-ying"&gt;基于反应&lt;/h3&gt;
&lt;p&gt;基于反应的分子生成是一种基于规则的方法，基于数据库数据或是使用逆合成模型，将分子拆分为化学反应片段，将其作为训练数据。&lt;/p&gt;
&lt;p&gt;在分子生成过程中，模型以不具有目标分子性质但可获得的反应物为原料，通过多步的化学反应最终得到目标分子。这种模型通常使用强化学习的方法，实现目标优化，在分子可合成性的表现很好。但这种模型的一大缺陷在于需要人工制定反应模版，这大大限制了其应用。&lt;/p&gt;
&lt;h2 id="tiao-zhan-yu-qian-jing_1"&gt;挑战与前景&lt;/h2&gt;
&lt;p&gt;药物化学中常用的设计策略是固定分子的特定结构不变，对分子结构进行改造，这有利于研究分子的构效关系，这种设计策略在分子生成任务中可以理解为在局部最优化学空间附近进行探索。&lt;/p&gt;
&lt;p&gt;在分子生成中实现这种分子改造，目前采取的两种思路是基于分子的知识改造分子和生成大量分子后过滤掉具有非目标结构的分子。相比之下，前一种方式更具有效率而且能生成更符合目标的分子，是目前研究的方向。基于图的分子描述形式能够更直接地学习到所需要的分子知识，文本形式的分子描述需要更好地提取出这种分子知识。&lt;/p&gt;
&lt;p&gt;分子生成的结果不能以单一指标衡量，药物分子的设计也不能只考虑单一特征，分子生成通常是多目标优化的任务。但实际中分子生成模型针对于多目标任务的表现并不好，这主要是由于针对这种多目标优化任务与药物成药性还有一定偏差。所以尽管有些模型在数值上表现更好，但无法真正用于药物设计，研究新的评估指标是解决这一问题的重要方向。&lt;/p&gt;
&lt;p&gt;文章还提出了以下几个未来重要研究方向：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;继续改进目前的模型，通过算法上的改进提高生成目标分子的成功率；&lt;/li&gt;
&lt;li&gt;发展专门的生成模型，例如针对于 3D 蛋白结合位点 3D 空间匹配的模型；&lt;/li&gt;
&lt;li&gt;研究可解释性的模型，用于分子生成的深度学习模型仍被视为黑箱，药物化学家需要通过可解释性模型给出的知识指导药物设计。&lt;/li&gt;
&lt;/ol&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Review"></category></entry><entry><title>CS224n 自然语言处理第一节：简介与词向量</title><link href="https://tseing.github.io/sui-sui-nian/2022-12-21-cs224n-lecture1.html" rel="alternate"></link><published>2022-12-21T00:00:00+08:00</published><updated>2022-12-21T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-12-21:/sui-sui-nian/2022-12-21-cs224n-lecture1.html</id><summary type="html">&lt;p&gt;CS224n Lecture 1: Introduction and Word Vectors&lt;/p&gt;</summary><content type="html">&lt;h2 id="one-hot-bian-ma"&gt;one-hot 编码&lt;/h2&gt;
&lt;p&gt;在传统 NLP 中，词可以使用 one-hot 向量表示，&lt;strong&gt;one-hot&lt;/strong&gt; 指向量中只有一个 1，其余都是 0。例如词库为向量&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{vocab}=[\mathrm{hotel\ conference\ motel}]$$&lt;/div&gt;
&lt;p&gt;那么单词的 one-hot 向量就是&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{motel}=[0\ 0\ 1]$$&lt;/div&gt;
&lt;div class="math"&gt;$$\mathrm{hotel}=[1\ 0\ 0]$$&lt;/div&gt;
&lt;p&gt;这样得到不同词向量是&lt;strong&gt;正交&lt;/strong&gt;的，无法判断词之间的相似性。&lt;/p&gt;
&lt;h2 id="word2vec"&gt;word2vec&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;分布式语义&lt;/strong&gt;（distributional semantics）：一个词的语义由最常出现的邻近词决定。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;分布式语义是 NLP 中的一个基本概念，基于这个假设，我们可以通过上下文来表示指定的词，得到的词向量又称为&lt;strong&gt;词嵌入&lt;/strong&gt;（word embeddings）。&lt;/p&gt;
&lt;p&gt;word2vec 是基于分布式语义得到词向量的一种重要方法，其基本设想是&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;拥有一个较大的语料数据库&lt;/li&gt;
&lt;li&gt;文本中的每一个词都能通过向量表示&lt;/li&gt;
&lt;li&gt;在文本中的位置 &lt;span class="math"&gt;\(t\)&lt;/span&gt; 上，有中心词 &lt;span class="math"&gt;\(c\)&lt;/span&gt; 和上下文词 &lt;span class="math"&gt;\(o\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;使用 &lt;span class="math"&gt;\(c\)&lt;/span&gt; 和 &lt;span class="math"&gt;\(o\)&lt;/span&gt; 的词向量相似性计算给定 &lt;span class="math"&gt;\(c\)&lt;/span&gt; 时 &lt;span class="math"&gt;\(o\)&lt;/span&gt; 的概率&lt;/li&gt;
&lt;li&gt;不断调整词向量直至&lt;dot&gt;最大化&lt;/dot&gt;该概率（最大似然法）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8285?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8285?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;在文本中的位置 &lt;span class="math"&gt;\(t=1,\cdots,T\)&lt;/span&gt; 上，对中心词 &lt;span class="math"&gt;\(w_j\)&lt;/span&gt; 固定窗口大小为 &lt;span class="math"&gt;\(m\)&lt;/span&gt;，那么文本数据的似然为&lt;/p&gt;
&lt;div class="math"&gt;$$L(\theta)=\prod^T_{t=1}\prod_{\substack{-m\leq j\leq m\\j\neq0}}P(w_{t+j}|w_t;\theta)$$&lt;/div&gt;
&lt;p&gt;最大似然的目标就是 &lt;span class="math"&gt;\(\max L(\theta)\)&lt;/span&gt;，在这里取负对数将其转化为&lt;/p&gt;
&lt;div class="math"&gt;$$J(\theta)=-\frac{1}{T}\log L(\theta)=-\frac{1}{T}\prod^T_{t=1}\prod_{\substack{-m\leq j\leq m\\j\neq0}}P(w_{t+j}|w_t;\theta)$$&lt;/div&gt;
&lt;p&gt;优化目标就变为 &lt;span class="math"&gt;\(\min J(\theta)\)&lt;/span&gt;，更加符合最优化的习惯，这里的 &lt;span class="math"&gt;\(J(\theta)\)&lt;/span&gt; 就是 word2vec 的损失函数。&lt;/p&gt;
&lt;p&gt;为了便于计算，当 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 为中心词时用 &lt;span class="math"&gt;\(v_w\)&lt;/span&gt; 表示，当 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 为上下文词时用 &lt;span class="math"&gt;\(u_w\)&lt;/span&gt; 表示。&lt;/p&gt;
&lt;p&gt;{note begin}每一个词 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 都会具有两个不同的向量 &lt;span class="math"&gt;\(v_w\)&lt;/span&gt; 和 &lt;span class="math"&gt;\(u_w\)&lt;/span&gt;，在计算结束后，这两个向量会非常相似，通常取这两个向量的平均得到词向量。{note end}&lt;/p&gt;
&lt;p&gt;那么对于指定的中心词 &lt;span class="math"&gt;\(c\)&lt;/span&gt; 和上下文词 &lt;span class="math"&gt;\(o\)&lt;/span&gt;，就有&lt;/p&gt;
&lt;div class="math"&gt;$$P(o|c)=\frac{\exp(u_o^Tv_c)}{\sum_{w\in V}\exp(u_w^Tv_c)}$$&lt;/div&gt;
&lt;p&gt;该式可以与 softmax 函数类比：&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{softmax}(x_i)=\frac{\exp(x_i)}{\sum_{j=1}^n\exp(x_j)}=p_i$$&lt;/div&gt;
&lt;p&gt;其本质是将中心词 &lt;span class="math"&gt;\(c\)&lt;/span&gt; 和上下文词 &lt;span class="math"&gt;\(o\)&lt;/span&gt; 的相似性 &lt;span class="math"&gt;\(u_o^Tv_c\)&lt;/span&gt; 转化为&lt;dot&gt;概率&lt;/dot&gt;形式。&lt;/p&gt;
&lt;p&gt;采用梯度下降的方法实现 &lt;span class="math"&gt;\(\min J(\theta)\)&lt;/span&gt;，所以需要计算每个目标词 &lt;span class="math"&gt;\(v_c\)&lt;/span&gt; 的 &lt;span class="math"&gt;\(\frac{\partial}{\partial v_c}\log P(o|c)\)&lt;/span&gt;，推导过程如下：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \frac{\partial}{\partial v_c}\log P(o|c)&amp;amp;=\frac{\partial}{\partial v_c}\log\frac{\exp(u_o^Tv_c)}{\sum_{w\in V}\exp(u_w^Tv_c)}\\
    &amp;amp;=\frac{\partial}{\partial v_c}\left[\log \exp(u_o^Tv_c)-\log\sum_{w\in V}\exp(u_w^Tv_c)\right]\\
    &amp;amp;=\frac{\partial}{\partial v_c}u_o^Tv_c-\frac{\partial}{\partial v_c}\log\sum_{w\in V}\exp(u_w^Tv_c)
\end{align}$$&lt;/div&gt;
&lt;p&gt;注意 &lt;span class="math"&gt;\(v_c\)&lt;/span&gt; 为向量，由向量求导法则 &lt;span class="math"&gt;\(\frac{\mathrm{d}Ax}{\mathrm{d}x}=A^T\)&lt;/span&gt;，可以得到&lt;/p&gt;
&lt;div class="math"&gt;$$
\begin{align}
    \frac{\partial}{\partial v_c}\log P(o|c)&amp;amp;=u_o-\frac{\partial}{\partial v_c}\log\sum_{w\in V}\exp(u_w^Tv_c)\\
    &amp;amp;=u_o-\frac{1}{\sum_{w\in V}\exp(u_w^Tv_c)}\left[\frac{\partial}{\partial v_c}\sum_{x\in V}\exp(u_x^Tv_c)\right]\\
    &amp;amp;=u_o-\frac{1}{\sum_{w\in V}\exp(u_w^Tv_c)}\sum_{x\in V}\frac{\partial}{\partial v_c}\exp(u_x^Tv_c)\\
    &amp;amp;=u_o-\frac{1}{\sum_{w\in V}\exp(u_w^Tv_c)}\sum_{x\in V}\exp(u_x^Tv_c)u_x\\
    &amp;amp;=u_o-\sum_{x\in V}\frac{\exp(u_x^Tv_c)}{\sum_{w\in V}\exp(u_w^Tv_c)}u_x\\
    &amp;amp;=u_o-\sum_{x\in V}P(x|c)u_x
\end{align}
$$&lt;/div&gt;
&lt;p&gt;实际上 &lt;span class="math"&gt;\(\sum_{x\in V}P(x|c)u_x\)&lt;/span&gt; 就是 &lt;span class="math"&gt;\(u_x\)&lt;/span&gt; 的期望，使用 softmax 的好处就在于能将最优化问题转化为最小化形如「观察值 &amp;ndash; 预测值」的误差。&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://web.stanford.edu/class/archive/cs/cs224n/cs224n.1214/"&gt;CS224n: Natural Language Processing with Deep Learning&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="NLP"></category><category term="CS224n"></category></entry><entry><title>文献总结｜DRlinker：使用深度强化学习优化连接片段设计</title><link href="https://tseing.github.io/sui-sui-nian/2022-12-18-summary-doi.org/10.1021/acs.jcim.2c00982.html" rel="alternate"></link><published>2022-12-18T00:00:00+08:00</published><updated>2022-12-18T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-12-18:/sui-sui-nian/2022-12-18-summary-doi.org/10.1021/acs.jcim.2c00982.html</id><summary type="html">&lt;p&gt;本文介绍于 2022 年发表在 Journal of Chemical Information and Modeling 上的一篇文章，文章原标题为 DRlinker: Deep Reinforcement Learning for Optimization in Fragment Linking Design，文章是对 SyntaLinker 的改进，在原有结构的基础上引入了强化学习策略，使模型在完成分子连接的任务以外，还能使模型根据设定的任务生成满足约束的新分子。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1021/acs.jcim.2c00982"&gt;doi.org/10.1021/acs.jcim.2c00982&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Journal of Chemical Information and Modeling&lt;/em&gt; 上的一篇文章，文章原标题为 DRlinker: Deep Reinforcement Learning for Optimization in Fragment Linking Design，文章是对 SyntaLinker 的改进，在原有结构的基础上引入了强化学习策略，使模型在完成分子连接的任务以外，还能使模型根据设定的任务生成满足约束的新分子。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="mo-xing"&gt;模型&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8280?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8280?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章从 SyntaLinker 分子连接模型受到启发，同样使用了强大的 Transformer 模型，但与之不同的是 DRlinker 还引入了强化学习的策略。使用 ChEMBL 数据训练 Transformer，得到先验模型，先验模型能够根据输入的分子片段给出新分子。接着引入基于策略的强化学习，通过打分函数等优化方法训练先验模型，得到代理模型。&lt;/p&gt;
&lt;p&gt;也就是说，代理模型与先验模型具有相同的结构，先验模型首先初始化了代理模型，接着代理模型的强化学习策略使其输出满足打分函数的约束，所以最终的模型可以根据输入的分子片段给出满足指定约束的新分子。&lt;/p&gt;
&lt;h3 id="shu-ju"&gt;数据&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8281?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8281?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;由于 DRlinker 是对 SyntaLinker 的改进，所使用的数据也与 SyntaLinker 一致，数据都来源于 ChEMBL 数据库，处据处理方法也一致。从 ChEMBL 数据库得到的分子数据首先使用 Lipinski 五规则、假阳性化合物和 SA 分数等标准过滤掉其中不具有类药性的分子，接着使用 MMP 算法将分子切分为片段。&lt;/p&gt;
&lt;p&gt;训练方法也与 SyntaLinker 一致，将切分的分子片段组合为 「片段 1，连接部分，片段 2，分子」的四部分数据，令 Transformer 模型完成将「片段 1，片段 2」转为分「分子」的 seq2seq 任务。&lt;/p&gt;
&lt;h3 id="da-fen-han-shu"&gt;打分函数&lt;/h3&gt;
&lt;p&gt;DRlinker 输出满足约束的新分子并完成不同任务是通过指定不同的打分函数决定的，打分函数决定了模型中强化学习过程中训练的方向，指产生的分子偏向于目标分子。&lt;/p&gt;
&lt;p&gt;为了评估 DRlinker 完成不同任务的表现，文章中使用了以下几个打分函数：&lt;/p&gt;
&lt;h4&gt;连接部分长度&lt;/h4&gt;
&lt;div class="math"&gt;$$\begin{equation}
    \mathcal{R}(m)_\mathrm{LinkerLen}=
    \begin{cases}
        \max\left(0,1-\frac{1}{a}|\mathrm{LinkerLen}(m)-\mathrm{Target}|\right)&amp;amp;,\ \mathrm{if\ valid}\\
        0&amp;amp;,\ \mathrm{if\ invalid}
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(\alpha\)&lt;/span&gt; 是参数，&lt;span class="math"&gt;\(m\)&lt;/span&gt; 是生成的分子。&lt;/p&gt;
&lt;h4&gt;log P&lt;/h4&gt;
&lt;div class="math"&gt;$$\begin{equation}
    \mathcal{R}(m)_{\log P}=
    \begin{cases}
        \max\left(0,1-\frac{1}{a}|\log P(m)-\mathrm{Target}|\right)&amp;amp;,\ \mathrm{if\ valid}\\
        0&amp;amp;,\ \mathrm{if\ invalid}
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;h4&gt;生物活性&lt;/h4&gt;
&lt;div class="math"&gt;$$\begin{equation}
    \mathcal{R}(m)_\mathrm{activity}=
    \begin{cases}
        P_\mathrm{active}(m)&amp;amp;,\ \mathrm{if\ valid}\\
        0&amp;amp;,\ \mathrm{if\ invalid}
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;&lt;span class="math"&gt;\(P_\mathrm{active}\)&lt;/span&gt; 是 JAK3 活性的活性预测模型，通过随机森林预测分子活性。&lt;/p&gt;
&lt;h4&gt;多目标约束&lt;/h4&gt;
&lt;div class="math"&gt;$$\begin{equation}
    \mathcal{R}(m)_\mathrm{QED\&amp;amp;SA}=
    \begin{cases}
        \max(0,\mathrm{QED}(m)-0.1\times\mathrm{SA}(m))&amp;amp;,\ \mathrm{if\ valid}\\
        0&amp;amp;,\ \mathrm{if\ invalid}
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;多目标约束用于评估模型针对多个目标进行优化时的表现。&lt;/p&gt;
&lt;h2 id="jie-guo_1"&gt;结果&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8282?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8282?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h4&gt;连接部分长度&lt;/h4&gt;
&lt;p&gt;指定模型生成连接部分长度为 5 和 10 的新分子，结果为 subplot a，可以看出与 SyntaLinker 和 DeLinker 相比，DRLinker 生成的分子分布更加集中在 5 和 10，DRLinker 能够更加准确地生成目标分子。这是由于 SyntaLinker 不具有强化学习策略，是通过在训练数据连接部分长度为 5 的分子中添加例如 &lt;code&gt;L_5&lt;/code&gt; 的前缀标记，利用 Transformer 的自注意力机制分配权重，使生成分子连接部分的长度与 &lt;code&gt;L_n&lt;/code&gt; 的前缀标记相关。使用这种方法虽然能使分子大致符合目标，但显然是不能使分子准确满足目标。&lt;/p&gt;
&lt;h4&gt;log P&lt;/h4&gt;
&lt;p&gt;指定模型分别生成 &lt;span class="math"&gt;\(\log P\)&lt;/span&gt; 为 1、2 和 3 的分子，分子分布为 subplot b，可以从先验模型生成分子到代理模型生成分子的分布中看出，经过强化学习，模型生成分子能够满足约束，集中在任务指定的 &lt;span class="math"&gt;\(\log P\)&lt;/span&gt; 附近。subplot c 列举了模型生成的分子，也可以看出，随着目标 &lt;span class="math"&gt;\(\log P\)&lt;/span&gt; 增大，生成分子的连接部分具有更多的芳香基团等疏水基团。&lt;/p&gt;
&lt;h4&gt;生物活性与多目标约束&lt;/h4&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8284?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8284?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;使用活性预测模型的预测活性作为打分函数，可以指定生成活性较高的新分子，使用 RDKit 的评估指标分析生成分子，可以看出在生成的分子在满足合法性、新颖性等要求的同时，相对于 SyntaLinker 活性还有所提升（Impv）。&lt;/p&gt;
&lt;p&gt;此外还可以使用优化 QED 和 SA 两种目标的打分函数，生成分子的 QED 与 SA 都有相应的提高，达到了使生成分子满足多目标约束的目的。&lt;/p&gt;
&lt;p&gt;以上两种应用都不是通过指定要求的目标生成分子，而是指定了优化目标，可以理解为一种优化分子结构的方式，这是 SyntaLinker 所不具有的功能。&lt;/p&gt;
&lt;h2 id="zong-jie"&gt;总结&lt;/h2&gt;
&lt;p&gt;DRlinker 在 SyntaLinker 的基础上引入了强化学习策略，使模型能够根据脂定的打分函数生成满足目标约束的分子，从实验结果来看，模型不仅能够使生成的分子满足单一目标，还能满足多目标的约束。但强化学习的策略也存在一定问题，例如必须要根据目标构造打分函数，打分函数不同也会造成结果不同，打分函数没有严格的标准而经验成分较多等等。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Transformer"></category><category term="RL"></category></entry><entry><title>机器翻译框架 OpenNMT 入门：快速上手</title><link href="https://tseing.github.io/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html" rel="alternate"></link><published>2022-12-16T00:00:00+08:00</published><updated>2022-12-16T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-12-16:/sui-sui-nian/2022-12-16-opennmt-tutorial-quickstart.html</id><summary type="html">&lt;p&gt;拆解项目代码的时候发现使用到了 onmt 这个古怪东西，查阅资料后才知道这是一个自然机器翻译的框架，是自然语言处理中常用的工具。但是相关资料又太少，于是不得不照着文档一点一点啃，最后留下了这篇笔记。&lt;/p&gt;</summary><content type="html">&lt;p&gt;拆解项目代码的时候发现使用到了 &lt;code&gt;onmt&lt;/code&gt; 这个古怪东西，查阅资料后才知道这是一个自然机器翻译的框架，是自然语言处理中常用的工具。但是相关资料又太少，于是不得不照着文档一点一点啃，最后留下了这篇笔记。&lt;/p&gt;
&lt;p&gt;OpenNMT 官方描述该框架为 an open source neural machine translation system，点进 &lt;a href="https://opennmt.net/"&gt;OpenNMT 的官网&lt;/a&gt;可以看到更多资料，因此也不需要我多描述。总结一下就是，OpenNMT 是搭建自然语言处理模型的开源框架，其中自然包括常见的 RNN 和 Transformer 等模型。如果在自然语言处理方面有需要，OpenNMT 绝对是一个轻量有效的框架。&lt;/p&gt;
&lt;p&gt;OpenNMT 的中文学习资料较少，于是我只能参考&lt;a href="https://opennmt.net/OpenNMT-py/main.html"&gt;官方文档&lt;/a&gt;学习。在这篇笔记中，我会把文档中的模型都试验一遍（希望别🕊️），记录下整个过程或许能帮助到需要的人。&lt;/p&gt;
&lt;h2 id="zhun-bei-gong-zuo"&gt;准备工作&lt;/h2&gt;
&lt;p&gt;首先介绍一下我的运行环境，我的设备搭载一块 &lt;code&gt;GTX 1080&lt;/code&gt; GPU，系统为 &lt;code&gt;Ubuntu 20.04&lt;/code&gt;，需要提前在设备上安装好 CUDA，我使用 Anaconda 配置 Python 环境。&lt;/p&gt;
&lt;p&gt;{note begin}OpenNMT 不支持过旧的 GPU，之前在 &lt;code&gt;GTX 970&lt;/code&gt; 的设备上就无法训练模型，这个问题可能除了换设备无解😭{note end}&lt;/p&gt;
&lt;h2 id="kuai-su-shang-shou"&gt;快速上手&lt;/h2&gt;
&lt;h4&gt;安装 OpenNMT&lt;/h4&gt;
&lt;p&gt;OpenNMT 有 PyTorch 与 TensorFlow 两个版本，PyTorch 在环境搭建上方便很多，所以我选择 PyTorch 版本。先创建虚拟环境，再直接通过 &lt;code&gt;pip&lt;/code&gt; 安装 OpenNMT-py，Python 版本为 &lt;code&gt;3.9&lt;/code&gt;，OpenNMT-py 为 &lt;code&gt;3.0.2&lt;/code&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;# 创建虚拟环境
conda create -n nlp python==3.9
# 激活虚拟环境
conda activate nlp
# 安装 OpenNMT
pip install OpenNMT-py==3.0.2
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{note begin}国内直连 PyPI 的速度可能很慢，可以使用清华源，命令为 &lt;code&gt;pip install -i https://pypi.tuna.tsinghua.edu.cn/simple {some-package}&lt;/code&gt;，将其中的 &lt;code&gt;{some-package}&lt;/code&gt; 替换为需要安装的包名称。{note end}&lt;/p&gt;
&lt;p&gt;直接安装 &lt;code&gt;OpenNMT-py&lt;/code&gt; 很有可能会有问题，主要原因是 Pytorch 与 CUDA 版本不匹配。可以用 &lt;code&gt;nvcc -V&lt;/code&gt; 查询 CUDA 版本，再在 &lt;a href="https://pytorch.org/get-started/previous-versions/"&gt;Pytorch 官网&lt;/a&gt;找到相应的版本。例如我的 CUDA 版本为 &lt;code&gt;11.4&lt;/code&gt;，那么就需要重新安装以下版本的包解决依赖问题：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;pip install torch==1.12.1+cu113 torchvision==0.13.1+cu113 torchaudio==0.12.1 --extra-index-url https://download.pytorch.org/whl/cu113
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;准备数据&lt;/h4&gt;
&lt;p&gt;快速上手一节搭建的是一个简单的双语翻译模型，因此需要准备两种语言的数据，分别为源语言&lt;code&gt;src&lt;/code&gt; 和目标语言 &lt;code&gt;tgt&lt;/code&gt;，数据文件中每行包含一句话，以空格分隔不同的词。再考虑到训练集和验证集，那么一共需要 4 种数据文件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;src-train.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tgt-train.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;src-val.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tgt-val.txt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;{note begin}可以想象到，如果处理的是英语、法语等以空格分隔单词的语言，只需要将文本数据处理为每行一句话的格式即可。但对于汉语、日语等不以特殊标记分隔词语的语言，数据需要经过额外的分词步骤后才可以使用。{note end}&lt;/p&gt;
&lt;p&gt;官方提供了英语-德语的数据文件，可以直接下载：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;wget https://s3.amazonaws.com/opennmt-trainingdata/toy-ende.tar.gz
tar xf toy-ende.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;也可以到 &lt;a href="https://github.com/OpenNMT/OpenNMT-py/tree/master/data"&gt;&lt;i class="fa fa-github"&gt;&lt;/i&gt; OpenNMT-py/data/&lt;/a&gt; 在线查看数据长什么样子。&lt;/p&gt;
&lt;p&gt;接着通过 &lt;code&gt;vim toy_en_de.yaml&lt;/code&gt; 在目录下创建 &lt;code&gt;.yaml&lt;/code&gt; 配置文件，内容为&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-yaml"&gt;# toy_en_de.yaml

## Where the samples will be written
save_data: toy-ende/run/example
## Where the vocab(s) will be written
src_vocab: toy-ende/run/example.vocab.src
tgt_vocab: toy-ende/run/example.vocab.tgt
# Prevent overwriting existing files in the folder
overwrite: False

# Corpus opts:
data:
    corpus_1:
        path_src: toy-ende/src-train.txt
        path_tgt: toy-ende/tgt-train.txt
    valid:
        path_src: toy-ende/src-val.txt
        path_tgt: toy-ende/tgt-val.txt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;创建文件后的文件结构为&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;.
&amp;boxvr;&amp;boxh;&amp;boxh; toy-ende
&amp;boxv;   &amp;boxvr;&amp;boxh;&amp;boxh; src-test.txt
&amp;boxv;   &amp;boxvr;&amp;boxh;&amp;boxh; src-train.txt
&amp;boxv;   &amp;boxvr;&amp;boxh;&amp;boxh; src-val.txt
&amp;boxv;   &amp;boxvr;&amp;boxh;&amp;boxh; tgt-test.txt
&amp;boxv;   &amp;boxvr;&amp;boxh;&amp;boxh; tgt-train.txt
&amp;boxv;   &amp;boxur;&amp;boxh;&amp;boxh; tgt-val.txt
&amp;boxur;&amp;boxh;&amp;boxh; toy_en_de.yaml
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;设置完成后，运行以下命令开始构建词库：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;onmt_build_vocab -config toy_en_de.yaml -n_sample 10000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中 &lt;code&gt;n_sample&lt;/code&gt; 设定了从语料中获取多少行的数据用于构建词库。&lt;/p&gt;
&lt;p&gt;{note begin}若使用虚拟环境，需要进入虚拟环境后才能运行上述命令，若使用 Anaconda，也需要先激活环境。Pytorch 与 CUDA 版本不匹配会导致 &lt;code&gt;undefined symbol: cublasLtGetStatusString, version libcublasLt.so&lt;/code&gt; 错误。{note end}&lt;/p&gt;
&lt;h4&gt;训练模型&lt;/h4&gt;
&lt;p&gt;训练模型也十分简单，在 &lt;code&gt;.yaml&lt;/code&gt; 文件中追加以下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-yaml"&gt;# Vocabulary files that were just created
src_vocab: toy-ende/run/example.vocab.src
tgt_vocab: toy-ende/run/example.vocab.tgt

# Train on a single GPU
world_size: 1
gpu_ranks: [0]

# Where to save the checkpoints
save_model: toy-ende/run/model
save_checkpoint_steps: 500
train_steps: 1000
valid_steps: 500
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用 &lt;code&gt;onmt_train -config toy_en_de.yaml&lt;/code&gt; 开始训练，该配置会生成默认的 2 层具有 500 个隐藏单元的 LSTM 模型。&lt;/p&gt;
&lt;h4&gt;模型预测&lt;/h4&gt;
&lt;p&gt;使用类似的命令进行模型预测，模型预测能够将文本文件中的内容翻译并保存到输出文件中：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;onmt_translate -model toy-ende/run/model_step_1000.pt -src toy-ende/src-test.txt -output toy-ende/pred_1000.txt -gpu 0 -verbose
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;上面的命令使用了训练得到的模型 &lt;code&gt;toy-ende/run/model_step_1000.pt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;预测 &lt;code&gt;toy-ende/src-test.txt&lt;/code&gt; 测试集数据&lt;/li&gt;
&lt;li&gt;将结果输出到 &lt;code&gt;toy-ende/pred_1000.txt&lt;/code&gt;，&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-gpu&lt;/code&gt; 指定了使用的 GPU&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-verbose&lt;/code&gt; 指定在终端中输出每个步骤的详细结果&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;使用 &lt;code&gt;head -n 2 toy-ende/src-test.txt&lt;/code&gt; 和 &lt;code&gt;head -n 2 toy-ende/pred_1000.txt&lt;/code&gt; 查看一下预测结果：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;# test
Orlando Bloom and Miranda Kerr still love each other
Actors Orlando Bloom and Model Miranda Kerr want to go their separate ways .

# pred
Die &amp;lt;unk&amp;gt; der &amp;lt;unk&amp;gt; der &amp;lt;unk&amp;gt; , die die &amp;lt;unk&amp;gt; der &amp;lt;unk&amp;gt; &amp;hellip;&amp;hellip;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;由于训练时间很短，数据集很小，预测结果不会好，再加上不认识德语，也无法判断结果的优劣，所以接下来尝试在更大的中文语料上进行翻译任务。&lt;/p&gt;
&lt;h2 id="wen-yan-fan-yi"&gt;文言翻译&lt;/h2&gt;
&lt;p&gt;B 站上有一个展示 OpenNMT 的&lt;a href="https://www.bilibili.com/video/BV1NL4y1t73c/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=a5a1b5dd5c760997f9e16b7806d64651"&gt;视频&lt;/a&gt;，实在很不错。视频中展示的翻译任务是将白话译为文言，不仅直观而且十分有趣，我觉得特别适合用来入门，作者的代码也公开在 &lt;a href="https://github.com/qhduan/notebook_gist/blob/master/%E7%BF%BB%E8%AF%91%E5%8F%A4%E6%96%87.ipynb"&gt;GitHub&lt;/a&gt; 上，可以和本文相互参照，本文中的代码也可以在 &lt;a href="https://github.com/Tseing/OpenNMT-wenyan"&gt;&lt;i class="fa fa-github"&gt;&lt;/i&gt; Tseing/OpenNMT-wenyan &lt;/a&gt; 找到。&lt;/p&gt;
&lt;h4&gt;准备数据&lt;/h4&gt;
&lt;p&gt;白话文与文言文的平行语料来自于 &lt;a href="https://github.com/NiuTrans/Classical-Modern"&gt;&lt;i class="fa fa-github"&gt;&lt;/i&gt; NiuTrans/Classical-Modern&lt;/a&gt;，包含了大量内容：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;# Classical-Modern/source/
元史  北齐书  南齐书  后汉书  太平广记  宋史    新五代史  旧五代史  明史  梁书      汉书              辽史  陈书  魏书
北史  南史    史记    周书    宋书      徐霞客  新唐书    旧唐书    晋书  水经注全  短篇章和资治通鉴  金史  隋书
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;下载数据后可以先用 &lt;code&gt;head Classical-Modern/source/史记&lt;/code&gt; 与 &lt;code&gt;head Classical-Modern/target/史记翻译&lt;/code&gt; 查看一下语料：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;# 史记
後为太常，坐法当死，赎免为庶人。
上曰：剑，人之所施易，独至今乎？
然终不自明也。
然亦无所毁。

# 史记翻译
因为触犯法律判处死刑，纳米粟入官赎罪后成了平民。
景帝说：剑是人们所喜爱之物，往往用来送人或交换他物，难道你能保存到现在吗？
说过后他终究不再做其他辩解。
然后也没有讲别人的什么坏话。
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;原始语料是将文言翻译为白话，因此 &lt;code&gt;source&lt;/code&gt; 中存储了原文，&lt;code&gt;target&lt;/code&gt; 中存储了翻译，每行一句话，两个文件一一对应。我们需要预处理数据，将所有文本都作为数据集。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;import os

source_root = 'Classical-Modern/source'
target_root = 'Classical-Modern/target'

for f in os.listdir(source_root):
    print("processing " + f)
    source_file = os.path.join(source_root, f)
    target_file = os.path.join(target_root, f + '翻译')

    # 统计各文本中行数
    with open(source_file, "r", encoding="utf-8") as source_f:
        source_len = sum(1 for _ in source_f)
    with open(target_file, "r", encoding="utf-8") as target_f:
        target_len = sum(1 for _ in target_f)

    # 对比平行语料行数，确保一致
    assert source_len == target_len
    try:
        with open('dataset/source_raw.txt', "a+", encoding="utf-8") as source_f:
            source_f.write(open(source_file, "r", encoding="utf-8").read())
        with open('dataset/target_raw.txt', "a+", encoding="utf-8") as target_f:
            target_f.write(open(target_file, "r", encoding="utf-8").read())
    except FileNotFoundError:
        os.mkdir('dataset')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;检查一下处理的结果：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;# dataset/source_raw.txt
密计不行。
使者利金，遂相许。
遣说诸小贼，所至辄降，让始敬焉，召与计事。
宇文温每谓密曰：不杀元真，公难未已。

# dataset/target_raw.txt
李密的意见没有被采纳。
押送的人贪图金钱，便满口答应。
派人游说小股义军，被劝说的人都归顺了翟让，翟让开始看重了他，叫他同自己一起讨论重大问题。
宇文温常对李密说：不杀邴元真，您的祸害就不会排除。
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;接下来要对文本分词，对于文言文来说，单字词的占比非常高，将每个单字作为一个词就是一种比较方便的分词方法，所以在每个字符后插入空格即可。而白话文中有大量的双字词，甚至三字词、四字词，必须使用专门的分词引擎，这里我使用了 &lt;a href="http://thulac.thunlp.org/"&gt;THULAC&lt;/a&gt;，直接通过 &lt;code&gt;pip install thualac&lt;/code&gt; 就能安装。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;import thulac

# 对文言文本分词
with open('dataset/source_raw.txt', 'r', encoding='utf-8') as f:
    # 目标是 白话-&amp;gt;文言，因此将文言作为目标 target.txt
    with open('dataset/target.txt', 'w+', encoding='utf-8') as s:
        print("separating wenyan text...")
        while True:
            line = f.readline()
            if line:
                line_seq = " ".join([char for char in line])
                s.write(line_seq)
            else:
                break

# 对白话文本分词，将白话作为源语言 source.txt
print("separating modern text...")
sep_model = thulac.thulac(seg_only=True)
sep_model.cut_f('dataset/target_raw.txt', 'dataset/source.txt')
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;thulac&lt;/code&gt; 首先要加载分词模型，&lt;code&gt;seg_only&lt;/code&gt; 指定只分词，不输出词性&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cut_f(input, output)&lt;/code&gt; 用于对文件 &lt;code&gt;input&lt;/code&gt; 分词，并将结果保存到 &lt;code&gt;output&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;{note begin}使用 thulac 处理文件时一般会输出 &lt;code&gt;UnicodeDecodeError&lt;/code&gt; 错误，主要是读取文件时的编码错误，是 thulac 本身的一个 bug，请看下文的解决方法&lt;del&gt;（也可能官方修好了）&lt;/del&gt;。&lt;/p&gt;
&lt;p&gt;找到错误信息中的 &lt;code&gt;site-packages\thulac\__init__.py&lt;/code&gt; 文件，第 187 行与第 188 行的代码为&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;input_f = open(input_file, 'r')
output_f = open(output_file, 'w')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;将其修改为&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;input_f = open(input_file, 'r', encoding='utf-8')
output_f = open(output_file, 'w', encoding='utf-8')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{note end}&lt;/p&gt;
&lt;p&gt;同样再检查一下处理的结果：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;# dataset/source.txt
李密 的 意见 没有 被 采纳 。
押送 的 人 贪图 金钱 ， 便 满口答应 。
派 人 游说 小 股义军 ， 被 劝说 的 人 都 归顺 了 翟让 ， 翟让 开始 看重 了 他 ， 叫 他 同 自己 一起 讨论 重大 问题 。
宇文 温常 对 李密 说 ： 不 杀 邴元真 ， 您 的 祸害 就 不 会 排除 。

# dataset/target.txt
密 计 不 行 。
使 者 利 金 ， 遂 相 许 。
遣 说 诸 小 贼 ， 所 至 辄 降 ， 让 始 敬 焉 ， 召 与 计 事 。
宇 文 温 每 谓 密 曰 ： 不 杀 元 真 ， 公 难 未 已 。
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;分词结果虽然有错误，但总体效果还可以，最后将全部文本划分为训练集与验证集。由于文本数据非常大，不适合读取后转换为列表进行操作，我写了一个划分 &lt;code&gt;.txt&lt;/code&gt; 文本的脚本，可以在 GitHub 上找到，代码不复杂，就不展开介绍了。划分数据集后的文件结构与 OpenNMT 要求的数据一致，就可以直接使用了。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;dataset
&amp;boxvr;&amp;boxh;&amp;boxh; src-train.txt
&amp;boxvr;&amp;boxh;&amp;boxh; src-val.txt
&amp;boxvr;&amp;boxh;&amp;boxh; source.txt
&amp;boxvr;&amp;boxh;&amp;boxh; source_raw.txt
&amp;boxvr;&amp;boxh;&amp;boxh; target.txt
&amp;boxvr;&amp;boxh;&amp;boxh; target_raw.txt
&amp;boxvr;&amp;boxh;&amp;boxh; tgt-train.txt
&amp;boxur;&amp;boxh;&amp;boxh; tgt-val.txt
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;构建词库&lt;/h4&gt;
&lt;p&gt;同样创建 &lt;code&gt;.yaml&lt;/code&gt; 配置文件，内容为&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-yaml"&gt;# wenyan.yaml

## Where the samples will be written
save_data: run/wenyan
## Where the vocab(s) will be written
src_vocab: run/wenyan.vocab.src
tgt_vocab: run/wenyan.vocab.tgt
src_vocab_size: 200000
tgt_vocab_size: 200000
overwrite: True

# Corpus opts:
data:
    corpus_1:
        path_src: dataset/src-train.txt
        path_tgt: dataset/tgt-train.txt
    valid:
        path_src: dataset/src-val.txt
        path_tgt: dataset/tgt-val.txt

# Train on a single GPU
world_size: 1
gpu_ranks: [0]
queue_size: 100
bucket_size: 2048

# Train batch
batch_size: 32
# Validation batch
valid_batch_size: 16

# Where to save the checkpoints
save_model: run/model
save_checkpoint_steps: 10000
train_steps: 1000000
valid_steps: 10000
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;queue_size&lt;/code&gt; 为读取数据的消息队列大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bucket_size&lt;/code&gt; 为读取数据的缓冲区大小，用于避免无法实时读取数据&lt;/li&gt;
&lt;li&gt;&lt;code&gt;batch_size&lt;/code&gt; 为训练过程中处理的批大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;valid_batch_size&lt;/code&gt; 为验证过程中处理的批大小&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;onmt_build_vocab -config wenyan.yaml -n_sample -1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;同样使用该命令开始构建词库，将 &lt;code&gt;-n_sample&lt;/code&gt; 指定为 &lt;code&gt;-1&lt;/code&gt; 能让模型使用整个数据集的数据构建词库。可以使用 &lt;code&gt;head run/wenyan.vocab.src&lt;/code&gt; 查看一下构建的词库：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;，      2041007
。      920182
的      700401
不      279935
、      224914
了      195770
是      176242
他      175822
在      156216
说      143227
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;训练模型&lt;/h4&gt;
&lt;p&gt;使用 &lt;code&gt;onmt_train -config wenyan.yaml&lt;/code&gt; 开始训练模型。&lt;/p&gt;
&lt;p&gt;由于数据集很大，训练模型需要非常长的时间，中途可能训练中断或卡死。由于在训练过程中保存了 &lt;code&gt;checkpoints&lt;/code&gt;，也不需要重头训练，可以从保存的断点继续训练。可以使用以下的自动化脚本，将其保存为 &lt;code&gt;train.py&lt;/code&gt;，就可以通过 &lt;code&gt;python train.py&lt;/code&gt; 自动继续训练。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;import os

model_root = 'run/wenyan'
try:
    checkpoints = [x for x in os.listdir(model_root) if x.endswith('.pt')]
except FileNotFoundError:
    os.mkdir(model_root)
    checkpoints = [x for x in os.listdir(model_root) if x.endswith('.pt')]

last_checkpoint = None
if len(checkpoints) &amp;gt; 0:
    checkpoints = sorted(checkpoints, key=lambda x: int(x[:-3].split('_')[-1]))
    last_checkpoint = checkpoints[-1]
    last_checkpoint = os.path.join(model_root, last_checkpoint)

if last_checkpoint is not None:
    print('last_checkpoint', last_checkpoint, os.path.exists(last_checkpoint))
    if isinstance(last_checkpoint, str) and os.path.exists(last_checkpoint):
        # 中断后继续训练使用
        os.system('onmt_train -config wenyan.yaml --train_from="%s"' % last_checkpoint)
    else:
        os.system('onmt_train -config wenyan.yaml')
else:
    os.system('onmt_train -config wenyan.yaml')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在 &lt;code&gt;.yaml&lt;/code&gt; 文件中添加 &lt;code&gt;log_file&lt;/code&gt; 可以将日志文件保存到相应目录，这里我没有添加，直接用终端中的输出数据分析。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8277?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8277?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;ACC 和 PPL 是自然语言处理中常用的指标，当然还有更好用的 BELU 等指标。可以看出训练过程收敛得非常快，PPL 迅速下降，ACC 也在第 20 个模型后保持稳定了，检查一下日志文件发现果然在第 23 个模型后学习率变成 0 了。这就说明不需要指定那么多的训练步骤，降低到 300000 可能是比较合适的。&lt;/p&gt;
&lt;h4&gt;模型预测&lt;/h4&gt;
&lt;p&gt;那么就选最后一个模型作为最终用于预测的模型，将其他模型全部删除。&lt;/p&gt;
&lt;p&gt;{note begin}可以在 &lt;code&gt;.yaml&lt;/code&gt; 文件中通过参数 &lt;code&gt;keep_checkpoint&lt;/code&gt; 指定需要保存的模型数量，在训练过程中会自动删去多余的模型，节省存储空间。{note end}&lt;/p&gt;
&lt;p&gt;在目录中新建一个文本 &lt;code&gt;input.txt&lt;/code&gt;，写入需要翻译的语句，每行一句话：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;这样的事情是很难令人相信的。
传说西北方有一座海岛，居住着神仙，留下这部书。
可惜这本书的字已经看不清了。
后来皇帝下旨找遍了天下具有智识的儒生。
命令大臣在几十年里翻遍了所有的藏书。
最后确定封面上写着《算法：C语言实现》。
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{warn begin}每句话以换行（&lt;code&gt;\n&lt;/code&gt;）分隔，注意最后一行不能有空行，否则会报错。{warn end}&lt;/p&gt;
&lt;p&gt;接着需要对输入文本分词，同样使用 &lt;code&gt;thulac&lt;/code&gt;，新建一个 &lt;code&gt;input_sep.py&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;import thulac

sep_model = thulac.thulac(seg_only=True)
sep_model.cut_f('input.txt', 'input_sep.txt')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;运行 &lt;code&gt;python input_sep.py&lt;/code&gt; 完成分词后，使用以下命令开始翻译：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;onmt_translate --model 'run/model_final.pt' --src input_sep.txt --output output.txt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用 &lt;code&gt;cat output.txt&lt;/code&gt; 就可以看到输出了，结果非常生草🤣&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-txt"&gt;如 此 者 ， 难 信 也 。
传 西 北 有 一 海 岛 ， 居 神 仙 ， 留 此 书 。
惜 此 书 已 不 明 矣 。
后 诏 遍 遍 天 下 有 知 儒 生 。
命 大 臣 数 十 年 ， 尽 有 书 藏 。
最 后 定 上 书 《 法 术 法 》 。
&lt;/code&gt;&lt;/pre&gt;
&lt;hr/&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://opennmt.net/OpenNMT-py/main.html"&gt;OpenNMT-py Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://arabelatso.github.io/2021/01/03/OpenNMT-Doc/"&gt;OpenNMT 2.0.0rc1 使用手册 - Arabela's Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.bilibili.com/video/BV1NL4y1t73c/"&gt;开源神经机器翻译-OpenNMT使用介绍 - 哔哩哔哩&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="碎碎念"></category><category term="OpenNMT"></category><category term="NLP"></category><category term="Python"></category></entry><entry><title>文献总结｜基于SMILES用于从头药物设计的深度分子骨架改造模型</title><link href="https://tseing.github.io/sui-sui-nian/2022-12-11-summary-doi.org/10.1186/s13321-020-00441-8.html" rel="alternate"></link><published>2022-12-11T00:00:00+08:00</published><updated>2022-12-11T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-12-11:/sui-sui-nian/2022-12-11-summary-doi.org/10.1186/s13321-020-00441-8.html</id><summary type="html">&lt;p&gt;本文介绍于 2020 年发表在 Journal of Cheminformatics 上的一篇文章，文章原标题为 SMILES‑based deep generative scaffold decorator for de‑novo drug design，文章通过 MMP 算法得到训练数据，基于 RNN 模型构建了能对分子骨架进行改造的生成模型，模型能够生成具有指定改造位点的分子骨架，并使用分子片段对其改造从而得到新分子。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1186/s13321-020-00441-8"&gt;doi.org/10.1186/s13321-020-00441-8&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2020 年发表在 &lt;em&gt;Journal of Cheminformatics&lt;/em&gt; 上的一篇文章，文章原标题为 SMILES‑based deep generative scaffold decorator for de‑novo drug design，文章通过 MMP 算法得到训练数据，基于 RNN 模型构建了能对分子骨架进行改造的生成模型，模型能够生成具有指定改造位点的分子骨架，并使用分子片段对其改造从而得到新分子。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;对先导化合物进行结构优化是药物设计中的重要步骤，利用深度学习手段对分子结构进行改造能够大大提升药物设计的效率。以往提出的结构改造模型有基于 SMILES 的双向 RNN 模型，其问题在于只能连接分子中的两个指定位点，也有基于图的深度模型，但需要消耗大量的计算资源和训练时间。&lt;/p&gt;
&lt;p&gt;文章提出了一种用于分子结构改造的深度生成模型，首先由 RNN 模型生成分子骨架，再由改造模型在分子骨架中的改造位点上进行合适的改造，生成新的分子。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="mo-xing"&gt;模型&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8212?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8212?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章提出的模型主要由分子骨架生成模型与分子骨架改造模型两部分构成。分子骨架生成模型是基于 RNN 的模型，使用 MMP 算法将分子的 SMILES 分割为分子片段并将其作为训练数据，分子骨架生成模型就能够生成具有结构改造位点标记 &lt;code&gt;[*]&lt;/code&gt; 的分子骨架。&lt;/p&gt;
&lt;p&gt;分子改造模型也是 RNN 模型，但具有注意力机制的编码器-解码器架构，编码器-解码器架构主要用于处理 seq2seq 任务，在这里，编码器-解码器将具有结构改造位点标记的分子骨架转化为用于结构改造的取代基。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8213?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8213?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;使用该模型对分子进行结构改造的主要流程如上图所示，首先手动输入或由模型生成带有改造位点的分子骨架，接着再由改造模型进行改造。改造模型具有两种模式，一种是一步模式，另一种是多步模式。在多步模式中，通过多步骤完成分子的改造，先将分子结构转化为改造基团，再将改造基团连入分子结构，然后再次将分子结构送入改造模型，直至所有改造位点完成改造。单步模式中，模型将分子结构转化为多个改造基团，以分隔符 &lt;code&gt;|&lt;/code&gt; 区分，将多个改造基团全部连入分子，一次性完成改造。&lt;/p&gt;
&lt;p&gt;文章设定了两个实验用于测试模型的表现：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;实验 1&lt;/strong&gt;：使用 DRD2 受体调节剂数据训练结构改造模型，用活性预测模型确定模型输出活性分子的数量；&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实验 2&lt;/strong&gt;：使用类药分子作为训练数据，测试模型表现。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="shu-ju-yu-chu-li"&gt;数据预处理&lt;/h3&gt;
&lt;p&gt;实验 1 所使用的数据是 DRD2 受体调节剂数据，来自于 ExCAPE-DB，使用 MMP 算法将分子分割为分子骨架与改造基团。&lt;/p&gt;
&lt;p&gt;实验 2 使用的数据是 ChEMBL 中的类药分子，同样使用 MMP 算法，但在分割的同时增加了 RECAP 规则的约束，RECAP 规则能让分子骨架与改造基团的分割更符合化学合成的规则。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8214?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8214?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8215?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8215?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;在训练集中随机选择了 5 个分子骨架（1-5），并将其从训练集中去除，将这 5 个分子骨架相关的分子片段数据作为验证集。&lt;/p&gt;
&lt;p&gt;在骨架生成模型生成的数据中选择 5 个未出现在数据集中的不同分子骨架（6-10）作为改造模型的输入。&lt;/p&gt;
&lt;h2 id="jie-guo_1"&gt;结果&lt;/h2&gt;
&lt;h3 id="shi-yan-1"&gt;实验 1&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8216?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8216?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;使用 1-10 分子骨架作为输入的生成分子结果如上图所示。从 subplot a 可以看出，分子骨架不同，所产生的结构改造数量也不同，这种不同不是由结构改造位点数量导致的，而且在单步模式下具有更多的结构改造。在 subplot c 和 d 中可以看出，在不同结构上生成结构改造的新颖性不同，这主要是由于模型对每个结构改造位点上所具有知识的不同，此外在生成新颖性的结构中，也有相当一部分分子具有预测活性，表明模型在进行结构改造的同时依然具有 DRD2 的知识，模型能够基于 SMILES 语境做出结构改造。&lt;/p&gt;
&lt;p&gt;尽管单步模式能够针对分子骨架产生更多的结构改造，但多步模型产生的所有分子中的活性分子占比更高，因此多模型在对分子进行结构改造上具有更好的表现。可以认为这是因为多步改造能够更好地利用训练数据中的知识，例如单步模式下，模型只会运用到对多个改造位点进行改造的知识，而在多模式下，模型会逐次运用到对三个、两个、一点改造位点改造的数据，使得生成的分子更能满足 DRD2 受体的活性要求。&lt;/p&gt;
&lt;h3 id="shi-yan-2"&gt;实验 2&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8217?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8217?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8218?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8218?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;实验 2 生成新分子的结果如图所示，其中上图为多步模式，下图为单步模式，non-dataset scaff. 表示分子具有未出现在数据集中的新骨架（6-10），val. set scaff. 表示分子具有训练集中的骨架（1-5）。&lt;/p&gt;
&lt;p&gt;可以看出，在多步模式下，尽管输入了不同的分子骨架，结构改造后新分子的性质仍然能和训练集保持一致，表现了模式良好的泛化能力，能够用于生成类药分子。而在单步模式下，模型利用的知识受限，生成新分子的性质偏离了训练数据。&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章基于 RNN 构建了一种新的分子改造模型，没有使用额外的深度学习方法，仅由 RNN 的分子骨架生成模型与 RNN 编码器-解码器的分子改造模型构成。通过 MMP 算法处理分子的 SMILES 数据后，即可用于该模型的训练，该模型能够基于 SMILES 语境进行合适的分子改造。该模型的结构较为简单，还有进一步改进的空间。&lt;/p&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="RNN"></category></entry><entry><title>文献总结｜通过生成深度学习发现 RIPK1 抑制剂</title><link href="https://tseing.github.io/sui-sui-nian/2022-12-03-summary-doi.org/10.1038/s41467-022-34692-w.html" rel="alternate"></link><published>2022-12-03T00:00:00+08:00</published><updated>2022-12-03T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-12-03:/sui-sui-nian/2022-12-03-summary-doi.org/10.1038/s41467-022-34692-w.html</id><summary type="html">&lt;p&gt;本文介绍于 2022 年发表在 Nature Communications 上的一篇文章，文章原标题为 Generative deep learning enables the discovery of a potent and selective RIPK1 inhibitor，文章通过构建 CRNN 模型，使用迁移学习、正则化强化和取样强化三种策略针对 RIPK1 靶点生成化合物，并从中得到了潜在的 RIPK1 抑制剂。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1038/s41467-022-34692-w"&gt;doi.org/10.1038/s41467-022-34692-w&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Nature Communications&lt;/em&gt; 上的一篇文章，文章原标题为 Generative deep learning enables the discovery of a potent and selective RIPK1 inhibitor，文章通过构建 RNN 模型，使用迁移学习、正则化强化和取样强化三种策略针对 RIPK1 靶点生成化合物，并从中得到了潜在的 RIPK1 抑制剂。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;包括 RNN 在内的许多深度生成模型在生成分子方而都有很好的表现，但大部分模型的作用都是生成满足预定目标的最可能分子（基于目标）。基于 目标的模型依赖于目标函数，就很可能生成更符合目标函数（数值上更优）而实际不可用的分子，因此还需要大量的湿实验验证。&lt;/p&gt;
&lt;p&gt;为了避免这一问题，文章构造了基于分布的 cRNN 模型，基于分布的模型能够生成与训练集化学分布相同的新分子，从而避免目标函数的影响。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8143?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8143?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章中的模型基于分布学习的 cRNN 架构，并且使用了 LSTM 策略。此外，文章还在模型中引入了三种策略用于增强模型对特定靶点（PIPK1）的针对性：迁移学习、正则化强化和取样强化。&lt;/p&gt;
&lt;h4&gt;迁移学习&lt;/h4&gt;
&lt;p&gt;首先使用包含约 1600 万分子的 ZINC12 数据库（源数据）预训练模型，再使用 1030 个已知的 RIPK1 抑制剂（目标数据） fine-tune 模型，这一过程就是迁移学习。&lt;/p&gt;
&lt;p&gt;从测试结果（subplot c）可以看出，使用迁移学习策略后，模型不仅重构出了源数据中的分子，也重构出了目标数据中的分子，具有更好的泛化能力。&lt;/p&gt;
&lt;h4&gt;正则化强化&lt;/h4&gt;
&lt;p&gt;正则化强化是为了提升模型的生成能力，主要操作就是在模型训练过程中的状态向量引入高斯噪声，可以表示为&lt;/p&gt;
&lt;div class="math"&gt;$$h^\mathrm{noise}_0=h_0+\varepsilon,\ \varepsilon_m\in\mathcal{N}(\mu,\sigma^2)$$&lt;/div&gt;
&lt;p&gt;从测试结果（subplot d）可以看出，使用正则化强化后，模型生成分子的能力得到提升。&lt;/p&gt;
&lt;h4&gt;取样强化&lt;/h4&gt;
&lt;p&gt;在模型生成分子的过程中，是通过对状态向量取样，从而在潜在的化学空间中得到新分子。因此在对状态向量取样的过程中引入强化策略，也能提升模型表现。取样强化的策略包括单点取样、线性插值取样、球面插值取样三种方法，可以分别表示为&lt;/p&gt;
&lt;div class="math"&gt;$$h^i_{0,\mathrm{new}}=\mathrm{Sample}(h^i_0)=h^i_0+\varepsilon_s,\ \varepsilon_s\in\mathcal{N}(\mu,\sigma^2)$$&lt;/div&gt;
&lt;div class="math"&gt;$$h^{ij,\alpha}_{0,\mathrm{new}}=\mathrm{Linear}(h^i_0,h^j_0;\alpha)=(1-\alpha)h^i_0+\alpha h^j_0,\ \alpha\in(0,1)$$&lt;/div&gt;
&lt;div class="math"&gt;$$h^{ij,\beta}_{0,\rm{new}}=\mathrm{Slerp}(h^i_0,h^j_0;\beta)=\frac{\sin[(1-\beta)\theta]}{\sin\theta}h^i_0+\frac{\sin(\beta\theta)}{\sin\theta}h^j_0,\ \beta\in(0,1)$$&lt;/div&gt;
&lt;p&gt;具体来说，就是在对状态向量取样引入临近插值点的状态向量影响。&lt;/p&gt;
&lt;h2 id="jie-guo"&gt;结果&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8144?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8144?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;使用模型得到 79323 个分子，通过 UMAP 数据降维展示了分子在化学空间的分布（subplot a），其中蓝色为生成分子，红色为源数据，紫色为目标数据，可以看出生成分子的化学空间不仅包含了源数据空间，而且有包含目标分子空间的趋势，这主要由于模型的迁移学习过程。&lt;/p&gt;
&lt;p&gt;对生成分子的理化性质进行评估，可以发现在四种性质指标上，生成分子与源数据和目标分子都十分接近，可以认为模型同时学习到了两种数据集的特征。&lt;/p&gt;
&lt;p&gt;以独特骨架/总骨架分析生成分子的分子骨架多样性，生成分子的 26.4% 显著高于源数据（1.2%）与目标分子（14.1%）。&lt;/p&gt;
&lt;p&gt;接下来使用生成的分子进行虚拟对接：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;删去具有相同 Murcko 骨架或与已知 RIPK1 抑制剂具有相同骨架的分子；&lt;/li&gt;
&lt;li&gt;使用 RDKit 计算分子类药性，删去低于阈值的分子；&lt;/li&gt;
&lt;li&gt;使用 RIPK1 进行药效团模型，保留具有要求药效团的分子；&lt;/li&gt;
&lt;li&gt;基于 RECAP 绘制分子结果相似性与对接分数的树状图。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8145?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8145?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;在树状图中选择局部对接打分最后的分子，经过合成性评估，选择其中 8 个分子进行后续合成与药理学实验，最终确定 RI-962 为潜在的 RIPK 抑制剂。&lt;/p&gt;
&lt;h2 id="tao-lun"&gt;讨论&lt;/h2&gt;
&lt;p&gt;文章中使用的分子生成模型是基于 cRNN 的模型，cRNN 通过学习训练集中分子的潜在特征从而生成新分子，不通过人为指定分子生成的目标，这种基于分布的分子生成方法减少了基于目标分子生成方法由于目标函数所导致的不准确性。&lt;/p&gt;
&lt;p&gt;基于分布的分子生成方法是一种数据驱动的深度学习方法，所以模型需要大量数据用于训练，而在现实中，目标分子的数据集一般较小。文章使用了迁移学习的方法，先使用较大的 ZINC12 数据集训练，再使用较小的目标分子集 fine-tune 模型，得到了很好的效果。&lt;/p&gt;
&lt;p&gt;文章在模型中还使用了正则化强化和取样强化的策略，都提升了 cRNN 模型的表现。此外，文章建立了「分子生成-虚拟筛选-化学合成-药理试验」的药物发现全过程流程，最终得到了潜在的 RIPK 抑制剂 RI-962。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="CRNN"></category></entry><entry><title>为深度学习环境配置 CUDA</title><link href="https://tseing.github.io/sui-sui-nian/2022-12-01-install-cuda.html" rel="alternate"></link><published>2022-12-01T00:00:00+08:00</published><updated>2022-12-01T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-12-01:/sui-sui-nian/2022-12-01-install-cuda.html</id><summary type="html">&lt;p&gt;最近在折腾 OpenNMT 框架，CUDA 与 PyTorch 都是需要的依赖。虽然网络上已经有大量的 CUDA 安装教程，相信也比我写得全面且详细，但手头上的服务器正巧没有安装 CUDA，索性记录下来以备不时之需。&lt;/p&gt;</summary><content type="html">&lt;p&gt;最近在折腾 OpenNMT 框架，CUDA 与 PyTorch 都是需要的依赖。虽然网络上已经有大量的 CUDA 安装教程，相信也比我写得全面且详细，但手头上的服务器正巧没有安装 CUDA，索性记录下来以备不时之需。&lt;/p&gt;
&lt;h2 id="zhun-bei-gong-zuo"&gt;准备工作&lt;/h2&gt;
&lt;p&gt;在普遍情况下，设备都安装了相应的显卡驱动，那么使用 &lt;code&gt;nvidia-smi&lt;/code&gt; 即可查看驱动信息，确定支持的 CUDA 版本。&lt;/p&gt;
&lt;p&gt;若没有安装驱动，那么需要在终端中输入 &lt;code&gt;lspci | grep -i nvidia&lt;/code&gt; 检测设备的 GPU 型号，接着查找适用的 CUDA 版本，在安装 CUDA 时也会自动安装上匹配的驱动。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html"&gt;CUDA 文档&lt;/a&gt;中给出了GPU 驱动与 CUDA 版本的对应关系，一定要选择适配的版本。&lt;/p&gt;
&lt;p&gt;在安装 CUDA 前，还要确保设备安装了 gcc 和 make，如果需要使用 C++ 进行 CUDA 编程，还需要安装 g++。这里我只安装 gcc 和 make：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;sudo apt update             # 更新 apt
sudo apt install gcc make   # 安装 gcc 和 make
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="xia-zai-cuda"&gt;下载 CUDA&lt;/h2&gt;
&lt;p&gt;确定需要安装的 CUDA 版本后，例如我的设备是 11.4，直接搜索 CUDA 11.4 进入&lt;a href="https://developer.nvidia.com/cuda-11-4-0-download-archive"&gt;下载页面&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8128?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8128?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;在下载页面中需要选择相应的架构和发行版，如果不确定设备架构可以在终端中输入 &lt;code&gt;uname -m&lt;/code&gt;，然后根据输出结果选择即可。&lt;/p&gt;
&lt;p&gt;我的设备是 Ubuntu 20.04，选择 Installer Type 为 &lt;code&gt;runfile(local)&lt;/code&gt;，网页就给出了下载命令：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;# 下载 CUDA
wget https://developer.download.nvidia.com/compute/cuda/11.4.0/local_installers/cuda_11.4.0_470.42.01_linux.run
# 安装 CUDA
sudo sh&amp;nbsp;cuda_11.4.0_470.42.01_linux.run
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="an-zhuang-cuda"&gt;安装 CUDA&lt;/h2&gt;
&lt;p&gt;下载需要较长时间，待下载完成后执行文件开始安装。若已经安装 GPU 驱动，会有以下提示，选择 &lt;code&gt;Continue&lt;/code&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;&amp;boxdr;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxdl;
&amp;boxv; Existing package manager installation of the driver found. It is strongly    &amp;boxv;
&amp;boxv; recommended that you remove this before continuing.                          &amp;boxv;
&amp;boxv; Abort                                                                        &amp;boxv;
&amp;boxv; Continue                                                                     &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv; Up/Down: Move | 'Enter': Select                                              &amp;boxv;
&amp;boxur;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxul;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;接下来输入 &lt;code&gt;accept&lt;/code&gt; 接受用户条款。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;&amp;boxdr;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxdl;
&amp;boxv;  End User License Agreement                                                  &amp;boxv;
&amp;boxv;  --------------------------                                                  &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;  NVIDIA Software License Agreement and CUDA Supplement to                    &amp;boxv;
&amp;boxv;  Software License Agreement. Last updated: October 8, 2021                   &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;  The CUDA Toolkit End User License Agreement applies to the                  &amp;boxv;
&amp;boxv;  NVIDIA CUDA Toolkit, the NVIDIA CUDA Samples, the NVIDIA                    &amp;boxv;
&amp;boxv;  Display Driver, NVIDIA Nsight tools (Visual Studio Edition),                &amp;boxv;
&amp;boxv;  and the associated documentation on CUDA APIs, programming                  &amp;boxv;
&amp;boxv;  model and development tools. If you do not agree with the                   &amp;boxv;
&amp;boxv;  terms and conditions of the license agreement, then do not                  &amp;boxv;
&amp;boxv;  download or use the software.                                               &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;  Last updated: October 8, 2021.                                              &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;  Preface                                                                     &amp;boxv;
&amp;boxv;  -------                                                                     &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxv;
&amp;boxv; Do you accept the above EULA? (accept/decline/quit):                         &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxur;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxul;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后出现下方的界面，需要选择安装的内容。若设备已经安装驱动，在这里需要&lt;strong&gt;取消&lt;/strong&gt; &lt;code&gt;Driver&lt;/code&gt; 的选择，否则会出现安装错误。在这个步骤中，我只选择了 &lt;code&gt;CUDA Toolkit 11.4&lt;/code&gt; 与 &lt;code&gt;CUDA Documentation 11.4&lt;/code&gt;，选择 &lt;code&gt;Intsall&lt;/code&gt; 开始安装。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;&amp;boxdr;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxdl;
&amp;boxv; CUDA Installer                                                               &amp;boxv;
&amp;boxv; - [X] Driver                                                                 &amp;boxv;
&amp;boxv;      [X] 470.42.01                                                           &amp;boxv;
&amp;boxv; + [X] CUDA Toolkit 11.4                                                      &amp;boxv;
&amp;boxv;   [X] CUDA Samples 11.4                                                      &amp;boxv;
&amp;boxv;   [X] CUDA Demo Suite 11.4                                                   &amp;boxv;
&amp;boxv;   [X] CUDA Documentation 11.4                                                &amp;boxv;
&amp;boxv;   Options                                                                    &amp;boxv;
&amp;boxv;   Install                                                                    &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv;                                                                              &amp;boxv;
&amp;boxv; Up/Down: Move | Left/Right: Expand | 'Enter': Select | 'A': Advanced options &amp;boxv;
&amp;boxur;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxh;&amp;boxul;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{note begin}安装过程中出现的 &lt;code&gt;boost::filesystem::copy_file: No such file or directory&lt;/code&gt; 错误是由于存储空间不足导致的。{note end}&lt;/p&gt;
&lt;h2 id="huan-jing-bian-liang"&gt;环境变量&lt;/h2&gt;
&lt;p&gt;当输出 &lt;code&gt;Summary&lt;/code&gt; 信息后即表示安装完成，在输出信息中还会提示修改环境变量:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Please make sure that
 -   PATH includes /usr/local/cuda-11.4/
 -   LD_LIBRARY_PATH includes /usr/local/cuda-11.4/lib64, or, add /usr/local/cuda-11.4/lib64 to /etc/ld.so.conf and run ldconfig as root
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用 &lt;code&gt;vim ~/.bashrc&lt;/code&gt;，在文件末添加以下内容并保存：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;# CUDA
export PATH="/usr/local/cuda-11.4/bin:$PATH"
export LD_LIBRARY_PATH="/usr/local/cuda-11.4/lib64:$ LD_LIBRARY_PATH"
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;最后使用 &lt;code&gt;source ~/.bashrc&lt;/code&gt; 更新修改内容，在终端中输入 &lt;code&gt;nvcc -V&lt;/code&gt;，输出 nvcc 的版本信息就说明安装完成。&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/79059379"&gt;Linux 下的 CUDA 安装和使用指南 - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="碎碎念"></category><category term="Linux"></category><category term="CUDA"></category></entry><entry><title>文献总结｜使用课程学习改进从头药物设计</title><link href="https://tseing.github.io/sui-sui-nian/2022-11-25-summary-doi.org/10.1038/s42256-022-00494-4.html" rel="alternate"></link><published>2022-11-25T00:00:00+08:00</published><updated>2022-11-25T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-11-25:/sui-sui-nian/2022-11-25-summary-doi.org/10.1038/s42256-022-00494-4.html</id><summary type="html">&lt;p&gt;本文介绍于 2022 年发表在 Nature Machine Intelligence 上的一篇文章，文章原标题为 Improving De Novo Molecular Design with Curriculum Learning，文章介绍了深度学习中的课程学习，并将课程学习的策略用于 REINVENT 模型，相比于强化学习的策略，课程学习对解决复杂任务具有更好效果。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1038/s42256-022-00494-4"&gt;doi.org/10.1038/s42256-022-00494-4&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Nature Machine Intelligence&lt;/em&gt; 上的一篇文章，文章原标题为 Improving De Novo Molecular Design with Curriculum Learning，文章介绍了深度学习中的课程学习，并将课程学习的策略用于 REINVENT 模型，相比于强化学习的策略，课程学习对解决复杂任务具有更好效果。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;强化学习是深度学习中的常用策略，而强化学习在面对较为复杂的任务时，奖励函数的计算将消耗大量资源，不仅效率低下，还有很大可能无法完成相应任务。课程学习是强化学习的一种替代方法，它将复杂任务分为连续的若干任务，通过这种方式节省了计算资源，同时模型也更容易学习简单的任务。&lt;/p&gt;
&lt;p&gt;包括 REINVENT 在内的许多药物分子生成模型都使用了强化学习策略，其中的奖励函数通常包括例如分子对接打分和理化性质预测等复杂的因素，使用这样复杂的奖励函数，模型很难通过学习过程找到最优解，最终偏离预期目标。&lt;/p&gt;
&lt;p&gt;因此文章在 REINVENT 模型中引入了课程学习策略，设计了以生成 PDK1 抑制剂为目标的复杂任务，对比与强化学习策略效果的差异。文章结果表明，课程学习绕过了包含分子对接在内的复杂奖励函数，大大提高了计算效率。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="ke-cheng-xue-xi-yuan-li"&gt;课程学习原理&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8089?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8089?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;课程学习的过程可以分为课程阶段与输出阶段，在课程阶段中，模型需要学习逐渐复杂的连续的任务，在输出阶段中，模型输出满足满足最终要求的分子。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;打分函数&lt;/strong&gt; &lt;span class="math"&gt;\(S:\rm{SMILES}\rightarrow[0,1]\)&lt;/span&gt; 由加权几何平均构成：&lt;/p&gt;
&lt;div class="math"&gt;$$S(x)=\left[\prod^n_{i=1}c_i(x)^{w_i}\right]^{1/\sum^n_{i=1}w_i}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(c_i:\rm{SMILES}\rightarrow[0,1]\)&lt;/span&gt;，&lt;span class="math"&gt;\(w_i\)&lt;/span&gt; 是 &lt;span class="math"&gt;\(c_i\)&lt;/span&gt; 的相应权值。&lt;span class="math"&gt;\(S(x)\)&lt;/span&gt; 是生成化合物 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 的打分函数，基梯度用于更新代理模型。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;课程&lt;/strong&gt; &lt;span class="math"&gt;\(C\)&lt;/span&gt; 由目标序列构成，&lt;span class="math"&gt;\(O=\{O_{C_1},\cdots,O_{C_{n-1}},O_{C_n},O_P\}\)&lt;/span&gt;，其中 &lt;span class="math"&gt;\(C\)&lt;/span&gt; 表示课程目标，&lt;span class="math"&gt;\(P\)&lt;/span&gt; 表示生成目标。对于每个目标，都有相应的 &lt;span class="math"&gt;\(S(x)\)&lt;/span&gt; 用于更新代理模型。&lt;/p&gt;
&lt;p&gt;课程阶段由若干个课程单元构成，每个单元中的强化学习目标是输出满足该单元课程学习目标 &lt;span class="math"&gt;\(O_{C_i}\)&lt;/span&gt; 的分子，只有打分高于阈值的分子才会进入下一个课程单元，经过连续的课程单元，生成分子的复杂性也增加（任务复杂性也增加）。完成全部连续的课程学习目标 &lt;span class="math"&gt;\(O_{C_n}\)&lt;/span&gt; 后，进入生成阶段，此时强化学习的目标是生成任务的目标 &lt;span class="math"&gt;\(O_P\)&lt;/span&gt;，最后输出符合预期的分子。&lt;/p&gt;
&lt;h3 id="mo-xing"&gt;模型&lt;/h3&gt;
&lt;p&gt;文章中使用的模型是 REINVENT 生成模型，主要由 RNN 构成，REINVENT 模型的先验模型已经使用 ChEMBL 数据集进行预训练，能够生成合法的 SMILES 分子。&lt;/p&gt;
&lt;p&gt;模型中同样使用了 REINVENT 原有的多样性过滤器，在课程阶段，为了保证能够准确获得先验知识，不使用过滤器，为了使输出分子具有尽可能的多样性，在输出阶段使用过滤器。&lt;/p&gt;
&lt;p&gt;关于 REINVENT 的更多细节，参考&lt;a href="https://tseing.github.io/sui-sui-nian/2022-10-15-summary-doi.org/10.1021/acs.jcim.0c00915.html"&gt;前文&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id="jie-guo_1"&gt;结果&lt;/h2&gt;
&lt;p&gt;文章设计了三种实验对比强化学习与课程学习的效果差异：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;实验 1&lt;/strong&gt;：生成具有目标骨架的分子。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;实验 2&lt;/strong&gt;：生成满足分子对接约束的分子，使用谷本相似性（2D）作为打分函数&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;实验 3&lt;/strong&gt;：生成满足分子对接约束的分子，使用 ROCS 3D 相似性作务打分函数。&lt;/p&gt;
&lt;p&gt;对于实验 2 和实验 3，将进入生成阶段的阈值设为低（0.5）和高（2D: 0.8, 3D: 0.75）两种模式，对比结果差异。&lt;/p&gt;
&lt;h4&gt;实验 1&lt;/h4&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8090?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8090?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;实验 1 的目标是生成包含二氢吡唑喹唑啉结构的分子。在使用 RL 策略的模型中，在 2000 个 epoch 的过程中，分子打分基本上都是 0.5（不包含该子结构），表明模型没能生成具有该结构的分子。而在使用 CL 策略的模型中，尽管目标十分复杂，在经过 5 个课程目标后，分子的阈值超过了 0.8，生成了具有该结构的分子。&lt;/p&gt;
&lt;p&gt;CL 过程中，分子打分不断上升，当分数超过 0.8 的阈值，即完成当前课程目标后，分子打分迅速下降，进入下一个课程目标。还可以从化合物的结构中看出，随着 CL 过程的进行，分子结构变得更加复杂，最终满足任务目标。上述结果明确展示了 CL 逐个完成连续目标的过程。&lt;/p&gt;
&lt;p&gt;此外，通过 CL 过程生成目标分子只经过了 1500 个 epoch，计算效率远远高于 RL 过程。&lt;/p&gt;
&lt;h4&gt;实验 2 和 3&lt;/h4&gt;
&lt;p&gt;实验 2 和 3 都加入了分子对接的约束，目标是生成与 PDK1 受体 Ala 162 具有两个氢键作用且相比参考配体具有更强的预测活性（对接打分）和类药性（QED） 的分子，两个实验的唯一区别在于分别使用了 2D 和 3D 的打分函数。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8091?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8091?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;在 0-100 epoch 中，RL 过程的分数一直很低，直到 100-200 epoch，RL 过程生成分子的分数才开始上升，但分数还是显著低于 CL 方法生成的分子。&lt;/p&gt;
&lt;p&gt;可以看出，使用谷本相似性或 ROCS 相似性作为模型的打分函数，都能指引模型完成复杂的生成目标。从完成生成目标的过程看来，两种打分函数没有什么区别，表现出相似的性能。&lt;/p&gt;
&lt;p&gt;而使用低分模式与高分模式谷本相似性的模型有所区别，使用低分模式的模型在刚开始阶段的分数很低，但是在 50 个 epoch 内迅速上升，赶上高分模型的打分。使用低分模式与高分模式 ROCS 相似性的模型也有相似的表现，但 ROCS 相似性模型开始阶段的分数没有谷本相似性模型高，这是由于从 SMILES 数据中学习 3D 构象有一定困难。&lt;/p&gt;
&lt;p&gt;在生成满足分子对接约束分子的任务上，CL 策略也顺利完成了目标。&lt;/p&gt;
&lt;h4&gt;优化效果&lt;/h4&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8092?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8092?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;对多种策略生成的结果分子进行分子对接，评估分子活性，可以看出，与相比 RL，CL 过程能够生成更大量的预期分子，在诸多 CL 过程中，使用高分模式的模型生成的分子活性更高（约 -11 kcal/mol）。&lt;/p&gt;
&lt;h4&gt;骨架多样性&lt;/h4&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8093?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8093?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;使用 Bemis-Murcko 分子骨架评估不同方式生成分子的多样性，在结果中也可以明显看出，CL 过程生成了更多独特的分子骨架，以谷本相似性作为打分函数的模型生成分子的多样性更高，高分模式生成分子的多样性更高。&lt;/p&gt;
&lt;h2 id="jie-lun"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章基于 REINVENT 模型，引入了课程学习策略，大大加快了模型解决多参数优化的问题的效率。强化学习策略在面对复杂任务时通常效率低下，甚至无法解决，实验结果证明引入 CL 策略的模型顺利解决了生成目标，完成了构造具有特定结构分子与生成满足对接要求分子的两种任务。课程学习策略有助于分子生成模型完成复杂任务并提高计算效率。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="RNN"></category></entry><entry><title>文献总结｜LibINVENT：可用于虚拟化合物库构建的基于反应的分子骨架改造模型</title><link href="https://tseing.github.io/sui-sui-nian/2022-11-20-summary-doi.org/10.1021/acs.jcim.1c00469.html" rel="alternate"></link><published>2022-11-20T00:00:00+08:00</published><updated>2022-11-20T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-11-20:/sui-sui-nian/2022-11-20-summary-doi.org/10.1021/acs.jcim.1c00469.html</id><summary type="html">&lt;p&gt;本文介绍于 2022 年发表在 Journal of Chemical Information and Modeling 上的一篇文章，文章原标题为 LibINVENT: Reaction-based Generative Scaffold Decoration for in Silico Library Design，文章基于 RNN 与 RL 构建了能够对分子进行结构改造的模型，模型在经过分子片段数据的训练后，模型能够在分子相应改造位点上连接不同化学结构，是构建虚拟化合物库的有利工具。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1021/acs.jcim.1c00469"&gt;doi.org/10.1021/acs.jcim.1c00469&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Journal of Chemical Information and Modeling&lt;/em&gt; 上的一篇文章，文章原标题为 LibINVENT: Reaction-based Generative Scaffold Decoration for in Silico Library Design，文章基于 RNN 与 RL 构建了能够对分子进行结构改造的模型，模型在经过分子片段数据的训练后，模型能够在分子相应改造位点上连接不同化学结构，是构建虚拟化合物库的有利工具。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;先导化合物优化的目的是优化掉那些阻止化合物成药的特征的同时，保留下化合物中符合预期的特征。由于预期活性常常与特定的分子骨架相关，可以把这种任务归结为保留特定的分子骨架，同时改变其他特定部分，最终使化合物满足成为候选药物的多种要求，该任务可以通过筛选具有相同母核的专一化合物库完成。&lt;/p&gt;
&lt;p&gt;化合物库是具有一系列分子的集合，文章对其中的分子具有两个要求：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;针对一个或多个分子骨架，所有分子都包含该子结构；&lt;/li&gt;
&lt;li&gt;所有分子都能通过一连串相同的化学合成转化得到。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第2个条件能够减少了合成中反应试剂与反应条件的数量，更适用于化合物的自动化设计与合成，能够提高在先导化合物优化方面的生产效率。&lt;/p&gt;
&lt;p&gt;文章设计了一种基于 REINVENT 的模型完成构建该化合物库的任务，模型能够使用相应的化学反对具有结构改造连接位点的输入骨架进行改造，这种生成化合物库的方法能够让用户在很大程度上控制模型的输出，生成实际上更加合理的分子。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="shu-ju-chu-li"&gt;数据处理&lt;/h3&gt;
&lt;p&gt;化合物数据可以从公开数据库ChEMBL获取，数据库中的分子都以SMILES序列的形式描述，化合物数据主要用于训练先验模型。&lt;/p&gt;
&lt;p&gt;首先清理数据，从数据集中移除非目标的化合物，例如分子量过大、过小的分子和具有不常见 SMILES 标记的数据。接着要对分子数据进行分割，以往的规则，例如 RECAP 规则，是对化合物中单键进行分割，但这样的分割并不能满足通过化学反应切分的要求。文章使用了 Arús-Pous 等提出的数据预处理方法，该方法通过 27 条基于反应的规则分割分子，满足了要求。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8026?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8026?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="mo-xing-xun-lian"&gt;模型训练&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8027?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8027?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;先验模型使用分割分子的 SMILES 数据集训练，训练先验模型的目的是使其学会 SMILES 序列的语义从而生成合法的 SMILES 结果。由于先验模型不针对于具有任务，所以只需要训练一次。&lt;/p&gt;
&lt;p&gt;为了将模型用于具体任务，需要将先验模型转化为专一的先验模型，使用的具体策略是 RL。在 RL 循环中，先验模型不断给出化合物，同时根据它的输出，先验模型接收到特定任务的奖惩。在RL运行过程中，所有高分化合物都保存到虚拟化合物库中，就是最后的结果数据。&lt;/p&gt;
&lt;p&gt;RL 过程中还引入了多样性过滤器（diversity filter, DF）与反应过滤器（reaction filter, RF），DF 会给予那些重复生成相同分子的 RL 代理模型相应的惩罚，这有助于增加生成分子的多样性。RF 能够保证给出的化合物库中的化合物都能通过选定的化学反应合成，有利于构建反应专一的化合物库。用户也可以设定 RF 中的参数，设定进行结构改造的化学反应。&lt;/p&gt;
&lt;h2 id="shi-yan_1"&gt;实验&lt;/h2&gt;
&lt;p&gt;实验部分的目标是&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;确定 RL 循环中最优的学习策略；&lt;/li&gt;
&lt;li&gt;与使用 RECAP 规则的模型对比，展示模型能够基于反应进行骨架的结构改造；&lt;/li&gt;
&lt;li&gt;展示模型对具有各种数量连接位点的骨架进行结构改造的能力。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="xue-xi-ce-lue"&gt;学习策略&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8028?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8028?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;首先使用 QSAR 预测模型与没有 RF 的模型生成分子，结果如上表所示。接着使用QSAR 预测模型与有 RF 的模型生成分子，结果如下表所示。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8029?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8029?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;可以看出 DAP 策略在两种模型中都是最优的策略，表现都超过了其他策略。最终选择 DAP 策略作为后续实验中的策略。引入 RF 的作用可以从下图中看出，在引入 RF 后，更优策略与其他策略的差距明显增大。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8030?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8030?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="fen-ge-ce-lue"&gt;分割策略&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8031?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8031?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;分别使用 QSAR 预测与 ROCS 3D 相似性评估分子生成模型不同分割策略的结果，一种是基于反应的分割策略，另一种是基于 RECAP 规则的分割策略，实验结果如表如示。不管是哪种打分模型，基于反应的分子分割方式都具有更高的分数，相比 RECAP 规则，基于反应的分割方式更具有优势。&lt;/p&gt;
&lt;p&gt;两种打分模型之间，ROCS 的分数要低于 QSAR，这是因为 ROCS 考虑了分子的 3D 特征，而模型很难从 SMILES 输入中学习到分子的 3D 特征。此外，使用 ROCS 模型的生成模型更加稳定，最终生成了更加多样的分子。这是因为简单的 QSAR 预测模型具有较大的约束，有很强的偏向性，将模型引入了更小的化学区域，最终对分子的结构改造较为单一。ROCS 虽然具有较低的分数，但它能让模型同时拥有对目标的指引和探索空间的自由，二者适当的结合使模型获得了更优的结果。&lt;/p&gt;
&lt;h3 id="ju-you-duo-ge-lian-jie-wei-dian-de-gu-jia"&gt;具有多个连接位点的骨架&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!8032?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!8032?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;最后使用具有多个（1~4）连接位点的分子骨架作为输入数据，得到了先前实验类似的结果，说明模型可以对具有不同连接位点的分子骨架进行结构改造。&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;针对于基于特定目标对分子骨架进行结构优化的任务，文章构造了一种灵活的工具 LibINVENT。它能够快速生成具有可用于先导化合物优化且易于合成的化合物库。RL 策略能够让模型在目标的化学空间生成分子，能够满足多种特定目标。用户还可以灵活地设定任务，指定化学空间中需要目标区域，让模型生成指定的化合物库，这使得 LibINVENT 具有很大的应用前景。&lt;/p&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="RNN"></category></entry><entry><title>文献总结｜SyntaLinker：使用 Conditional Transformer 神经网络自动连接分子片段</title><link href="https://tseing.github.io/sui-sui-nian/2022-11-14-summary-doi.org/10.1039/d0sc03126g.html" rel="alternate"></link><published>2022-11-14T00:00:00+08:00</published><updated>2022-11-14T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-11-14:/sui-sui-nian/2022-11-14-summary-doi.org/10.1039/d0sc03126g.html</id><summary type="html">&lt;p&gt;本文介绍于 2020 年发表在 Chemical Science 上的一篇文章，文章原标题为 SyntaLinker: automatic fragment linking with deep conditional transformer neural networks，文章将基于语义模型 Transformer 识别并连接分子片段，最终设计了一种分子片段连接工具 SyntaLinker，它能够有效完成有约束的分子片段连接任务。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1039/d0sc03126g"&gt;doi.org/10.1039/d0sc03126g&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2020 年发表在 &lt;em&gt;Chemical Science&lt;/em&gt; 上的一篇文章，文章原标题为 SyntaLinker: automatic fragment linking with deep conditional transformer neural networks，文章将基于语义模型 Transformer 识别并连接分子片段，最终设计了一种分子片段连接工具 SyntaLinker，它能够有效完成有约束的分子片段连接任务。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;基于片段的药物设计（Fragment-Based Drug Design , FBDD）是计算机辅助药物设计的一种基本手段，在药物设计中 FBDD 需要完成的任务包括&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;寻找合适的分子片段；&lt;/li&gt;
&lt;li&gt;基于分子片段生长并优化片段，最终得到类药分子。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;其中，使分子片段不断生长并连接组成分子的任务仍具有很大困难，因为很大的一个挑战就在于如何保持各片段连接后各片段与受体的结合方式不发生改变。从这一点看来，连接片段的任务是 FBDD 中的关键难题。&lt;/p&gt;
&lt;p&gt;文章借用深度学习的方法来解决这一问题，文章以 SMILES 表示分子片段，将片段连接视作自然语言处理中的句子填空任务，并设计了一种新的 conditional transformer 模型用于完成该任务。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="fen-zi-biao-shi"&gt;分子表示&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7969?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7969?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;如图所示，文章使用 SMILES 表示分子片段，用 &lt;code&gt;[*]&lt;/code&gt; 表示分子片段的连接位置，用 &lt;code&gt;.&lt;/code&gt; 分隔两个分子片段。文章还设计了两种有约束任务，在最短连接键长（shortest linker bond distance, SLBD）约束模式下，在 SMILES 最前面以 &lt;code&gt;[L_n]&lt;/code&gt; 表示两个分子片段连接部分应当具有 &lt;span class="math"&gt;\(n\)&lt;/span&gt; 个化学键。在多约束模式下，考虑的约束条件除了 SLBD 以外，还包括氢键给体、氢键受体、可旋转键和环状结构，若需要约束连接部分是否存在相应结构，则按四个约束的次序分别以 &lt;span class="math"&gt;\(1\)&lt;/span&gt; 表示存在，以 &lt;span class="math"&gt;\(0\)&lt;/span&gt; 表示不存在，如图中的 &lt;code&gt;[L_4 1 1 1 0]&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id="mo-xing"&gt;模型&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7975?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7975?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;SyntaLinker 模型的结构基于 transformer 模型，能够根据用户指定的条件生成分子，transformer 模型的原理可以参考&lt;a href="https://tseing.github.io/sui-sui-nian/2022-10-08-summary-doi.org/10.1038/s42256-021-00403-1.html"&gt;先前的文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;输入的 SMILES 字符串以 one-hot 矩阵形式表示，再通过 word embedding 算法转化为 embedding 向量构成的矩阵。输入的 embedding 被编码器层处理为潜在表达，潜在表达被解码器用 softmax 函数转化为各词的概率序列，直至遇到结束符 &lt;code&gt;&amp;lt;/s&amp;gt;&lt;/code&gt;，就完成了分子的生成。最后，使用生成分子与目标分子间的交叉熵损失训练模型：&lt;/p&gt;
&lt;div class="math"&gt;$$\mathcal{L}(Y,M)=-\sum_{i=1}^ky_i\log m_i$$&lt;/div&gt;
&lt;h3 id="shu-ju-chu-li"&gt;数据处理&lt;/h3&gt;
&lt;p&gt;分子数据来自于 ChEMBL，并使用 Lipinski 五规则、泛筛选干扰化合物（pan assay interference compounds, PAINS）结构和 SA score（synthetic accessibility score）初步筛去不合理的分子。&lt;/p&gt;
&lt;p&gt;文章使用匹配分子对（matched molecular pairs, MMPs）划分算法将原始分子数据转化为用于训练的分子片段数据。MMPs 划分算法在每个分子的两个非官能团的无环单键处切割，最后得到片段甲、连接部分、片段乙和完整分子四个部分数据，将其称为片段分子四部分数据（fragment molecule quadruples, FMQs）。
接着所有 FMQs 都要经过 RO3（Rule of three）规则、SLBE 和 SA score 的筛选，最终分子片段满足 SLBD 小于 15 的条件从而避免连接部分过于复杂，并满足以下 SA score 要求避免分子难以合成：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{equation}
    \mathrm{SAscore\_filter}(x)=
    \begin{cases}
        &amp;amp;\mathrm{SA_{fragment\ 1}&amp;lt;5}\\
        &amp;amp;\mathrm{SA_{fragment\ 2}&amp;lt;5}\\
        &amp;amp;\mathrm{SA_{linker}}&amp;lt;(\mathrm{SA_{fragment\ 1}}+\mathrm{SA_{fragment\ 2}})
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;h3 id="zhi-biao"&gt;指标&lt;/h3&gt;
&lt;p&gt;使用通过片段数据生成分子的合法性、独特性、回复性和新颖性评价模型：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;合法性（validity）&lt;/strong&gt; 指通过一对分子片段生成合法化学结构分子的比例，定义为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{Validity}=\frac{\mathrm{\#\ of\ chemically\ valid\ SMILES\ with\ fragments}}{\mathrm{\#\ of\ generated\ SMILES}}$$&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;独特性（uniqueness）&lt;/strong&gt; 指生成分子中具有特有化合结构分子的数量，定义为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{Uniqueness}=\frac{\mathrm{\#\ of\ non\mbox{-}duplicate;\ valid\ structures}}{\mathrm{\#\ of\ valid\ structures}}$$&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;回复性（recovery）&lt;/strong&gt; 指生成分子中生成的训练集中真实分子所占比例;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;新颖性（novelty）&lt;/strong&gt; 指生成分子中生成的化学结构合法且未出现在训练集中的连接部分所占比例，定义为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{Uniqueness}=\frac{\mathrm{\#\ of\ novel\ linkers\ not\ in\ training set}}{\mathrm{\#\ of\ unique\ structures}}$$&lt;/div&gt;
&lt;h2 id="jie-guo-yu-tao-lun_1"&gt;结果与讨论&lt;/h2&gt;
&lt;h3 id="sheng-cheng-fen-zi"&gt;生成分子&lt;/h3&gt;
&lt;p&gt;文章设置了无约束的 SyntaLinker_n、SLBD 约束的 SyntaLinker 和 多约束的 SyntaLinker_multi 三种模式，从每对分子片段生成 10 个最优分子，根据生成分子评估三种模式。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7970?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7970?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;使用 ChEMBL 数据集验证生成分子，可以判断三种模式都初步完成了连接分子片段的任务，生成了大比例符合要求的分子，其中多约束的 SyntaLinker_multi 在多方面具有较好的效果。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7971?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7971?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;为了与 DeLinker 模型对比，再从每对分子片段生成 250 个最优分子，生成的分子数据用  CASF 验证集验证。与 DeLinker 模型生成的数据相比，SyntaLinker 的三种模式都具有更优的性能，特别是在新颖性方面的优势，说明 SyntaLinker 能生成结构更新颖的连接部分。在SyntaLinker 的三种模式中，仍然是多约束的 SyntaLinker_multi 具有更好效果。&lt;/p&gt;
&lt;h3 id="yue-shu-neng-li"&gt;约束能力&lt;/h3&gt;
&lt;p&gt;与上文设置类似，分别使用 SyntaLinker 的三种模式基于每对分子生成 10 个和 250 个分子，使用 ChEMBL 和 CASF-2016 验证集验证各模型生成的分子是否满足约束条件。SyntaLinker 中的约束条件可以分为两部分，一部分是化学键约束，需要考察生成分子的连接部分满足 SLBD 条件，另一部分是药效团约束，需要考察生成分子是否根据预设的条件生成了类药性高的分子。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7972?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7972?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;note&gt;(a) The percentage of compounds among top 10 solutions in the ChEMBL test set; (b) the percentage of compounds among top 250 solutions in the ChEMBL test set; (c) the percentage of compounds among top 10 solutions in the CASF set; (d) the percentage of compounds among top 250 solutions in the CASF set.&lt;/note&gt;&lt;/p&gt;
&lt;p&gt;首先考察各模型的化学键约束，可以看出，具有化学键约束的 SyntaLinker 与 SyntaLinker_multi 在所有评估结果中，生成满足约束分子的比例都要更高，表明两种模型确实能够完成有约束的分子片断连接任务。随着每对片段生成分子数量的增加，满足约束分子的比例也有所减少，但相比无约束的 SyntaLinker_n，有约束的 SyntaLinker 与 SyntaLinker_multi 仍具有优势。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7973?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7973?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;接着考察各模型的药效团约束，药效团约束的结果也表现出相似的趋势，具有约束的 SyntaLinker_multi 生成满足约束的分子占比更多，而无约束的 SyntaLinker 与 SyntaLinker_n 则占比更少。随着每对片段生成分子数从 10 增加到 250，满足多约束的困难增加，满足条件的分子相应减少。&lt;/p&gt;
&lt;h3 id="quan-zhong-fen-xi"&gt;权重分析&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7974?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7974?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章根据模型权重绘制了热图，从中可以看出模型处理分子对 SMILES 的流程。上方是输入模型的 SMILES ，左方是生成分子的 SMILES，权值大体呈左上至右下的对角线排列，这与输入和输出 SMILES 相似度较高的特性吻合。值得住意的是，表明分子连接位置的 &lt;code&gt;*&lt;/code&gt; 几乎没有权值，说明模型从语义上学习到 &lt;code&gt;*&lt;/code&gt; 是不会出现在输出中的输入标记。此外，还可以注意到表示两分子片段的 &lt;code&gt;.&lt;/code&gt; 在输出的连接（蓝色）部分具有很大权重，表明模型能够认识这个分隔符并将其转化为连接部分。输入 SMILES 开头部分的 &lt;code&gt;L_3&lt;/code&gt; 在连接（蓝色）部分也具有较大权值，可以佐证模型根据约束条件生成连接部分。&lt;/p&gt;
&lt;h3 id="fen-zi-dui-jie-an-li"&gt;分子对接案例&lt;/h3&gt;
&lt;p&gt;除了对生成分子进行评估，文章还结合分子对接等技术验证了 SyntaLinker 应用在药物发现中的可行性。例如，文章使用已有 FBDD 案例相同的分子片段，借助 SyntaLinker 模型生成最终分子，使用 MOE 对生成分子打分，其分数甚至高于原有案例中设计出的分子。&lt;/p&gt;
&lt;p&gt;SyntaLinker 模型还可以用于先导化合物的优化，文章选择 dequalinium 作为先导化合物，使用 MMPs 将其划分为分子对，使用 SyntaLinker 模型根据分子对数据生成分子，经过分子对接的验证，生成分子性能确实得到了优化。&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章基于 conditional transformer 模型设计子 SyntaLinker 模型，SyntaLinker 模型能够根据给定的分子对数据生成相应的连接部分，最终生成一个新分子，完成了 FBDD 中分子连接的任务。同时，transformer 能够基于语义处理序列，这使得 SyntaLinker 模型生成的分子能够很好地满足指定的约束。最后文章还尝试了将 SyntaLinker 模型与分子对接相应合，拓展了将其应用于从分子片段构建虚拟库、优化优导化合物的可能性。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Transformer"></category></entry><entry><title>文献总结｜使用强化学习和基于图的深度生成模型进行从头药物设计</title><link href="https://tseing.github.io/sui-sui-nian/2022-11-05-summary-doi.org/10.1021/acs.jcim.2c00838.html" rel="alternate"></link><published>2022-11-05T00:00:00+08:00</published><updated>2022-11-05T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-11-05:/sui-sui-nian/2022-11-05-summary-doi.org/10.1021/acs.jcim.2c00838.html</id><summary type="html">&lt;p&gt;本文介绍于 2022 年发表在 Journal of Chemical Information and Modeling 上的一篇文章，文章原标题为 De Novo Drug Design Using Reinforcement Learning with Graph-Based Deep Generative Models，文章借鉴了 REINVENT 模型的强化学习策略，将其用于基于图的分子生成模型，得到了较好的结果。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1021/acs.jcim.2c00838"&gt;doi.org/10.1021/acs.jcim.2c00838&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Journal of Chemical Information and Modeling&lt;/em&gt; 上的一篇文章，文章原标题为 De Novo Drug Design Using Reinforcement Learning with Graph-Based Deep Generative Models，文章借鉴了 REINVENT 模型的强化学习策略，将其用于基于图的分子生成模型，得到了较好的结果。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;强化学习是机器学习中常用的一种策略，强化学习通过奖惩函数确定某环境下执行相应行为的优劣，从而做出决策。强化学习常常用来 fine-tune 深度生成模型，使其生成的分子逐渐向具有目标特征的分子靠近。&lt;/p&gt;
&lt;p&gt;GraphINVENT 是基于图神经网络的分子生成模型，REINVENT 是使用强化学习和 RNN 基于序列的分子生成模型。文章从这两个模型中受到启发，将 GraphINVENT 基于图的分子生成模型与 REINVENT 的强化学习策略相结合，提出了本文的模型。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7927?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7927?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章中提出的模型主要由三个部分构成：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基于图的分子生成模型；&lt;/li&gt;
&lt;li&gt;具有记忆力感知损失函数（memory-aware loss）的强化学习框架；&lt;/li&gt;
&lt;li&gt;打分模型。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="fen-zi-sheng-cheng-mo-xing"&gt;分子生成模型&lt;/h3&gt;
&lt;p&gt;分子生成模型来自于 GraphINVENT 模型，使用了门控图神经网络（GGNN）。GGNN 通过不断选取行为，从而修改输入的分子图。行为集合中包括 3 种可选的行为：添加原子、添加键和结束，将行为集合记作 &lt;span class="math"&gt;\(\mathcal{A}\)&lt;/span&gt;。那么生成分子图 &lt;span class="math"&gt;\(\mathcal{G}\)&lt;/span&gt; 的任务就可以描述为一个马尔可夫过程：代理模型依据一定的行为概率分布（action probability distributions, APD）不断选择行为，最终生成 &lt;span class="math"&gt;\(\mathcal{G}\)&lt;/span&gt;。行为概率分布由当前的状态决定，也就是说，通过前一步骤添加原子或键决定下一步可能的行为。&lt;/p&gt;
&lt;p&gt;每个步骤的 APD 可以记作 &lt;span class="math"&gt;\(\mathrm{APD}_i\)&lt;/span&gt;，&lt;span class="math"&gt;\(f:\mathcal{G}_i\rightarrow \mathrm{APD}_i\)&lt;/span&gt;，GGNN 模型就是将在 &lt;span class="math"&gt;\(i\)&lt;/span&gt; 步骤生成的子图 &lt;span class="math"&gt;\(\mathcal{G}_i\)&lt;/span&gt; 映射到&lt;span class="math"&gt;\(\mathrm{APD}_i\)&lt;/span&gt; 的函数 &lt;span class="math"&gt;\(f\)&lt;/span&gt;，若用 &lt;span class="math"&gt;\(a_i\)&lt;/span&gt; 表示每个步骤的行为，那么完整的图生成过程就可以表示为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{G}_0\rightarrow a_0\sim\mathrm{APD}_0\rightarrow\mathcal{G}_1\rightarrow\cdots\rightarrow a_{n-1}\sim\mathrm{APD}_{n-1}\rightarrow\mathcal{G}_n$$&lt;/div&gt;
&lt;p&gt;在 GGNN 训练中使用目标 &lt;span class="math"&gt;\(\mathrm{APD}_\mathrm{t}\)&lt;/span&gt; 与预测 &lt;span class="math"&gt;\(\mathrm{APD}_\mathrm{p}\)&lt;/span&gt; 的 KL 散度作为损失函数:&lt;/p&gt;
&lt;div class="math"&gt;$$D_\mathrm{KL}(\mathrm{APD}_\mathrm{t}||\mathrm{APD}_\mathrm{p})=\sum_{a\in\mathcal{A}}\mathrm{APD}_\mathrm{t}(a)\log\frac{\mathrm{APD}_\mathrm{t}(a)}{\mathrm{APD}_\mathrm{p}(a)}$$&lt;/div&gt;
&lt;h3 id="qiang-hua-xue-xi-kuang-jia"&gt;强化学习框架&lt;/h3&gt;
&lt;p&gt;强化学习的目的是基于先验策略 &lt;span class="math"&gt;\(\pi_\mathrm{prior}\)&lt;/span&gt; 更新策略，使行为序列的预期打分增加，具体来说，就是在每个学习步骤中更新代理模型，保证其一直是最佳的代理模型。最佳代理模型提醒（the best agent reminder， BAR）损失函数定义为：&lt;/p&gt;
&lt;div class="math"&gt;$$J(\boldsymbol{\theta})=(1-\alpha)J_\mathbb{A}(\mathbb{A},\mathbb{P};\boldsymbol{\theta})+\alpha J_\tilde{\mathbb{A}}(\mathbb{A},\tilde{\mathbb{A}};\boldsymbol{\theta})$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(\alpha\in[0,1]\)&lt;/span&gt; 是设定的比例系数，&lt;span class="math"&gt;\(\mathbb{P}\)&lt;/span&gt; 是先验模型，&lt;span class="math"&gt;\(\mathbb{A}\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(\tilde{\mathbb{A}}\)&lt;/span&gt; 分别是当前模型与最优模型（详见强化学习的策略梯度算法）。&lt;/p&gt;
&lt;h3 id="da-fen-han-shu"&gt;打分函数&lt;/h3&gt;
&lt;p&gt;为了执行不同的优化任务，使用了不同的打分函数。&lt;/p&gt;
&lt;h4&gt;增加或减少分子的大小&lt;/h4&gt;
&lt;p&gt;为了改变生成分子的大小，提出了以下打分函数：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{equation}
    S_\mathrm{size}(A)=
    \begin{cases}
        0, &amp;amp;\mathrm{if\ not\ \{PT,\ valid\ and\ unique\}}\\
        1-\frac{|n_\mathrm{nodes}-n^*_\mathrm{nodes}|}{\max_\mathrm{nodes}-n^*_\mathrm{nodes}}, &amp;amp;\mathrm{otherwise}
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(n^*_\mathrm{nodes}\)&lt;/span&gt; 是分子中目标重原子数量，若要增加分子大小，设定高 &lt;span class="math"&gt;\(n^*_\mathrm{nodes}\)&lt;/span&gt;，若要减小分子大小，设定低&lt;span class="math"&gt;\(n^*_\mathrm{nodes}\)&lt;/span&gt;。&lt;span class="math"&gt;\(\max_\mathrm{nodes}\)&lt;/span&gt; 是分子中最大节点数量，&lt;span class="math"&gt;\(n_\mathrm{nodes}\)&lt;/span&gt; 是分子中重原子数量，&lt;span class="math"&gt;\(A\)&lt;/span&gt; 指当前步骤的行为，&lt;span class="math"&gt;\(\mathrm{PT}\)&lt;/span&gt;  指结束构造分子的行为。&lt;/p&gt;
&lt;h4&gt;增加分子类药性&lt;/h4&gt;
&lt;p&gt;类药性使用 RDKit 的 QED 进行评估，打分函数定义为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{equation}
    S_\mathrm{QED}(A)=
    \begin{cases}
        0, &amp;amp;\mathrm{if\ not\ \{PT,\ valid\ and\ unique\}}\\
        \mathrm{QED}(\mathrm{Mol}(A)), &amp;amp;\mathrm{otherwise}
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;h4&gt;增加分子活性&lt;/h4&gt;
&lt;p&gt;使用支持向量机模型预测分子对于 DRD2 的活性，打分函数定义为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{equation}
    S_\mathrm{QED}(A)=
    \begin{cases}
        1, &amp;amp;\mathrm{if\ PT,\ valid,\ unique,}\\
        &amp;amp;\quad \mathrm{QED}&amp;gt;0.5\ \mathrm{and\ activity} &amp;gt; 0.5\\
        0, &amp;amp;\mathrm{otherwise}
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;h3 id="shu-ju"&gt;数据&lt;/h3&gt;
&lt;p&gt;训练模型的 DRD2 活性分子数据来自于 ChEMBL。&lt;/p&gt;
&lt;h2 id="jie-guo_1"&gt;结果&lt;/h2&gt;
&lt;h3 id="bu-tong-da-fen-han-shu"&gt;不同打分函数&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7928?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7928?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;从使用不同打分函数生成的分子数据中可以看出，在训练过程中，生成分子的均分不断提高，合法分子和 PT 分子的比例也不断升高，说明打分函数都能够正确地奖惩生成分子，可以用于分子生成模型的训练。另外，选择减小分子尺寸或提高分子类药性或提高活性的打分函数后，独特分子的比例有所下降，这主要是因为指定的打分函数使模型进入了一个更小的化学空间。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7929?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7929?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章分别从先验模型与单个 fine-tune 过的模型中选取 10000 个分子，在 10 个不同 fine-tune 过的模型中各选取 1000 个分子进行评估。针对平均 QED 这一指标，经过 fine-tune 的模型表现出了接近的数值且要高于先验模型。最重要的是，先验模型无法生成具有 DRD2 活性的分子，而在这一点上，经过 fine-tune 的模型生成的活性分子数量显著更高。最后，来自于 10 个不同模型的 10000 个分子中，活性分子与独特分子的占比都很高，说明 10 个模型间重叠程度小，将比单个模型更有潜力。&lt;/p&gt;
&lt;h3 id="ke-he-cheng-xing"&gt;可合成性&lt;/h3&gt;
&lt;p&gt;文章使用 AiZynthFinder 分析分子的可合成性，AiZynthFinder 能通过循环树搜索的方式将分子通过化学反应分割为商用试剂分子。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7930?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7930?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;可以看出，预训练模型生成的可合成分子的比例要低于训练集，可以认为 GraphINVENT 模型没能学习到可合成性这一特征。在经过 fine-tune 的模型中，除了增大分子尺寸的模型以外，都生成了较多可合成分子。主要原因是，一方面，减小分子的尺寸就是在提高分子的可合成性，另一方面，具有高类药性与 DRD2 活性的分子大多具有相似的化学结构或片段，这也使得该类分子具有较高可合成性。&lt;/p&gt;
&lt;h3 id="tao-lun"&gt;讨论&lt;/h3&gt;
&lt;p&gt;模型在训练过程中并没有使用任何真实活性分子的数据，fine-tune 之前的模型无法生成具有真实活性的分子，而经过 fine-tune 的模型能够生成一部分真实具有活性的分子，表明在实际药物发现中尚未发现真实活性分子情况下，文章中所使用的模型具有应用潜力。&lt;/p&gt;
&lt;p&gt;文章中使用记忆力机制能够使模型在训练中更加平滑地偏向于最优代理模型，也能够使模型不会忘记生成较优分子的行为序列，从而引导模型更好地完成生成分子任务。文章使用的 BAR 损失函数能够很好完成多种分子生成任务。&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章将策略梯度强化学习应用于基于图的从头药物设计工具，并且使用该模型生成了具有目标特征的分子。在该模型中所使用的 BAR 损失函数能够用于模型训练，并提升了分子生成模型的性能。此外，模型中使用的 4 种打分函数也完成了 4 种生成具有相应特征分子的任务。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="GNN"></category><category term="RL"></category></entry><entry><title>文献总结｜ChemistGA：用于实际药物发现的可合成分子生成算法</title><link href="https://tseing.github.io/sui-sui-nian/2022-10-29-summary-doi.org/10.1021/acs.jmedchem.2c01179.html" rel="alternate"></link><published>2022-10-29T00:00:00+08:00</published><updated>2022-10-29T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-10-29:/sui-sui-nian/2022-10-29-summary-doi.org/10.1021/acs.jmedchem.2c01179.html</id><summary type="html">&lt;p&gt;本文介绍于 2022 年发表在 Journal of Medicinal Chemistry 上的一篇文章，文章原标题为 ChemistGA: A Chemical Synthesizable Accessible Molecular Generation Algorithm for Real-World Drug Discovery，文章改进了传统的遗传算法，使其在药物分子生成的任务上具有比深度学习更优的表现效果。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1021/acs.jmedchem.2c01179"&gt;doi.org/10.1021/acs.jmedchem.2c01179&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍于 2022 年发表在 &lt;em&gt;Journal of Medicinal Chemistry&lt;/em&gt; 上的一篇文章，文章原标题为 ChemistGA: A Chemical Synthesizable Accessible Molecular Generation Algorithm for Real-World Drug Discovery，文章改进了传统的遗传算法，ChemistGA 算法在药物分子生成的任务上具有比深度学习更优的表现效果。&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;基于深度学习的分子生成方法大多都是数据驱动型的方法，这些模型通常需要大量的数量用于训练模型，从而生成特定结构和特征的分子。而传统的机器学习方法，例如遗传算法，不需要大量数据，也不需要经过训练过程，只需要少量的分子数据就能生成大量分子。因此，在深度学习席卷所有行业的今天，遗传算法等机器学习方法仍具有优势。&lt;/p&gt;
&lt;p&gt;遗传算法借鉴了生物学中遗传的概念，从初始种群（初始数据）出发，在两两个体间发生数据的交叉、突变，得到子代，再以子代作为父代不断繁衍。在繁衍的过程中，引入适应函数，适应性函数衡量了个体是否适应环境（满足目标要求），并淘汰低于阈值的个体。繁衍与淘汰的过程不断迭代，直至满足结束条件（迭代次数或子代与父代间适应性函数的差异），最终的种群就是问题的最优解。&lt;/p&gt;
&lt;p&gt;但将遗传算法用于分子生成任务仍有一定问题，例如，染色体交叉和突变的过程通常是随机的，若将分子的片段随机交换，很容易生成大量无法合成的分子。&lt;/p&gt;
&lt;p&gt;因此，文章结合化学合成模版和逆合成预测等模块改进了遗传算法，构造了适用于分子生成任务的模型，取得了良好的效果。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="jiao-cha"&gt;交叉&lt;/h3&gt;
&lt;p&gt;ChemistGA 的交叉步骤不是随机的交换，而是使用了反应预测模型 molecular transformer（MT），MT 以两个分子的为输入（&lt;code&gt;SMILES.SMILES&lt;/code&gt;），输出一系列分子。MT 已经经过专门化学反应数据的预训练，因此它会基于反应事实预测两个分子相互反应可能产生的结果。就算两个分子不能反应，MT 也能给出一系列具有两分子结构特征的分子，从而避免生成不可合成的分子。&lt;/p&gt;
&lt;h3 id="fan-jiao"&gt;反交&lt;/h3&gt;
&lt;p&gt;使用 MT 作为分子交叉的模型无法避免最后的结果陷入局部最优解，因此引入了反应的方法。具体来说，就是在每一子代中插入一部分初始种群中的个体。&lt;/p&gt;
&lt;h3 id="gua-ying-xing-han-shu"&gt;适应性函数&lt;/h3&gt;
&lt;p&gt;文章使用了两种适应性函数，一种是连续适应性函数，另一种是离散适应性函数。连续适应性函数可以理解为对分子的打分，涉及 QED、SA 以及生物活性等指标。离散适应性函数也与之类似，唯一的不同在于使用 1 或 0 表示分子是否满足指标的要求。&lt;/p&gt;
&lt;h3 id="shu-ju-ji"&gt;数据集&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;靶点&lt;/th&gt;
&lt;th&gt;negative / positive&lt;/th&gt;
&lt;th&gt;来源&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;DRD2&lt;/td&gt;
&lt;td&gt;100000 / 7219&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.1186/s13321-017-0235-x"&gt;Olivecrona et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;JNK3&lt;/td&gt;
&lt;td&gt;50000 / 2665&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.48550/arXiv.1806.02473"&gt;Li et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GSK3&amp;beta;&lt;/td&gt;
&lt;td&gt;50000 / 740&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.48550/arXiv.1806.02473"&gt;Li et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="huo-xing-yu-ce-mo-xing"&gt;活性预测模型&lt;/h3&gt;
&lt;p&gt;文章针对 DRD2、JNK3 和 GSK3&amp;beta; 构建了两利活性预测模型，一种模型预测结果较为准确，另一种模型较不准确。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;准确的活性预测模型：随机森林分类&lt;/li&gt;
&lt;li&gt;不准确的活性预测模型：3 层决策树分类&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="zhi-biao"&gt;指标&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Synthesizability Rate&lt;/strong&gt;：随机选择生成的 5000 个分子，使用 Retro* 算法预测其逆合成过程，可完成的分子占比就为 Synthesizability Rate。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mismatch Rate&lt;/strong&gt;：随机选择生成的 5000 个分子，使用 RECAP 算法获取分子片段，将生成分子的片段库与商用分子片段库对比得到 Mismatch Rate。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Diversity&lt;/strong&gt;：&lt;span class="math"&gt;\(\mathrm{diversity}=1-\frac{2}{n(n-1)}\sum\mathrm{sim}(X,Y)\)&lt;/span&gt;，其中 &lt;span class="math"&gt;\(\mathrm{sim}(X,Y)\)&lt;/span&gt; 为谷本距离。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Novelty&lt;/strong&gt;：&lt;span class="math"&gt;\(\mathrm{novelty}=\frac{1}{n}\sum1[\mathrm{sim}(G,G_\mathrm{SNN}&amp;lt;0.4&amp;gt;)]\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Scaffolds&lt;/strong&gt;：使用 Murcko 化合物骨架数据计算骨架数量。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="jie-guo-yu-lun-lun_1"&gt;结果与论论&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7893?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7893?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;ChemistGA 的主要工作流程是如果所示，首先计算初始种群的适应性函数，根据适应性函数选择其中的部分分子交叉，再经过突变过程后，重新计算分子的适应性函数，不断迭代。与 ChemistGA 不同，R-ChemistGA 每个周期前 4 次使用不准确的活性预测模型计算适应性函数，而第 5 次使用准确模型。&lt;/p&gt;
&lt;p&gt;这是由于在现实情况下，我们很难得到完全准确且数据量大的化合物活性数据库，引入的噪声的目的就是为了模拟了这种现实状况。&lt;/p&gt;
&lt;h3 id="shi-yan-fang-an-1"&gt;实验方案 1&lt;/h3&gt;
&lt;p&gt;实验方案 1 分别使用 ChemistGA 与 GB-GA（传统遗传算法）针对 JNK3 与 GSK3&amp;beta; 生成分子，比较二者结果。&lt;/p&gt;
&lt;p&gt;在生物活性（通过预测模型）、QED 以及 SA 几个方面，ChemistGA 都生成了更好的结果，其中的重要原因就是 GB-GA 等传统遗传算法的交叉过程是随机的，不可避免地生成了大量无效分子。&lt;/p&gt;
&lt;h3 id="shi-yan-fang-an-2"&gt;实验方案 2&lt;/h3&gt;
&lt;p&gt;实验方案 2 的目标是评估 ChemistGA 基于现实活性分子生成药物分子的能力，任务 1 针对于 DRD2 靶点，任务 1 针对于 JNK3 与 GSK3&amp;beta; 靶点。&lt;/p&gt;
&lt;p&gt;分别从 REINVENT、GB-GA、RationaleRL 和 ChemistGA 几种模型中随机选择 5000 个分子用于比较结果。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7894?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7894?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;从表格上半部分的结果中，可以看出，ChemistGA 在各方面具有比较均衡结果，也就是 ChemistGA 在生成分子的多样性与可合成性间找到了平衡。而 REINVENT 产生的结果明显多样性不足，GB-GA 的结果可合成性低。任务 2 的结果也类似。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7896?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7896?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="gua-ying-xing-han-shu-de-ying-xiang"&gt;适应性函数的影响&lt;/h3&gt;
&lt;p&gt;以上实验中的遗传算法（GB-GA 与 ChemistGA）使用的都是连续适应性函数，接下来将适应性函数换为离散适应性函数，表格的下半部分即为结果，以（F）表示。&lt;/p&gt;
&lt;p&gt;在使用离散适应性函数后，生成结果有了一定程度上的提升，其本质原因是使用离散适应性函数相当于引入了一定的随机性。例如，在使用连续适应性函数的情况下，若有评分为 3.65、3.64 与 3.63 的三个分子，算法就会选择 3.65 与 3.64 两个分子作为父代，尽管 3.63 的分子也具有近似相同的评分，但也会被淘汰，所以该分子的结构片段就很难进入到最终的生成结果中。若使用离散适应性函数，相应的打分就为 4、4、4，那么算法就将随机选择两个分子作为父代，最后的结果也会具有更大的多样性和可合成性。&lt;/p&gt;
&lt;h3 id="r-chemistga"&gt;R-ChemistGA&lt;/h3&gt;
&lt;p&gt;R-ChemistGA 与 ChemistGA 唯一不同之处在于 R-ChemistGA 使用不准确的活性预测模型引入了噪声，用于模拟真实世界中的数据。&lt;/p&gt;
&lt;p&gt;R-ChemistGA 产生的结果在各方面都与 ChemistGA 相当，同时具有更高的 novelty，说明 ChemistGA 算法不仅足够稳健，可以用不完全准确的真实数据集训练，同时还能通过使用不准确的活性预测模型的方法提升生成分子的 novelty。&lt;/p&gt;
&lt;p&gt;可以将 R-ChemistGA 工作流程中的 5 次循环看作 1 个周期，每个周期中，前 4 次循环使用用不准确的活性预测模型淘汰分子，第 5 次循环使用准确的活性预测模型淘汰分子。&lt;/p&gt;
&lt;p&gt;R-ChemistGA 的生成结果具有更高 novelty 的原因就在于，预测模型认为没有活性的分子会被淘汰，不会使其产生子代，但很重要的一个事实就是，没有活性的分子通过交叉得到的子代可能具有活性。因此，R-ChemistGA 相当于放宽了淘汰的标准，使其尽可能产生多的分子，在第 5 次循环才用更严格的标准淘汰掉没有活性的分子。&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章提出了两种分子生成算法，分别是 ChemistGA 与 R-ChemistGA。这两种算法都基于机器学习中的遗传算法，改进了遗传算法生成的分子难于合成等问题，让遗传算法在分子生成领域也能发挥其独特的优势。&lt;/p&gt;
&lt;p&gt;ChemistGA 与 R-ChemistGA 的主要特点就是不需要大量数据用于训练模型，算法足够稳健，可以使用不是完全准确的真实活性数据用于分子生成，生成的分子具有较高的多样性与可合成性。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Algorithm"></category></entry><entry><title>文献总结｜通过随机化 SMILES 序列提升分子生成模型质量</title><link href="https://tseing.github.io/sui-sui-nian/2022-10-21-summary-doi.org/10.1186/s13321-019-0393-0.html" rel="alternate"></link><published>2022-10-21T00:00:00+08:00</published><updated>2022-10-21T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-10-21:/sui-sui-nian/2022-10-21-summary-doi.org/10.1186/s13321-019-0393-0.html</id><summary type="html">&lt;p&gt;本文介绍于 2019 年发表在 Journal of Cheminformatics 上的一篇文章，文章原标题为 Randomized SMILES strings improve the quality of molecular generative models。&lt;/p&gt;</summary><content type="html">&lt;p&gt;本文介绍于 2019 年发表在 &lt;em&gt;Journal of Cheminformatics&lt;/em&gt; 上的一篇文章，文章原标题为 Randomized SMILES strings improve the quality of molecular generative models。&lt;/p&gt;
&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1186/s13321-019-0393-0"&gt;doi.org/10.1186/s13321-019-0393-0&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;SMILES 是深度学习邻域最常用的化学分子描述方式，在众多研究中使用的 SMILES 都是规范形式（canonical format）。而规范形式的 SMILES 常常会使模型具有一定偏向，还常常导致模型生成大量极相似的分子。文章考查了不同形式的 SMILES 编码对于模型的影响，主要包括规范形式、无约束随机形式和有约束随机形式。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7804?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7804?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;例如图片所示，对于阿司匹林分子具有三种不同的编码形式，规范形式（a）是 RDKit 工具中的默认形式。经过随机化后，起始原子发生了变化，无约束形式与有约束形式的区别在于，无约束形式先编码芳环，再编码支链，而有约束形式则先编码支链，最后编码芳环。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="yu-chu-li"&gt;预处理&lt;/h3&gt;
&lt;p&gt;对于 SMILES 的预处理在文中被称为 tokenization，其目的是使 SMILES 序列成为能够被神经网络识别的形式。其步骤包括在字列始末加上起始与终止符号、将两个字符的元素（如 Cl 和 Br）视作一个 token 等，最终将 SMILES 序列转化为 one-hot 形式。&lt;/p&gt;
&lt;h3 id="mo-xing-jie-gou"&gt;模型结构&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7805?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7805?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;分子生成模型由 RNN 构成，经过处理后的 SMILES 序列将逐个 token 进入 &lt;span class="math"&gt;\(m\)&lt;/span&gt; 维的 embedding 层，再进入 &lt;span class="math"&gt;\(l\)&lt;/span&gt; 层大小为 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 的 LSTM 或 GRU 单元，在 RNN 层间也可以设置 dropout 层，最终得到 token 的概率分布 &lt;span class="math"&gt;\(Y_{ij}\)&lt;/span&gt;。&lt;/p&gt;
&lt;h3 id="shu-ju-ji"&gt;数据集&lt;/h3&gt;
&lt;p&gt;GDB-13 数据来自于&lt;a href="https://gdb.unibe.ch/downloads/"&gt;官网&lt;/a&gt;，使用 RDKit 对 SMILES 规范化。&lt;/p&gt;
&lt;p&gt;ChEMBL 25 数据来自于 ChEMBL 官网，使用 MolVS 0.1.1 数据库对其处理，主要的处理包括去重、去除含有重原子的分子等，最终数据集中的分子都编码为 one-hot 形式。&lt;/p&gt;
&lt;p&gt;在使用随机化 SMILES 序列训练模型时，将数据集中的分子转化为随机化形式，也就是说，不论分子的编码形式是哪一种，数据集所使用的分子都是相同的。&lt;/p&gt;
&lt;h3 id="xun-lian"&gt;训练&lt;/h3&gt;
&lt;p&gt;将训练集中的若干 SMILES 整合为批数据后用于训练 RNN，在训练过程中使用了 Teacher&amp;rsquo;s Forcing 方法。&lt;/p&gt;
&lt;p&gt;未预训练的模型通常没有很好的预测能力，因此每个 RNN 单元产生的错误结果势必会导致模型训练时间大大增加。Teacher&amp;rsquo;s Forcing 方法就是为了解决这个问题，具体步骤是忽略每个 RNN 单元输出的预测结果，而是以正解的标签作为下一个 RNN 单元的输入，避免了一个 RNN 单元的错误预测影响整个网络的训练。&lt;/p&gt;
&lt;h2 id="ping-jie-zhi-biao_1"&gt;评价指标&lt;/h2&gt;
&lt;h3 id="dui-sheng-cheng-mo-xing-de-ping-gu"&gt;对生成模型的评估&lt;/h3&gt;
&lt;p&gt;文章假设最好的模型对于验证集、训练集和生成分子集的 NLL 分布应当是均一且相等（uniform and equal）的，所以就用 JSD（Jensen&amp;ndash;Shannon Divergence）衡量若干概率分布的差异：&lt;/p&gt;
&lt;div class="math"&gt;$$JSD=H\left(\sum_{d\in D}\alpha_i\cdot d_i\right)-\sum_{d\in D}\alpha_iH(d_i)$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(H(d)\)&lt;/span&gt; 是给定概率分布的信息熵，&lt;span class="math"&gt;\(\alpha_d\)&lt;/span&gt; 为权值，满足 &lt;span class="math"&gt;\(0&amp;lt;\alpha_d&amp;lt;1\)&lt;/span&gt; 且 &lt;span class="math"&gt;\(\sum\alpha_d=1\)&lt;/span&gt;。当 &lt;span class="math"&gt;\(d_i=d_j\)&lt;/span&gt; 时，就有 &lt;span class="math"&gt;\(JSD\rightarrow 0\)&lt;/span&gt; ，但此时还有可能 &lt;span class="math"&gt;\(i\not =j\)&lt;/span&gt;， 所以该指标只能保证概率分布是相等的而非均一的。&lt;/p&gt;
&lt;p&gt;UC-JSD（Uniformity&amp;ndash;Completeness JSD）解决了这个问题，考虑给定的三个 NLL 向量，有&lt;/p&gt;
&lt;div class="math"&gt;$$NLLS=\{NLL_\mathrm{validation},NLL_\mathrm{training},NLL_\mathrm{sampled}\}$$&lt;/div&gt;
&lt;p&gt;并指定 &lt;span class="math"&gt;\(\alpha_i=1/3\)&lt;/span&gt;。当 &lt;span class="math"&gt;\(UC_{JSD}\rightarrow0\)&lt;/span&gt; 时，生成的分子具有相同的 NLL 或三个概率分布均一。&lt;/p&gt;
&lt;h3 id="dui-sheng-cheng-jie-guo-de-ping-gu"&gt;对生成结果的评估&lt;/h3&gt;
&lt;p&gt;对于 GDB-13 数据集，文章对生成结果提出了三个要求：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;均一（uniformity）：对于各取样结果（生成分子）的概率相等&lt;/li&gt;
&lt;li&gt;完备（completeness）：能够从 GDB-13 数据集中取样出所有分子&lt;/li&gt;
&lt;li&gt;封闭（closedness）：只有 GDB-13 数据集中的分子被取样&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;针对这三个要求，文章定义了三种量化指标：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\mathrm{uniformity}=ratio_\mathrm{unique}/\varphi(k)\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\mathrm{completeness}=ratio_\mathrm{unique}/\varphi(|in|)\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(closedness=ratio_\mathrm{in}\)&lt;/span&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span class="math"&gt;\(\varphi(k)\)&lt;/span&gt; 表示在 GDB-13 的理想模型（每个分子概率完全均一）上生成 &lt;span class="math"&gt;\(k\)&lt;/span&gt; 个分子中不同分子的比例。&lt;/p&gt;
&lt;p&gt;此外，具有合法 SMILES 的分子就称为 valid，在 GDB-13 数据集中的分子就称为 in，在 GDB-13 中独一的分子就称为 unique。&lt;/p&gt;
&lt;div class="math"&gt;$$UCC=\mathrm{completeness}\cdot\mathrm{uniformity}\cdot\mathrm{closedness}$$&lt;/div&gt;
&lt;p&gt;作为对模型结果的整体打分。&lt;/p&gt;
&lt;h3 id="gong-ju"&gt;工具&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;PyTorch 1.0.1&lt;/li&gt;
&lt;li&gt;RDKit 2019_03_01&lt;/li&gt;
&lt;li&gt;Spark 2.4.3：数据处理&lt;/li&gt;
&lt;li&gt;MOSES 和 FCD：提供评价指标&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="jie-guo_1"&gt;结果&lt;/h2&gt;
&lt;h3 id="gui-fan-xing-shi-yu-sui-ji-hua-xing-shi"&gt;规范形式与随机化形式&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7829?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7829?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;在 GDB-13 中随机选择 1000000 个分子用于模型训练，结果表明随机化形式 SMILES 训练的模型生成了更多 GDB-13 数据集中的分子。从生成结果的其他指标上来看，与规范形式 SMILES 训练的模型相比，随机化形式模型产生了更好的结果。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7830?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7830?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="chao-can-shu-de-you-hua"&gt;超参数的优化&lt;/h3&gt;
&lt;p&gt;在 RNN 间的 dropout 比例、批处理数据的大小都属于模型的超参数，针对于这两个超参数，文章比较了改变这两个超参数对于 3 种模型 4 个指标的影响。结果表明，在增加 dropout 比例后，规范形式的模型表现出更好的效果，其完备性上升了，但封闭性下降了，也就是说模型以产生更多错误为代价，生成了更多 GDB-13 数据集中的分子。至于批大小，随着批处理数据的增加，所有模型的效果都改善了。&lt;/p&gt;
&lt;h3 id="uc-jsd-ping-gu"&gt;UC-JSD 评估&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7831?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7831?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;由于不同模型的输出空间不同，不同模型的 UC-JSD 不能相互比较，但 UC-JSD 可以用作为对于每个 epoch 训练结果的损失函数。UC-JSD-UCC 图像可以明确显示中模型在各个 epoch 中优化的过程，最后得到的最优模型应当是具有最低 UC-JSD 与 最高 UCC 的模型。&lt;/p&gt;
&lt;h3 id="xiao-fen-zi-ji-ce-shi"&gt;小分子集测试&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7832?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7832?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章中分别使用 1000 个分子与 10000 个分子训练模型。使用 1000 分子训练的规范形式模型仅生成了 14.5% 的 GDB-13 数据集分子，其合法性也仅有 0.504，可以认为模型没有学习到数据集的特征。当训练集增加到 10000 个分子，模型的效果也有所提高，但随机化形式的模型效果都要高于规范形式模型。&lt;/p&gt;
&lt;h3 id="chembl-shu-ju-ce-shi"&gt;ChEMBL 数据测试&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="n" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7833?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="n" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7833?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;文章还使用 ChEMBL 的类药分子训练集测试了两种两种模型，最后绘制了两种模型对于 NLL 的核密度估计（Kernel Density Estimates）结果。结果表明，规范形式模型生成的规范形式 SMILES 能够很好地接近训练集和验证集，但是它不能很好地产生随机形式的 SMILES。与之相反，随机化形式模型不仅能产生随机化形式的 SMILES，产生规范形式 SMILES 的平均概率也很高。这个结果可以说明规范形式模型的输出空间是随机化形式模型的子集。&lt;/p&gt;
&lt;h2 id="tao-lun_1"&gt;讨论&lt;/h2&gt;
&lt;p&gt;当以规范形式 SMILES 表示分子时，模型不仅要学习如何生成合法的 SMILES 序列，还需要学习如何以规范形式生成。相应地，如果使用随机化形式的 SMILES 序列，模型就可以不受限制地学习 SMILES 语法。&lt;/p&gt;
&lt;p&gt;从另一方面理解，就是随机化 SMILES 序列具有数据增强（Data Augmentation）的功能，类似于对图片进行裁切、旋转以提升模型识别的准确度，随机化 SMILES 序列可以看作是从不同的角度「观察」一个分子，这不仅能提高模型应对噪声的能力，还有利于模型更好地学习到训练集化学空间的特征。&lt;/p&gt;
&lt;p&gt;在文章中构建的模型很难生成较大的分子，可以将模型生成每个 token 的步骤看作一系列可选的行为（加原子、加键），这种模型的问题就在于随着分子增大，可选的行为激增，所以使用 SMILES 生成较大、较复杂的的分子仍有难度。&lt;/p&gt;
&lt;h2 id="jie-lun"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章基于 RNN 构建了分子生成模型，在不用修改仍何模型结构的情况下，使用随机化的 SMILES 序列编码分子可以显著提高模型质量。&lt;/p&gt;
&lt;p&gt;在使用 ChEMBL 训练集的测试中，文章进一步确定了相比于常用的规范形式模型，随机化形式模型具有更大的输出空间，也是性能更优的原因。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category></entry><entry><title>RDKit 入门：绘制分子图像</title><link href="https://tseing.github.io/sui-sui-nian/2022-10-20-rdkit-draw-molecule.html" rel="alternate"></link><published>2022-10-20T00:00:00+08:00</published><updated>2022-10-20T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-10-20:/sui-sui-nian/2022-10-20-rdkit-draw-molecule.html</id><summary type="html">&lt;p&gt;介绍使用 RDKit 实现分子可视化的基本操作，主要使用了 rdMolDraw2D 模块，其功能包括分子结构的绘制以及在分子结构上添加标记。&lt;/p&gt;</summary><content type="html">&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="分子可视化"&gt;分子可视化&lt;a class="anchor-link" href="#分子可视化"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[1]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rdkit&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rdkit.Chem&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Draw&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="绘制单个分子"&gt;绘制单个分子&lt;a class="anchor-link" href="#绘制单个分子"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Draw.MolToImage(mol, parameters)&lt;/code&gt; 用于绘制分子的图片，可选参数包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kekulize=True&lt;/code&gt;：是否以凯库勒式表示芳香体系&lt;/li&gt;
&lt;li&gt;&lt;code&gt;size=(300, 300)&lt;/code&gt;：用像素表示的图片大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;wedgeBonds=True&lt;/code&gt;：是否用楔形键表示分子&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightAtoms=[]&lt;/code&gt;：需要高亮表示的原子&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightBonds=[]&lt;/code&gt;：需要高亮表示的化学键&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightColor=[1, 0, 0]&lt;/code&gt;：用 RGB 设定高亮颜色&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[2]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mols&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SDMolSupplier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./mols.sdf"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Draw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToImage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[2]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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
"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[3]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Draw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToImage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;kekulize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                &lt;span class="n"&gt;highlightAtoms&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;highlightBonds&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[3]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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
"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;&lt;code&gt;Draw.MolToFile(mol, filename, parameters)&lt;/code&gt; 具有与之相似的参数，不过 &lt;code&gt;Draw.MolToFile()&lt;/code&gt; 用于将分子导出为图片文件。&lt;/p&gt;
&lt;h3 id="绘制多个分子"&gt;绘制多个分子&lt;a class="anchor-link" href="#绘制多个分子"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Draw.MolsToGridImage(mols, parameters)&lt;/code&gt; 用于同时展示多个分子，其参数如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;molsPerRow=3&lt;/code&gt;：每行分子数目&lt;/li&gt;
&lt;li&gt;&lt;code&gt;subImgSize=(200, 200)&lt;/code&gt;：每个子图的大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;legends=None&lt;/code&gt;：分子的标签，应为列表&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightAtomLists=None&lt;/code&gt;：高亮的原子&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightBondLists=None&lt;/code&gt;：高亮的化学键&lt;/li&gt;
&lt;li&gt;&lt;code&gt;useSVG=False&lt;/code&gt;：是否转化为 svg 矢量图&lt;/li&gt;
&lt;li&gt;&lt;code&gt;returnPNG=False&lt;/code&gt;：是否返回 png 图片&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[4]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Draw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolsToGridImage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;molsPerRow&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;returnPNG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                     &lt;span class="n"&gt;legends&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"_Name"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;mol&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[4]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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
"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;所有图片都可以通过 &lt;code&gt;img.save(filename)&lt;/code&gt;的方式来保存。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[5]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;img&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Draw&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToImage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;img&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./save_demo.png"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="rdMolDraw2D-模块"&gt;rdMolDraw2D 模块&lt;a class="anchor-link" href="#rdMolDraw2D-模块"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Draw.rdMolDraw2D&lt;/code&gt; 模块提供了更加复杂但功能也更加强大的分子绘制方式。使用&lt;code&gt;Draw.rdMolDraw2D&lt;/code&gt; 模块绘制分子的步骤可以分为四步，首先需要创建画布，&lt;code&gt;MolDraw2DSVG()&lt;/code&gt; 用于创建 svg 图片，&lt;code&gt;MolDraw2DCairo()&lt;/code&gt; 用于创建 png 图片，然后使用 &lt;code&gt;PrepareAndDrawMolecule()&lt;/code&gt; 在画布上绘图，接着使用 &lt;code&gt;FinishDrawing()&lt;/code&gt; 结束绘图，最后输出结果。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建画布：&lt;code&gt;MolDraw2DSVG()&lt;/code&gt; / &lt;code&gt;MolDraw2DCairo()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;绘制分子：&lt;code&gt;PrepareAndDrawMolecule()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;结束绘制：&lt;code&gt;FinishDrawing()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;输出图片：&lt;code&gt;WriteDrawingText()&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="绘制单个分子"&gt;绘制单个分子&lt;a class="anchor-link" href="#绘制单个分子"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[6]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rdkit.Chem.Draw&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;IPython.display&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Image&lt;/span&gt;


&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DCairo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PrepareAndDrawMolecule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WriteDrawingText&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./rdMolDraw2D_output_1.png"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;Image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"./rdMolDraw2D_output_1.png"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[6]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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
"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;&lt;code&gt;MolDraw2DSVG(width, height)&lt;/code&gt; / &lt;code&gt;MolDraw2DCairo(width, height)&lt;/code&gt; 接受的参数决定了图片的大小。&lt;/p&gt;
&lt;h4 id="在分子上添加标记"&gt;在分子上添加标记&lt;a class="anchor-link" href="#在分子上添加标记"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;PrepareAndDrawMolecule(drawer, mol, parameters)&lt;/code&gt; 也可以接受与 &lt;code&gt;MolToImage()&lt;/code&gt; 类似的参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;legend=''&lt;/code&gt;：分子的标签&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightAtoms&lt;/code&gt;：略&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightBonds&lt;/code&gt;：略&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightAtomColors&lt;/code&gt;：略&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightBondColors&lt;/code&gt;：略&lt;/li&gt;
&lt;li&gt;&lt;code&gt;highlightAtomRadii&lt;/code&gt;：指定原子高亮的半径&lt;/li&gt;
&lt;li&gt;&lt;code&gt;confId = -1&lt;/code&gt;：存储分子构象的 Conformer() 类 id&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kekulize=True&lt;/code&gt;：略&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[7]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DCairo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PrepareAndDrawMolecule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'Furan'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;highlightAtoms&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                                   &lt;span class="n"&gt;highlightBonds&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;highlightAtomRadii&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.35&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WriteDrawingText&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./rdMolDraw2D_output_2.png"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;Image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"./rdMolDraw2D_output_2.png"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[7]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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
"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h4 id="绘制多个分子"&gt;绘制多个分子&lt;a class="anchor-link" href="#绘制多个分子"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;为了避免生成太多的图片文件，这里先额外介绍一下在 Jupyter Notebook 中使用 svg 绘制分子而不导出图片文件的方法。绘制分子步骤没有差异，但是在最后一步中不使用 &lt;code&gt;WriteDrawingText()&lt;/code&gt; 导出文件，而使用 svg 画布特有的 &lt;code&gt;GetDrawingText()&lt;/code&gt;。&lt;code&gt;GetDrawingText()&lt;/code&gt; 直接返回 svg 图片的二进制字符串，使用 &lt;code&gt;IPython.display&lt;/code&gt; 中的 &lt;code&gt;SVG&lt;/code&gt; 就能让图片直接显示在输出区了。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[8]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;IPython.display&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SVG&lt;/span&gt;


&lt;span class="n"&gt;mol&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'[F][C@@H](Cl)NC/C=C/C'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DSVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PrepareAndDrawMolecule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;SVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetDrawingText&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[8]:&lt;/div&gt;
&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg baseprofile="full" height="150px" version="1.1" viewbox="0 0 450 150" width="450px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
&lt;!-- END OF HEADER --&gt;
&lt;rect height="150.0" style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" x="0.0" y="0.0"&gt; &lt;/rect&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 101.9,59.5 L 100.6,61.3" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 95.0,53.3 L 92.5,57.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 88.2,47.1 L 84.3,52.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 81.3,41.0 L 76.2,48.3" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 74.5,34.8 L 68.0,43.9" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 67.6,28.6 L 59.9,39.6" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 108.7,65.7 L 106.3,93.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 106.3,93.6 L 103.8,121.4" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 108.7,65.7 L 134.5,53.7" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 134.5,53.7 L 160.3,41.7" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 179.2,44.0 L 202.0,60.0" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 202.0,60.0 L 224.9,76.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 224.9,76.0 L 285.9,47.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 285.9,47.6 L 341.0,86.3" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 286.4,64.5 L 325.0,91.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-6 atom-6 atom-7" d="M 341.0,86.3 L 402.0,58.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="atom-0" d="M 48.0 17.5 L 59.3 17.5 L 59.3 19.6 L 50.5 19.6 L 50.5 25.4 L 58.3 25.4 L 58.3 27.6 L 50.5 27.6 L 50.5 36.5 L 48.0 36.5 L 48.0 17.5 " fill="#33CCCC"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 95.4 133.4 Q 95.4 128.6, 97.6 126.2 Q 99.9 123.7, 104.1 123.7 Q 108.0 123.7, 110.1 126.4 L 108.3 127.9 Q 106.8 125.9, 104.1 125.9 Q 101.2 125.9, 99.7 127.8 Q 98.2 129.7, 98.2 133.4 Q 98.2 137.2, 99.7 139.1 Q 101.3 141.0, 104.4 141.0 Q 106.5 141.0, 108.9 139.8 L 109.7 141.8 Q 108.7 142.4, 107.2 142.8 Q 105.7 143.2, 104.0 143.2 Q 99.9 143.2, 97.6 140.7 Q 95.4 138.1, 95.4 133.4 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 111.2 122.5 L 113.7 122.5 L 113.7 142.9 L 111.2 142.9 L 111.2 122.5 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 165.6 27.8 L 171.8 37.9 Q 172.4 38.9, 173.4 40.7 Q 174.4 42.5, 174.5 42.6 L 174.5 27.8 L 177.0 27.8 L 177.0 46.8 L 174.4 46.8 L 167.7 35.8 Q 166.9 34.5, 166.1 33.0 Q 165.3 31.6, 165.0 31.1 L 165.0 46.8 L 162.5 46.8 L 162.5 27.8 L 165.6 27.8 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 162.3 6.8 L 164.9 6.8 L 164.9 14.9 L 174.6 14.9 L 174.6 6.8 L 177.2 6.8 L 177.2 25.9 L 174.6 25.9 L 174.6 17.1 L 164.9 17.1 L 164.9 25.9 L 162.3 25.9 L 162.3 6.8 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;除使用 &lt;code&gt;PrepareAndDrawMolecule()&lt;/code&gt; 绘制分子外，还可以使用 &lt;code&gt;DrawMolecule(mol)&lt;/code&gt; / &lt;code&gt;DrawMolecules(mol)&lt;/code&gt; 完成同样的功能，&lt;code&gt;DrawMolecule()&lt;/code&gt; 用于绘制单个分子，&lt;code&gt;DrawMolecules()&lt;/code&gt; 用于绘制多个分子。&lt;code&gt;DrawMolecule(mol)&lt;/code&gt; / &lt;code&gt;DrawMolecules(mol)&lt;/code&gt; 不需要传入画布参数，因为它们是画布的方法，它们具有与 &lt;code&gt;PrepareAndDrawMolecule()&lt;/code&gt; 相同的其他参数。&lt;/p&gt;
&lt;p&gt;从函数名称还可以看出，&lt;code&gt;PrepareAndDrawMolecule()&lt;/code&gt; 合并了 Prepare 与 Draw 两个步骤，因此在使用 &lt;code&gt;DrawMolecule()&lt;/code&gt; / &lt;code&gt;DrawMolecules()&lt;/code&gt; 绘制分子前，还需要手动完成额外的 Prepare 步骤。&lt;/p&gt;
&lt;p&gt;Prepare 步骤是将对分子的预设，例如是否为凯库勒式、是否显示楔形键，应用到分子上，如果没有相应的预设，自然也可以省略 Prepare 步骤。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[9]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DSVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mol_prepare&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PrepareMolForDrawing&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DrawMolecule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mol_prepare&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;SVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetDrawingText&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[9]:&lt;/div&gt;
&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg baseprofile="full" height="150px" version="1.1" viewbox="0 0 450 150" width="450px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
&lt;!-- END OF HEADER --&gt;
&lt;rect height="150.0" style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" x="0.0" y="0.0"&gt; &lt;/rect&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 101.9,59.5 L 100.6,61.3" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 95.0,53.3 L 92.5,57.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 88.2,47.1 L 84.3,52.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 81.3,41.0 L 76.2,48.3" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 74.5,34.8 L 68.0,43.9" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 67.6,28.6 L 59.9,39.6" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 108.7,65.7 L 106.3,93.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 106.3,93.6 L 103.8,121.4" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 108.7,65.7 L 134.5,53.7" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 134.5,53.7 L 160.3,41.7" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 179.2,44.0 L 202.0,60.0" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 202.0,60.0 L 224.9,76.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 224.9,76.0 L 285.9,47.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 285.9,47.6 L 341.0,86.3" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 286.4,64.5 L 325.0,91.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-6 atom-6 atom-7" d="M 341.0,86.3 L 402.0,58.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="atom-0" d="M 48.0 17.5 L 59.3 17.5 L 59.3 19.6 L 50.5 19.6 L 50.5 25.4 L 58.3 25.4 L 58.3 27.6 L 50.5 27.6 L 50.5 36.5 L 48.0 36.5 L 48.0 17.5 " fill="#33CCCC"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 95.4 133.4 Q 95.4 128.6, 97.6 126.2 Q 99.9 123.7, 104.1 123.7 Q 108.0 123.7, 110.1 126.4 L 108.3 127.9 Q 106.8 125.9, 104.1 125.9 Q 101.2 125.9, 99.7 127.8 Q 98.2 129.7, 98.2 133.4 Q 98.2 137.2, 99.7 139.1 Q 101.3 141.0, 104.4 141.0 Q 106.5 141.0, 108.9 139.8 L 109.7 141.8 Q 108.7 142.4, 107.2 142.8 Q 105.7 143.2, 104.0 143.2 Q 99.9 143.2, 97.6 140.7 Q 95.4 138.1, 95.4 133.4 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 111.2 122.5 L 113.7 122.5 L 113.7 142.9 L 111.2 142.9 L 111.2 122.5 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 165.6 27.8 L 171.8 37.9 Q 172.4 38.9, 173.4 40.7 Q 174.4 42.5, 174.5 42.6 L 174.5 27.8 L 177.0 27.8 L 177.0 46.8 L 174.4 46.8 L 167.7 35.8 Q 166.9 34.5, 166.1 33.0 Q 165.3 31.6, 165.0 31.1 L 165.0 46.8 L 162.5 46.8 L 162.5 27.8 L 165.6 27.8 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 162.3 6.8 L 164.9 6.8 L 164.9 14.9 L 174.6 14.9 L 174.6 6.8 L 177.2 6.8 L 177.2 25.9 L 174.6 25.9 L 174.6 17.1 L 164.9 17.1 L 164.9 25.9 L 162.3 25.9 L 162.3 6.8 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;&lt;code&gt;MolDraw2DSVG()&lt;/code&gt; / &lt;code&gt;MolDraw2DCairo()&lt;/code&gt; 除了接受 &lt;code&gt;width&lt;/code&gt; 与 &lt;code&gt;height&lt;/code&gt; 参数以外，还接受 &lt;code&gt;panelWidth&lt;/code&gt; 与 &lt;code&gt;panelHeigh&lt;/code&gt; 两个参数，这两个参数决定了子图的大小，若子图的尽寸过大，在画布中无法放置下多个分子，分子就会重叠在一起。&lt;/p&gt;
&lt;p&gt;PrepareAndDrawMolecule()&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[10]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DSVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;600&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DrawMolecules&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt; &lt;span class="n"&gt;legends&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"a"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"b"&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;SVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetDrawingText&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[10]:&lt;/div&gt;
&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg baseprofile="full" height="150px" version="1.1" viewbox="0 0 600 150" width="600px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
&lt;!-- END OF HEADER --&gt;
&lt;rect height="150.0" style="opacity:1.0;fill:#FFFFFF;stroke:none" width="600.0" x="0.0" y="0.0"&gt; &lt;/rect&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 55.2,55.6 L 54.2,57.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 49.9,50.8 L 47.9,53.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 44.6,46.0 L 41.6,50.3" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 39.3,41.3 L 35.4,46.9" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 34.0,36.5 L 29.1,43.6" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 28.8,31.7 L 22.8,40.2" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 60.4,60.3 L 58.5,81.8" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 58.5,81.8 L 56.6,103.3" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 60.4,60.3 L 80.3,51.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 80.3,51.1 L 100.2,41.9" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 114.7,43.6 L 132.3,55.9" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 132.3,55.9 L 149.9,68.3" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 149.9,68.3 L 196.9,46.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 196.9,46.4 L 239.3,76.2" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 197.3,59.4 L 227.0,80.2" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-6 atom-6 atom-7" d="M 239.3,76.2 L 286.4,54.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="atom-0" d="M 13.6 23.2 L 22.4 23.2 L 22.4 24.9 L 15.6 24.9 L 15.6 29.3 L 21.6 29.3 L 21.6 31.0 L 15.6 31.0 L 15.6 37.9 L 13.6 37.9 L 13.6 23.2 " fill="#33CCCC"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 50.2 112.5 Q 50.2 108.8, 51.9 106.9 Q 53.6 105.0, 56.9 105.0 Q 59.9 105.0, 61.5 107.1 L 60.1 108.2 Q 59.0 106.7, 56.9 106.7 Q 54.6 106.7, 53.5 108.2 Q 52.3 109.7, 52.3 112.5 Q 52.3 115.4, 53.5 116.9 Q 54.7 118.4, 57.1 118.4 Q 58.7 118.4, 60.6 117.4 L 61.2 118.9 Q 60.4 119.4, 59.2 119.7 Q 58.1 120.0, 56.8 120.0 Q 53.6 120.0, 51.9 118.1 Q 50.2 116.1, 50.2 112.5 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 62.3 104.1 L 64.2 104.1 L 64.2 119.8 L 62.3 119.8 L 62.3 104.1 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 104.2 31.1 L 109.0 38.9 Q 109.5 39.7, 110.3 41.1 Q 111.0 42.5, 111.1 42.5 L 111.1 31.1 L 113.0 31.1 L 113.0 45.8 L 111.0 45.8 L 105.8 37.3 Q 105.2 36.3, 104.6 35.2 Q 104.0 34.0, 103.8 33.7 L 103.8 45.8 L 101.9 45.8 L 101.9 31.1 L 104.2 31.1 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 101.7 15.0 L 103.7 15.0 L 103.7 21.2 L 111.2 21.2 L 111.2 15.0 L 113.2 15.0 L 113.2 29.7 L 111.2 29.7 L 111.2 22.9 L 103.7 22.9 L 103.7 29.7 L 101.7 29.7 L 101.7 15.0 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="legend" d="M 146.6 143.8 Q 146.6 142.5, 147.7 141.8 Q 148.7 141.1, 150.7 141.1 L 151.9 141.1 L 151.9 140.8 Q 151.9 139.7, 151.4 139.3 Q 151.0 138.9, 150.0 138.9 Q 149.4 138.9, 148.8 139.0 Q 148.3 139.1, 147.5 139.5 L 147.1 138.4 Q 148.6 137.7, 150.0 137.7 Q 151.8 137.7, 152.6 138.4 Q 153.4 139.2, 153.4 140.8 L 153.4 146.1 L 152.2 146.1 Q 152.2 146.0, 152.2 145.8 Q 152.1 145.5, 152.0 145.1 Q 150.9 146.2, 149.3 146.2 Q 148.1 146.2, 147.4 145.6 Q 146.6 144.9, 146.6 143.8 M 148.1 143.8 Q 148.1 144.4, 148.5 144.7 Q 148.9 145.1, 149.6 145.1 Q 150.2 145.1, 150.9 144.8 Q 151.5 144.5, 151.9 144.0 L 151.9 142.2 L 150.8 142.2 Q 149.4 142.2, 148.8 142.6 Q 148.1 143.0, 148.1 143.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-0 atom-1" d="M 527.8,67.5 L 475.9,67.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 475.9,67.5 L 450.0,112.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 463.1,69.1 L 444.9,100.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-2 atom-3" d="M 450.0,112.4 L 398.2,112.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 398.2,112.4 L 372.2,67.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 403.2,100.5 L 385.1,69.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 372.2,67.5 L 398.2,22.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 398.2,22.6 L 450.0,22.6" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 405.9,33.0 L 442.2,33.0" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-6 atom-6 atom-1" d="M 450.0,22.6 L 475.9,67.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="legend" d="M 450.1 138.5 Q 451.7 138.5, 452.5 139.4 Q 453.4 140.4, 453.4 142.2 Q 453.4 144.1, 452.4 145.2 Q 451.3 146.3, 449.5 146.3 Q 448.4 146.3, 447.2 145.8 L 446.6 145.6 L 446.6 135.0 L 448.0 135.0 L 448.0 139.4 Q 448.8 138.5, 450.1 138.5 M 449.5 145.2 Q 450.7 145.2, 451.3 144.4 Q 452.0 143.6, 452.0 142.2 Q 452.0 140.9, 451.5 140.3 Q 451.0 139.5, 450.0 139.5 Q 449.3 139.5, 448.7 140.0 Q 448.2 140.4, 448.0 141.1 L 448.0 144.9 Q 448.7 145.2, 449.5 145.2 " fill="#000000"&gt;&lt;/path&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h4 id="在分子上添加标记的进阶"&gt;在分子上添加标记的进阶&lt;a class="anchor-link" href="#在分子上添加标记的进阶"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;原子的 &lt;code&gt;atomLabel&lt;/code&gt; 特征决定了相应原子的符号，&lt;code&gt;_displayLabel&lt;/code&gt; 特征决定了原子符号的显示样式，&lt;code&gt;atomNote&lt;/code&gt; 特征用于在原子上添加字符标记，&lt;code&gt;bondNote&lt;/code&gt; 用于在化学键上添加标记。&lt;/p&gt;
&lt;p&gt;这些特征都支持输入并显示 html 标签 &lt;code&gt;&amp;lt;sub&amp;gt;&lt;/code&gt; 与 &lt;code&gt;&amp;lt;sup&amp;gt;&lt;/code&gt;，也是通过这种方法来显示上下标。&lt;code&gt;_displayLabelW&lt;/code&gt; 用于指定文字自右向左排列，主要用于例如 HOOC-Ar 的情况。&lt;code&gt;atomLabel&lt;/code&gt; 与 &lt;code&gt;_displayLabel&lt;/code&gt; 虽然具有相同的效果，但 &lt;code&gt;atomLabel&lt;/code&gt; 本质上是指定了原子的标签，一般用于指定语义，而不是显示样式。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[11]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetAtomWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"_displayLabel"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;"R&amp;lt;sub&amp;gt;1&amp;lt;/sub&amp;gt;"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetAtomWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"atomLabel"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"R&amp;lt;sub&amp;gt;2&amp;lt;/sub&amp;gt;"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetAtomWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"atomNote"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"F was replaced by R&amp;lt;sub&amp;gt;1&amp;lt;/sub&amp;gt;"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetBondWithIdx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"bondNote"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"C-Cl"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DSVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DrawMolecule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;SVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetDrawingText&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[11]:&lt;/div&gt;
&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg baseprofile="full" height="150px" version="1.1" viewbox="0 0 450 150" width="450px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
&lt;!-- END OF HEADER --&gt;
&lt;rect height="150.0" style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" x="0.0" y="0.0"&gt; &lt;/rect&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 137.1,63.6 L 135.8,65.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 132.0,58.7 L 129.5,62.3" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 126.8,53.8 L 123.1,59.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 121.7,48.9 L 116.7,55.9" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 116.6,43.9 L 110.4,52.8" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 111.4,39.0 L 104.0,49.6" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 142.2,68.6 L 139.8,95.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 139.8,95.4 L 137.4,122.3" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 142.2,68.6 L 167.4,56.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 167.4,56.9 L 192.5,45.2" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 218.2,53.4 L 236.1,65.9" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 236.1,65.9 L 254.0,78.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 254.0,78.5 L 312.8,51.2" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 312.8,51.2 L 365.8,88.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 313.3,67.4 L 350.4,93.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-6 atom-6 atom-7" d="M 365.8,88.4 L 424.6,61.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="atom-0" d="M 92.8 40.5 L 88.3 33.0 L 88.3 33.0 L 85.4 33.0 L 85.4 40.5 L 82.9 40.5 L 82.9 22.1 L 88.3 22.1 Q 91.4 22.1, 93.0 23.6 Q 94.6 25.0, 94.6 27.5 Q 94.6 29.5, 93.6 30.8 Q 92.7 32.1, 90.9 32.6 L 95.5 40.5 L 92.8 40.5 M 85.4 30.9 L 88.3 30.9 Q 90.1 30.9, 91.0 30.0 Q 92.0 29.2, 92.0 27.5 Q 92.0 25.9, 91.0 25.1 Q 90.1 24.2, 88.3 24.2 L 85.4 24.2 L 85.4 30.9 " fill="#33CCCC"&gt;&lt;/path&gt;
&lt;path class="atom-0" d="M 96.8 48.3 L 99.4 48.3 L 99.4 39.3 L 96.5 40.2 L 96.1 39.2 L 99.8 37.5 L 101.1 37.7 L 101.1 48.3 L 103.4 48.3 L 103.4 49.7 L 96.8 49.7 L 96.8 48.3 " fill="#33CCCC"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 129.4 133.7 Q 129.4 129.2, 131.5 126.8 Q 133.7 124.4, 137.8 124.4 Q 141.5 124.4, 143.6 127.1 L 141.8 128.5 Q 140.4 126.5, 137.8 126.5 Q 135.0 126.5, 133.5 128.4 Q 132.1 130.2, 132.1 133.7 Q 132.1 137.4, 133.6 139.2 Q 135.1 141.1, 138.0 141.1 Q 140.1 141.1, 142.4 139.9 L 143.1 141.8 Q 142.2 142.5, 140.7 142.8 Q 139.3 143.2, 137.7 143.2 Q 133.7 143.2, 131.5 140.7 Q 129.4 138.3, 129.4 133.7 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 144.6 123.3 L 147.0 123.3 L 147.0 142.9 L 144.6 142.9 L 144.6 123.3 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 204.6 50.4 L 200.1 42.9 L 200.1 42.9 L 197.2 42.9 L 197.2 50.4 L 194.7 50.4 L 194.7 32.1 L 200.1 32.1 Q 203.2 32.1, 204.8 33.5 Q 206.4 34.9, 206.4 37.5 Q 206.4 39.4, 205.4 40.7 Q 204.5 42.0, 202.7 42.6 L 207.3 50.4 L 204.6 50.4 M 197.2 40.8 L 200.1 40.8 Q 201.9 40.8, 202.8 40.0 Q 203.8 39.1, 203.8 37.5 Q 203.8 35.8, 202.8 35.0 Q 201.9 34.2, 200.1 34.2 L 197.2 34.2 L 197.2 40.8 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 208.0 49.8 Q 208.4 48.6, 209.5 48.0 Q 210.5 47.4, 212.0 47.4 Q 213.8 47.4, 214.8 48.4 Q 215.9 49.3, 215.9 51.1 Q 215.9 52.9, 214.5 54.6 Q 213.2 56.3, 210.5 58.2 L 216.1 58.2 L 216.1 59.6 L 207.9 59.6 L 207.9 58.5 Q 210.2 56.9, 211.5 55.7 Q 212.9 54.5, 213.5 53.4 Q 214.2 52.3, 214.2 51.2 Q 214.2 50.0, 213.6 49.4 Q 213.0 48.7, 212.0 48.7 Q 211.0 48.7, 210.4 49.1 Q 209.7 49.5, 209.3 50.4 L 208.0 49.8 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="note" d="M 25.4 7.5 L 30.9 7.5 L 30.9 8.5 L 26.7 8.5 L 26.7 11.3 L 30.4 11.3 L 30.4 12.4 L 26.7 12.4 L 26.7 16.7 L 25.4 16.7 L 25.4 7.5 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="" fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 43.9 10.0 L 45.1 10.0 L 43.2 16.7 L 41.6 16.7 L 40.3 11.7 L 39.0 16.7 L 37.3 16.7 L 35.5 10.0 L 36.7 10.0 L 38.2 15.5 L 39.6 10.0 L 40.9 10.0 L 42.4 15.5 L 43.9 10.0 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 45.4 14.9 Q 45.4 13.8, 46.3 13.2 Q 47.1 12.6, 48.7 12.6 L 49.7 12.6 L 49.7 12.4 Q 49.7 11.5, 49.3 11.2 Q 49.0 10.8, 48.2 10.8 Q 47.7 10.8, 47.2 10.9 Q 46.8 11.0, 46.2 11.3 L 45.8 10.5 Q 47.0 9.9, 48.2 9.9 Q 49.6 9.9, 50.3 10.5 Q 50.9 11.1, 50.9 12.4 L 50.9 16.7 L 50.0 16.7 Q 50.0 16.6, 49.9 16.4 Q 49.9 16.2, 49.8 15.9 Q 48.9 16.8, 47.6 16.8 Q 46.6 16.8, 46.0 16.3 Q 45.4 15.7, 45.4 14.9 M 46.7 14.8 Q 46.7 15.3, 47.0 15.6 Q 47.3 15.9, 47.9 15.9 Q 48.4 15.9, 48.9 15.6 Q 49.4 15.4, 49.7 15.0 L 49.7 13.5 L 48.8 13.5 Q 47.7 13.5, 47.2 13.9 Q 46.7 14.2, 46.7 14.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 52.3 15.3 Q 52.9 15.5, 53.3 15.6 Q 53.7 15.8, 54.2 15.8 Q 54.8 15.8, 55.1 15.5 Q 55.4 15.3, 55.4 14.8 Q 55.4 14.5, 55.2 14.3 Q 55.1 14.1, 54.8 14.0 Q 54.6 13.9, 54.1 13.7 Q 54.0 13.7, 53.4 13.5 Q 52.8 13.3, 52.4 12.9 Q 52.1 12.4, 52.1 11.8 Q 52.1 11.0, 52.8 10.4 Q 53.4 9.9, 54.6 9.9 Q 55.1 9.9, 55.5 10.0 Q 56.0 10.1, 56.5 10.3 L 56.2 11.3 Q 55.7 11.1, 55.4 11.0 Q 55.0 10.9, 54.6 10.9 Q 54.0 10.9, 53.7 11.1 Q 53.4 11.4, 53.4 11.8 Q 53.4 12.1, 53.6 12.3 Q 53.8 12.5, 54.4 12.7 Q 54.5 12.7, 54.7 12.8 L 55.0 12.9 Q 55.5 13.1, 55.8 13.2 Q 56.2 13.4, 56.4 13.8 Q 56.6 14.2, 56.6 14.8 Q 56.6 15.7, 55.9 16.3 Q 55.3 16.8, 54.2 16.8 Q 53.5 16.8, 53.0 16.6 Q 52.5 16.5, 51.9 16.3 L 52.3 15.3 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="" fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 62.6 10.0 L 62.8 10.9 Q 63.5 9.9, 64.6 9.9 Q 65.0 9.9, 65.5 10.0 L 65.3 11.1 Q 64.7 11.0, 64.4 11.0 Q 63.9 11.0, 63.5 11.2 Q 63.1 11.4, 62.9 11.9 L 62.9 16.7 L 61.6 16.7 L 61.6 10.0 L 62.6 10.0 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 65.7 13.3 Q 65.7 11.7, 66.5 10.8 Q 67.3 9.9, 68.8 9.9 Q 70.2 9.9, 70.9 10.8 Q 71.6 11.6, 71.6 13.3 L 71.6 13.5 L 66.9 13.5 Q 66.9 14.6, 67.4 15.2 Q 67.9 15.8, 68.9 15.8 Q 69.4 15.8, 69.9 15.7 Q 70.4 15.6, 70.9 15.3 L 71.3 16.1 Q 70.6 16.5, 70.0 16.6 Q 69.4 16.8, 68.8 16.8 Q 67.3 16.8, 66.5 15.9 Q 65.7 14.9, 65.7 13.3 M 68.8 10.8 Q 68.0 10.8, 67.5 11.3 Q 67.1 11.7, 67.0 12.6 L 70.3 12.6 Q 70.2 11.7, 69.8 11.3 Q 69.5 10.8, 68.8 10.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 75.1 9.9 Q 76.5 9.9, 77.3 10.7 Q 78.1 11.6, 78.1 13.2 Q 78.1 14.9, 77.2 15.8 Q 76.2 16.8, 74.7 16.8 Q 73.9 16.8, 73.3 16.6 L 73.3 19.8 L 72.0 19.8 L 72.0 10.0 L 73.0 10.0 L 73.2 10.8 Q 73.5 10.3, 74.0 10.1 Q 74.5 9.9, 75.1 9.9 M 74.6 15.8 Q 75.7 15.8, 76.2 15.1 Q 76.8 14.4, 76.8 13.2 Q 76.8 12.1, 76.4 11.5 Q 75.9 10.8, 75.1 10.8 Q 74.4 10.8, 73.9 11.2 Q 73.5 11.5, 73.3 12.2 L 73.3 15.6 Q 73.9 15.8, 74.6 15.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 78.7 6.8 L 79.8 6.8 L 79.8 16.7 L 78.7 16.7 L 78.7 6.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 81.0 14.9 Q 81.0 13.8, 81.8 13.2 Q 82.7 12.6, 84.2 12.6 L 85.2 12.6 L 85.2 12.4 Q 85.2 11.5, 84.9 11.2 Q 84.5 10.8, 83.7 10.8 Q 83.2 10.8, 82.8 10.9 Q 82.4 11.0, 81.7 11.3 L 81.3 10.5 Q 82.6 9.9, 83.7 9.9 Q 85.1 9.9, 85.8 10.5 Q 86.4 11.1, 86.4 12.4 L 86.4 16.7 L 85.5 16.7 Q 85.5 16.6, 85.4 16.4 Q 85.4 16.2, 85.3 15.9 Q 84.4 16.8, 83.2 16.8 Q 82.2 16.8, 81.6 16.3 Q 81.0 15.7, 81.0 14.9 M 82.2 14.8 Q 82.2 15.3, 82.5 15.6 Q 82.8 15.9, 83.4 15.9 Q 83.9 15.9, 84.4 15.6 Q 84.9 15.4, 85.2 15.0 L 85.2 13.5 L 84.3 13.5 Q 83.3 13.5, 82.7 13.9 Q 82.2 14.2, 82.2 14.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 87.4 13.3 Q 87.4 11.7, 88.2 10.8 Q 89.1 9.9, 90.6 9.9 Q 92.1 9.9, 92.9 11.0 L 92.1 11.6 Q 91.8 11.2, 91.4 11.0 Q 91.1 10.8, 90.6 10.8 Q 89.7 10.8, 89.2 11.5 Q 88.7 12.1, 88.7 13.3 Q 88.7 14.5, 89.2 15.2 Q 89.7 15.8, 90.7 15.8 Q 91.3 15.8, 91.6 15.7 Q 92.0 15.6, 92.5 15.3 L 92.8 16.2 Q 91.8 16.7, 90.6 16.7 Q 89.1 16.7, 88.2 15.8 Q 87.4 14.9, 87.4 13.3 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 93.2 13.3 Q 93.2 11.7, 94.1 10.8 Q 94.9 9.9, 96.4 9.9 Q 97.8 9.9, 98.5 10.8 Q 99.1 11.6, 99.1 13.3 L 99.1 13.5 L 94.5 13.5 Q 94.5 14.6, 95.0 15.2 Q 95.5 15.8, 96.5 15.8 Q 97.0 15.8, 97.5 15.7 Q 98.0 15.6, 98.5 15.3 L 98.9 16.1 Q 98.2 16.5, 97.6 16.6 Q 97.0 16.8, 96.4 16.8 Q 94.9 16.8, 94.1 15.9 Q 93.2 14.9, 93.2 13.3 M 96.4 10.8 Q 95.6 10.8, 95.1 11.3 Q 94.7 11.7, 94.5 12.6 L 97.9 12.6 Q 97.8 11.7, 97.4 11.3 Q 97.0 10.8, 96.4 10.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 105.7 6.8 L 105.7 16.6 L 104.7 16.6 L 104.5 15.8 Q 103.8 16.8, 102.6 16.8 Q 101.2 16.8, 100.4 15.9 Q 99.6 15.0, 99.6 13.4 Q 99.6 11.8, 100.5 10.8 Q 101.5 9.9, 103.1 9.9 Q 103.7 9.9, 104.5 10.1 L 104.5 6.8 L 105.7 6.8 M 102.6 15.8 Q 103.3 15.8, 103.8 15.4 Q 104.3 15.1, 104.5 14.4 L 104.5 11.0 Q 103.8 10.8, 103.1 10.8 Q 102.0 10.8, 101.5 11.5 Q 100.9 12.2, 100.9 13.4 Q 100.9 14.6, 101.3 15.2 Q 101.8 15.8, 102.6 15.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="" fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 114.2 9.9 Q 115.5 9.9, 116.3 10.7 Q 117.1 11.6, 117.1 13.2 Q 117.1 14.9, 116.2 15.8 Q 115.3 16.8, 113.7 16.8 Q 112.6 16.8, 111.6 16.4 L 111.0 16.2 L 111.0 6.8 L 112.3 6.8 L 112.3 10.7 Q 113.0 9.9, 114.2 9.9 M 113.7 15.8 Q 114.7 15.8, 115.3 15.1 Q 115.8 14.4, 115.8 13.2 Q 115.8 12.1, 115.4 11.5 Q 114.9 10.8, 114.1 10.8 Q 113.4 10.8, 112.9 11.2 Q 112.4 11.6, 112.3 12.2 L 112.3 15.6 Q 112.9 15.8, 113.7 15.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 122.8 10.0 L 124.0 10.0 L 120.6 19.8 L 119.5 19.8 L 120.5 16.7 L 120.0 16.7 L 117.7 10.0 L 118.9 10.0 L 120.9 15.6 L 122.8 10.0 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="" fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 133.4 16.7 L 131.2 12.9 L 131.2 12.9 L 129.7 12.9 L 129.7 16.7 L 128.4 16.7 L 128.4 7.5 L 131.2 7.5 Q 132.7 7.5, 133.5 8.2 Q 134.3 8.9, 134.3 10.2 Q 134.3 11.1, 133.8 11.8 Q 133.4 12.5, 132.4 12.7 L 134.8 16.7 L 133.4 16.7 M 129.7 11.8 L 131.2 11.8 Q 132.0 11.8, 132.5 11.4 Q 133.0 11.0, 133.0 10.2 Q 133.0 9.4, 132.5 8.9 Q 132.1 8.5, 131.2 8.5 L 129.7 8.5 L 129.7 11.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 135.4 20.6 L 136.7 20.6 L 136.7 16.0 L 135.3 16.5 L 135.1 16.0 L 136.9 15.2 L 137.5 15.3 L 137.5 20.6 L 138.7 20.6 L 138.7 21.2 L 135.4 21.2 L 135.4 20.6 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 147.8 102.9 Q 147.8 100.6, 148.9 99.4 Q 150.0 98.2, 152.0 98.2 Q 153.9 98.2, 154.9 99.5 L 154.0 100.2 Q 153.3 99.3, 152.0 99.3 Q 150.6 99.3, 149.9 100.2 Q 149.1 101.1, 149.1 102.9 Q 149.1 104.7, 149.9 105.6 Q 150.7 106.6, 152.1 106.6 Q 153.1 106.6, 154.3 105.9 L 154.7 106.9 Q 154.2 107.2, 153.5 107.4 Q 152.8 107.6, 152.0 107.6 Q 150.0 107.6, 148.9 106.4 Q 147.8 105.2, 147.8 102.9 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 155.4 102.8 L 160.2 102.8 L 160.2 103.9 L 155.4 103.9 L 155.4 102.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 160.8 102.9 Q 160.8 100.6, 161.9 99.4 Q 163.0 98.2, 165.0 98.2 Q 166.9 98.2, 167.9 99.5 L 167.0 100.2 Q 166.3 99.3, 165.0 99.3 Q 163.6 99.3, 162.9 100.2 Q 162.1 101.1, 162.1 102.9 Q 162.1 104.7, 162.9 105.6 Q 163.7 106.6, 165.1 106.6 Q 166.1 106.6, 167.3 105.9 L 167.7 106.9 Q 167.2 107.2, 166.5 107.4 Q 165.8 107.6, 165.0 107.6 Q 163.0 107.6, 161.9 106.4 Q 160.8 105.2, 160.8 102.9 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 168.4 97.6 L 169.6 97.6 L 169.6 107.5 L 168.4 107.5 L 168.4 97.6 " fill="#000000"&gt;&lt;/path&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;对于分子样式的更多样式设置一般通过设置参数器 &lt;code&gt;drawOptions()&lt;/code&gt; 实现，&lt;code&gt;drawOptions()&lt;/code&gt; 具有非常多绘图选项，仅列出几个比较常用的选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;addAtomIndices=False&lt;/code&gt;：为原子添加索引标签&lt;/li&gt;
&lt;li&gt;&lt;code&gt;addBondIndices=False&lt;/code&gt;：为化学键添加索引标签&lt;/li&gt;
&lt;li&gt;&lt;code&gt;addStereoAnnotation=False&lt;/code&gt;：添加立体构型标签&lt;/li&gt;
&lt;li&gt;&lt;code&gt;annotationFontScale=0.75&lt;/code&gt;：原子和化学键标记相对于原子符号的大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;atomLabelDeuteriumTritium&lt;/code&gt;：将氘和氚分别用 D 和 T 表示&lt;/li&gt;
&lt;li&gt;&lt;code&gt;baseFontSize=0.6&lt;/code&gt;：字体的相对大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bondLineWidth=-1&lt;/code&gt;：化学键粗细&lt;/li&gt;
&lt;li&gt;&lt;code&gt;drawMolsSameScale=True&lt;/code&gt;：是否使绘制的多个分子大小相同&lt;/li&gt;
&lt;li&gt;&lt;code&gt;explicitMethyl=False&lt;/code&gt;：是否显示末端甲基&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fixedBondLength=-1&lt;/code&gt;：固定键长&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fixedFontSize=-1&lt;/code&gt;固定字体大小：&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fixedScale=-1&lt;/code&gt;：固定绘图窗口大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fontFile&lt;/code&gt;：字体文件&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[12]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'[F][C@@H](Cl)NC/C=C/C'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdMolDraw2D&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolDraw2DSVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;do&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;drawOptions&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;addAtomIndices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;addStereoAnnotation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;explicitMethyl&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;annotationFontScale&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.8&lt;/span&gt;
&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bondLineWidth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;

&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DrawMolecule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FinishDrawing&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;SVG&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetDrawingText&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[12]:&lt;/div&gt;
&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg baseprofile="full" height="150px" version="1.1" viewbox="0 0 450 150" width="450px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
&lt;!-- END OF HEADER --&gt;
&lt;rect height="150.0" style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" x="0.0" y="0.0"&gt; &lt;/rect&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 110.8,53.1 L 109.6,54.7" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 104.8,47.7 L 102.5,50.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 98.8,42.3 L 95.4,47.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 92.8,37.0 L 88.3,43.4" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 86.9,31.6 L 81.2,39.6" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-0 atom-1 atom-0" d="M 80.9,26.2 L 74.1,35.8" style="fill:none;fill-rule:evenodd;stroke:#33CCCC;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 116.7,58.5 L 114.6,82.8" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-1 atom-1 atom-2" d="M 114.6,82.8 L 112.4,107.1" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 116.7,58.5 L 139.2,48.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-2 atom-1 atom-3" d="M 139.2,48.1 L 161.7,37.6" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 178.2,39.6 L 198.1,53.5" style="fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-3 atom-3 atom-4" d="M 198.1,53.5 L 218.0,67.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-4 atom-4 atom-5" d="M 218.0,67.5 L 271.2,42.8" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 271.2,42.8 L 319.2,76.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-5 atom-5 atom-6" d="M 271.7,57.4 L 305.3,81.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="bond-6 atom-6 atom-7" d="M 319.2,76.5 L 364.1,55.7" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:3.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"&gt;&lt;/path&gt;
&lt;path class="atom-0" d="M 63.8 16.5 L 73.6 16.5 L 73.6 18.4 L 66.0 18.4 L 66.0 23.4 L 72.8 23.4 L 72.8 25.3 L 66.0 25.3 L 66.0 33.1 L 63.8 33.1 L 63.8 16.5 " fill="#33CCCC"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 105.1 117.5 Q 105.1 113.4, 107.0 111.3 Q 109.0 109.1, 112.7 109.1 Q 116.1 109.1, 117.9 111.5 L 116.4 112.8 Q 115.0 111.0, 112.7 111.0 Q 110.2 111.0, 108.8 112.7 Q 107.5 114.4, 107.5 117.5 Q 107.5 120.8, 108.9 122.5 Q 110.3 124.2, 112.9 124.2 Q 114.8 124.2, 116.9 123.1 L 117.6 124.9 Q 116.7 125.4, 115.4 125.8 Q 114.1 126.1, 112.6 126.1 Q 109.0 126.1, 107.0 123.9 Q 105.1 121.7, 105.1 117.5 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-2" d="M 118.9 108.1 L 121.0 108.1 L 121.0 125.9 L 118.9 125.9 L 118.9 108.1 " fill="#00CC00"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 166.3 25.5 L 171.7 34.3 Q 172.3 35.1, 173.1 36.7 Q 174.0 38.3, 174.0 38.4 L 174.0 25.5 L 176.3 25.5 L 176.3 42.1 L 174.0 42.1 L 168.1 32.5 Q 167.4 31.3, 166.7 30.1 Q 166.0 28.8, 165.8 28.4 L 165.8 42.1 L 163.6 42.1 L 163.6 25.5 L 166.3 25.5 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="atom-3" d="M 163.4 7.2 L 165.7 7.2 L 165.7 14.3 L 174.2 14.3 L 174.2 7.2 L 176.5 7.2 L 176.5 23.8 L 174.2 23.8 L 174.2 16.1 L 165.7 16.1 L 165.7 23.8 L 163.4 23.8 L 163.4 7.2 " fill="#0000FF"&gt;&lt;/path&gt;
&lt;path class="atom-7" d="M 366.0 51.9 Q 366.0 47.7, 368.0 45.6 Q 369.9 43.4, 373.6 43.4 Q 377.0 43.4, 378.9 45.8 L 377.3 47.1 Q 376.0 45.3, 373.6 45.3 Q 371.1 45.3, 369.8 47.0 Q 368.4 48.7, 368.4 51.9 Q 368.4 55.1, 369.8 56.8 Q 371.2 58.5, 373.9 58.5 Q 375.7 58.5, 377.8 57.4 L 378.5 59.2 Q 377.6 59.7, 376.3 60.1 Q 375.0 60.4, 373.5 60.4 Q 369.9 60.4, 368.0 58.2 Q 366.0 56.0, 366.0 51.9 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="atom-7" d="M 379.8 43.6 L 382.1 43.6 L 382.1 50.6 L 390.6 50.6 L 390.6 43.6 L 392.8 43.6 L 392.8 60.2 L 390.6 60.2 L 390.6 52.5 L 382.1 52.5 L 382.1 60.2 L 379.8 60.2 L 379.8 43.6 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="atom-7" d="M 400.1 62.7 Q 401.1 63.0, 401.7 63.7 Q 402.2 64.4, 402.2 65.5 Q 402.2 66.4, 401.7 67.1 Q 401.2 67.9, 400.4 68.3 Q 399.5 68.7, 398.4 68.7 Q 397.3 68.7, 396.4 68.2 Q 395.5 67.8, 394.8 67.0 L 395.7 66.1 Q 396.4 66.8, 396.9 67.1 Q 397.5 67.4, 398.4 67.4 Q 399.4 67.4, 400.0 66.9 Q 400.6 66.3, 400.6 65.5 Q 400.6 64.4, 400.0 63.9 Q 399.4 63.4, 398.0 63.4 L 397.2 63.4 L 397.2 62.2 L 397.9 62.2 Q 399.1 62.2, 399.8 61.7 Q 400.4 61.2, 400.4 60.2 Q 400.4 59.5, 399.9 59.1 Q 399.3 58.6, 398.4 58.6 Q 397.5 58.6, 397.0 59.0 Q 396.4 59.3, 396.0 60.1 L 394.9 59.5 Q 395.3 58.6, 396.2 58.0 Q 397.1 57.4, 398.4 57.4 Q 400.1 57.4, 401.0 58.2 Q 401.9 58.9, 401.9 60.2 Q 401.9 61.1, 401.5 61.7 Q 401.0 62.4, 400.1 62.7 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 52.7 20.4 Q 50.2 20.4, 49.0 18.6 Q 47.8 16.8, 47.8 13.6 Q 47.8 10.4, 49.0 8.6 Q 50.2 6.8, 52.7 6.8 Q 55.1 6.8, 56.3 8.6 Q 57.5 10.4, 57.5 13.6 Q 57.5 16.8, 56.3 18.6 Q 55.1 20.4, 52.7 20.4 M 52.7 18.9 Q 54.1 18.9, 54.9 17.6 Q 55.7 16.2, 55.7 13.6 Q 55.7 11.0, 54.9 9.7 Q 54.1 8.3, 52.7 8.3 Q 51.3 8.3, 50.5 9.7 Q 49.7 11.0, 49.7 13.6 Q 49.7 16.2, 50.5 17.6 Q 51.3 18.9, 52.7 18.9 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 75.8 76.8 L 78.7 76.8 L 78.7 66.9 L 75.5 67.9 L 75.1 66.8 L 79.2 64.9 L 80.5 65.2 L 80.5 76.8 L 83.1 76.8 L 83.1 78.3 L 75.8 78.3 L 75.8 76.8 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 83.9 76.4 L 85.8 76.4 L 85.8 77.9 L 85.4 80.5 L 84.7 80.5 L 84.7 78.3 L 83.9 78.3 L 83.9 76.4 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 87.0 73.0 Q 87.0 70.3, 87.8 68.1 Q 88.6 65.9, 90.1 63.4 L 91.1 64.1 Q 89.9 66.4, 89.3 68.4 Q 88.7 70.4, 88.7 73.0 Q 88.7 75.5, 89.3 77.5 Q 89.9 79.5, 91.1 81.8 L 90.1 82.5 Q 88.6 80.1, 87.8 77.9 Q 87.0 75.7, 87.0 73.0 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 92.1 76.2 Q 92.3 76.3, 92.9 76.6 Q 93.5 76.8, 94.2 77.0 Q 94.9 77.2, 95.5 77.2 Q 96.8 77.2, 97.5 76.6 Q 98.3 75.9, 98.3 74.9 Q 98.3 74.1, 97.9 73.7 Q 97.5 73.2, 97.0 73.0 Q 96.4 72.7, 95.5 72.5 Q 94.3 72.1, 93.6 71.8 Q 92.9 71.4, 92.4 70.7 Q 91.9 70.0, 91.9 68.8 Q 91.9 67.1, 93.0 66.1 Q 94.1 65.1, 96.4 65.1 Q 97.9 65.1, 99.7 65.8 L 99.3 67.2 Q 97.7 66.6, 96.5 66.6 Q 95.2 66.6, 94.4 67.1 Q 93.7 67.6, 93.8 68.6 Q 93.8 69.3, 94.1 69.7 Q 94.5 70.1, 95.0 70.4 Q 95.6 70.6, 96.5 70.9 Q 97.7 71.3, 98.4 71.7 Q 99.1 72.0, 99.6 72.8 Q 100.1 73.6, 100.1 74.9 Q 100.1 76.7, 98.9 77.7 Q 97.7 78.7, 95.6 78.7 Q 94.4 78.7, 93.5 78.4 Q 92.6 78.2, 91.6 77.7 L 92.1 76.2 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 105.1 73.0 Q 105.1 75.7, 104.3 77.9 Q 103.6 80.1, 102.1 82.5 L 101.0 81.8 Q 102.2 79.5, 102.8 77.5 Q 103.4 75.5, 103.4 73.0 Q 103.4 70.4, 102.8 68.4 Q 102.2 66.4, 101.0 64.1 L 102.1 63.4 Q 103.6 65.9, 104.3 68.1 Q 105.1 70.3, 105.1 73.0 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 105.4 132.4 Q 105.8 131.1, 107.0 130.4 Q 108.2 129.7, 109.8 129.7 Q 111.8 129.7, 112.9 130.8 Q 114.0 131.9, 114.0 133.8 Q 114.0 135.8, 112.6 137.7 Q 111.1 139.5, 108.1 141.7 L 114.3 141.7 L 114.3 143.2 L 105.3 143.2 L 105.3 141.9 Q 107.8 140.2, 109.3 138.8 Q 110.7 137.5, 111.5 136.3 Q 112.2 135.2, 112.2 133.9 Q 112.2 132.7, 111.5 132.0 Q 110.9 131.2, 109.8 131.2 Q 108.7 131.2, 108.0 131.7 Q 107.3 132.1, 106.8 133.1 L 105.4 132.4 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 170.1 53.0 Q 171.4 53.4, 172.0 54.2 Q 172.7 55.0, 172.7 56.4 Q 172.7 57.5, 172.1 58.4 Q 171.6 59.2, 170.5 59.7 Q 169.5 60.2, 168.1 60.2 Q 166.7 60.2, 165.6 59.7 Q 164.6 59.2, 163.7 58.2 L 164.8 57.1 Q 165.6 58.0, 166.3 58.3 Q 167.0 58.7, 168.1 58.7 Q 169.3 58.7, 170.1 58.0 Q 170.8 57.4, 170.8 56.3 Q 170.8 55.0, 170.0 54.4 Q 169.3 53.8, 167.7 53.8 L 166.7 53.8 L 166.7 52.4 L 167.5 52.4 Q 169.0 52.4, 169.8 51.8 Q 170.5 51.1, 170.5 49.9 Q 170.5 49.1, 169.9 48.6 Q 169.2 48.0, 168.2 48.0 Q 167.1 48.0, 166.4 48.4 Q 165.7 48.8, 165.2 49.8 L 163.9 49.1 Q 164.3 48.0, 165.5 47.3 Q 166.6 46.5, 168.2 46.5 Q 170.1 46.5, 171.3 47.5 Q 172.4 48.4, 172.4 49.9 Q 172.4 51.0, 171.8 51.8 Q 171.2 52.6, 170.1 53.0 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 220.6 79.3 L 222.2 79.3 L 222.2 80.8 L 220.6 80.8 L 220.6 83.9 L 218.9 83.9 L 218.9 80.8 L 212.0 80.8 L 212.0 79.7 L 217.8 70.6 L 220.6 70.6 L 220.6 79.3 M 214.2 79.3 L 218.9 79.3 L 218.9 71.8 L 214.2 79.3 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 272.4 31.4 Q 273.6 31.4, 274.5 31.9 Q 275.5 32.4, 276.0 33.3 Q 276.6 34.2, 276.6 35.5 Q 276.6 36.9, 275.9 37.8 Q 275.2 38.8, 274.1 39.3 Q 273.1 39.8, 271.8 39.8 Q 270.6 39.8, 269.5 39.4 Q 268.3 38.9, 267.6 38.1 L 268.7 36.9 Q 269.3 37.6, 270.2 38.0 Q 271.0 38.3, 271.9 38.3 Q 273.1 38.3, 273.9 37.6 Q 274.7 36.9, 274.7 35.5 Q 274.7 34.1, 273.9 33.5 Q 273.1 32.8, 271.8 32.8 Q 270.6 32.8, 269.3 33.3 L 268.3 32.8 L 268.9 26.4 L 275.7 26.4 L 275.6 27.9 L 270.4 27.9 L 270.0 31.8 Q 271.2 31.4, 272.4 31.4 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 319.0 84.7 Q 320.1 84.7, 321.0 85.2 Q 322.0 85.7, 322.5 86.6 Q 323.0 87.5, 323.0 88.7 Q 323.0 90.0, 322.4 91.0 Q 321.8 92.0, 320.8 92.6 Q 319.8 93.1, 318.5 93.1 Q 316.1 93.1, 314.9 91.5 Q 313.8 89.9, 313.8 86.7 Q 313.8 83.2, 315.2 81.4 Q 316.7 79.5, 319.5 79.5 Q 320.4 79.5, 321.1 79.7 Q 321.8 79.9, 322.4 80.3 L 321.7 81.6 Q 320.7 81.0, 319.6 81.0 Q 317.7 81.0, 316.7 82.3 Q 315.8 83.5, 315.7 86.0 Q 316.3 85.3, 317.2 85.0 Q 318.0 84.7, 319.0 84.7 M 318.5 91.6 Q 319.2 91.6, 319.8 91.2 Q 320.4 90.8, 320.8 90.2 Q 321.1 89.5, 321.1 88.7 Q 321.1 87.5, 320.4 86.9 Q 319.8 86.2, 318.6 86.2 Q 317.8 86.2, 317.0 86.5 Q 316.2 86.8, 315.7 87.4 Q 315.7 89.6, 316.4 90.6 Q 317.1 91.6, 318.5 91.6 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 373.3 66.1 L 366.3 66.1 L 366.3 64.6 L 375.1 64.6 L 375.1 66.0 L 369.8 77.9 L 368.0 77.9 L 373.3 66.1 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 296.5 47.3 Q 296.5 44.6, 297.2 42.4 Q 298.0 40.2, 299.5 37.8 L 300.6 38.5 Q 299.4 40.7, 298.7 42.7 Q 298.1 44.8, 298.1 47.3 Q 298.1 49.9, 298.7 51.9 Q 299.4 53.9, 300.6 56.2 L 299.5 56.8 Q 298.0 54.5, 297.2 52.3 Q 296.5 50.0, 296.5 47.3 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 301.1 39.4 L 309.0 39.4 L 309.0 40.9 L 302.8 40.9 L 302.8 44.9 L 308.3 44.9 L 308.3 46.5 L 302.8 46.5 L 302.8 51.1 L 309.2 51.1 L 309.2 52.7 L 301.1 52.7 L 301.1 39.4 " fill="#000000"&gt;&lt;/path&gt;
&lt;path class="note" d="M 314.2 47.3 Q 314.2 50.0, 313.4 52.3 Q 312.7 54.5, 311.1 56.8 L 310.1 56.2 Q 311.3 53.9, 311.9 51.9 Q 312.5 49.9, 312.5 47.3 Q 312.5 44.8, 311.9 42.7 Q 311.3 40.7, 310.1 38.5 L 311.1 37.8 Q 312.7 40.2, 313.4 42.4 Q 314.2 44.6, 314.2 47.3 " fill="#000000"&gt;&lt;/path&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;hr/&gt;
&lt;h2 id="Reference_1"&gt;Reference&lt;a class="anchor-link" href="#Reference"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.rdkit.org/docs/GettingStartedInPython.html"&gt;Getting Started with the RDKit in Python - RDKit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/dreadlesss/rdkit_summary/blob/master/rdMolDraw2D_for_png_svg.ipynb"&gt;@dreadlesss/rdkit_summary - Github&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;
</content><category term="碎碎念"></category><category term="RDKit"></category><category term="Python"></category></entry><entry><title>RDKit 入门：文件的导入与导出</title><link href="https://tseing.github.io/sui-sui-nian/2022-10-18-rdkit-import-export-file.html" rel="alternate"></link><published>2022-10-18T00:00:00+08:00</published><updated>2022-10-18T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-10-18:/sui-sui-nian/2022-10-18-rdkit-import-export-file.html</id><summary type="html">&lt;p&gt;介绍一些 RDKit 的基本操作，包括简单地创建分子、从外部文件中导入分子以及导出分子为外部文件。&lt;/p&gt;</summary><content type="html">&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[1]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pickle&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rdkit&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="单个分子的导入与导出"&gt;单个分子的导入与导出&lt;a class="anchor-link" href="#单个分子的导入与导出"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;&lt;h3 id="SMILES"&gt;SMILES&lt;a class="anchor-link" href="#SMILES"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;h4 id="使用-SMILES-导入分子"&gt;使用 SMILES 导入分子&lt;a class="anchor-link" href="#使用-SMILES-导入分子"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;所有读取分子的函数都返回 &lt;code&gt;rdkit.Chem.rdchem.Mol&lt;/code&gt; 对象，若读取失败，则返回 &lt;code&gt;None&lt;/code&gt;。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[2]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Cc1ccccc1'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[2]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h4 id="导出为-SMILES"&gt;导出为 SMILES&lt;a class="anchor-link" href="#导出为-SMILES"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;使用 &lt;code&gt;Chem.MolToSmiles(mol, parameters)&lt;/code&gt; 可以将对象 &lt;code&gt;mol&lt;/code&gt; 转换为 SMILES 字符串，可选参数包括&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;isomericSmiles=True&lt;/code&gt;：是否区分同分异构体&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kekuleSmiles=False&lt;/code&gt;：是否以 Kekule 式输出&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rootedAtAtom=-1&lt;/code&gt;：非负时以指定的原子作为起始点&lt;/li&gt;
&lt;li&gt;&lt;code&gt;canonical=True&lt;/code&gt;：是否以标准 SMILES 输出&lt;/li&gt;
&lt;li&gt;&lt;code&gt;allBondsExplicit=False&lt;/code&gt;：是否表示出各个键&lt;/li&gt;
&lt;li&gt;&lt;code&gt;allHsExplicit=False&lt;/code&gt;：是否表示出各个氢原子&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[3]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;%-15s&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="s2"&gt;"SMILES: "&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;%-15s&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="s2"&gt;"Kekule: "&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;kekuleSmiles&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;%-15s&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="s2"&gt;"Rooted atiom: "&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rootedAtAtom&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;%-15s&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="s2"&gt;"Non canonical: "&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;canonical&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;%-15s&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="s2"&gt;"All bonds: "&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;allBondsExplicit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;%-15s&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="s2"&gt;"All H: "&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;allHsExplicit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;SMILES:         Cc1ccccc1
Kekule:         CC1=CC=CC=C1
Rooted atiom:   c1ccccc1C
Non canonical:  Cc1ccccc1
All bonds:      C-c1:c:c:c:c:c:1
All H:          [CH3][c]1[cH][cH][cH][cH][cH]1
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id=".pkl-格式"&gt;.pkl 格式&lt;a class="anchor-link" href="#.pkl-格式"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;h4 id="转换为二进制并导出"&gt;转换为二进制并导出&lt;a class="anchor-link" href="#转换为二进制并导出"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;pickle.dump()&lt;/code&gt;：将对象以二进制形式存储&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[4]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;binary_m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ToBinary&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./binary_m.pkl"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"wb"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;pickle&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dump&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;binary_m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[4]:&lt;/div&gt;
&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;b'\xef\xbe\xad\xde\x00\x00\x00\x00\r\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x07\x00\x00\x00\x07\x00\x00\x00\x80\x01\x06\x00`\x00\x00\x00\x01\x03\x06@(\x00\x00\x00\x03\x04\x06@h\x00\x00\x00\x03\x03\x01\x06@h\x00\x00\x00\x03\x03\x01\x06@h\x00\x00\x00\x03\x03\x01\x06@h\x00\x00\x00\x03\x03\x01\x06@h\x00\x00\x00\x03\x03\x01\x0b\x00\x01\x00\x01\x02h\x0c\x02\x03h\x0c\x03\x04h\x0c\x04\x05h\x0c\x05\x06h\x0c\x06\x01h\x0c\x14\x01\x06\x01\x06\x05\x04\x03\x02\x17\x04\x00\x00\x00\x00\x00\x00\x00\x16'&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h4 id="从二进制导入分子"&gt;从二进制导入分子&lt;a class="anchor-link" href="#从二进制导入分子"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Chem.mol()&lt;/code&gt;：将二进制字符串转为分子&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pickle.load()&lt;/code&gt;：读取 &lt;code&gt;.pkl&lt;/code&gt; 文件中存储的对象&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[5]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Mol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;binary_m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[5]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[6]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./binary_m.pkl"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"rb"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;binary_m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pickle&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loads&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;binary_m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[6]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAACWCAIAAADCEh9HAAAABmJLR0QA/wD/AP+gvaeTAAAWfUlEQVR4nO3dfVSUddoH8GsGQkXSZEvbLDcJZ0BAQMClJHfDYCWhVsXVVXwpWEoMeRNFwFAMWAW3YY+1snmOobu5a8HJt9RtNxPNF0xUhAg0VAxRhJH3cYZ5ef6Y3dmnjk/PzM3c87vvme/n7y7PNz3nmut+u34Sg8FAAADAlZR1AAAAcUMbBQAYErRRAIAhQRsFABgSZ9YBgIvm5ube3l7WKWzE39+fdQSAH4M2Kj4KhaKysvLEiROsg9hISUlJQkLC6NGjWQcBeDAJXngSlyNHjkRFRY0cOdLDw0MikbCOw7uWlpaurq6MjIySkhLWWQAeDG1UTLRabUBAQH19fUlJSUZGBus4tnDx4sXg4GCpVHr58mW5XM46DsAD4BGTmGzbtq2+vt7T0/PNN99kncVGAgICXnvttcHBQQf52QAxwjQqGkqlUiaTdXZ2Hjx4cPbs2azj2E57e7tMJuvu7v7000+joqJYxwH4IUyjopGTk9PZ2fniiy86VA8lorFjx+bm5hJRenr64OAg6zgAP4RpVBzq6+sDAgKI6MKFC76+vqzj2JpGo5kyZUpjY+M777yTmprKOg7A92AaFYe0tDStVvvmm286YA8lIhcXF+OT+o0bN969e5d1HIDvQRsVgYqKis8++8zd3d14beuYoqOjo6Kiurq63nrrLdZZAL4HF/VCp1arfX19r169+qc//emNN95gHYelb775ZsqUKXq9/vz58/i0CYQD06jQlZSUXL161cfHJyEhgXUWxry8vJKSknQ6XVpaGussAP+FaVTQbt++LZfLe3p6/vGPf0RERLCOw969e/dkMllHR8fHH388b9481nEAiDCNCtyaNWt6enrmzZuHHmo0ZsyY/Px8IsrMzLx//z7rOABEmEaF7Pz589OmTXvooYfq6uo8PT1ZxxEKnU4XFBR06dKlgoKC7Oxs1nEAMI0KlcFgSElJ0ev1GRkZ6KH/m5OT0zvvvENERUVFt27dYh0HANOoUO3atWvZsmXjxo1ramoaNWoUhz+hrKxMpVJZPZh1LV68+LHHHuNQOG/evMrKyqVLl5aXl1s9FYBF0EaFqK+vTy6X37p1q7y8fOnSpdz+kEcffbSzs9O6wayupqYmMDCQQ+G1a9cmT56sVqurqqrCwsKsHgzAfFjbLETGy9WgoKC4uDjOf8gbb7zR19dnxVR8GDt2LLfCiRMnpqenFxYWpqamVldXS6W4PQXMYBoVHMxZZjLN7Lt27VqyZAnrOOC48BsuOMZXeeLi4tBDf5ybm1thYSH957Uw1nHAcWEaFZZjx46Fh4e7uro2NDRMmDCBdRyhMxgMzz777NmzZ3Nyct5++23WccBBYRoVENNnjtnZ2eih5pBIJAqFQiKRGD+ZZR0HHBTaqIC8//77ly5dmjBhAr4ZN19oaGhcXJxarc7KymKdBRwULuqFoqurSyaT3b17F1+LW6q1tdXLy6uvrw+bB4AJTKNCYVxIHBYWNnfuXNZZRGb8+PFr166l/yy3Zh0HHA6mUUEwbtLU6XTV1dVBQUGs44gPtrICQ5hGBcF4WFtiYiJ6KDfDhg0rKiqi/xz8xzoOOBa0UfYOHTp0+PDhRx55xLgCDriJjY2NiIhQKpV48wlsDBf1jA0ODvr5+eHMS6swnZ968eJFHx8f1nHAUWAaZeyPf/xjY2Ojl5fXypUrWWcRPR8fn/j4eK1Wix8ksCVMoyy1t7fL5fKurq5PP/00KiqKdRx7oFQqJ02apFQqDx48OHv2bNZxwCFgGmUpNze3q6tr9uzZ6KHWYjqGOjU1Va1Ws44DDgHTKDMXL14MDg6WSqWXL1+Wy+Ws49gPrVYbEBBQX1+/devW9PR01nHA/mEaZSY1NVWn0yUnJ6OHWpezs7NCoSCijRs33r59m3UcsH9oo2zs3bv3+PHjjz322Pr161lnsUMvvvjiSy+91NPTk5eXxzoL2D9c1DOgUqkmT558/fr1srKyxMRE1nHs09WrV319fQcHB8+ePRscHMw6DtgzTKMMFBcXX79+PSAgID4+nnUWu+Xp6bly5Uq9Xp+amopZAXiFadTWWltb5XJ5f3//F1988Ytf/IJ1HHvW09Mjl8tv3769d+/e+fPns44DdgvTqK2tXbu2v79//vz56KF8GzVq1MaNG4koIyNjYGCAdRywW5hGber06dPTp08fNmxYQ0PD008/zTqO/dPr9dOmTTt//nx+fj6e5gFPMI3ajuk+XWZmJnqobUil0tLSUolEUlRU1NLSwjoO2Ce0UdspLy+vrq427RgG25g+fXpsbKxKpcrOzmadBewTLuptpK+vTyaTtbW1/eUvf1m8eDHrOI7l5s2bXl5eKpWqqqoKx1aD1WEatZGCgoK2trbQ0NBFixaxzuJwnnrqqfT0dIPBkJKSotfrWccBe4Np1Baam5t9fHzUavWZM2emTZvGOo4jGhgY8Pb2bmlp2blz5/Lly1nHAbuCadQWMjIy7t+/v2zZMvRQVlxdXQsKCogoKyurp6eHdRywK5hGeff555/PnDnTzc2tsbHxiSeeYB3HcRkMhhkzZpw8eTIrK8t4cBOAVaCN8kun002dOrW2traoqCgrK4t1HEdXU1MTEhLi7OxcV1c3adIk1nHATuCinl/bt2+vra318PDAsRZCMHXq1CVLlmg0GrxzBlaEaZRH9+7dk8lkHR0dlZWVc+bMYR0HiIju3Lkjk8l6enqOHj0aGRnJOg7YA0yjPMrLy+vo6AgPD0cPFY5x48YZ766kpaVptVrWccAeYBrlS0NDg7+/v16vr6mpmTJlCus48F8ajcbX1/fKlSvvvvtuUlIS6zggephG+ZKenj44OPj666+jhwqNi4vL5s2biWj9+vWdnZ2s44DooY3yYv/+/UeOHBkzZoxxURsIzZw5cyIjI5VKZX5+PussIHq4qLc+jUbj5+fX1NRUWlq6atUq1nHgwb7++mt/f38iqqmp8fPzYx0HRAzTqPUpFIqmpiZvb+8VK1awzgL/p8mTJycmJmq12rS0NNZZQNwwjVpZe3u7TCbr7u4+fPjwrFmzWMeBH6NUKmUyWWdn5/79+2NiYljHAbHCNGpl2dnZ3d3dMTEx6KHC5+7u/tZbbxFRWlqaWq1mHQfECtOoNV24cCE4ONjZ2fny5csymYx1HPj/abXawMDAurq6LVu2ZGZmso4DooRp1JpSU1P1en1KSgp6qFg4OzsrFAoi2rRpU1tbG+s4IEpoo1azZ8+eqqqqsWPH5uTksM4CFpg5c2ZMTExvby/OvANucFFvHSqVytvb+8aNGzt27IiPj2cdByzz7bff+vj4DA4OnjlzJiQkhHUcEBlMo9axefPmGzduBAYGvvrqq6yzgMWeeeaZ5ORk09GtrOOAyGAatYLvvvvOy8urv7//+PHjM2bMYB0HuOjt7ZXL5W1tbXv27Fm4cCHrOCAmmEatIDMzs7+/f+HCheih4vXwww8bPww1/muyjgNigml0qE6dOhUWFjZ8+PCGhoaf/exnrOMAd3q9PjQ09Ny5c3l5eRs2bGAdB0QD0+iQmO6mrVmzBj1U7KRSqUKhkEgkW7ZsuXHjBus4IBpoo0Oyc+fOc+fOPfnkk3hz2z4899xzv/nNb1Qq1bp161hnAdHARf2QxMbGVlRU/PWvf120aBHrLGAdLS0tMpnMyclpYGCAdRYbaWtre/zxx1mnEDFMowAPIJFIWEcA0UAbHZKXXnqJiNasWcPt2a5Go7F2Ivg3nU6n0+k4FGZmZqrV6ldeecXgMDCKDhHa6JAsX748JCSktbW1uLjYosLW1tbY2NgFCxbwFAzKysqmTp365ZdfWlR16tSpjz76aMSIEYWFhTwFAzvE+odQ9E6dOiWRSEaMGHHt2jXzq27fvj1q1CgiOnr0KG/RHJdSqXz00UeJqLKy0vwqnU4XHBxMRBs2bOAvG9gftFEr+O1vf0tECxYssKjKOO9Mnjx5cHCQp2AOKzk5mYjCw8Mtqvrzn/9MRE8++WRfXx9PwcAuoY1awc2bN0eOHElEX3zxhflVarV60qRJRLRt2zb+sjmgr7/++qGHHnJycrp06ZL5VT09PcZbhH/729/4ywZ2CW3UOowfvQQEBGi1WvOrKisriWjMmDEdHR38ZXM0v/rVr4ho5cqVFlVlZGQQ0XPPPafX63kKBvYKbdQ6BgYGjF8xvf/++xYVRkZGEtGqVat4CuZo9u3bZ/xlunv3rvlVV69eHTZsmFQqPXfuHH/ZwF6hjVrNnj17iGjs2LFdXV3mV9XX1zs7Ozs7O9fW1vKXzUGo1WrjuQOlpaUWFUZHRxNRQkICT8HAvqGNWpNxw9Pq1astqkpKSiKimTNn8pTKcWzevJmIvL29NRqN+VWfffYZET388MO3bt3iLxvYMbRRa6qpqXFycnJxcfnmm2/Mr+rs7PzJT35CRPv27eMvm927c+fO6NGjiejw4cPmVw0ODvr6+hJRcXExf9nAvqGNWllCQgIRRUdHW1RVWlpKRM8888z9+/d5Cmb3XnvtNSJ6+eWXLaoynmeHv3kYCrRRK+M8E/n5+RHRli1b+Mtmx2pqaqRSqYuLS2Njo/lVpuuAAwcO8JcN7B7aqPVt2bKFwx26f/7zn7hDx5nxrnRmZqZFVStWrMBdaRg6tFHrMz0vVigUFhXGxMQQUXx8PE/B7NWHH37I4R2Juro64zsSly9f5i8bOAK0UV7s379/KG8vVldX85fNzpje2N2xY4dFhREREUSUkpLCUzBwHGijfJk1axYRrVixwqIq4xb9Z599Ft/SmCkvL4+IAgMDdTqd+VUVFRVE5O7uju/HYOjQRvnC+cvun/70p0T04Ycf8pfNbpi2GRw/ftz8KtM2g/fee4+/bOA40EZ5tGrVKiJ64YUXLKrasWMH9gyZyXig/MKFCy2qKigowG4tsCK0UR6Ztl5WVFSYX6XT6UJCQogoLy+Pt2j24MsvvzRuer1+/br5Vdj0ClaHNsqvd999l4gmTpyoUqnMr+LWIBwK5x+bpUuXEtHcuXP5yQWOCG2UX1qtdsqUKURUWFhoUSG3y1XHwe3Wx1dffWV8S7+pqYm/bOBo0EZ59/nnnxORm5tba2ur+VXcHp44CNODuD179phfpdfrw8LCiGjdunX8ZQMHhDZqC3PmzCGiZcuWWVTF7VUeR8DttbBdu3YR0bhx47q7u/nLBg4IbdQWvv322+HDh0skkjNnzphfxfnFcvvG7SOF/v7+CRMmENEHH3zAXzZwTDhg2RY8PDzS0tIMBkNqaqrBYDCzasSIEUVFRUSUnZ3d3d3NZ0AxSUtLU6vVr776qvERk5kKCwtbWlqCgoKWLFnCXzZwUKz7uKPo7e194okniGj37t0WFXJbumGvuC1waWlpcXV1lUgkJ06c4C8bOCy0UdvZuXMnEY0fP763t9f8Km4r4OwS53WCsbGxRBQXF8dTMHBwaKO2o9frp02bRkS5ubkWFcbHxxNRTEwMT8HEgtty6xMnTkgkEldX1xs3bvCXDRwZ2qhNnT59WiKRDB8+vLm52fwqbqug7Qy3o1Z0Ol1QUBARbdq0ib9s4ODQRm0tLi6OiGJjYy2q4rYK2p5wO/hv+/btRPTUU0/19/fzFAwAbdTWvvvuO+N79ceOHTO/ivPRwfaB2zHU3d3djz/+OBF99NFH/GUDQBtlID8/n4j8/f21Wq35Vfv27SPLV0Hbh8jISCJKTk62qCotLY2Ipk+fjuWtwCu0UQZUKtXTTz9NRNu3b7eo0LgKOikpiadgwlRZWWn8/bBoxfKVK1dcXFykUulXX33FXzYAA9ooK3v37iUid3f3zs5O86u4rYIWNdOK5W3btllUGBUVRUSvv/46T8EATNBGmfnlL39JRMavm8yXnJxMROHh4TylEprCwkKyfMXyoUOHiGjUqFFtbW38ZQMwQhtl5uLFi05OTs7OznV1deZXmVZBV1ZW8pdNILitWNZoNHK5nIj+8Ic/8JcNwARtlKXExEQiioiIsKhq27ZtROTh4WHRKmgxWr58ORH9+te/tqhq69atROTp6WnRW/oAnKGNstTe3v7II48Q0aFDh8yv4rwKWlzOnz/PYcUyt79SgKFAG2WM2+j0r3/9iyxfBS0iphXLWVlZFhVyG/ABhgJtlDHON/K4rYIWi927d5PlK5a53W4GGCK0Ufa4PVY2rYI+e/Ysf9mYGBgYMK5Y3rlzp0WF3F5+ABgitFFB4PaSY1ZWFhGFhoba2Vc669evJ6KpU6dadHoKt1dxAYYObVQQuH1yw3kVtJCZVixXVVWZX8X5wzCAocMhIoLg6em5cuVKvV6fkpJiMPuUETc3t4KCAiLKysrq6+vjM6DtZGRkDAwMLFq06Pnnnze/qri4+Pr16/7+/gkJCfxlA3gw1n0c/o3bOiLOq6CF6eTJkxKJZMSIERatWOa2NAvAWtBGBYTbckzTKuhr167xFs0WTCuW8/PzLSrktsIVwFrQRgWE86r2xYsXE9H8+fN5CmYbZWVlQ/kVsehAAQArQhsVFm4HB9nBVa3pnsbf//5386vs7J4GiBQeMQlLWFjYvHnzBgYGcnJyzK8aP3782rVriai8vJy3aPw6ePDgnTt3nn/++fnz55tfVV5eXl1dbfrfB2BCYjD7uTDYxs2bN728vFQqVVVVlfGDSHOoVKpPPvlkwYIFUqlYfxrPnDnj5ubm6+tr5n/f19cnl8tv3bq1e/du4+1RACbQRoUoNze3oKAgKCiourpavG2Rb9nZ2UVFRaGhoadOnZJIJKzjgONCGxWigYEBb2/vlpaWDz74YNmyZazjCFFzc7OPj49arT59+vTPf/5z1nHAoWHSESJXV9e3336biNauXdvT08M6jhCtXr36/v37S5cuRQ8F5jCNCpTBYJgxY8bJkyfXrVtnPEgDTI4dOxYeHu7m5tbY2Gj8HBaAIUyjAiWRSBQKhVQq3bp165UrV1jHERCdTpeamkpE2dnZ6KEgBGijwhUUFBQXF6fRaIybnMCorKystrZ24sSJxmPoAZjDRb2g3blzRyaT9fT0HD16NDIyknUc9u7duyeTyTo6OioqKubOncs6DgARplGBGzdunPHF8rS0NK1WyzoOexs2bOjo6HjhhRfQQ0E4MI0KnUaj8fX1vXLlynvvvbdixQrWcVhqaGjw9/fX6/U1NTXGQ/0AhADTqNC5uLj8/ve/J6Lc3NzOzk7WcVhKT08fHBxMTExEDwVBQRsVgblz50ZERCiVyk2bNrHOwsyBAweOHDkyZsyY/Px81lkAvgcX9eJQX18fEBBARBcuXDD/q3O7odFo/Pz8mpqaFApFSkoK6zgA34NpVBx8fHx+97vfabVa4yuTjqa0tLSpqcnb2zspKYl1FoAfwjQqGkqlUiaTdXZ2HjhwIDo6mnUc22lvb5fJZN3d3YcPH541axbrOAA/hGlUNNzd3Y0nD6empqrVatZxbCcnJ6e7uzs6Oho9FIQJ06iYaLXawMDAurq64uLi1atXs45jCxcuXAgJCXFycqqtrZXL5azjADwA2qjIHDlyJCoqauTIkR4eHo6wZLOlpaWrqysjI6OkpIR1FoAHQxsVH4VCUVlZeeLECdZBbKSkpCQhIWH06NGsgwA8GNqoKDU3N/f29rJOYSP+/v6sIwD8GLRRAIAhwZN6AIAhQRsFABgStFEAgCFBGwUAGJL/AU6pWkXQ7CbsAAAAo3pUWHRyZGtpdFBLTCByZGtpdCAyMDIyLjAzLjUAAHice79v7T0GIOBlgABGIGaH4gZGNoYEkBgzm4MGkGZmYXPIANHMjMQwuIGGMTJlMDExJzCzZDCxsCawsmUwsTEmiDCyMbKxsjAzicdBbQQDds9JKg6qnpNUQZxJKp32qp5CKiC256Qldg/dlu0HsfNuT9uPYH/bLxJToYokbo+kHswWAwDoRCYMHrO/jAAAANt6VFh0TU9MIHJka2l0IDIwMjIuMDMuNQAAeJyFkVEKwyAMht89RS4widHW+tjWMsaoha3bHfa++7PY4rQwXGIg6kcSfwVEu/nr6w1fIy8EAFaWcw6eGhHFDDGBYTpfAoxrP6STcXmE9Q6WHaMfyX5d5nSiYASSjVWGHKDEzYokccSckviX08yh1LRxJyXJOdTdD9AwyPfKdty8SjY76WgjK73bQ8lKRVsOWeGm4A9i7fINS/BZvuiUVTIcOothYuQnR2/yu3gDbZ7ecNg8o+GgcpSycdynH+dcfAAofW6cljdW6QAAAGN6VFh0U01JTEVTIHJka2l0IDIwMjIuMDMuNQAAeJxzTjZMBgFDhRoNIz1Tc0MTYx0DHWtDPQMY00DP2MjQxMhSR9dQz8jS0sBExxrIMjS3MDVHFbI0AgkZIEnDZeFmwEQ0awBGahlkixdqVAAAAABJRU5ErkJggg=="/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id=".mol-格式"&gt;.mol 格式&lt;a class="anchor-link" href="#.mol-格式"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Chem.MolToMolBlock(mol)&lt;/code&gt;：输出分子的 &lt;code&gt;.mol&lt;/code&gt; 信息
&lt;code&gt;Chem.MolToMolFile(mol, filename)&lt;/code&gt;：导出分子的 &lt;code&gt;.mol&lt;/code&gt; 文件&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[7]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToMolBlock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;
     RDKit          2D

  7  7  0  0  0  0  0  0  0  0999 V2000
    3.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
  1  2  1  0
  2  3  2  0
  3  4  1  0
  4  5  2  0
  5  6  1  0
  6  7  2  0
  7  2  1  0
M  END

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;&lt;code&gt;.mol&lt;/code&gt; 格式便于在其中添加信息，导入其他软件。此外，在生成 &lt;code&gt;.mol&lt;/code&gt; 文件时会自动生成原子的坐标，避免导入其他软件时因为立体化学而出现问题。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[8]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"_Name"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"Toluene"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToMolBlock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;Toluene
     RDKit          2D

  7  7  0  0  0  0  0  0  0  0999 V2000
    3.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
  1  2  1  0
  2  3  2  0
  3  4  1  0
  4  5  2  0
  5  6  1  0
  6  7  2  0
  7  2  1  0
M  END

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="分子集的导入与导出_1"&gt;分子集的导入与导出&lt;a class="anchor-link" href="#分子集的导入与导出"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;&lt;h3 id="SMILES_1"&gt;SMILES&lt;a class="anchor-link" href="#SMILES"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;h4 id="导出-SMILES-分子集"&gt;导出 SMILES 分子集&lt;a class="anchor-link" href="#导出-SMILES-分子集"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;首先用 SMILES 创建多个分子并保存在列表中，作为分子集。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[9]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mols_smiles&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;"Cc1ccccc1"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"C1CCCCC1"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"c1cocc1"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;mols&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolFromSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;mol&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mols_smiles&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[9]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;分子集（化合物库）的主流保存格式是 &lt;code&gt;.smi&lt;/code&gt; 与 &lt;code&gt;.sdf&lt;/code&gt;，其中 &lt;code&gt;.smi&lt;/code&gt; 直接保存了化合物的 SMILES 与名字，格式也十分简单，首行为标题，后续每行保存一个 SMILES，空格后为化合物名称，也可使用制表符作为分隔符，格式比较自由：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SMILES Name
Cc1ccccc1 Toluene
C1CCCCC1 molecule2
c1cocc1 molecule3
{SIMLES} {name}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;RDKit 没有提供导出为 &lt;code&gt;.smi&lt;/code&gt; 文件的函数，那么就需要根据自己的要求来生成。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[10]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"_Name"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"Toluene"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./mols.smi"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"w"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;title&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;" "&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s2"&gt;"SMILES"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"Name&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;mol&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;""&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"_Name"&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;KeyError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
        &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;" "&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MolToSmiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
        &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h4 id="导入-SMILES-分子集"&gt;导入 SMILES 分子集&lt;a class="anchor-link" href="#导入-SMILES-分子集"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;Chem.SmilesMolSupplier(filename, parameters)&lt;/code&gt; 提供了读取 &lt;code&gt;.smi&lt;/code&gt; 文件的快捷方法，返回一个可迭代对象。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;filename&lt;/code&gt;：读取的文件路径&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delimiter=' '&lt;/code&gt;：分隔符&lt;/li&gt;
&lt;li&gt;&lt;code&gt;smilesColumn=0&lt;/code&gt;：SMILES 所在列的索引&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nameColumn=1&lt;/code&gt;：SMILES 对应名称所在列的索引&lt;/li&gt;
&lt;li&gt;&lt;code&gt;titleLine=True&lt;/code&gt;：是否有标题行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sanitize=True&lt;/code&gt;：是否检查 SMILES 数据正确性&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[11]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mols_read&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SmilesMolSupplier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./mols.smi"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mols_read&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"_Name"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;mols_read&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;Toluene
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[11]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id=".sdf-格式"&gt;.sdf 格式&lt;a class="anchor-link" href="#.sdf-格式"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;&lt;h4 id="导出为-.sdf-分子集"&gt;导出为 .sdf 分子集&lt;a class="anchor-link" href="#导出为-.sdf-分子集"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;.sdf&lt;/code&gt; 是更为常用的分子集存储格式，可以使用 &lt;code&gt;Chem.SDWriter()&lt;/code&gt; 导出文件。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[12]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SDWriter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./mols.sdf"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;mol&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mols&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;&lt;code&gt;.sdf&lt;/code&gt; 文件保存的数据更为详细，文件中使用 &lt;code&gt;$$$$&lt;/code&gt; 分隔不同分子：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Toluene
     RDKit          2D

  7  7  0  0  0  0  0  0  0  0999 V2000
    3.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
  1  2  1  0
  2  3  2  0
  3  4  1  0
  4  5  2  0
  5  6  1  0
  6  7  2  0
  7  2  1  0
M  END
$$$$

     RDKit          2D

  6  6  0  0  0  0  0  0  0  0999 V2000
    1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500   -1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -1.5000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.7500    1.2990    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
  1  2  1  0
  2  3  1  0
  3  4  1  0
  4  5  1  0
  5  6  1  0
  6  1  1  0
M  END
$$$$

     RDKit          2D

  5  5  0  0  0  0  0  0  0  0999 V2000
    1.2760    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.3943    1.2135    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
   -1.0323    0.7500    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0
   -1.0323   -0.7500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    0.3943   -1.2135    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
  1  2  2  0
  2  3  1  0
  3  4  1  0
  4  5  2  0
  5  1  1  0
M  END
$$$$&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id="从-.sdf-导入分子集"&gt;从 .sdf 导入分子集&lt;a class="anchor-link" href="#从-.sdf-导入分子集"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;与导入 &lt;code&gt;.smi&lt;/code&gt; 文件相似，导入 &lt;code&gt;.sdf&lt;/code&gt; 文件也有 &lt;code&gt;Chem.SDMolSupplier()&lt;/code&gt; 函数，使用方法也类似。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[13]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="input_area"&gt;
&lt;div class="highlight hl-ipython2"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mols_read&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Chem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SDMolSupplier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"./mols.sdf"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mols_read&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetProp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"_Name"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;mols_read&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;Toluene
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="output_area"&gt;
&lt;div class="prompt output_prompt"&gt;Out[13]:&lt;/div&gt;
&lt;div class="output_png output_subarea output_execute_result"&gt;
&lt;img src="data:image/png;base64,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"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;hr/&gt;
&lt;h2 id="Reference_1"&gt;Reference&lt;a class="anchor-link" href="#Reference"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.rdkit.org/docs/GettingStartedInPython.html"&gt;Getting Started with the RDKit in Python - RDKit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/dreadlesss/rdkit_summary"&gt;@dreadlesss/rdkit_summary - Github&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;
</content><category term="碎碎念"></category><category term="RDKit"></category><category term="Python"></category></entry><entry><title>文献总结｜REINVENT 2.0：用于从头药物设计的 AI 工具</title><link href="https://tseing.github.io/sui-sui-nian/2022-10-15-summary-doi.org/10.1021/acs.jcim.0c00915.html" rel="alternate"></link><published>2022-10-15T00:00:00+08:00</published><updated>2022-10-15T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-10-15:/sui-sui-nian/2022-10-15-summary-doi.org/10.1021/acs.jcim.0c00915.html</id><summary type="html">&lt;p&gt;本文介绍于 2020 年发表在 Journal of Chemical Information and Modeling 上的一篇 Application Note，文章原标题为 REINVENT 2.0: An AI Tool for De Novo Drug Design。文章主要介绍了一种开源、便于使用的分子生成工具的原理及其使用案例。&lt;/p&gt;</summary><content type="html">&lt;p&gt;本文介绍于 2020 年发表在 &lt;em&gt;Journal of Chemical Information and Modeling&lt;/em&gt; 上的一篇 Application Note，文章原标题为 REINVENT 2.0: An AI Tool for De Novo Drug Design。文章主要介绍了一种开源、便于使用的分子生成工具的原理及其使用案例。&lt;/p&gt;
&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1021/acs.jcim.0c00915"&gt;doi.org/10.1021/acs.jcim.0c00915&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;目前的分子生成模型可以分为概率分布学习与目标主导的分子生成。概率分布学习旨在生成与特定分子集相类似的分子，而目标主导的分子生成则使用搜索算法，给出满足指定目标的分子，在此过程中，目标主导的分子生成没有在整个搜索空间中取样。&lt;/p&gt;
&lt;p&gt;目标主导的分子生成遇到的主要问题是结果分子集太小，概率分布学习的结果是需要筛选大量与目的无关的结果。这两种不同的策略就分别被称为「利用（exploitation）」和「探索（exploration）」。&lt;/p&gt;
&lt;p&gt;针对于这些问题，可以概括出两种解决方法，对于利用的策略，用户指定一片区域，基于这片区域产生具有相似结构特征的分子；对于探索的策略，产生的分子具有相对更少的结构相似性，但满足其他的特征要求。&lt;/p&gt;
&lt;p&gt;REINVENT 2.0 包括概率分布学习与目标主导的分子生成两种模式，主要使用了 &lt;a href="https://dx.doi.org/10.1186/s13321-019-0393-0?ref=pdf"&gt;Arus-Pous et al.&lt;/a&gt; 的分子生成模型和强化学习的策略。&lt;/p&gt;
&lt;h2 id="ying-yong-gai-lan"&gt;应用概览&lt;/h2&gt;
&lt;p&gt;REINVENT 是开源的 Python 应用，使用 PyTorch 1.3.0 作为深度学习引擎，RDKit 2019.03.3.0 作为化学引擎。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7783?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7783?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;对于每一个步骤 &lt;span class="math"&gt;\(t\)&lt;/span&gt;，使用 one-hot 编码的向量 &lt;span class="math"&gt;\(x_t\)&lt;/span&gt; 经过 embedding 层，用户可以构建任意数量 LSTM 或 GRU 层。线性层由词汇数量决定，它逐个识别数据得到标记，最后经过 softmax 层将其转化为标记的概率分布。&lt;span class="math"&gt;\(H_t\)&lt;/span&gt; 是 &lt;span class="math"&gt;\(t\)&lt;/span&gt; 时刻的状态。&lt;/p&gt;
&lt;h3 id="shu-ju"&gt;数据&lt;/h3&gt;
&lt;p&gt;模型使用来自 ChEMBL 数据训练，模型生成 SMILES 格式的分子。&lt;/p&gt;
&lt;h3 id="duo-yang-xing-guo-lu-qi"&gt;多样性过滤器&lt;/h3&gt;
&lt;p&gt;多样性过滤器（Diversity Filters, DF）可以比作是追踪化合物骨架和生成分子骨架的收集器，一个收集器就是一系列具有相似骨架的化合物。DF 同时记录了多参数目标（Multiparameter Objective, MPO）分数与用户设定的阈值。&lt;/p&gt;
&lt;p&gt;如果生成分子的 MPO 分数高于阈值，它的骨架就被存储在骨架数据中，生成分子进入相应的收集器。当收集器的分子达到一定数量后就不能容纳新分子，新生成的相应分子就会受到一定惩罚，即意味着化学空间中的这片区域不再是目标。这种策略能够防止代理模型陷入局部最优点而不断生成相同分子。&lt;/p&gt;
&lt;h3 id="qiang-hua-xue-xi"&gt;强化学习&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7784?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7784?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;强化学习用于将生成模型导向化学空间中包含目标化学物的区域。在 REINVENT 中，生成用于转化为 SMILES 的标记序列的每个步骤就是行为，打分模块就是环境，在环境中，行为者做出一定行为并受到奖惩。&lt;/p&gt;
&lt;p&gt;打分模块由先验模块、DF 和打分函数构成。先验模块具有与代理模型相同的结构，对于每个由代理模型生成的 SMILES，先验模型都计算其 NLL。除此以外，生成的 SMILES 还会由与 DF 规则相结合的打分函数给出相应的分数。&lt;/p&gt;
&lt;div class="math"&gt;$$
\begin{align}
    &amp;amp;NLL(S)_\mathrm{Augmented}=NLL(S)_\mathrm{Prior}-\sigma\times MPO(S)_\mathrm{score}\\
    &amp;amp;loss=[NLL(S)_\mathrm{Augmented}-NLL(S)_\mathrm{Agent}]^2
\end{align}
$$&lt;/div&gt;
&lt;h3 id="da-fen-han-shu"&gt;打分函数&lt;/h3&gt;
&lt;p&gt;REINVENT 提供了两种打分函数，用户可以根据所需要的参数指定打分函数。&lt;/p&gt;
&lt;div class="math"&gt;$$S(x)=\left[\prod_ip_i(x)^{w_i}\right]^{1/\sum_iw_i}$$&lt;/div&gt;
&lt;div class="math"&gt;$$S(x)=\frac{\sum_iw_i\times p_i(x)}{\sum_iw_i}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(p_i\)&lt;/span&gt; 是用户指定的参数，&lt;span class="math"&gt;\(w_i\)&lt;/span&gt; 是对应的权重，可选的参数包括谷本近似程度、杰卡德距离、QED、分子量、TPSA、可旋转键等等。&lt;/p&gt;
&lt;h3 id="qian-yi-xue-xi"&gt;迁移学习&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7792?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7792?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;REINVENT 支持在生成模型中加入迁移学习模块，以寻找小数据集相关的分子为目的时，可以加入迁移学习的步骤。使用小数据集预训练模型，经过迁移学习能够得到与小数据集具有相当高相似程度的分子。&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;REINVENT 是一个开箱即用的开源分子生成工具，它可以用与解决与「利用（exploitation）」和「探索（exploration）」相关的药物发现问题。除此之外，由于 REINVENT 的灵活性，用户可以便捷地构建分子生成的模型，REINVENT 也能用于与其他模型对比性能的差异。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="RNN"></category><category term="RL"></category></entry><entry><title>文献总结｜基于 Conditional Transformer、知识蒸馏与强化学习的多约束分子生成</title><link href="https://tseing.github.io/sui-sui-nian/2022-10-08-summary-doi.org/10.1038/s42256-021-00403-1.html" rel="alternate"></link><published>2022-10-08T00:00:00+08:00</published><updated>2022-10-08T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-10-08:/sui-sui-nian/2022-10-08-summary-doi.org/10.1038/s42256-021-00403-1.html</id><summary type="html">&lt;p&gt;本文介绍了来自浙江大学侯廷军老师的工作，文章原标题为 Multi-constraint molecular generation based on conditional transformer, knowledge distillation and reinforcement learning，于 2021 年发表在 Nature Machine Intelligence 上。文章基于 transformer 建立了分子生成模型，并借助知识蒸馏与强化学习算法，提出了一种新的分子生成模型。&lt;/p&gt;</summary><content type="html">&lt;p&gt;本文介绍了来自浙江大学侯廷军老师的工作，文章原标题为 Multi-constraint molecular generation based on conditional transformer, knowledge distillation and reinforcement learning，于 2021 年发表在 &lt;em&gt;Nature Machine Intelligence&lt;/em&gt; 上。文章基于 transformer 建立了分子生成模型，并借助知识蒸馏与强化学习算法，提出了一种新的分子生成模型，该模型能够顺利完成药物分子生成这样的多约束优化问题。&lt;/p&gt;
&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1038/s42256-021-00403-1"&gt;doi.org/10.1038/s42256-021-00403-1&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;在药物分子生成的任务中，目标分子既需要有高类药性、低毒性，其结构又需要尽可多样和新颖，药物分子生成就是这样一个多约束优化问题。&lt;/p&gt;
&lt;p&gt;文章针对该问题提出了一种新的分子生成方法&amp;mdash;&amp;mdash;MCMG（Multi-Constraint Molecular Generation），鉴于 conditional transformer 在自然语言处理中的优势，MCMG 将其作为分子生成模型，接着使用知识蒸馏降低模型复杂程度，简化后的模型更便于使用强化学习 fine-tune，最后得到由 RNN 构成的代理模型。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="bian-ma"&gt;编码&lt;/h3&gt;
&lt;p&gt;MCMG 使用 SMILES 作为分子的表示方式。&lt;/p&gt;
&lt;h3 id="shu-ju-lai-yuan"&gt;数据来源&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;训练数据来自于 &lt;a href="https://doi.org/10.1186/s13321-017-0235-x"&gt;Olivecrona et al.&lt;/a&gt; 从 ChEMBL 中挑选的数据。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;生物活性数据：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;靶点&lt;/th&gt;
&lt;th&gt;negative / positive&lt;/th&gt;
&lt;th&gt;来源&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;DRD2&lt;/td&gt;
&lt;td&gt;100000 / 7219&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.1186/s13321-017-0235-x"&gt;Olivecrona et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;JNK3&lt;/td&gt;
&lt;td&gt;50000 / 2665&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.48550/arXiv.1806.02473"&gt;Li et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GSK3&amp;beta;&lt;/td&gt;
&lt;td&gt;50000 / 740&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.48550/arXiv.1806.02473"&gt;Li et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="huo-xing-yu-ce-mo-xing"&gt;活性预测模型&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;靶点&lt;/th&gt;
&lt;th&gt;算法&lt;/th&gt;
&lt;th&gt;来源&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;DRD2&lt;/td&gt;
&lt;td&gt;支持向量机&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.1186/s13321-017-0235-x"&gt;Olivecrona et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;JNK3&lt;/td&gt;
&lt;td&gt;随机森林&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.48550/arXiv.2002.03244"&gt;Jin et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GSK3&amp;beta;&lt;/td&gt;
&lt;td&gt;随机森林&lt;/td&gt;
&lt;td&gt;&lt;a href="https://doi.org/10.48550/arXiv.2002.03244"&gt;Jin et al.&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="fen-zi-sheng-cheng-mo-xing"&gt;分子生成模型&lt;/h3&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7714?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7714?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 先验模型&lt;/strong&gt;：生成具有目标特征的分子。&lt;/p&gt;
&lt;p&gt;在先验模型中添加了约束码 &lt;span class="math"&gt;\(c\)&lt;/span&gt;，约束码 &lt;span class="math"&gt;\(c\)&lt;/span&gt; 是一个 n 位字符串，用于表示分子是否满足了 n 个约束。先验模型的训练目标就是以 &lt;code&gt;\s&lt;/code&gt; + SMILES 为输入，以 SMILES + &lt;code&gt;\EOS&lt;/code&gt; 为输出，通过 &lt;span class="math"&gt;\(c\)&lt;/span&gt; 表示分子状态，输出最优分子。先验模型通过这个过程中学习到的条件概率分布生成预期分子：&lt;/p&gt;
&lt;div class="math"&gt;$$p(x|c)=\prod^n_{i=1}p(x_i|x_{&amp;lt;i},c)$$&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;2. 蒸馏模型&lt;/strong&gt;：简化 transformer 结果，便于 RL 优化。&lt;/p&gt;
&lt;p&gt;蒸馏模型的结构是具有三层循环单元的 RNN，蒸馏模型分为两种模式，分别是 DL（Distilled Likelihood） 与 DM（Distilled Molecules）。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DL: 使用先验模型中生成的字符作为训练集，与先验模型的训练过程类似，首先输入 &lt;code&gt;\s&lt;/code&gt; 与 &lt;span class="math"&gt;\(c\)&lt;/span&gt;，再逐个输入先验模型生成的下一个字符，直至到达 &lt;code&gt;\EOS&lt;/code&gt;。在这个过程中，模型能够学习到准确的概率。最后经过 fine-tune 的模型就称作 MCMGL。&lt;/li&gt;
&lt;li&gt;DM： 直接使用先验模型中生成的分子集作为训练集，无法学习到准确的概率。最后经过 fine-tune 的模型就称作 MCMGM。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此外，文章还提出了 semi-DM 与 semi-MCMGM 模型，这部分模型的训练集由满足一部分约束条件的分子构成，例如 QED 与 SA，用于增加计算效率。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. 代理模型&lt;/strong&gt;：使用 RL 算法 fine-tune 预先训练好的神经网络。&lt;/p&gt;
&lt;p&gt;在该步骤中，使用 REINVENT 中的 RL 算法 fine-tune 蒸馏模型。具体来说，RL 将模型产生 SMILES 视作行为，接着根据每个行为给予一定的奖惩，代理模型最终学习到状态 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 下行为 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 的条件概率 &lt;span class="math"&gt;\(p(A|S)\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;在代理模型生成的分子中取样，记录其概率 &lt;span class="math"&gt;\(\log p(A)_{\mathrm{agent}}\)&lt;/span&gt;，将生成的分子输入蒸馏模型得到概率 &lt;span class="math"&gt;\(\log p(A)_{\mathrm{middle}}\)&lt;/span&gt;，通过下式计算增广概率：&lt;/p&gt;
&lt;div class="math"&gt;$$\log p(A)_{\mathrm{aug}}=\log p(A)_{\mathrm{middle}}+\sigma S(A)$$&lt;/div&gt;
&lt;p&gt;式中 &lt;span class="math"&gt;\(S(A)\)&lt;/span&gt; 是对分子的打分，可以通过活性预测模型得到。代理模型的损失函数就是&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{Loss}=[\log p(A)_{\mathrm{aug}}-\log p(A)_{\mathrm{agent}}]^2$$&lt;/div&gt;
&lt;h3 id="mo-xing-ping-gu"&gt;模型评估&lt;/h3&gt;
&lt;p&gt;对于模型的评估从两方面展开：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;实验 1&lt;/strong&gt;：评估优化后各个最佳模型的能力，即评估模型最后生成的分子的各方面指标；&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实验 2&lt;/strong&gt;：评估各模型在相同条件下生成分子的性能与质量，即保存了全过程中生成的分子用于评估。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;文章中将针对 DRD2 生成活性分子的工作称为任务 1，针对 JNK3 与 GSK3&amp;beta; 的称为任务 2。&lt;/p&gt;
&lt;h3 id="ping-jie-zhi-biao"&gt;评价指标&lt;/h3&gt;
&lt;p&gt;文章中对生成分子的评价使用了 &lt;a href="https://doi.org/10.48550/arXiv.2002.03244"&gt;Jin et al.&lt;/a&gt; 提出的标准指标与 MOSES 指标。&lt;/p&gt;
&lt;p&gt;标准指标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Success：若 QED、SA、对受体活性的预测值都在指定范围内，则认为该分子属于 success，successful 分子占比即为 success rate。&lt;/li&gt;
&lt;li&gt;Real success：生成分子中满足 success 条件的独特（unique）分子占比。&lt;/li&gt;
&lt;li&gt;Diversity：在 successful 分子中基于摩根指纹两两评估谷本距离 &lt;span class="math"&gt;\(\mathrm{sim}(X,Y)\)&lt;/span&gt;，
    &lt;div class="math"&gt;$$\mathrm{Diversity}=1-\frac{2}{n(n-1)}\sum_{X,Y}\mathrm{sim}(X,Y)$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;Novelty：对于每个 successful 分子 &lt;span class="math"&gt;\(G\)&lt;/span&gt;，在训练集中取其最近邻 &lt;span class="math"&gt;\(G_{\mathrm{SNN}}\)&lt;/span&gt;，
    &lt;div class="math"&gt;$$\mathrm{Novelty}=\frac{1}{n}\sum_G\mathrm{sim}(G,G_{\mathrm{SNN}})$$&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;生成分子集为 &lt;span class="math"&gt;\(G\)&lt;/span&gt;，测试集为 &lt;span class="math"&gt;\(T\)&lt;/span&gt;，MOSES 指标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\mathrm{Novelty}=1-\frac{|\mathrm{set}(G\cap T)|}{G}\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\mathrm{IntDiv}(G)=1-\frac{1}{|\mathrm{set}(G)|^2}\sum_{(X,Y)\in\mathrm{set}(G)}\mathrm{sim}(X,Y)\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Frag：衡量训练集与测试集中不同的分子片段出现频率，用 RDKit 的 BRICS 函数计算。&lt;/li&gt;
&lt;li&gt;SNN：生成分子中分子与训练集中其最近邻分子的平均谷本系数。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="jie-guo_1"&gt;结果&lt;/h2&gt;
&lt;h3 id="transformer-xiang-bi-rnn-de-you-shi"&gt;Transformer 相比 RNN 的优势&lt;/h3&gt;
&lt;p&gt;为了对比 RNN、conditional RNN 和 conditional transformer 性能差别，经过训练后，在各模型中抽取相同数量的生成分子进行评估。&lt;/p&gt;
&lt;p&gt;RNN 的 success 占比为 0%，这说明 RNN 模型生成的分子无法同时满足四种约束，c-RNN 虽然生成了一定数量的 successful 分子，但仍是低于 c-transformer 模型。这是因为 c-transformer 模型并不是像 RNN 模型那样依赖于输入的上一个词再输出下一个词，c-transformer 模型将句子看作整体进行计算，不仅提高了计算性能，还有效避免了长期依赖问题。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7715?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7715?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="liang-chong-zheng-liu-mo-shi-de-dui-bi"&gt;两种蒸馏模式的对比&lt;/h3&gt;
&lt;p&gt;文章对比了两种蒸馏模式生成分子的结果，其中 DM 生成的 successful 分子显著少于 DL，但 DM 模式具有更高的 Frag 与 IntDiv，DM 模式可能构建了一个更大的化学空间，生成了更多新颖的分子。&lt;/p&gt;
&lt;p&gt;文章提出了以下假设，将灰色的椭圆区域视作无条件的化学空间，其中的红点代表需要寻找的分子。DL 模式得到的模型可以看作为蓝色区域，在这个区域中红点的密度更高（success 比例更大），但区域面积较小，在后续 RL 过程中容易陷入局部最优点，而 DM 模式得到的模型可以看作为绿色区域，虽然红点密度比蓝色区域更低，但是相比于灰色区域还是更高的，因此也可以使用后续 RL 过程优化。&lt;/p&gt;
&lt;p&gt;&lt;img alt="chemical space" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7716?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;文章计算了 RNN、DM、DL 和 semi-DM 模型生成分子的平均负对数似然（Negative Log-Likelihood, NLL），平均 NLL 越小，生成 SMILES 序列的随机性也越小，分子多样性越低，相应化学空间也更小。&lt;/p&gt;
&lt;p&gt;结果表明 DL 模型的平均 NLL 最低，DM 次之，semi-DM 再次之，验证了上文的假设。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7717?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7717?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="mo-xing-ping-gu_1"&gt;模型评估&lt;/h3&gt;
&lt;p&gt;实验 1 的目的是评估模型经过若干过程的优化后，最终生成的分子的各方面指标。模型不断优化得到最优模型的过程可以看作模型相应的化学空间不断缩小，化学空间中预期分子密度达到设定值的过程，左图中橙色区域就代表最优模型。&lt;/p&gt;
&lt;p&gt;实验 2 的目的是评估各模型在优化过程中生成分子的质量，也就是评估化学空间缩小的过程中涉及的分子，如右图中的路径所示。&lt;/p&gt;
&lt;p&gt;&lt;img alt="模型评估" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7718?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;实验 1 的结果列举在表格中，其中 MCMGL（DL）具有接近 100% 的 success 比例，但该模型生成分子的 Novelty 与 Div 都很低，REINVENT2.0 模型也有同样的问题。这不仅是因为训练数据集中活性分子占比少，更是因为 MCMGL 经过 RL 优化后的化学空间很小，在这一点上，化学空间更大的 MCMGM 与 semi-MCMGM 具有更大优势。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7719?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7719?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;实验 2 评估了在 RL 优化过程中每个步骤生成的一部分分子。在初始阶段，MCMGM、MCMGL 和 REINVENT2.0 模型就生成了大量 successful 分子，在 1000 步后，REINVENT 和 semi-MCMGM 模型生成的分子迅速增长。其原因就是 REINVENT 和 semi-MCMGM 模型具有更大的化学空间，不会受制随着 RL 过程推进而越一越小的化学空间。在后期，MCMGL 无法生成新颖的 successful 分子，REINVENT2.0 显然也有相同的趋势，这是因为 RL 优化进入了局部最优点。&lt;/p&gt;
&lt;p&gt;除此之外，文章还对模型生成的分子骨架做了相似性评估，其中 MCMGM 和 semi-MCMGM 模型在生成新颖骨架上同样具有优势。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7720?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7720?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章提出了一种运用了 conditional transformer、知识蒸馏与强化学习的分子生成方法，经过一系列评估，MCMG 方法能够生成更多独特且满足目标条件的分子，在一系列评估中，MCMG 模型与已知的活性分子具有最低的相似度，能够完成针对文中 3 个靶点的活性分子生成任务。在一系列模型评估中，MCMG 模型具有显著优势。&lt;/p&gt;
&lt;h2 id="ling-transformer-de-jie-shao"&gt;另：Transformer 的介绍&lt;/h2&gt;
&lt;p&gt;transformer 是一种应用在自然语言处理中的模型，transformer 解决了 RNN 存在的一系列缺点。对于 RNN（或 LSTM）来说，计算的过程是顺序的，那么，&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;第 &lt;span class="math"&gt;\(t\)&lt;/span&gt; 步的计算依赖于第 &lt;span class="math"&gt;\(t-1\)&lt;/span&gt; 步的计算结果，不能并行计算；&lt;/li&gt;
&lt;li&gt;顺序计算导致长时间前的信息丢失，尽管 LSTM 可以缓解这一问题，但对于特别长期的记忆仍然会失效，也就是长期依赖问题。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;而对于 transformer 来说，&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用了注意力机制，序列中任意两个位置之间的距离为常量；&lt;/li&gt;
&lt;li&gt;并非顺序计算，具有并行能力。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7721?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7721?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;transformer 的结构可以大致分为 Encoder 与 Decoder 两个部分。&lt;/p&gt;
&lt;h3 id="encoder"&gt;Encoder&lt;/h3&gt;
&lt;h4&gt;Self-Attention 机制&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;输入的单词&lt;/code&gt; &amp;rarr; &lt;code&gt;映射为向量并添加位置编码&lt;/code&gt; &amp;rarr; &lt;code&gt;得到 Input Embedding (x)&lt;/code&gt; &amp;rarr; &lt;code&gt;通过矩阵乘法得到 q,k,v&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;矩阵乘法的的运算过程为&lt;/p&gt;
&lt;div class="math"&gt;$$q=xW^Q,\,k=xW^K,\,v=xW^V$$&lt;/div&gt;
&lt;p&gt;&lt;span class="math"&gt;\(q\)&lt;/span&gt; 代表 query，&lt;span class="math"&gt;\(k\)&lt;/span&gt; 代表 key，&lt;span class="math"&gt;\(v\)&lt;/span&gt; 代表 value，也就是需要用 query 去寻找更匹配的 key，因为数量积可以表示两向量的相似程度，匹配程度就为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{score}=q\cdot k_i=qk^\mathrm{T}_i$$&lt;/div&gt;
&lt;p&gt;假设输入的句子中包含两个单词，需要得到的中间量 &lt;span class="math"&gt;\(z\)&lt;/span&gt; 通过下式计算：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    z_1=\theta_{11}v_1+\theta_{12}v_2\\
    z_2=\theta_{21}v_1+\theta_{22}v_2
\end{align}$$&lt;/div&gt;
&lt;p&gt;权值 &lt;span class="math"&gt;\(\theta\)&lt;/span&gt; 可以通过下式计算：&lt;/p&gt;
&lt;div class="math"&gt;$$(\theta_{11},\theta_{12})=\mathrm{softmax}\left(\frac{q_1k^\mathrm{T}_1}{\sqrt{d_k}},\frac{q_1k^\mathrm{T}_2}{\sqrt{d_k}}\right)$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(d_k\)&lt;/span&gt; 是向量的维度，将上述运算转为矩阵形式，也就是&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{Attention}(Q,K,V)=\mathrm{softmax}\left(\frac{QK^\mathrm{T}}{\sqrt{d_k}}\right)V$$&lt;/div&gt;
&lt;p&gt;self-attention 机制的目的就是在句子中寻找对自己影响力大的词。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7722?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7722?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h4&gt;Multi-headed Attention&lt;/h4&gt;
&lt;p&gt;使用不同的矩阵 &lt;span class="math"&gt;\(W^Q\)&lt;/span&gt;，&lt;span class="math"&gt;\(W^K\)&lt;/span&gt;，&lt;span class="math"&gt;\(W^V\)&lt;/span&gt; 就能得到不同的 &lt;span class="math"&gt;\(Q\)&lt;/span&gt;，&lt;span class="math"&gt;\(K\)&lt;/span&gt;，&lt;span class="math"&gt;\(V\)&lt;/span&gt;，multi-headed attention 就是使用了不同的 &lt;span class="math"&gt;\(Q\)&lt;/span&gt;，&lt;span class="math"&gt;\(K\)&lt;/span&gt;，&lt;span class="math"&gt;\(V\)&lt;/span&gt;，产生若干不同的 &lt;span class="math"&gt;\(z_{i1},z_{i2},\cdots,z_{in}\)&lt;/span&gt;，然后在全连通网络中，将其拼接为一个长向量再乘以矩阵 &lt;span class="math"&gt;\(W^O\)&lt;/span&gt;，得到形状符合预期的向量 &lt;span class="math"&gt;\(z_i\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;使用不同的矩阵 &lt;span class="math"&gt;\(W^Q\)&lt;/span&gt;，&lt;span class="math"&gt;\(W^K\)&lt;/span&gt;，&lt;span class="math"&gt;\(W^V\)&lt;/span&gt; 的目的就是从不同角度（特征）计算 attention，例如在某一角度 panda 与 bamboo 具有高关联性，而另一个角度，panda 与 China 也有很高关联，那么 multi-attention 的作用就是将这些不同角度的 attention 综合起来。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7723?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7723?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h3 id="decoder"&gt;Decoder&lt;/h3&gt;
&lt;p&gt;Decoder 部分具有与 Encoder 相类似的注意力层，但 Decoder 部分除了接收前一步骤的输出 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 以外，还要接收 Encoder 部分的结果 &lt;span class="math"&gt;\(m\)&lt;/span&gt;。可以这么理解，Decoder 部分将 &lt;span class="math"&gt;\(m\)&lt;/span&gt; 视作 key 和 value，以前一步的输出 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 作为 query，具体过程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Decoder 输入 Encoder 对整个句子的运算结果和开始符号 &lt;code&gt;\s&lt;/code&gt;，Decoder 产生预测 &lt;code&gt;I&lt;/code&gt;:&lt;/li&gt;
&lt;li&gt;Decoder 输入 Encoder 对整个句子的运算结果和 &lt;code&gt;\s I&lt;/code&gt;，产生预测 &lt;code&gt;am&lt;/code&gt;；&lt;/li&gt;
&lt;li&gt;Decoder 不断产生预测直至生成 &lt;code&gt;\EOS&lt;/code&gt;，句子结束。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img alt="Decoder" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7724?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references_1"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://luweikxy.gitbook.io/machine-learning-notes/self-attention-and-transformer"&gt;Self-Attention和Transformer - GitBook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://jalammar.github.io/illustrated-transformer/"&gt;The Illustrated Transformer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Transformer"></category></entry><entry><title>文献总结｜使用循环神经网络为药物发现生成指定的分子库</title><link href="https://tseing.github.io/sui-sui-nian/2022-09-30-summary-doi.org/10.1021/acscentsci.7b00512.html" rel="alternate"></link><published>2022-09-30T00:00:00+08:00</published><updated>2022-09-30T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-09-30:/sui-sui-nian/2022-09-30-summary-doi.org/10.1021/acscentsci.7b00512.html</id><summary type="html">&lt;p&gt;本文介绍 2018 年发表在 ACS Central Science 上的一篇文献，文章原题目为 Generating Focused Molecule Libraries for Drug Discovery with Recurrent Neural Networks。文章利用基于 LSTM 的循环神经网络构建了分子生成模型，在输入具有特定活性化合物训练集后，该模型能够产生新分子库，新分子库中的许多分子具有与训练集相似的活性。&lt;/p&gt;</summary><content type="html">&lt;p&gt;本文介绍 2018 年发表在 &lt;em&gt;ACS Central Science&lt;/em&gt; 上的一篇文献，文章原题目为 Generating Focused Molecule Libraries for Drug Discovery with Recurrent Neural Networks。文章利用基于 LSTM 的循环神经网络构建了分子生成模型，在输入具有特定活性化合物训练集后，该模型能够产生新分子库，新分子库中的许多分子具有与训练集相似的活性。&lt;/p&gt;
&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1021/acscentsci.7b00512"&gt;doi.org/10.1021/acscentsci.7b00512&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;在通常的分子任务中，计算机需要完成&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;生成分子；&lt;/li&gt;
&lt;li&gt;给分子打分并根据结果过滤；&lt;/li&gt;
&lt;li&gt;基于此前步骤中获得的知识，寻找更优分子。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;针对于目标（1），常见方式包括&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;基于预先定义的原子团或片段构建分子在 &amp;rarr; 分子可能难以合成；&lt;/li&gt;
&lt;li&gt;基于专门的编码规则进行虚拟反应 &amp;rarr; 反应难以预测。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;针对于目标（2），可以使用靶点对接或机器学习过滤去不需要的基团，这会需要用到靶点预测与定量构效关系（QSAR）。针对于目标（3），传统的方式包括遗传算法和蚁群优化。此外还有新提出的逆 QSAR 方法，传统的 QSAR 将结构映射到性质，逆 QSAR 将性质映射到结构，但这种映射关系常常是一对多的，带来了许多问题。&lt;/p&gt;
&lt;p&gt;在这篇文章中，作者提出了一种完全由数据驱动的从头药物没计方法。基于循环神经网络（Recurrent Neural Network, RNN），模型通过学习训练集生成概率分布，并从该分布中取样生成新实例，生成的新实例与训练集数据具有相似特征。&lt;/p&gt;
&lt;h2 id="fang-fa"&gt;方法&lt;/h2&gt;
&lt;h3 id="mo-xing"&gt;模型&lt;/h3&gt;
&lt;p&gt;文章决定使用 SMILES 作为分子的编码方式，并以 &lt;code&gt;\n&lt;/code&gt; 作为每个分子编码的结束符。&lt;/p&gt;
&lt;p&gt;对于给定的词序列 &lt;span class="math"&gt;\((w_1,w_2,\cdots,w_i)\)&lt;/span&gt;，语言模型能够预测第 &lt;span class="math"&gt;\(i+1\)&lt;/span&gt; 个词 &lt;span class="math"&gt;\(w_{i+1}\)&lt;/span&gt; 的概率分布，同时还能识别其中的语法错误和语义错误。就其本质而，在步骤 &lt;span class="math"&gt;\(t_i\in T\)&lt;/span&gt; 中，对于给定的字符 &lt;span class="math"&gt;\(s_i\)&lt;/span&gt; 序列 &lt;span class="math"&gt;\(S\)&lt;/span&gt;，语言模型通过计算概率（马尔可夫链）&lt;/p&gt;
&lt;div class="math"&gt;$$P_\theta(S)=P_\theta(s_1)\prod_{t=2}^TP_\theta(s_t|s_{t_1},\cdots,s_1)$$&lt;/div&gt;
&lt;p&gt;预测下一个字符，其中 &lt;span class="math"&gt;\(\theta\)&lt;/span&gt; 是从训练集中学习到的参数。&lt;/p&gt;
&lt;p&gt;对于上述 &lt;span class="math"&gt;\(P_\theta\)&lt;/span&gt; 的计算，文章主要应用了 RNN。RNN 得到输入向量序列 &lt;span class="math"&gt;\(\boldsymbol{x}_{1:n}=(\boldsymbol{x}_1,\boldsymbol{x}_2,\cdots,\boldsymbol{x}_n)\)&lt;/span&gt; 和初始状态向量 &lt;span class="math"&gt;\(\boldsymbol{h}_0\)&lt;/span&gt;，输出状态向量序列 &lt;span class="math"&gt;\(\boldsymbol{h}_{1:n}=(\boldsymbol{h}_1,\boldsymbol{h}_2,\cdots,\boldsymbol{h}_n)\)&lt;/span&gt; 和输出向量序列 &lt;span class="math"&gt;\(\boldsymbol{y}_{1:n}=(\boldsymbol{y}_1,\boldsymbol{y}_2,\cdots,\boldsymbol{y}_n)\)&lt;/span&gt;，可以表达为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{RNN}(\boldsymbol{h}_0,\boldsymbol{x}_{1:n})=\boldsymbol{h}_{1:n},\boldsymbol{y}_{1:n}$$&lt;/div&gt;
&lt;p&gt;RNN 中的迭代函数 &lt;span class="math"&gt;\(R\)&lt;/span&gt; 获取状态向量 &lt;span class="math"&gt;\(\boldsymbol{h}_i\)&lt;/span&gt; 和输入向量 &lt;span class="math"&gt;\(\boldsymbol{x}_{i+1}\)&lt;/span&gt;，然后输出新的状态向量 &lt;span class="math"&gt;\(\boldsymbol{h}_{i+1}\)&lt;/span&gt;。另一个函数 &lt;span class="math"&gt;\(O\)&lt;/span&gt; 将状态向量 &lt;span class="math"&gt;\(\boldsymbol{h}_i\)&lt;/span&gt; 映射为输出 &lt;span class="math"&gt;\(\boldsymbol{y}_i\)&lt;/span&gt;（激活函数）。&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    &amp;amp;\boldsymbol{h}_i=R(\boldsymbol{h}_{i_1},\boldsymbol{x}_i)\\
    &amp;amp;\boldsymbol{y}_i=O(\boldsymbol{h}_i)
\end{align}$$&lt;/div&gt;
&lt;p&gt;&lt;img alt="RNN" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7694?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;预先将分子编码转换为 one-hot 模式，在该模型中，通过计算（softmax 函数）&lt;/p&gt;
&lt;div class="math"&gt;$$P_\theta(s_{t+1}|s_t,\cdots,s_1)=\frac{\exp(y^k_t)}{\sum^K_{k'=1}\exp(y^{k'}_t)}$$&lt;/div&gt;
&lt;p&gt;得到序列的下一个字符 &lt;span class="math"&gt;\(s_{t+1}\)&lt;/span&gt;，再将该字符加入到输入向量中，继续得到 &lt;span class="math"&gt;\(y_{t+1}\)&lt;/span&gt;，从而得到 &lt;span class="math"&gt;\(s_{t+2}\)&lt;/span&gt;，用这种迭代的方式生成分子的描述序列。&lt;/p&gt;
&lt;p&gt;&lt;img alt="symbol generation" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7695?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;h3 id="qian-yi-xue-xi"&gt;迁移学习&lt;/h3&gt;
&lt;p&gt;文章的两个目标是生成尽可能大的多样分子数据用于虚拟筛选和针对特定靶点生成可能具有活性的分子数据。对于第一个目标，首先使用一个较大的训练集训练模型，使模型学会 SMILES 语法后，让模型生成大量分子数据。对于第二个目标，就需要用到迁移学习，使用更小的具有某特征的数据集训练再次训练模型，该操作称为 fine-tune，模型就能从中学习到特征，生成对某靶点可能具有活性的分子。&lt;/p&gt;
&lt;h3 id="shu-ju"&gt;数据&lt;/h3&gt;
&lt;p&gt;140 万个分子的 SMILES 数据来自于 ChEMBL 数据库。&lt;/p&gt;
&lt;h3 id="ping-jie-zhi-biao"&gt;评价指标&lt;/h3&gt;
&lt;div class="math"&gt;$$\mathrm{EOR}=\frac{n/|G_N|}{m/|R_M|}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(R_M\)&lt;/span&gt; 为只经过较大数据集训练的模型生成的分子集，&lt;span class="math"&gt;\(G_N\)&lt;/span&gt; 为经过 fine-tune 后模型生成的分子集，用 &lt;span class="math"&gt;\(T\)&lt;/span&gt; 表示测试集，&lt;span class="math"&gt;\(m=|G_N\cap T|\)&lt;/span&gt;，&lt;span class="math"&gt;\(n=|R_M\cap T|\)&lt;/span&gt;，EOR 表示相对于普通模型，经过 fine-tune 后的模型有多好。&lt;/p&gt;
&lt;h2 id="jie-guo_1"&gt;结果&lt;/h2&gt;
&lt;h3 id="sheng-cheng-xin-fen-zi"&gt;生成新分子&lt;/h3&gt;
&lt;p&gt;在使用大数据集训练模型后，让模型生成 50,000,000 个SMILES 符号，这些符号构成了 976,327 个分子，其中 97.7% 通过了 CDK 工具的合法性检测，说明模型学会了 SMILES 语法。在剔除重复与非法分子后，最终得到了 847,955 个新分子。&lt;/p&gt;
&lt;p&gt;接着使用 RDKit 库（version 2016.03.1）调查了生成的分子的物理化学性质，绘制了 t-SNE（(t-distributed stochastic neighbor embedding）数据降维图。&lt;/p&gt;
&lt;p&gt;&lt;img alt="t-SNE of novel molecules" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7696?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;可以看出生成分子集与训练集有很大的重叠，二者物理化学性质相似，该模型学习到了训练集中的特征。&lt;/p&gt;
&lt;h3 id="zhen-dui-te-ding-ba-ding-sheng-cheng-huo-xing-fen-zi-ku"&gt;针对特定靶定生成活性分子库&lt;/h3&gt;
&lt;p&gt;针对于 5-HT&lt;sub&gt;2A&lt;/sub&gt; 受体，在 ChEMBL 数据库中选择 pIC&lt;sub&gt;50&lt;/sub&gt; &amp;gt; 7 的 732 个分子作为训练集，用于 fine-tune 之前已经训练好的模型。随着 fine-tune 的 epochs 不断增加，生成分子中具有活性的分子占比随之增加。&lt;/p&gt;
&lt;p&gt;&lt;img alt="epochs" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7697?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;此外，文章中还针金黄色葡萄球菌生成了具有活性的分子，使用 1000 个数据得到预训练的模型后，只需要使用 50 个数据进行 fine-tune 操作也能得到可观的结果，这有利于在数据较少的情况下生成特定特征的分子。&lt;/p&gt;
&lt;p&gt;&lt;img alt="fine-tune table" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7699?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;h3 id="mo-ni-she-ji-he-cheng-ce-shi-de-xun-huan"&gt;模拟「设计-合成-测试」的循环&lt;/h3&gt;
&lt;p&gt;从头药物设计的流程包括药物的设计、合成、活性性测的循环，不断重复直至寻找到新的药物。这篇文章中使用模型模拟了这一流程，也就是分子生成（合成）&amp;rarr; 基于靶点预测选择更优分子（虚拟筛选）&amp;rarr; 使用更优分子训练模型（设计）。&lt;/p&gt;
&lt;p&gt;在经过 8 次循环后，模型生成了与测试集（7001 个分子）中相同 416 个分子，得到了 59.6 的 EOR，比使用 fine-tune 直接训练模型的结果更高。&lt;/p&gt;
&lt;h2 id="jie-lun_1"&gt;结论&lt;/h2&gt;
&lt;p&gt;文章利用循环神经网络构建了分子生成模型，该模型能够生成与训练集具有类似特征的分子。文章还使用了 fine-tune 的操作，在使用大数据集训练模型后，使用较小的数据集就能生成有针对性的分子。最后，文章将生成模型与靶点预测模型相结合，使用靶点预测的结果再训练生成模型，实现了从头药物设计流程的闭环。&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="RNN"></category></entry><entry><title>用 Markdown 创作 pptx 的尝试</title><link href="https://tseing.github.io/sui-sui-nian/2022-09-27-generate-ppt-by-marp.html" rel="alternate"></link><published>2022-09-27T00:00:00+08:00</published><updated>2022-09-27T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-09-27:/sui-sui-nian/2022-09-27-generate-ppt-by-marp.html</id><summary type="html">&lt;p&gt;总是遇到一些时候，一个又一个的 presentation 接踵而来，制作幻灯片就变成了令人头疼的事情。Marp 是一款支持使用 Markdown 语法生成 pptx 的工具，使用它或许可以解放双手。&lt;/p&gt;</summary><content type="html">&lt;p&gt;Marp 的全称是 Markdown Presentation Ecosystem，专门用于制作各种展示的演示文稿，除 pptx 外，Marp 还可以输出 pdf 和 html 格式，Marp 输出的 html 文件特别有意思，值得一试！但是 html 中的图片依赖于相对路径，真正用于 presentation 还是 pptx 的 slide 更为方便。&lt;/p&gt;
&lt;h2 id="an-zhuang"&gt;安装&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://marp.app/#get-started"&gt;Marp 官网&lt;/a&gt;提供了 Marp for VS Code 与 Marp CLI 两个版本，相信会命令行的用户也不用看这篇文章了，所以我选择了 Marp for VS Code。直接在 VS Code 中搜索拓展 Marp for VS Code，下载安装即可。&lt;/p&gt;
&lt;p&gt;安装完成后打开拓展设置，将 &lt;code&gt;Markdown &amp;gt; Marp:Export Type&lt;/code&gt; 修改为 &lt;code&gt;pptx&lt;/code&gt;，输出文件格式就默认为 pptx（若要调试 CSS 样式，输出 html 更为方便），其余设置按需修改。&lt;/p&gt;
&lt;p&gt;接下来测试一下 Marp 的功能是否正常，新建一个 &lt;code&gt;.md&lt;/code&gt; 文件，内容如下：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-markdown"&gt;---
marp: true
---

# Hello, Marp!

pptx by Marp
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;接着点击右上角的 &lt;code&gt;打开侧边预览&lt;/code&gt; 按钮，或使用快捷键 &lt;code&gt;Ctrl+K V&lt;/code&gt; （摁下 Ctrl+K 后再摁 V）打开预览界面。点击右上角 Marp 的图标，选择 &lt;code&gt;Toggle Marp Feature For Current Markdown&lt;/code&gt; 后理应出现像下图一样的幻灯片预览。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7652?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7652?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;有的朋友会发现仍然是 Markdown 文档的样式，而非幻灯片分页的形式，这可能是因为之前安装了其他的 Markdown 预览插件。最简单的方法就是使用 VS Code 自带的预览工具，以我的 Markdown Preview Enhanced 插件为例，在它的插件设置中找到 &lt;code&gt;Hide Default VSCode Markdown Preview Button&lt;/code&gt;，取消取定，重新启动后就会看见右上角有两个预览图标，一个是 VS Code 默认预览，另一个是 Markdown Preview Enhanced 插件，使用默认预览就能正常显示了。&lt;/p&gt;
&lt;h2 id="chuang-zuo-huan-deng-pian"&gt;创作幻灯片&lt;/h2&gt;
&lt;p&gt;Marp 中比较特殊的语法可以参考&lt;a href="https://github.com/marp-team/marp-vscode"&gt;官方文档&lt;/a&gt;与&lt;a href="https://caizhiyuan.gitee.io/categories/skills/20200730-marp.html"&gt;博客 CAI&lt;/a&gt;，其他语法与 Markdown 无异。&lt;/p&gt;
&lt;p&gt;全局的样式定义在主题 CSS 文件中，有时候需要修改单独页面的主题，Marp 提供了局部样式的方式：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-html"&gt;&amp;lt;style scoped&amp;gt;
    &amp;lt;!-- Your style Here.
    Such as: --&amp;gt;
    p{
        font-size: 30px;
    }
&amp;lt;/style&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Marp 使用与 Markdown 相同的方式插入图片，例如&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-markdown"&gt;![img](url) ![img](url)

---

![img](url)
![img](url)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;若将两个以上插入图片的语句写在同一行，那么两张图片会被包装在同一个 &lt;code&gt;&amp;lt;p&amp;gt;&amp;lt;/p&amp;gt;&lt;/code&gt; 标签中，也就类似于在文本框中插入两张图片，若宽度足够，两张图片会左右排列在同一行。&lt;/p&gt;
&lt;p&gt;若用第二种方式，也就是将两个以上插入图片的语句分行书写，那么各个图片在各自的 &lt;code&gt;&amp;lt;p&amp;gt;&amp;lt;/p&amp;gt;&lt;/code&gt; 标签中，也就是分行排列。&lt;/p&gt;
&lt;p&gt;正是因为图片在 &lt;code&gt;&amp;lt;p&amp;gt;&lt;/code&gt; 标签中，继承了 &lt;code&gt;text-align: left&lt;/code&gt; 的属性，也就是左侧对齐。对于我而言，图片居中更为重要，所以在样式文件中加入以下代码：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-css"&gt;img[alt~="center"] {
    display: block;
    margin: 0px auto;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在撰写文章时，使用 &lt;code&gt;![center](url)&lt;/code&gt; 就能使图片居中了。但是因为 &lt;code&gt;display: block&lt;/code&gt; 属性，居中的同时就不能左右排列两张图片了，所以欲使两张图片并排共同居中可能还要想点办法&lt;del&gt;（为什么要用 Markdown 做排版软件做的事 ..&amp;bull;&amp;breve;_&amp;breve;&amp;bull;.. ）&lt;/del&gt;。&lt;/p&gt;
&lt;h2 id="yi-ge-wo-chuang-jian-de-mo-ban"&gt;一个我创建的模版&lt;/h2&gt;
&lt;p&gt;Marp 中的样式是由 CSS 文件定义的，因此只要会使用 CSS，就能创建自己的主题。我制作了一个适用于各种汇报和答辩的 slide 主题，主题项目已经发布到 GitHub 了， &lt;a href="https://github.com/Tseing/Marp-Theme-NKU"&gt;&lt;i class="fa fa-github fa-lg"&gt;&lt;/i&gt; Marp-Theme-NKU&lt;/a&gt; 仓库页面有更详细的介绍和安装方法。&lt;/p&gt;
&lt;p&gt;&lt;img alt="page1" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7687?authkey=ALYpzW-ZQ_VBXTU"/&gt;
&lt;img alt="page2" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7688?authkey=ALYpzW-ZQ_VBXTU"/&gt;
&lt;img alt="page3" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7689?authkey=ALYpzW-ZQ_VBXTU"/&gt;
&lt;img alt="page4" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7690?authkey=ALYpzW-ZQ_VBXTU"/&gt;
&lt;img alt="page5" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7691?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;</content><category term="碎碎念"></category><category term="Marp"></category><category term="Markdown"></category></entry><entry><title>文献总结｜从头药物设计中的深度学习方法</title><link href="https://tseing.github.io/sui-sui-nian/2022-09-21-summary-doi.org/10.1016/j.sbi.2021.10.001.html" rel="alternate"></link><published>2022-09-21T00:00:00+08:00</published><updated>2022-09-21T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-09-21:/sui-sui-nian/2022-09-21-summary-doi.org/10.1016/j.sbi.2021.10.001.html</id><summary type="html">&lt;p&gt;本文主要介绍来自浙江大学的 Mingyang Wang 等人的综述，综述名称为 Deep learning approaches for de novo drug design: An overview，发表在 Current Opinion in Structural Biology 上。文章主要介绍了深度学习技术在从头药物设计领域的应用与分子生成方法，同时还指出了深度学习技术在药物设计方面目前所面临的问题。&lt;/p&gt;</summary><content type="html">&lt;p&gt;本文主要介绍来自浙江大学的 Mingyang Wang 等人的综述，综述名称为 Deep learning approaches for de novo drug design: An overview，发表在 &lt;em&gt;Current Opinion in Structural Biology&lt;/em&gt; 上。文章主要介绍了深度学习技术在从头药物设计领域的应用与分子生成方法，同时还指出了深度学习技术在药物设计方面目前所面临的问题。&lt;/p&gt;
&lt;p&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; &lt;a href="https://doi.org/10.1016/j.sbi.2021.10.001"&gt;doi.org/10.1016/j.sbi.2021.10.001&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="yin-yan"&gt;引言&lt;/h2&gt;
&lt;p&gt;从头药物设计（分子生成）的主要目标是从现有的化合物库中生成新颖且具有指定特征的分子。与虚拟筛选相比，虚拟筛选通过多种筛选方法不断缩小化合物范围，最终获得目标分子，而基于深度学习的生成模型则是通过总结和提取现有分子的特征，然后将其转换成新颖的化合物。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7638?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7638?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h2 id="fen-zi-miao-shu-yu-sheng-cheng-mo-xing-ping-jie-zhi-biao"&gt;分子描述与生成模型评价指标&lt;/h2&gt;
&lt;h3 id="fen-zi-miao-shu"&gt;分子描述&lt;/h3&gt;
&lt;p&gt;数据集和生成算法都会影响生成模型的预测性能，除此之外，模型的预测性能很大程度上也依赖于如何将配体和蛋白-配体复合物描述成合适的形式并用于特征用学习。&lt;/p&gt;
&lt;p&gt;常见的分子描述形式包括&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;简化分子线性输入规范（Simplified Molecular-Input Line-Entry System, SMILES）；&lt;/li&gt;
&lt;li&gt;分子指纹；&lt;/li&gt;
&lt;li&gt;分子概念图（Molecular Conceptual Diagram, MCD）。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;SMILES&lt;/h4&gt;
&lt;p&gt;SMILES 是计算化学领域通用的分子表达形式，也经常被用于分子生成模型中。但 SMILES 也存在着一定问题，例如同一个分子可以表达成多种不同的 SMILES 序列，这就会影响分子生成多样性。&lt;/p&gt;
&lt;h4&gt;MCD&lt;/h4&gt;
&lt;p&gt;MCD 将分子转化成 2D 或 3D 的图，例如 2D 形式的概率全连接图：原子作为结点，键作为边，点与边通过邻接矩阵完全相连，3D MCD 则将输入数据转化为图像或矩阵。&lt;/p&gt;
&lt;h3 id="mo-xing-ping-jie-zhi-biao"&gt;模型评价指标&lt;/h3&gt;
&lt;p&gt;模型评价指标也可以粗略分为 3 类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;针对整个生成分子集的评价指标；&lt;/li&gt;
&lt;li&gt;针对生成分子集中单个分子的评价指标；&lt;/li&gt;
&lt;li&gt;针对生成模型的整体评价指标。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;针对整个生成分子集的评价指标&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;合理性（Validity）：生成分子集中合理有效分子的占比。&lt;/li&gt;
&lt;li&gt;新颖性（Novelty）：存在于生成分子集中，而不存在于现有分子集中的分子比例。&lt;/li&gt;
&lt;li&gt;独特性（Uniqueness）：生成分子集中合理且非重复分子的占比。&lt;/li&gt;
&lt;li&gt;Frag：生成分子集与现有分子集中化学片段的相似程度。&lt;/li&gt;
&lt;li&gt;Scaff：生成分子集与现有分子集中化学骨架的相似程度。&lt;/li&gt;
&lt;li&gt;SNN：生成分子集与现有分子集中最相似分子的平均谷本系数。&lt;/li&gt;
&lt;li&gt;Div：生成分子集中的分子多样性。&lt;/li&gt;
&lt;li&gt;FCD：生成分子集与现有分子集中分子生物活性的差别。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;针对生成分子集中单个分子的评价指标&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;分子的物理化学性质。&lt;/li&gt;
&lt;li&gt;SA：用 1-10 来评价分子的合成复杂程度。&lt;/li&gt;
&lt;li&gt;NP：用 0-5 表示天然产物，-5-0 表示合成产物。&lt;/li&gt;
&lt;li&gt;QED：成为候选药物的可能性。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;针对生成模型的整体评价工具&lt;/h4&gt;
&lt;p&gt;一些整体评价工具套件常用于评价整体的生成模型，这些工具大多集成了内置的指标，常用的工具包括 MOSES 与 GuacaMol。&lt;/p&gt;
&lt;h2 id="fen-zi-sheng-cheng-zhong-zui-xin-de-shen-du-xue-xi-kuang-jia_1"&gt;分子生成中最新的深度学习框架&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7639?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7639?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p class="intro"&gt;（a）VAE 生成模型使用包括编码器 q(z|x) 与解码器 (x|z) 的分子通过最大化 LB（下界）训练模型；（b）RNN 模型通过最大化合理分子字符序列组合的概率 (y1y2&amp;hellip;yt) 生成分子；（c）GAN 模型中，鉴别器 D 否决生成器 G（D(x)&amp;rarr;0, D(G(z))&amp;rarr;0），而生成器要生成更&amp;ldquo;真实&amp;rdquo;的分子来欺骗鉴别器（D(G(z))&amp;rarr;1)）;（d）RL 框架使用预测器来奖励生成器的每个状态 s，最大化末了状态 S 的总分 R；（e）不同的分子描述形式。&lt;/p&gt;
&lt;h3 id="ji-yu-enc-dec-de-mo-xing"&gt;基于 Enc-Dec 的模型&lt;/h3&gt;
&lt;p&gt;Enc-Dec 是一种无监督学习的模型，编码器将分子映射成潜在空间中的向量，解码器将概率分布映射回原始空间，基于 Enc-Dec 的模型就通过在潜在空间中抽样来生成分子。最早基于 Enc-Dec 的模型属于变分自编码器（Variational Autoencoder, VAE），后来又产生了许多种变种。&lt;/p&gt;
&lt;h3 id="ji-yu-rnn-rl-he-gan-de-mo-xing"&gt;基于 RNN、RL 和 GAN 的模型&lt;/h3&gt;
&lt;p&gt;与基于 Enc-Dec 的模型不同，基于循环神经网络（Recurrent Neural Network, RNN）、强化学习（Reinforcement
Learning, RL）和生成对抗网络（Generative Adversarial
Network, GAN）的模型向着预先设定的特征生成分子。&lt;/p&gt;
&lt;p&gt;基于 RNN 的模型能够通过逐层的神经网络生成具有最高概率的分子排布形式，为了解决梯度下降等问题，还向 RNN 层中引入了长短期记忆和门循环单元算法。转移学习（Transfer Learning, TL）通过转移从相关任务中的知识来提升对新任务的学习效果。在基于 RNN 的模型中，TL 通常就是指在针对某特定靶点的任务中使用一些具有活性的化合物来再训练生成模型，这种 RNN 与 TL 的结合已经有许多成功案例。相比其他算法，RNN 具有的优势包括能够生成无限长度的分子和模型训练的操作简单。&lt;/p&gt;
&lt;p&gt;GAN 的基本原理是生成器与鉴别器之间的二人零和博弈，鉴别器尝试鉴别出生成分子中的真阳性分子，而生成器尝试在噪声中生成分子并欺骗鉴别器。GAN 常与其他深度学习框架结合，共同完成药物设计任务，例如在训练过程中可以将 GAN 鉴别器与 RL 奖励系统结合，为生成分子打分。&lt;/p&gt;
&lt;p&gt;DL 更多作为深度学习模型的一种优化策略，DL 使用奖励函数为行要打分，打分结果就决定了下一阶段的行为。在分子生成模型中，生成器通过某些方式生成分子，然后内置的 QSAR 预测器就会评估生成分子的质量（奖励还是惩罚），评估过程的目的就是增强生成分子的人为预设特征。&lt;/p&gt;
&lt;h2 id="wei-lai-zhan-wang_1"&gt;未来展望&lt;/h2&gt;
&lt;p&gt;分子描述仍然是分子生成模型中的关键问题，不同于文本或图像能够直接使用计算机处理，针对于不同的任务，具有多种多样的分子描述形式，根本原因还是在于仍没有完美的分子表述形式，所以针对于不同算法和任务，必须选取合适的描述方式。分子描述还具有一个容错率的问题，例如文本中某些词语和图像中某些像素若具有错误，不会被鉴别器完全否定，而在分子生成模型中，只要一个原子存在错误，就可能生成不合理的分子。&lt;/p&gt;
&lt;p&gt;在各种分子生成模型中，假阳性也是一个不能忽视的问题。湿实验当然是评估生成分子质量的最直接方法，但生成分子的数量如此之大，这种方法也是不可行的。目前在机器学习领域仍然缺少评估生成分子质量的标准，我们仍需要评估模型与生成分子质量的普适标准。&lt;/p&gt;
&lt;p&gt;目前方法学的研究还是集中于优化深度学习框架的算法，实际应用的研究远少于方法学研究，许多开源工具也集中于新算法的优化而不是针对特定靶点的药物设计。因此，目前迫切需要一种集成了多种分子生成算法的平台，并将其用于药物设计。&lt;/p&gt;
&lt;p&gt;在深度学习展现出广阔前景的同时，传统算法并未过时，例如传统的遗传算法在分子生成模型中也能得到可观的结果。在深度学习在其他领域迈步向前的同时，在药物设计邻域才初具雏形，因此其他邻域的应用可能也能为药物设计与发现提供有价值的导向。&lt;/p&gt;</content><category term="碎碎念"></category><category term="Literature Summary"></category><category term="CADD"></category><category term="Review"></category></entry><entry><title>《统计学习方法》第七章：支持向量机</title><link href="https://tseing.github.io/sui-sui-nian/2022-09-16-statistical-learning-chapter7.html" rel="alternate"></link><published>2022-09-16T00:00:00+08:00</published><updated>2022-09-16T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-09-16:/sui-sui-nian/2022-09-16-statistical-learning-chapter7.html</id><summary type="html">&lt;p&gt;《统计学习方法》第五章介绍了支持向量机模型以及支持向量机模型在处理线性可分、线性近似可分、线性不可分数据时的应用。支持向量机的学习过程同样采用对偶算法，此外还有 SMO 算法，大大提高了运算速度。&lt;/p&gt;</summary><content type="html">&lt;p&gt;支持向量机是一种与感知机相似的二分类模型，但感知机的学习策略仅仅是使线性可分的两类实例区分开来，而支持向量机使用的是间隔最大化策略。间隔最大化使支持向量机不仅能完成二分类任务，同时使支持向量机具有更加良好的可信度和预测功能。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;训练数据&lt;/th&gt;
&lt;th&gt;策略&lt;/th&gt;
&lt;th&gt;模型&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;线性可分&lt;/td&gt;
&lt;td&gt;硬间隔最大化&lt;/td&gt;
&lt;td&gt;线性可分支持向量机&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;近似线性可分&lt;/td&gt;
&lt;td&gt;软间隔最大化&lt;/td&gt;
&lt;td&gt;线性支持向量机&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;线性不可分&lt;/td&gt;
&lt;td&gt;核技巧、软间隔最大化&lt;/td&gt;
&lt;td&gt;非线性支持向量机&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="xian-xing-ke-fen-zhi-chi-xiang-liang-ji"&gt;线性可分支持向量机&lt;/h2&gt;
&lt;h3 id="mo-xing"&gt;模型&lt;/h3&gt;
&lt;p&gt;支持向量机的模型与感知机类似，分离超平面为&lt;/p&gt;
&lt;div class="math"&gt;$$w^*\cdot x+b^*=0$$&lt;/div&gt;
&lt;p&gt;分类决策函数为&lt;/p&gt;
&lt;div class="math"&gt;$$f(x)=\mathrm{sign}(w^*\cdot x+b^*)$$&lt;/div&gt;
&lt;h3 id="ce-lue"&gt;策略&lt;/h3&gt;
&lt;h4&gt;函数间隔与几何间隔&lt;/h4&gt;
&lt;p&gt;实例到超平面的距离能&lt;dot&gt;相对地&lt;/dot&gt;用 &lt;span class="math"&gt;\(|w\cdot x+b|\)&lt;/span&gt; 衡量，称为函数间隔。样本点到超平面的函数间隔记作 &lt;span class="math"&gt;\(\hat{\gamma}_i\)&lt;/span&gt;，将数据集 &lt;span class="math"&gt;\(T\)&lt;/span&gt; 中所有样本点函数间隔的最小值称为超平面关于数据集 &lt;span class="math"&gt;\(T\)&lt;/span&gt; 的函数间隔，记作 &lt;span class="math"&gt;\(\hat{\gamma}\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;函数间隔会随着超平面参数 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt; 的改变而改变，但若 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt; 等比例缩放，超平面没有变化（等式左右可同时约去比例），样本点到超平面距离没有变化，而函数间隔变化了。&lt;/p&gt;
&lt;p&gt;这说明需要将函数间隔规范化，也就得到了几何间隔 &lt;span class="math"&gt;\(\frac{w}{||w||}\)&lt;/span&gt;，这也就是样本点到超平面的实际（几何）距离，记作 &lt;span class="math"&gt;\(\gamma_i\)&lt;/span&gt;，类似地，超平面关于数据集的几何间隔记作 &lt;span class="math"&gt;\(\gamma\)&lt;/span&gt;，得到转化公式&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \gamma_i=\frac{\hat{\gamma}_i}{||w||}\\
    \gamma=\frac{\hat{\gamma}}{||w||}
\end{align}$$&lt;/div&gt;
&lt;h4&gt;间隔最大化&lt;/h4&gt;
&lt;p&gt;不同于感知机，间隔最大化的策略不仅用超平面将两类样本点分开，还要使不同类别的样本点的几何距离超平面最大，这样的做法使得超平面有足够的确信度将两类样本分开。&lt;/p&gt;
&lt;p&gt;再回忆一下感知机，感知机仅仅将线性可分的样本点分开，因此运算过程中取样本点的顺序不同，会得到不同的结果，当然这些不同的结果都能分开两类样本。但支持向量机采用了间隔最大化策略，几何间隔最大的分离超平面是唯一的，最后也就得到唯一且最优的模型。&lt;/p&gt;
&lt;p&gt;间隔最大化策略使得分离超平面的确定只依赖于最靠近超平面的样本点，这些实例点就称为支持向量。&lt;/p&gt;
&lt;p&gt;根据间隔最大化的思路，可以得到以下最优化问题：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \max_{w,b}&amp;amp;\quad \frac{\hat{\gamma}}{||w||}\\
    \mathrm{s.t.}&amp;amp;\quad y_i\frac{w\cdot x+b}{||w||}\geqslant \frac{\hat{\gamma}}{||w||}
\end{align}$$&lt;/div&gt;
&lt;p&gt;等比缩放 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt; 将得到 &lt;span class="math"&gt;\(\lambda \hat{\gamma}\)&lt;/span&gt;，但超平面没有改变，几何间隔也没有改变，也就是说只需要考虑 &lt;span class="math"&gt;\(\frac{1}{||w||}\)&lt;/span&gt;，略去 &lt;span class="math"&gt;\(\hat{\gamma}\)&lt;/span&gt; 得到&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \max_{w,b}&amp;amp;\quad \frac{1}{||w||}\\
    \mathrm{s.t.}&amp;amp;\quad y_i(w\cdot x+b)\geqslant 1
\end{align}$$&lt;/div&gt;
&lt;p&gt;将该最优化问题转化为最小化问题：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \min_{w,b}&amp;amp;\quad \frac{1}{2}||w||^2\\
    \mathrm{s.t.}&amp;amp;\quad y_i(w\cdot x+b)-1\geqslant 0
\end{align}$$&lt;/div&gt;
&lt;p&gt;{note begin}最大化 &lt;span class="math"&gt;\(\frac{1}{||w||}\)&lt;/span&gt; 等价于最小化 &lt;span class="math"&gt;\(||w||^2\)&lt;/span&gt;，当然前面的常数项更是无所谓的。{note end}&lt;/p&gt;
&lt;h3 id="suan-fa"&gt;算法&lt;/h3&gt;
&lt;h4&gt;原始算法&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;算法 7.1&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：线性可分的数据集&lt;br/&gt;
输出：最大间隔分离超平面和分离决策函数&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;构造求解最优化问题得到最优解 &lt;span class="math"&gt;\(w^*\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b^*\)&lt;/span&gt;（解不等式组）；
    &lt;div class="math"&gt;$$\begin{align}
        \min_{w,b}&amp;amp;\quad \frac{1}{2}||w||^2\\
        \mathrm{s.t.}&amp;amp;\quad y_i(w\cdot x+b)-1\geqslant 0
    \end{align}$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;得到分离超平面与决策函数。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;对偶算法&lt;/h4&gt;
&lt;p&gt;对偶算法同样依赖于 Lagrange 函数（见&lt;a href="https://tseing.github.io/sui-sui-nian/2022-09-09-statistical-learning-chapter6.html#yan-yi-la-ge-lang-ri-han-shu"&gt;第六章&lt;/a&gt;），构造 lagrange 函数：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    L(w,b,\alpha)&amp;amp;=\frac{1}{2}||w||^2-\sum_i\alpha_i[y_i(w\cdot x+b)-1]\\
    &amp;amp;=\frac{1}{2}||w||^2-\sum_i\alpha_iy_i(w\cdot x+b)+\sum_i\alpha_i
\end{align}$$&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;求对偶问题的极小 &lt;span class="math"&gt;\(\min_{w,b}L(w,b,\alpha)\)&lt;/span&gt;：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;求 Lagrange 函数对 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt; 的偏导并令其为零：&lt;/p&gt;
&lt;div class="math"&gt;$$\frac{\partial L}{w}=w-\sum_i\alpha_iy_ix_i=0$$&lt;/div&gt;
&lt;div class="math"&gt;$$\frac{\partial L}{b}=-\sum_i\alpha_iy_i=0$$&lt;/div&gt;
&lt;p&gt;将 &lt;span class="math"&gt;\(w=\sum_i\alpha_iy_ix_i\)&lt;/span&gt; 代入 Lagrange 函数，为简洁起见，先只考虑 &lt;span class="math"&gt;\(\frac{1}{2}||w||^2\)&lt;/span&gt; 一项：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \frac{1}{2}||w||^2&amp;amp;=\frac{1}{2}x^\mathrm{T}\cdot x\\
    &amp;amp;=\frac{1}{2}\left(\sum_i\alpha_iy_ix_i\right)\cdot\left(\sum_j\alpha_jy_jx_j\right)\\
    &amp;amp;=\frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)
\end{align}$$&lt;/div&gt;
&lt;p&gt;再考虑到 &lt;span class="math"&gt;\(b\sum_i\alpha_iy_i=0\)&lt;/span&gt; 那么 Lagrange 函数应当为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    L(w,b,\alpha)&amp;amp;=\frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)-\sum_i\alpha_iy_i\left(\sum_j\alpha_jy_jx_j\cdot x_i\right)+\sum_i\alpha_i\\
    &amp;amp;=-\frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)+\sum_i\alpha_i
\end{align}$$&lt;/div&gt;
&lt;p&gt;对偶问题的极小也就是 &lt;span class="math"&gt;\(-\frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)+\sum_i\alpha_i\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;求对偶问题极小的极大 &lt;span class="math"&gt;\(\max_{\alpha}\min_{w,b}L(w,b,\alpha)\)&lt;/span&gt;：&lt;/strong&gt;&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \max_{\alpha}&amp;amp;\quad -\frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)+\sum_i\alpha_i\\
    \mathrm{s.t.}&amp;amp;\quad \sum_i\alpha_iy_i=0,\ \alpha_i\geqslant0
\end{align}$$&lt;/div&gt;
&lt;p&gt;转化为极小问题&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \min_{\alpha}&amp;amp;\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)-\sum_i\alpha_i\\
    \mathrm{s.t.}&amp;amp;\quad \sum_i\alpha_iy_i=0,\ \alpha_i\geqslant0
\end{align}$$&lt;/div&gt;
&lt;p&gt;假设该问题的解为 &lt;span class="math"&gt;\(\alpha^*=(\alpha^*_1,\alpha^*_2,\cdots,\alpha^*_N)^\mathrm{T}\)&lt;/span&gt;，那么支持向量机的参数（从 KKT 条件导出）为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    &amp;amp;w^*=\sum_i\alpha^*_iy_ix_i\\
    &amp;amp;b^*=y_j-\sum_i\alpha^*_iy_i(x_i\cdot x_j)
\end{align}$$&lt;/div&gt;
&lt;p&gt;可以看出，若 &lt;span class="math"&gt;\(\alpha_i=0\)&lt;/span&gt;，参数与该分量无关，也就是说该分量所对应的样本点不影响支持向量机。从另一方面看，支持向量机只与 &lt;span class="math"&gt;\(\alpha_i&amp;gt;0\)&lt;/span&gt; 对应的样本点有关，这些样本点就是支持向量。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法 7.2&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：线性可分的数据集&lt;br/&gt;
输出：最大间隔分离超平面和分离决策函数&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;构造并求解问题得到 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt;
&lt;div class="math"&gt;$$\begin{align}
        \min_{\alpha}&amp;amp;\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)-\sum_i\alpha_i\\
        \mathrm{s.t.}&amp;amp;\quad \sum_i\alpha_iy_i=0,\ \alpha_i\geqslant0
    \end{align}$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;用 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt; 计算 &lt;span class="math"&gt;\(w^*\)&lt;/span&gt;，用 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt; 的正分量计算 &lt;span class="math"&gt;\(b^*\)&lt;/span&gt;;&lt;/li&gt;
&lt;li&gt;得到分离超平面与决策函数。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;对偶算法案例&lt;/h4&gt;
&lt;p&gt;在算法 7.2 的第 1 步中，需要求解 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt;，这里容易令人困惑，以书中的例子说明计算方法。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;正例点为 &lt;span class="math"&gt;\(x_1=(3,3)^\mathrm{T}\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(x_2=(4,3)^\mathrm{T}\)&lt;/span&gt;，负例点为 &lt;span class="math"&gt;\(x_3=(1,1)^\mathrm{T}\)&lt;/span&gt;，求线性可分支持向量机。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;先计算样本点的 Gram 矩阵，以便后续计算：&lt;/p&gt;
&lt;div class="math"&gt;$$G=\begin{bmatrix}
    18 &amp;amp;21 &amp;amp;6\\
    21 &amp;amp;25 &amp;amp;7\\
    6  &amp;amp;7  &amp;amp;2
\end{bmatrix}$$&lt;/div&gt;
&lt;div class="math"&gt;$$\begin{align}
     \min_{w,b}&amp;amp;\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)-\sum_i\alpha_i\\
     &amp;amp;=\frac{1}{2}(18\alpha^2_1+25\alpha^2_2+2\alpha^2_3+42\alpha_1\alpha_2-12\alpha_1\alpha_3-14\alpha_2\alpha_3)-\alpha_1-\alpha_2-\alpha3\\
     \mathrm{s.t.}&amp;amp;\quad \alpha_1+\alpha_2-\alpha_3=0,\ \alpha_i\geqslant0
 \end{align}$$&lt;/div&gt;
&lt;p&gt;为了求解这一最优化问题，需要将约束代入目标问题，得到&lt;/p&gt;
&lt;div class="math"&gt;$$s(\alpha_1,\alpha_2)=4\alpha^2_1+\frac{13}{2}\alpha^2_2+10\alpha_1\alpha_2-2\alpha_1-2\alpha_2$$&lt;/div&gt;
&lt;p&gt;求其偏导并令其为零，得知 &lt;span class="math"&gt;\(s(\alpha_1,\alpha_2)\)&lt;/span&gt; 在 &lt;span class="math"&gt;\((\frac{3}{2},-1)^\mathrm{T}\)&lt;/span&gt; 处取得极值，但 &lt;span class="math"&gt;\(\alpha_2=-1\)&lt;/span&gt; 违反了 &lt;span class="math"&gt;\(\alpha_i\geqslant0\)&lt;/span&gt; 的约束，那么&lt;dot&gt;最小值将在边界上取到&lt;/dot&gt;。&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    &amp;amp;a_1=0,\quad s(0,\frac{2}{13})=-\frac{2}{13}\\
    &amp;amp;a_2=0,\quad s(\frac{1}{4},0)=-\frac{1}{4}
\end{align}$$&lt;/div&gt;
&lt;p&gt;所以计算得到最终的 &lt;span class="math"&gt;\(\alpha^*=(\frac{1}{4},0,\frac{1}{4})^\mathrm{T}\)&lt;/span&gt;。&lt;/p&gt;
&lt;h2 id="xian-xing-zhi-chi-xiang-liang-ji_1"&gt;线性支持向量机&lt;/h2&gt;
&lt;h3 id="mo-xing_1"&gt;模型&lt;/h3&gt;
&lt;p&gt;线性可分支持向量机是线性支持向量机的特例，所以线性支持向量机的模型与线性可分支持向量机相同。在现实情况中，很难遇到标准的线性可分的数据，这时候就需要使用更为普遍的线性支持向量机。&lt;/p&gt;
&lt;h3 id="ce-lue_1"&gt;策略&lt;/h3&gt;
&lt;p&gt;线性可分数据集与近似线性可分数据集的差别在于，近似线性可分数据集中存在一些特异点，若将这些特异点去除，那么数据集就变成了线性可分的。&lt;/p&gt;
&lt;p&gt;特异点无法被正常分类的原因是特异点不能满足支持向量机的分类条件&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    &amp;amp;正例点：w\cdot x+b\geqslant1\\
    &amp;amp;负例点：w\cdot x+b\leqslant-1
\end{align}$$&lt;/div&gt;
&lt;p&gt;从几何上来看，也就是特异点与分离超平面的距离不够远，不能满足函数间隔大于等于 1，因此引入一个松驰变量 &lt;span class="math"&gt;\(\xi_i\geqslant0\)&lt;/span&gt;，使得特异点的函数间隔加上松驰变量大于等于 1，那么最优化问题的约束就变为&lt;/p&gt;
&lt;div class="math"&gt;$$y_i(w\cdot x_i+b)\geqslant1-\xi_i$$&lt;/div&gt;
&lt;p&gt;原来的目标函数改为&lt;/p&gt;
&lt;div class="math"&gt;$$\frac{1}{2}||w||^2+C\sum_i\xi_i$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(C&amp;gt;0\)&lt;/span&gt; 称为惩罚参数，目标函数使 &lt;span class="math"&gt;\(\frac{1}{2}||w||^2\)&lt;/span&gt; 尽可能小，也就是间隔尽量大；&lt;span class="math"&gt;\(\xi_i\)&lt;/span&gt; 尽可能小，也就是误分类的点（补偿的间隔）尽量少；&lt;span class="math"&gt;\(C\)&lt;/span&gt; 就是在二种策略间权衡的权重值，调和二者关系。&lt;/p&gt;
&lt;h3 id="suan-fa_1"&gt;算法&lt;/h3&gt;
&lt;h4&gt;原始算法&lt;/h4&gt;
&lt;p&gt;线性支持向量机的原始问题为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
     \min_{w,b}&amp;amp;\quad \frac{1}{2}||w||^2+C\sum_i\xi_i\\
     \mathrm{s.t.}&amp;amp;\quad y_i(w\cdot x_i+b)\geqslant1-\xi_i,\ \xi_i\geqslant0
\end{align}$$&lt;/div&gt;
&lt;p&gt;线性支持向量机的原始问题与线性可分支持向量机也相似，求解该问题得到分离超平面与分类决策函数。&lt;/p&gt;
&lt;h4&gt;对偶算法&lt;/h4&gt;
&lt;p&gt;从原始问题中导出对偶问题，使用同样的步骤构造 Lagrange 函数，并求其极大极小：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
     \min_{\alpha}&amp;amp;\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)-\sum_i\alpha_i\\
     \mathrm{s.t.}&amp;amp;\quad \sum_i\alpha_iy_i=0,\ 0\leqslant\alpha_i\color{orangered}{\leqslant C}
\end{align}$$&lt;/div&gt;
&lt;p&gt;可以看出线性支持向量机的原始问题只是比线性可分支持向量机多了一个约束条件，因此最终导出的结果也是相似的。求解该对偶问题得到 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt;，求得支持向量机参数&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    &amp;amp;w^*=\sum_i\alpha^*_iy_ix_i\\
    &amp;amp;b^*=y_j-\sum_i\alpha^*_iy_i(x_i\cdot x_j)
\end{align}$$&lt;/div&gt;
&lt;p&gt;这里需要注意的是，由于存在 &lt;span class="math"&gt;\(0\leqslant\alpha_i\leqslant C\)&lt;/span&gt; 的约束条件，需要保证 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt; 中各分量满足这一约束，选择其中满足 &lt;span class="math"&gt;\(0&amp;lt;\alpha_i&amp;lt;C\)&lt;/span&gt; 条件的分量计算支持向量机参数，很容易明白，满足 &lt;span class="math"&gt;\(0&amp;lt;\alpha_i&amp;lt;C\)&lt;/span&gt; 条件分量所对应的样本点就是该模型中的支持向量。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法 7.3&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：数据集&lt;br/&gt;
输出：分离超平面和分离决策函数&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;构造并求解问题得到 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt;
&lt;div class="math"&gt;$$\begin{align}
        \min_{\alpha}&amp;amp;\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(x_i\cdot x_j)-\sum_i\alpha_i\\
        \mathrm{s.t.}&amp;amp;\quad \sum_i\alpha_iy_i=0,\ 0\leqslant\alpha_i\leqslant C
    \end{align}$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;用 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt; 计算 &lt;span class="math"&gt;\(w^*\)&lt;/span&gt;，用 &lt;span class="math"&gt;\(\alpha^*\)&lt;/span&gt; 中满足条件 &lt;span class="math"&gt;\(0&amp;lt;\alpha_i&amp;lt;C\)&lt;/span&gt; 的分量计算 &lt;span class="math"&gt;\(b^*\)&lt;/span&gt;;&lt;/li&gt;
&lt;li&gt;得到分离超平面与决策函数。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="fei-xian-xing-zhi-chi-xiang-liang-ji_1"&gt;非线性支持向量机&lt;/h2&gt;
&lt;h3 id="mo-xing_2"&gt;模型&lt;/h3&gt;
&lt;p&gt;在实际情况中，常常还会得到非线性的数据集，这时候若尝试用一个超平面将两类实例区分开，会得到大量的误分类点，这样的模型没有很好的确信度和预测性能。超平面的模型是简单的，若使用更复杂一些的超曲面，通常能取得更好的效果。&lt;/p&gt;
&lt;p&gt;我用一个简单的例子说明这个问题，回忆中学时代的线性回归，也就是用一条直线来拟合一系列数据点，如果数据点是由二次函数产生的，断然是无法找到这条合适的直线的。此时需要将数据点经过变换，经过变换后，在另一空间中得到适合拟合的数据。&lt;/p&gt;
&lt;p&gt;&lt;img alt="核技巧" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7606?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;核技巧也是同样的思路，将不适合使用超平面分类的数据集变换到另一空间中，在该空间中使用超平面分类，就相当于在原空间中使用超曲面而非超平面分类。&lt;/p&gt;
&lt;p&gt;将这个从输入空间到特征空间的映射记作 &lt;span class="math"&gt;\(\phi(x)\)&lt;/span&gt;，使得输入空间中的所有 &lt;span class="math"&gt;\(x,z\)&lt;/span&gt; 满足&lt;/p&gt;
&lt;div class="math"&gt;$$K(x,z)=\phi(x)\cdot\phi(z)$$&lt;/div&gt;
&lt;p&gt;就称 &lt;span class="math"&gt;\(K(x,z)\)&lt;/span&gt; 为核函数。考虑对偶问题&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{\alpha}\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j(\color{orangered}{x_i\cdot x_j})-\sum_i\alpha_i$$&lt;/div&gt;
&lt;p&gt;将核函数代入就得到非线性支持向量机的对偶问题&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{\alpha}\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_j\color{orangered}{K(x_i,x_j)}-\sum_i\alpha_i$$&lt;/div&gt;
&lt;p&gt;所以非线性支持向量机的分类决策函数就是&lt;/p&gt;
&lt;div class="math"&gt;$$f(x)=\mathrm{sign}\left(\sum_i\alpha^*_iy_iK(x,x_i)+b^*\right)$$&lt;/div&gt;
&lt;p&gt;核函数一般不用自己计算，常见的核函数有&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;核函数&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;多项式核函数&lt;/td&gt;
&lt;td&gt;&lt;span class="math"&gt;\(K(x,z)=(x\cdot z+1)^p\)&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;高斯核函数&lt;/td&gt;
&lt;td&gt;&lt;span class="math"&gt;\(K(x,z)=\exp\left(-\frac{\|x-z\|^2}{2\sigma^2}\right)\)&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="suan-fa_2"&gt;算法&lt;/h3&gt;
&lt;p&gt;非线性支持向量机的算法与线性支持向量机无异，不过是需要预先选择合适的核函数，构造最优化问题&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{\alpha}\quad \frac{1}{2}\sum_i\sum_j\alpha_i\alpha_jy_iy_jK(x_i,x_j)-\sum_i\alpha_i$$&lt;/div&gt;
&lt;p&gt;最后用同样的方法求解该最优化问题得到非线性支持向量机。&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references_1"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/33437381/"&gt;李航, 2019. 统计学习方法（第2版）. 清华大学出版社.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/433150785"&gt;保姆级笔记-详细剖析SMO算法中的知识点 - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="统计学习方法"></category><category term="Machine learning"></category><category term="Algorithm"></category></entry><entry><title>《统计学习方法》第六章：逻辑斯谛回归与最大熵模型</title><link href="https://tseing.github.io/sui-sui-nian/2022-09-09-statistical-learning-chapter6.html" rel="alternate"></link><published>2022-09-09T00:00:00+08:00</published><updated>2022-09-09T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-09-09:/sui-sui-nian/2022-09-09-statistical-learning-chapter6.html</id><summary type="html">&lt;p&gt;《统计学习方法》第五章主要介绍逻辑斯谛回归模型与最大熵模型，这两种模型具有类似的对数结构，都利用了极大似然估计原理。本章还介绍了广义拉格朗日函数和拟牛顿法。&lt;/p&gt;</summary><content type="html">&lt;h2 id="mo-xing"&gt;模型&lt;/h2&gt;
&lt;h3 id="luo-ji-si-di-hui-gui-mo-xing"&gt;逻辑斯谛回归模型&lt;/h3&gt;
&lt;p&gt;逻辑斯谛分布具有良好的性质，能够将 &lt;span class="math"&gt;\((-\infty,+\infty)\)&lt;/span&gt; 映射至 &lt;span class="math"&gt;\((-1，+1)\)&lt;/span&gt;，因此选用逻辑斯谛分布作为回归模型。逻辑斯谛分布函数与密度函数为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    F(x)&amp;amp;=P(\leqslant x)=\frac{1}{1+\mathrm{e}^{-(x-\mu)/\gamma}}\\
    f(x)&amp;amp;=F'(x)=\frac{\mathrm{e}^{-(x-\mu)/\gamma}}{\gamma(1+\mathrm{e}^{-(x-\mu)/\gamma})^2}
\end{align}$$&lt;/div&gt;
&lt;p&gt;逻辑斯谛分布函数与密度函数的图像分别如下：&lt;/p&gt;
&lt;p&gt;&lt;img alt="逻辑斯谛分布" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7554?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;将逻辑斯谛分布函数简化，可以得到 Sigmoid 函数：&lt;/p&gt;
&lt;div class="math"&gt;$$S(x)=\frac{1}{1+\mathrm{e}^{-x}}=\frac{\mathrm{e}^x}{1+\mathrm{e}^x}$$&lt;/div&gt;
&lt;p&gt;回忆二分类的感知机 &lt;span class="math"&gt;\(w\cdot x+b\)&lt;/span&gt;，超平面将实例分作 &lt;span class="math"&gt;\(w\cdot x+b\geqslant 0\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(w\cdot x+b&amp;lt; 0\)&lt;/span&gt; 两类。可以看出，&lt;span class="math"&gt;\(w\cdot x+b\)&lt;/span&gt; 的值域为实数域，那么就可以利用逻辑斯谛分布将实数域映射到 &lt;span class="math"&gt;\((-1，+1)\)&lt;/span&gt;，实现分类。&lt;/p&gt;
&lt;p&gt;为了表述简洁，令 &lt;span class="math"&gt;\(w=(w^{(1)},w^{(2)},\cdots,w^{(n)},b)^{\mathrm{T}}\)&lt;/span&gt;，&lt;span class="math"&gt;\(x=(x^{(1)},x^{(2)},\cdots,x^{(n)},1)^{\mathrm{T}}\)&lt;/span&gt;，将 &lt;span class="math"&gt;\(w\cdot x\)&lt;/span&gt; 代入 Sigmoid 函数：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    P(Y=1|x)&amp;amp;=\frac{\exp(w\cdot x)}{1+\exp(w\cdot x)}\\
    P(Y=0|x)&amp;amp;=1-P(Y=1|x)=\frac{1}{1+\exp(w\cdot x)}
\end{align}$$&lt;/div&gt;
&lt;p&gt;这就是二项逻辑斯谛回归模型。从式中也能看到，若线性函数 &lt;span class="math"&gt;\(w\cdot x\)&lt;/span&gt;越大，&lt;span class="math"&gt;\(P(Y=1|x)\)&lt;/span&gt; 概率越大；若线性函数 &lt;span class="math"&gt;\(w\cdot x\)&lt;/span&gt;越小，&lt;span class="math"&gt;\(P(Y=0|x)\)&lt;/span&gt; 概率越大。最后就通过对比 &lt;span class="math"&gt;\(P(Y=1|x)\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(P(Y=0|x)\)&lt;/span&gt; 的大小来确定实例的类别。&lt;/p&gt;
&lt;h3 id="zui-da-shang-mo-xing"&gt;最大熵模型&lt;/h3&gt;
&lt;p&gt;最大熵原理认为，熵最大的模型是最好的模型。这是一个十分在「直觉」的原理，例如说，在等待公交车时，下一辆公交车只有两种情况&amp;mdash;&amp;mdash;「乘」或「不乘」，基于这种判断，通常会认为下一辆公交车有 50% 的概率可乘，50% 的概率不可乘。&lt;/p&gt;
&lt;p&gt;再例如，某事件有 &lt;span class="math"&gt;\(\{A,B,C,D,E\}\)&lt;/span&gt; 5 种情况，相应满足约束：&lt;/p&gt;
&lt;div class="math"&gt;$$P(A)+P(B)+P(C)+P(D)+P(E)=1$$&lt;/div&gt;
&lt;p&gt;在没有更多信息的情况下，根据最大熵原理，我们会认为&lt;/p&gt;
&lt;div class="math"&gt;$$P(A)=P(B)=P(C)=P(D)=P(E)=\frac{1}{5}$$&lt;/div&gt;
&lt;p&gt;如果额外获得了信息 &lt;span class="math"&gt;\(P(A)+P(B)=\frac{3}{10}\)&lt;/span&gt;，那么根据最大熵原理就会认为&lt;/p&gt;
&lt;div class="math"&gt;$$P(A)=P(B)=\frac{3}{20},\ P(C)=P(D)=P(E)=\frac{7}{30}$$&lt;/div&gt;
&lt;p&gt;可以看出，在缺少信息的情况下，最大熵原理将那些不确定的部分都视作等可能。等概率表示了对于事实的无知，但是没有更多信息，这种判断又是合理的。&lt;/p&gt;
&lt;p&gt;对于训练数据集，可以得到经验分布 &lt;span class="math"&gt;\(\tilde{P}(X=x,Y=y)\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(\tilde{P}(X=x)\)&lt;/span&gt;，这里的经验分布是用频数估计得到的。但是使用频数估计联合分布是不准确的，这种不准确在最大熵模型中会造成约束条件的不准确，而约束条件又是最大熵模型的关键。例如上例中，约束条件为 &lt;span class="math"&gt;\(P(A)+P(B)=\frac{3}{10}\)&lt;/span&gt;，若该约束条件不准确，后续的概率估计也是无意义的。&lt;/p&gt;
&lt;p&gt;因此在最大熵模型中需要引入特征函数，特征函数用于人为选取「合适」的实例：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{equation}
    f(x,y)=
    \begin{cases}
        1, &amp;amp;x\ 与\ y\ 满足某事实\\
        0, &amp;amp;否则
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;特征函数 &lt;span class="math"&gt;\(f(x,y)\)&lt;/span&gt; 关于经验分布 &lt;span class="math"&gt;\(\tilde{P}(X,Y)\)&lt;/span&gt; 的期望为&lt;/p&gt;
&lt;div class="math"&gt;$$E_{\tilde{P}}(f)=\sum_{x,y}\tilde{P}(x,y)f(x,y)$$&lt;/div&gt;
&lt;p&gt;特征函数 &lt;span class="math"&gt;\(f(x,y)\)&lt;/span&gt; 关于模型 &lt;span class="math"&gt;\(P(X|Y)\)&lt;/span&gt; 与经验分布 &lt;span class="math"&gt;\(\tilde{P}(X)\)&lt;/span&gt; 的期望为&lt;/p&gt;
&lt;div class="math"&gt;$$E_P(f)=\sum_{x,y}\tilde{P}(x)P(y|x)f(x,y)$$&lt;/div&gt;
&lt;p&gt;若模型准确，二者理应相等，即&lt;/p&gt;
&lt;div class="math"&gt;$$E_{\tilde{P}}(f)=E_P(f)$$&lt;/div&gt;
&lt;p&gt;{note begin}回忆条件概率基本公式 &lt;span class="math"&gt;\(P(x,y)=P(y|x)P(x)\)&lt;/span&gt;。{note end}&lt;/p&gt;
&lt;p&gt;满足所有约束条件的模型构成的集合为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathcal{C}\equiv \{P\in\mathcal{P}|E_P(f_i)=E_{\tilde{P}}(f_i)\}$$&lt;/div&gt;
&lt;p&gt;在条件概率分布 &lt;span class="math"&gt;\(P(Y|X)\)&lt;/span&gt; 上的条件熵为&lt;/p&gt;
&lt;div class="math"&gt;$$H(P)=-\sum_{x,y}\tilde{P}(x)P(y|x)\log P(y|x)$$&lt;/div&gt;
&lt;p&gt;在集合 &lt;span class="math"&gt;\(\mathcal{C}\)&lt;/span&gt; 中选出 &lt;span class="math"&gt;\(H(P)\)&lt;/span&gt; 最大的模型即为最大熵模型。&lt;/p&gt;
&lt;h2 id="ce-lue_1"&gt;策略&lt;/h2&gt;
&lt;h3 id="luo-ji-si-di-hui-gui-mo-xing_1"&gt;逻辑斯谛回归模型&lt;/h3&gt;
&lt;p&gt;设数据集中的概率为&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y=1|x)=\pi(x),\ P(Y=0|x)=1-\pi(x)$$&lt;/div&gt;
&lt;p&gt;构造对数似然函数：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    L(w)&amp;amp;=\log\prod_{i}[\pi(x_i)]^{y_i}[1-\pi(x_i)]^{1-y_i}\\
    &amp;amp;=\sum_i[y_i\log\pi(x_i)+(1-y_i)\log(1-\pi(x_i))]\\
    &amp;amp;=\sum_i[y_i(w\cdot x_i)-\log(1+\exp(w\cdot x_i)]
\end{align}$$&lt;/div&gt;
&lt;p&gt;那么求 &lt;span class="math"&gt;\(L(w)\)&lt;/span&gt; 的极大值，就能得到估计值 &lt;span class="math"&gt;\(\hat{w}\)&lt;/span&gt;，得到回归模型。也就是说，求解逻辑斯谛回归模型就是对于对数似然函数的最优化问题。&lt;/p&gt;
&lt;p&gt;{note begin}似然函数定义为 &lt;span class="math"&gt;\(L(p)=\prod_i p^{x_i}(1-p)^{1-x_i}\)&lt;/span&gt;，即抽样结果中各概率之积。由于每次抽样独立同分布的前提，可以认为似然函数为抽样结果（该事件）发生的概率。因为已经得到了该抽样结果，该事件发生的概率理应为 1，所以就要使似然函数最大化，这就是&lt;dot&gt;最大似然估计&lt;/dot&gt;的原理。{note end}&lt;/p&gt;
&lt;h3 id="yan-yi-la-ge-lang-ri-han-shu"&gt;广义拉格朗日函数&lt;/h3&gt;
&lt;p&gt;最大熵模型中使用了拉格朗日乘数法，因此有必要先介绍一下广义拉格朗日函数。回忆一下高等数学中的拉格朗日函数，若函数 &lt;span class="math"&gt;\(z=f(x,y)\)&lt;/span&gt; 有约束条件 &lt;span class="math"&gt;\(\varphi(x,y)=0\)&lt;/span&gt;，那么拉格朗日函数就为&lt;/p&gt;
&lt;div class="math"&gt;$$L(x,y)=f(x,y)+\lambda\varphi(x,y)$$&lt;/div&gt;
&lt;p&gt;欲寻找函数 &lt;span class="math"&gt;\(z=f(x,y)\)&lt;/span&gt; 的可能极值点，只需令拉格朗日函数的各一阶偏导数为零，联立求解。&lt;/p&gt;
&lt;p&gt;这里引入广义拉格朗日函数，若有约束最优化问题：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \min_x&amp;amp;\quad f(x)\\
    \mathrm{s.t.}&amp;amp;\quad c_i(x)\leqslant0,\ h_j(x)=0
\end{align}$$&lt;/div&gt;
&lt;p&gt;那么广义拉格朗日函数为&lt;/p&gt;
&lt;div class="math"&gt;$$L(x,\alpha,\beta)=f(x)+\color{teal}{\sum_i\alpha_ic_i(x)}+\color{steelblue}{\sum_j\beta_jh_j(x)}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(\alpha_i\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(\beta_j\)&lt;/span&gt; 为拉格朗日乘子，&lt;span class="math"&gt;\(\alpha_i\geqslant0\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;可以看出，只要 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 满足约束，&lt;span class="math"&gt;\(L(x,\alpha,\beta)\)&lt;/span&gt; 的第二项是递减的，第三项是不增的。那么就有&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{equation}
    \max_{\alpha,\beta:\alpha_i\geqslant0}L(x,\alpha,\beta)=
    \begin{cases}
        f(x), &amp;amp;x\ 满足约束\\
        +\infty, &amp;amp;否则
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;原来的约束最优化问题 &lt;span class="math"&gt;\(\min_xf(x)\)&lt;/span&gt; 在这里就可以改写为 &lt;/p&gt;
&lt;div class="math"&gt;$$\min_x\max_{\alpha,\beta:\alpha_i\geqslant0}L(x,\alpha,\beta)$$&lt;/div&gt;
&lt;p&gt;在满足 Karush-Kuhn-Tucker（KKT）条件下，原始问题的解与对偶问题的解相等，即&lt;/p&gt;
&lt;div class="math"&gt;$$\min_x\max_{\alpha,\beta:\alpha_i\geqslant0}L(x,\alpha,\beta)=\max_{\alpha,\beta:\alpha_i\geqslant0}\min_xL(x,\alpha,\beta)$$&lt;/div&gt;
&lt;h3 id="zui-da-shang-mo-xing_1"&gt;最大熵模型&lt;/h3&gt;
&lt;p&gt;最大熵模型的学习过程是有约束的最优化问题：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \max_{P\in\mathcal{C}}&amp;amp;\quad H(P)=-\sum_{x,y}\tilde{P}(x)P(y|x)\log P(y|x)\\
    \mathrm{s.t.}&amp;amp;\quad E_P(f_i)=E_{\tilde{P}}(f_i),\ \sum_yP(y|x)=1
\end{align}$$&lt;/div&gt;
&lt;p&gt;按照凸优化的习惯（求向下凸的函数的最小值），问题等价于&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \min_{P\in\mathcal{C}}&amp;amp;\quad -H(P)=\sum_{x,y}\tilde{P}(x)P(y|x)\log P(y|x)\\
    \mathrm{s.t.}&amp;amp;\quad E_P(f_i)=E_{\tilde{P}}(f_i),\ \sum_yP(y|x)=1
\end{align}$$&lt;/div&gt;
&lt;p&gt;构造拉格朗日函数 &lt;span class="math"&gt;\(L(P,w)\)&lt;/span&gt;：&lt;/p&gt;
&lt;div class="math"&gt;$$L(P,w)\equiv-H(P)+w_0\left[1-\sum_yP(y|x)\right]+\sum_iw_i[E_P(f_i)-E_{\tilde{P}}(f_i)]$$&lt;/div&gt;
&lt;p&gt;在这里，原始问题的解与对偶问题的解同样是等价的，即&lt;/p&gt;
&lt;div class="math"&gt;$$\underbrace{\min_{P\in\mathcal{C}}\max_wL(P,w)}_{原始形式}=\underbrace{\max_w\min_{P\in\mathcal{C}}L(P,w)}_{对偶形式}$$&lt;/div&gt;
&lt;p&gt;那么就可以通过求解对偶问题来求解原始问题，具体来说，就是先求解 &lt;span class="math"&gt;\(\min_{P\in\mathcal{C}}L(P,w)\)&lt;/span&gt;，固定 &lt;span class="math"&gt;\(w\)&lt;/span&gt;，令 &lt;span class="math"&gt;\(\frac{\partial L(P,w)}{\partial P(y|x)}=0\)&lt;/span&gt;，得到 &lt;span class="math"&gt;\(P(y|x)\)&lt;/span&gt; 的表达式后将其代入 &lt;span class="math"&gt;\(L(P,w)\)&lt;/span&gt; 得到 &lt;span class="math"&gt;\(\min_{P\in\mathcal{C}}L(P,w)\)&lt;/span&gt;。再令 &lt;span class="math"&gt;\(\frac{\partial \min_{P\in\mathcal{C}}L(P,w)}{\partial w}=0\)&lt;/span&gt;，最终得到 &lt;span class="math"&gt;\(P(y|x)\)&lt;/span&gt;。&lt;/p&gt;
&lt;h2 id="suan-fa_1"&gt;算法&lt;/h2&gt;
&lt;p&gt;逻辑斯谛回归模型和最大熵模型都是光滑的凸函数，适用于多种最优化方法，常用的方法包括迭代尺度算法、梯度下降法、牛顿法或拟牛顿法。&lt;/p&gt;
&lt;h3 id="gai-jin-de-die-dai-chi-du-fa"&gt;改进的迭代尺度法&lt;/h3&gt;
&lt;p&gt;令 &lt;span class="math"&gt;\(\frac{\partial L(P,w)}{\partial P(y|x)}=0\)&lt;/span&gt;，可以得到&lt;/p&gt;
&lt;div class="math"&gt;$$P(y|x)=\frac{\exp(\sum_iw_if_i(x,y))}{\exp(1-w_0)}$$&lt;/div&gt;
&lt;p&gt;其中的 &lt;span class="math"&gt;\(\exp(1-w_0)\)&lt;/span&gt; 部分是个定值，不影响概率的相对大小，因此略去该项并归一化，得到&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    P_w(y|x)&amp;amp;=\frac{1}{Z_w(x)}\exp\left(\sum_iw_if_i(x,y)\right)\\
    Z_w(x)&amp;amp;=\sum_y\exp\left(w_if_i(x,y)\right)
\end{align}$$&lt;/div&gt;
&lt;p&gt;对数似然函数为&lt;/p&gt;
&lt;div class="math"&gt;$$L(w)=\log\prod_{x,y}P(y|x)^{\tilde{P}(x,y)}=\sum_{x,y}\tilde{P}(x,y)\log P(y|x)$$&lt;/div&gt;
&lt;p&gt;将 &lt;span class="math"&gt;\(P_w(y|x)\)&lt;/span&gt; 代入得到&lt;/p&gt;
&lt;div class="math"&gt;$$L(w)=\sum_{x,y}\tilde{P}(x,y)\sum_iw_if_i(x,y)-\sum_x\tilde{P}(x)\log Z_w(x)$$&lt;/div&gt;
&lt;p&gt;迭代尺度法的思路就是寻找一个新参数向量 &lt;span class="math"&gt;\(w+\delta=(w_i+\delta_1,w_2+\delta_2,\cdots,w_n+\delta_n)^\mathrm{T}\)&lt;/span&gt;，使 &lt;span class="math"&gt;\(L(w)\)&lt;/span&gt; 增大，并不断迭代更新 &lt;span class="math"&gt;\(w\rightarrow w+\delta\)&lt;/span&gt;，最终使 &lt;span class="math"&gt;\(L(w)\)&lt;/span&gt; 最大。&lt;/p&gt;
&lt;p&gt;为了简化计算，在该算法中需要引入一个量 &lt;span class="math"&gt;\(f^\#(x,y)\)&lt;/span&gt;：&lt;/p&gt;
&lt;div class="math"&gt;$$f^\#(x,y)=\sum_if_i(x,y)$$&lt;/div&gt;
&lt;p&gt;&lt;span class="math"&gt;\(f^\#(x,y)\)&lt;/span&gt; 表示了所有特征出现的次数。&lt;/p&gt;
&lt;p&gt;&lt;span class="math"&gt;\(w\)&lt;/span&gt; 更新前后似然函数的变化值为（证明略）&lt;/p&gt;
&lt;div class="math"&gt;$$L(w+\delta)-L(w)\geqslant B(\delta|w)$$&lt;/div&gt;
&lt;div class="math"&gt;$$B(\delta|w)=\sum_{x,y}\tilde{P}(x,y)\sum_i\delta_if_i(x,y)+1-\sum_x\tilde{P}(x)\sum_yP_w(y|x)\sum_i\left(\frac{f_i(x,y)}{f^\#(x,y)}\right)\exp(\delta_i,f^\#(x,y))$$&lt;/div&gt;
&lt;p&gt;我们需要找到 &lt;span class="math"&gt;\(B(\delta|w)\)&lt;/span&gt; 的极值，让每次迭代后 &lt;span class="math"&gt;\(L(w)\)&lt;/span&gt; 尽可能大，因此求 &lt;span class="math"&gt;\(B(\delta|w)\)&lt;/span&gt; 对 &lt;span class="math"&gt;\(\delta_i\)&lt;/span&gt; 的偏导，并令其为零，得到&lt;/p&gt;
&lt;div class="math"&gt;$$\underbrace{\sum_{x,y}\tilde{P}(x)P_w(y|x)f_i(x,y)}_{E_P(f_i)}\exp(\delta_if^\#(x,y))=E_{\tilde{P}}(f_i)$$&lt;/div&gt;
&lt;p&gt;解该方程即可得到用于每次迭代的 &lt;span class="math"&gt;\(\delta\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;若 &lt;span class="math"&gt;\(f^\#(x,y)\)&lt;/span&gt; 为常数，那么&lt;/p&gt;
&lt;div class="math"&gt;$$\delta_i=\frac{1}{f^\#(x,y)}\log\frac{E_{\tilde{P}}(f_i)}{E_P(f_i)}$$&lt;/div&gt;
&lt;p&gt;若 &lt;span class="math"&gt;\(f^\#(x,y)\)&lt;/span&gt; 不是常数，通常使用数值计算的方法求解。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法 6.1（IIS 算法）&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：特征函数 &lt;span class="math"&gt;\(f_i\)&lt;/span&gt;；经验分布 &lt;span class="math"&gt;\(\tilde{P}(X,Y)\)&lt;/span&gt;；模型 &lt;span class="math"&gt;\(P_w(y|x)\)&lt;/span&gt;；&lt;br/&gt;
输出：最优参数 &lt;span class="math"&gt;\(w^*_i\)&lt;/span&gt;；最优模型 &lt;span class="math"&gt;\(P_{w^*}\)&lt;/span&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;对所有 &lt;span class="math"&gt;\(i\)&lt;/span&gt;，取初值 &lt;span class="math"&gt;\(w_i=0\)&lt;/span&gt;。&lt;/li&gt;
&lt;li&gt;对每一个 &lt;span class="math"&gt;\(i\)&lt;/span&gt;，&lt;ol&gt;
&lt;li&gt;解以下方程得到 &lt;span class="math"&gt;\(\delta_i\)&lt;/span&gt;：
    &lt;div class="math"&gt;$$\sum_{x,y}\tilde{P}(x)P_w(y|x)f_i(x,y)\exp(\delta_if^\#(x,y))=E_{\tilde{P}}(f_i)$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;更新 &lt;span class="math"&gt;\(w_i\)&lt;/span&gt;：&lt;span class="math"&gt;\(w_i\leftarrow w_i+\delta_i\)&lt;/span&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;若不是所有 &lt;span class="math"&gt;\(w_i\)&lt;/span&gt; 收敛，重复第 2 步。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="niu-dun-fa-yu-ni-niu-dun-fa"&gt;牛顿法与拟牛顿法&lt;/h3&gt;
&lt;h4&gt;牛顿法&lt;/h4&gt;
&lt;p&gt;对于最优化的目标目标函数 &lt;span class="math"&gt;\(f(x)\)&lt;/span&gt;，若满足二阶可微的前提，可以在 &lt;span class="math"&gt;\(x=x^{(k)}\)&lt;/span&gt; 处二阶泰勒展开：&lt;/p&gt;
&lt;div class="math"&gt;$$f(x)=f(x^{(x)})+\nabla f(x^{(k)})\Delta x^{(k)}+\frac{1}{2}(\Delta x^{(k)})^\mathrm{T}\nabla^2f(x^{(k)})\Delta x^{(k)}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(\Delta x^{(k)}=x-x^{(k)}\)&lt;/span&gt;。牛顿法的思路就是利用二阶泰勒展开近似，寻找合理的下降方向 &lt;span class="math"&gt;\(p_k\)&lt;/span&gt;，使 &lt;span class="math"&gt;\(f(x)\)&lt;/span&gt; 在数次迭代后到达极小值。显然当 &lt;span class="math"&gt;\(f(x)\)&lt;/span&gt; 达到极小值时梯度为 0。那么假设下一次（第 &lt;span class="math"&gt;\(k+1\)&lt;/span&gt; 次）迭代时 &lt;span class="math"&gt;\(f(x)\)&lt;/span&gt; 就能达到极小值，也就是令上式在 &lt;span class="math"&gt;\(x^{(k+1)}\)&lt;/span&gt; 处的梯度为零：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \nabla f(x)&amp;amp;=\nabla f(x^{(k)})+\nabla^2f(x^{(k)})\Delta x^{(k)}\\
    \nabla f(x^{(k+1)})&amp;amp;=\nabla f(x^{(k)})+\nabla^2f(x^{(k)})(x^{(k+1)}-x^{(k)})=0\\
    x^{(k+1)}&amp;amp;=x^{(k)}-\nabla^2f(x^{(k)})^{-1}\nabla f(x^{(k)})
\end{align}$$&lt;/div&gt;
&lt;p&gt;将其中的 &lt;span class="math"&gt;\(\nabla^2f(x^{(k)})^{-1}\)&lt;/span&gt; 记作 &lt;span class="math"&gt;\(H^{-1}_k\)&lt;/span&gt;，是黑塞矩阵的逆，将 &lt;span class="math"&gt;\(\nabla f(x^{(k)})\)&lt;/span&gt; 记作 &lt;span class="math"&gt;\(g_k\)&lt;/span&gt;。令 &lt;span class="math"&gt;\(p_k=-H^{-1}_kg_k\)&lt;/span&gt;，称为牛顿方向，那么每次迭代的过程就是&lt;/p&gt;
&lt;div class="math"&gt;$$x^{(k+1)}=x^{k}+p_k$$&lt;/div&gt;
&lt;p&gt;{note begin}这里的泰勒展开为矩阵形式，因此式中带有转置与逆等符号，若对求导过程有疑惑，可以参考&lt;a href="https://zhuanlan.zhihu.com/p/382683133"&gt;泰勒展开的矩阵形式&lt;/a&gt;。{note end}&lt;/p&gt;
&lt;h4&gt;拟牛顿法&lt;/h4&gt;
&lt;p&gt;考虑以上推导过程中得到的&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \nabla f(x^{(k+1)})&amp;amp;=\nabla f(x^{(k)})+\nabla^2f(x^{(k)})(x^{(k+1)}-x^{(k)})\\
    g_{k+1}-g_k&amp;amp;=H_k(x^{(k+1)}-x^{(k)})\\
\end{align}$$&lt;/div&gt;
&lt;p&gt;令 &lt;span class="math"&gt;\(y_k=g_{k+1}-g_k\)&lt;/span&gt;，&lt;span class="math"&gt;\(\delta_k=x^{(k+1)}-x^{(k)}\)&lt;/span&gt;，可以改写为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    y_k&amp;amp;=H_k\delta_k\\
    H^{-1}_ky_k&amp;amp;=\delta_k
\end{align}$$&lt;/div&gt;
&lt;p&gt;由于牛顿法每次迭代都需要计算黑森矩阵的逆 &lt;span class="math"&gt;\(H^{-1}_k\)&lt;/span&gt;，逆矩阵的计算过程比较繁琐，拟牛顿法的思路是寻找一个矩阵 &lt;span class="math"&gt;\(G_k\)&lt;/span&gt;，使其代替逆黑森矩阵：&lt;/p&gt;
&lt;div class="math"&gt;$$G_{k+1}y_k=\delta_k$$&lt;/div&gt;
&lt;p&gt;或是用 &lt;span class="math"&gt;\(B_k\)&lt;/span&gt; 逼近黑塞矩阵：&lt;/p&gt;
&lt;div class="math"&gt;$$B_{k+1}\delta_k=y_k$$&lt;/div&gt;
&lt;p&gt;那么每次迭代的步骤就是更新该矩阵：&lt;/p&gt;
&lt;div class="math"&gt;$$B_{k+1}=B_k+\Delta B_k$$&lt;/div&gt;
&lt;p&gt;拟牛顿矩阵更新方式不同，会有不同的计算公式和算法，这里以 BFGS 算法为例推导矩阵更新公式。&lt;/p&gt;
&lt;p&gt;假设 &lt;span class="math"&gt;\(B_{k+1}=B_k+P_k+Q_k\)&lt;/span&gt;，其中 &lt;span class="math"&gt;\(P_k\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(Q_k\)&lt;/span&gt; 为待定矩阵：&lt;/p&gt;
&lt;div class="math"&gt;$$B_{k+1}\delta_k=\color{teal}{y_k}=\color{steelblue}{B_k\delta_k}+\color{teal}{P_k\delta_k}+\color{steelblue}{Q_k\delta_k}$$&lt;/div&gt;
&lt;p&gt;&lt;span class="math"&gt;\(P_k\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(Q_k\)&lt;/span&gt; 在该式中可以有多种取法，这里用最简单的取法：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    &amp;amp;\color{teal}{P_k\delta_k=y_k}\\
    &amp;amp;\color{steelblue}{Q_k\delta_k=-B_k\delta_k}
\end{align}$$&lt;/div&gt;
&lt;p&gt;那么就可以得到迭代公式：&lt;/p&gt;
&lt;div class="math"&gt;$$B_{k+1}=B_k+\frac{y_ky^\mathrm{T}_k}{y^\mathrm{T}_k\delta_k}-\frac{B_k\delta_k\delta^\mathrm{T}_kB_k}{\delta^\mathrm{T}_kB_k\delta_k}$$&lt;/div&gt;
&lt;p&gt;{note begin}式中有许多 &lt;span class="math"&gt;\(y_ky^\mathrm{T}_k\)&lt;/span&gt; 类型结构，这是为了将向量转化为方阵，才有逆运算，否则向量不具有除法运算。{note end}&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法 6.2（最大熵模型的 BFGS 算法）&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：特征函数 &lt;span class="math"&gt;\(f_i\)&lt;/span&gt;；经验分布 &lt;span class="math"&gt;\(\tilde{P}(x,y)\)&lt;/span&gt;；目标函数 &lt;span class="math"&gt;\(f(w)=-L(w)\)&lt;/span&gt;，梯度 &lt;span class="math"&gt;\(g(w)=\nabla f(w)\)&lt;/span&gt;，精度 &lt;span class="math"&gt;\(\varepsilon\)&lt;/span&gt;；&lt;br/&gt;
输出：最优参数值 &lt;span class="math"&gt;\(w^*\)&lt;/span&gt;；最优模型 &lt;span class="math"&gt;\(P_{w^*}(y|x)\)&lt;/span&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;选定初始点 &lt;span class="math"&gt;\(w^{(0)}\)&lt;/span&gt;，取 &lt;span class="math"&gt;\(B_0\)&lt;/span&gt; 为正定对称矩阵，置 &lt;span class="math"&gt;\(k=0\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;计算 &lt;span class="math"&gt;\(g_k=g(w^{(k)})\)&lt;/span&gt;。若 &lt;span class="math"&gt;\(||g_k||&amp;lt;\varepsilon\)&lt;/span&gt;，则停止，&lt;span class="math"&gt;\(w^*=w^{(k)}\)&lt;/span&gt;，否则继续。&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(B_kp_k=-g_k\)&lt;/span&gt;，求 &lt;span class="math"&gt;\(p_k\)&lt;/span&gt;。&lt;/li&gt;
&lt;li&gt;求 &lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt; 使得 &lt;span class="math"&gt;\(f(w^{(k)}+\lambda_kp_k)=\min_{\lambda\geqslant0}f(w^{(k)}+\lambda p_k)\)&lt;/span&gt;。&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(w^{(k+1)}=w^{(k)}+\lambda_kp_k\)&lt;/span&gt;。&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(g_{k+1}=g(w^{(k+1)})\)&lt;/span&gt;，若 &lt;span class="math"&gt;\(||g_{k+1}||\varepsilon\)&lt;/span&gt;，则停止，&lt;span class="math"&gt;\(w^*=w^{(k)}\)&lt;/span&gt;，否则按 BFGS 迭代公式求 &lt;span class="math"&gt;\(B_{k+1}\)&lt;/span&gt;。&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(k=k+1\)&lt;/span&gt;，回到步骤 3。&lt;/li&gt;
&lt;/ol&gt;
&lt;hr/&gt;
&lt;h2 id="references_1"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/33437381/"&gt;李航, 2019. 统计学习方法（第2版）. 清华大学出版社.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/35258057/"&gt;刘浩洋, 户将, 李勇锋, 文再文, 2020. 最优化：建模、算法与理论. 高等教育出版社.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.zhihu.com/question/24094554"&gt;如何理解最大熵模型里面的特征？ - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/38163970"&gt;Karush-Kuhn-Tucker (KKT)条件 - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="统计学习方法"></category><category term="Machine learning"></category><category term="Algorithm"></category></entry><entry><title>国内部分网络无法访问 githui.io 的解决方案</title><link href="https://tseing.github.io/sui-sui-nian/2022-09-06-dns-forbidden-of-github-pages.html" rel="alternate"></link><published>2022-09-06T00:00:00+08:00</published><updated>2022-09-06T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-09-06:/sui-sui-nian/2022-09-06-dns-forbidden-of-github-pages.html</id><summary type="html">&lt;p&gt;和往常一样，在浏览器中键入我的 GitHub Pages 地址，Firefox 却提示「找不到服务器」。发现运营商自动提供的 DNS 服务不解析 github.io，需要通过更改 DNS 服务来解决。&lt;/p&gt;</summary><content type="html">&lt;p&gt;和往常一样，在浏览器中键入我的 GitHub Pages 地址，Firefox 却提示「找不到服务器」。我心头一紧，以为是 GitHub 的服务全部挂掉了，但发现 GitHub 可以正常访问。&lt;/p&gt;
&lt;p&gt;我还注意到，在键入 GitHub Pages 地址后，没有经过加载过程，立马给出了无法访问的信息，我怀疑这可能是带有 &lt;code&gt;github.io&lt;/code&gt; 后缀的域名都进了黑名单。后来我切换到手机流量访问 GitHub Pages 页面，网页解析一切正常，更是验证了这一猜测。&lt;/p&gt;
&lt;p&gt;正好最近在忙 ICP 备案的事，在工信部官网一查，&lt;code&gt;已经列入黑名单&lt;/code&gt; 赫然在目。&lt;/p&gt;
&lt;p&gt;&lt;img alt="黑名单" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7550?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;在网上看了一圈，原来 &lt;code&gt;github.io&lt;/code&gt; 早就进了黑名单，但还没有被屏蔽。各个网络运营商参考了这份黑名单，但采取了不同的措施，例如我以前使用联通宽带时，访问 GitHub Pages 时就一切正常，现在切换到移动的服务，却没法访问了。至于电信，暂时还不了解。&lt;/p&gt;
&lt;p&gt;既然不是被长城屏蔽，只是运营商提供的 DNS 不解析某些网址，那就好办了，只需更换 DNS 服务器即可。下面以阿里公共 DNS &lt;code&gt;223.5.5.5&lt;/code&gt; 与 &lt;code&gt;223.6.6.6&lt;/code&gt; 为例，更换设备的 DNS 服务器。&lt;/p&gt;
&lt;h2 id="windows-she-bei"&gt;Windows 设备&lt;/h2&gt;
&lt;p&gt;&lt;img alt="网络连接属性" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7551?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;打开网络连接的属性后，选择 IPv4 属性，输入相应的 DNS 地址后保存即可生效。&lt;/p&gt;
&lt;p&gt;&lt;img alt="IPv4属性" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7552?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;h2 id="ios-she-bei"&gt;IOS 设备&lt;/h2&gt;
&lt;p&gt;IOS 设备与 Windows 类似，选择 &lt;code&gt;设置&lt;/code&gt; - &lt;code&gt;Wi-Fi&lt;/code&gt;，选择已连接的网络，下划选择&lt;code&gt;配置 DNS&lt;/code&gt; - &lt;code&gt;手动&lt;/code&gt;，最后添加 DNS 地址。&lt;/p&gt;
&lt;h2 id="android-she-bei"&gt;Android 设备&lt;/h2&gt;
&lt;p&gt;Android 设备稍有不同，因为在 &lt;code&gt;Wi-Fi&lt;/code&gt; - &lt;code&gt;高级选项&lt;/code&gt; 中，若选择手动配置 DNS，就必须关闭 DHCP 服务，改用静态 IP 地址，这可能会与路由配置冲突。&lt;/p&gt;
&lt;p&gt;在新版本的 Android 中，在 &lt;code&gt;Wi-Fi&lt;/code&gt; 界面中提供了一个新的选项 &lt;code&gt;私人 DNS&lt;/code&gt;。选择 &lt;code&gt;私人 DNS&lt;/code&gt;，打开该功能后，输入阿里 DNS 的域名 &lt;code&gt;dns.alidns.com&lt;/code&gt; 后保存。注意在此处不能输入 DNS 地址。&lt;/p&gt;
&lt;h2 id="linux-she-bei"&gt;Linux 设备&lt;/h2&gt;
&lt;p&gt;我的 Linux 设备是安装了 KDE Plasma 桌面的 Debian 11，想必没有安装桌面的 Linux 也没有用浏览器访问网页的需求。在 KDE 下更改 DNS 就和 Windows 一样容易了，在网络选项中选择 &lt;code&gt;IPv4&lt;/code&gt;，将方法改为 &lt;code&gt;自动（仅网络地址）&lt;/code&gt;后再添加 DNS 服务器地址。保存设置后需要注销再重新登录才能生效。&lt;/p&gt;
&lt;h2 id="hou-ji"&gt;后记&lt;/h2&gt;
&lt;p&gt;无论如何，修改 DNS 也只是权宜之计，过不了多久，可能其他 DNS 供应方也不再解析「黑名单」中的地址，或是被长城挡在外面，那时恐怕就无计可施了。&lt;/p&gt;
&lt;p&gt;因此我也一直想着把网站搬到国内的服务器上，但是国内的服务器需要各种备案手续，让我比较难接受。考虑种种因素之后，决定还是让我的博客继续在外面漂流一阵子吧&amp;hellip;&amp;hellip;&lt;/p&gt;</content><category term="碎碎念"></category><category term="Blog"></category><category term="GithHub"></category><category term="DNS"></category></entry><entry><title>函数绘图工具的选择</title><link href="https://tseing.github.io/sui-sui-nian/2022-09-05-function-drawer.html" rel="alternate"></link><published>2022-09-05T00:00:00+08:00</published><updated>2022-09-05T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-09-05:/sui-sui-nian/2022-09-05-function-drawer.html</id><summary type="html">&lt;p&gt;不管是论文、博客文章还是 PPT，凡是有数学公式的地方，常常都需要伴有函数图象。绘制插图的工具多到难以计数，找到称心顺手的工具更是难上加难，以下就尝试过的工具给出我的评价，或许能提供一些参考。&lt;/p&gt;</summary><content type="html">&lt;p&gt;不管是论文、博客文章还是 PPT，凡是有数学公式的地方，常常都需要伴有函数图象。绘制插图的工具多到难以计数，找到称心顺手的工具更是难上加难，以下就尝试过的工具给出我的评价，或许能提供一些参考。&lt;/p&gt;
&lt;h2 id="powerpoint"&gt;PowerPoint&lt;/h2&gt;
&lt;p&gt;对，没有看错，正是 Office 家族的 PowerPoint，PowerPoint 的绘图工具十分强劲。&lt;/p&gt;
&lt;p&gt;一来是具有图形化界面，所见即所得的操作方式很适合完全没有绘图基础的用户，在一顿摸索之后总能画得出不错的图形。二是 PowerPoint 支持多种图片格式，不管是网络上常用的 JPEG，还是用于论文的 SVG，一键就能导出。此外，在 PowerPoint 原生环境中绘制的图形，插入到 PPT 中更是天衣无缝。再者，PowerPoint 是 Windows 系统中的预装软件，开箱即用，十分方便。&lt;/p&gt;
&lt;p&gt;在我看来，对于一些简单或是要求不高的图形，PowerPoint 就已经足够满足要求了。但是，若对排版有着较高要求，那么 PowerPoint 就难堪此任了。&lt;/p&gt;
&lt;p&gt;对于较为复杂的图形，在 PowerPoint 需要绘制大量图层，操作相当困难，建议还是交给专业的 Adobe Illustrator。再者，PowerPoint 很难直接放大整个图形。例如，一组包含文字与几何形状的图形，直接放大就会造成文字与几何形状间的错位，必须一个个调整。另一大缺点就是 Office 的公式编辑器相当难用，尽管新版的 Office 已经支持了 LaTex 表达式，但是字体等等问题真是一言难尽。令我放弃 PowerPoint 关键是 PowerPoint 不能按公式绘制函数，只能用曲线工具一点点去描图，这就不能满足我的需求了。&lt;/p&gt;
&lt;h2 id="tikz"&gt;TikZ&lt;/h2&gt;
&lt;p&gt;TikZ 是 LaTex 的绘图宏包，能够通过 LaTex 指令直接在 PDF 中绘制矢量图。TikZ 是在 LaTex 环境中用指令绘图的，因此 TikZ 绘制的图形特别能满足排版强迫症患者，同时绘图风格与 LaTex 文章一致，看起来十分舒服。&lt;/p&gt;
&lt;p&gt;我也尝试过使用 TikZ 绘图，我的感觉是操作较为繁琐。例如绘制平面坐标系，竟然需要绘制两根箭头线，再绘制线上的短线作为刻度。或许为了排版美观，这不算什么，「严谨」嘛。那么对会绘图工具来说，最致命的一点莫过于不能导出图片文件了吧，是的，TikZ 竟然只能导出 PDF。我还尝试了各种格式转换工具，总不能导出清晰的 JPEG，不适合放在网页上，遂放弃。&lt;/p&gt;
&lt;p&gt;TikZ 还有另一个小问题，也可能是我配置的问题，在我使用 TikZ 绘制函数时，若指定的定义域超过某个值，就会给出错误 &lt;code&gt;Dimension too large&lt;/code&gt;。网络上给出的原因是，TikZ 不支持计算过大的数值，这一点在使用上也让人备感掣肘。&lt;/p&gt;
&lt;h2 id="matplotlib"&gt;matplotlib&lt;/h2&gt;
&lt;p&gt;matplotlib 是我最早学习的专业绘图工具，过去几年，我也见证着它越来越完善。随着使用 matplotlib 越多，对于 matplotlib 的样式总会疲倦，于是我尝试了其他绘图工具，最终兜兜转转，又回到了 matplotlib 的怀抱，这大概就是「否定之否定」吧。&lt;/p&gt;
&lt;p&gt;matplotlib 是 Python 的绘图包，因为同时依赖于强力的 numpy 包，复杂的运算对它而言是轻而易举，这对于各种数据的处理非常方便。matplotlib 通过代码绘制图像，各种样式自然也可以自定义。matplotlib 的各种优点在此也不再赘述，回到本文的主题，那么如何绘制出教科书式的函数示意图呢？&lt;/p&gt;
&lt;p&gt;用以下代码绘制默认样式的函数图像：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;import numpy as np
import matplotlib.pyplot as plt

fig = plt.figure(figsize=(4,3))     # 新建画布
ax = fig.add_subplot(111)           # 新建坐标系
fig.add_axes(ax)                    # 将坐标系添加到画布

x = np.arange(-6, 6, 0.1)
y = lambda x: 1/(1+np.e**(-x))

ax.plot(x, y(x))

plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img alt="默认" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7548?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;matplotlib 的默认样式虽然也很美观，但是与我们想要的教科书样式差别很大，教科书样式的主要特点就是坐标轴位于原点、黑白配色，我的解决方案是使用以下代码的样式：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;import numpy as np
import matplotlib.pyplot as plt
import mpl_toolkits.axisartist as axisartist

fig = plt.figure(figsize=(10,4))
ax1 = axisartist.Subplot(fig, 121)      # 左侧子图
ax2 = axisartist.Subplot(fig, 122)      # 右侧子图
fig.add_axes(ax1)
fig.add_axes(ax2)

axes_list = [ax1, ax2]

for ax in axes_list:
    # 隐藏边框
    ax.axis[:].set_visible(False)
    # 在原点绘制 x, y 轴
    ax.axis["x"] = ax.new_floating_axis(0,0)
    ax.axis["y"] = ax.new_floating_axis(1,0)
    # 设置 x, y 轴的样式
    ax.axis["x"].set_axisline_style("-|&amp;gt;", size=1.5)
    ax.axis["y"].set_axisline_style("-|&amp;gt;", size=1.5)
    # 设置 x, y 轴的箭头设为黑色
    ax.axis["x"].line.set_facecolor("black")
    ax.axis["y"].line.set_facecolor("black")
    # 隐藏坐标轴刻度
    ax.set_xticks([])
    ax.set_yticks([])

x = np.arange(-6, 6, 0.1)
y = lambda x: 1/(1+np.e**(-x))
ax1.plot(x, y(x), lw=2, c="black")

x = np.arange(-6, 6, 0.1)
y = lambda x: np.e**(-x)/(1+np.e**(-x))**2
ax2.plot(x, y(x), lw=2, c="black")

plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img alt="教科书式" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7549?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;唯一的不足之处是坐标轴的箭头稍有些肥大，略显怪异，我没有找到改变这个箭头样式的方法，于是只好直接修改默认样式。在 &lt;code&gt;matplotlib.patches&lt;/code&gt; 中找到以下代码片段：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;@_register_style(_style_list, name="-|&amp;gt;")
    class CurveFilledB(_Curve):
        """An arrow with filled triangle head at the end."""
        arrow = "-|&amp;gt;"
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在后面添加代码修改箭头样式，修改后的代码片段是：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;@_register_style(_style_list, name="-|&amp;gt;")
    class CurveFilledB(_Curve):
        """An arrow with filled triangle head at the end."""
        arrow = "-|&amp;gt;"
        # 修改默认箭头样式
        def __init__(self, head_length=.75, head_width=.125):
            super().__init__(head_length=head_length, head_width=head_width)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{warn begin}对于 &lt;code&gt;matplotlib.patches&lt;/code&gt; 的修改，在matplotlib 更新后会失效，需要重新修改。{warn end}&lt;/p&gt;
&lt;p&gt;最后使用以下代码绘制图像：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;import numpy as np
import matplotlib.pyplot as plt
import mpl_toolkits.axisartist as axisartist

def scale_axes(ax, x, y, xscale=0.2, yscale=0.2):
    dx = np.max(x) - np.min(x)
    ax.set_xlim([np.min(x)-xscale*dx, np.max(x)+xscale*dx])
    dy = np.max(y) - np.min(y)
    ax.set_ylim([np.min(y)-yscale*dy, np.max(y)+yscale*dy])

fig = plt.figure(figsize=(10,4))
ax1 = axisartist.Subplot(fig, 121)
ax2 = axisartist.Subplot(fig, 122)
fig.add_axes(ax1)
fig.add_axes(ax2)

axes_list = [ax1, ax2]

for ax in axes_list:
    ax.axis[:].set_visible(False)
    ax.axis["x"] = ax.new_floating_axis(0,0)
    ax.axis["y"] = ax.new_floating_axis(1,0)
    ax.axis["x"].set_axisline_style("-|&amp;gt;", size=1.5)
    ax.axis["y"].set_axisline_style("-|&amp;gt;", size=1.5)
    ax.axis["x"].line.set_facecolor("black")
    ax.axis["y"].line.set_facecolor("black")

    ax.set_xticks([])
    ax.set_yticks([])

x = np.arange(-6, 6, 0.1)
y = lambda x: 1/(1+np.e**(-x))
ax1.plot(x, y(x), lw=2, c="black")
scale_axes(ax1, x, y(x))

x = np.arange(-6, 6, 0.1)
y = lambda x: np.e**(-x)/(1+np.e**(-x))**2
ax2.plot(x, y(x), lw=2, c="black")
scale_axes(ax2, x, y(x))

plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中我新增了 &lt;code&gt;scale_axes()&lt;/code&gt; 用于控制函数图像按比例自动缩放，能够让左右图的坐标轴对齐，风格更统一，这样的图像就非常美观了。&lt;/p&gt;
&lt;p&gt;&lt;img alt="修改箭头" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7554?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;{warn begin}本文最后更新于 2022 年 09 月 07 日，请确定内容是否过时。{warn end}&lt;/p&gt;</content><category term="碎碎念"></category><category term="matplotlib"></category><category term="Python"></category></entry><entry><title>詞藪</title><link href="https://tseing.github.io/gu-zhi-dui/2022-08-31-hokciu-word-collect.html" rel="alternate"></link><published>2022-08-31T00:00:00+08:00</published><updated>2022-08-31T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-08-31:/gu-zhi-dui/2022-08-31-hokciu-word-collect.html</id><summary type="html">&lt;p&gt;輯錄閩東語散佚在民間的字詞。&lt;/p&gt;</summary><content type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;p class="cite"&gt;洎夫醇醨旣異，步驟不同，一物多名，繫方俗之語；片言殊訓，滯今古之情，將使後生若爲之鑽仰？&lt;/p&gt;
&amp;mdash;&amp;mdash;《爾雅疏敘》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;近年来出版了诸多闽东语词典，这是十分令人欣喜的事，所起到正字音、辨名实的作用不可胜量。但语言的灵魂终不在于纸面，而在于传诵人之口。倘一语尚存母语者，则仍能旧字递陈、新声迭出，有描类状物之用。若使无人传诵，则旧字漫漶、新声瘖然，终为死语矣。&lt;/p&gt;
&lt;p&gt;因此我将尚存于母语者之口而词典失收者，不论旧字新声，备列如下，毋使后来人寻之无路。若能确定正字，则以正字书之，若正字难辨，则谨录其音，以俟高明。其于所不知，盖阙如也。&lt;/p&gt;
&lt;h2 id="ming-wu-di-yi"&gt;名物第一&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;南京豆&lt;/strong&gt; /nang21 nging53 dau213/：豌豆。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;福馬林&lt;/strong&gt; /huk5 ma55 ling53/：福爾馬林（Formalin）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;凝凍&lt;/strong&gt; /ngik5 doeyng213/：一指凝固的过程。又指類似龜苓膏的凍類食品。例：「買仂囝凝凍食」。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="shi-shi-di-er"&gt;世事第二&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;生精&lt;/strong&gt; /ciang55 zing55/：喜愛喫生食的人（謔）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;糠餡&lt;/strong&gt; /koung55 ngang242/：餅或麵點長時間放置後，餡料的口感變差。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;搿喙&lt;/strong&gt; /ba53 cui213/：打呵欠。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;筋潤&lt;/strong&gt; /gyng55 noung213/：稍帶有韌性又軟糯的口感。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;凋尾&lt;/strong&gt; /d(i)eu55 mui33/：咽下食物后殘留的苦味。例：「者茶有仂囝凋尾。」&lt;/li&gt;
&lt;li&gt;/huak5/（滑？/乏？）：骨疽潰爛的樣子。例：「伊大腿上肉都huak5去。」&lt;/li&gt;
&lt;li&gt;/ie53/（栘？）相/suong213/：容貌好看，上相。&lt;/li&gt;
&lt;li&gt;/l(i)au53 gooyk24/（漏斞？）：小氣吝嗇。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="cheng-yu-di-san"&gt;成語第三&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;屎驚五色&lt;/strong&gt; /sai33 giang55 ngu33 laik24/：害怕得屁滾尿流。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;碗碟匙箸&lt;/strong&gt; /uang33 diek5 sie53 doey242/：鍋碗瓢盆。例：「蜀桌排滿碗碟匙箸。」&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;風時交北&lt;/strong&gt; /hung55 si53 gau55 booyk24/：狂風大作。例：「做風颱其辰候，風時交北。」&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;大男小女&lt;/strong&gt; /duai55 nang53 siu24 ny33/：男女老幼。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;斜踑倒砑&lt;/strong&gt; /sia55 gi55 do55 nga242/：形容坐姿歪斜、不端正。例：「學生著有學生樣，伓通坐會斜踑倒砑。」&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="li-yan-di-si"&gt;俚諺第四&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;熟熟食肥肉&lt;/strong&gt; /syk5 syk5 siek55 bui21 nyk5/：熟人宰客。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;有顧喙無顧身&amp;mdash;&amp;mdash;㑚記食&lt;/strong&gt; /u53 gu21 cui213 mo33 gu21 sing55 na53 gei213 siek5/：貪喫而邋遢。&lt;/li&gt;
&lt;/ul&gt;</content><category term="故纸堆"></category><category term="平话"></category></entry><entry><title>《统计学习方法》第五章：决策树</title><link href="https://tseing.github.io/sui-sui-nian/2022-08-23-statistical-learning-chapter5.html" rel="alternate"></link><published>2022-08-23T00:00:00+08:00</published><updated>2022-08-23T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-08-23:/sui-sui-nian/2022-08-23-statistical-learning-chapter5.html</id><summary type="html">&lt;p&gt;《统计学习方法》第五章主要介绍一种具有树形结构的分类与回归模型——决策树，使用不同的特征分类能力的衡量标准，存在不同的决策树生成算法。&lt;/p&gt;</summary><content type="html">&lt;h2 id="mo-xing"&gt;模型&lt;/h2&gt;
&lt;h3 id="jue-ce-shu"&gt;决策树&lt;/h3&gt;
&lt;p&gt;决策树是一种&lt;dot&gt;分类&lt;/dot&gt;与&lt;dot&gt;回归&lt;/dot&gt;的方法，它是由结点和有向边组成的树形结构。决策树的内部结点表示一个特征或属性，叶结点表示一个类。&lt;/p&gt;
&lt;p&gt;&lt;img alt="决策树模型" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7527?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;决策树学习的目标就是根据给定的训练集生成一个决策树模型，利用该模型对实例正确分类。也就是说决策树的生成在本质上是从训练集中归纳出一组分类规则，决策树中结点之间的路径正是对应了这种分类规则。&lt;/p&gt;
&lt;h3 id="fen-lei-yu-hui-gui-shu"&gt;分类与回归树&lt;/h3&gt;
&lt;p&gt;分类与回归树（CART）模型是一种应用广泛的&lt;dot&gt;决策树&lt;/dot&gt;模型，CART 假定决策树为&lt;dot&gt;二叉树&lt;/dot&gt;，左分支为&amp;ldquo;是&amp;rdquo;路径，右分支为&amp;ldquo;否&amp;rdquo;路径。CART 模型将每个特征不断二分，划分为有限个单元，最后就能在这些单元上进行预测。&lt;/p&gt;
&lt;h2 id="ce-lue_1"&gt;策略&lt;/h2&gt;
&lt;p&gt;决策树可以看作为一系列 if-then 规则的集合，那么如何选择规则的判断条件就十分重要了。选择判断条件就是在选择训练数据的特征，可以想象，如果利用一个特征作为分类条件得到的结果与&lt;dot&gt;随机分类&lt;/dot&gt;的结果没有很大差别，那么这个特征是没有分类能力的。为了生成精确的决策树模型，我们需要设立用于衡量所选特征分类能力的准则。&lt;/p&gt;
&lt;p&gt;常用选择特征的准则包括信息增益、信息增益比、平方误差和基尼指数。&lt;/p&gt;
&lt;h3 id="xin-xi-zeng-yi"&gt;信息增益&lt;/h3&gt;
&lt;p&gt;设一个离散随机分布为&lt;/p&gt;
&lt;div class="math"&gt;$$P(X=x_i)=p_i,\qquad i=1,2,\cdots,n$$&lt;/div&gt;
&lt;p&gt;那么随机变量 &lt;span class="math"&gt;\(X\)&lt;/span&gt; 的熵就定义为&lt;/p&gt;
&lt;div class="math"&gt;$$H(p)=-\sum_{i=1}^np_i\log p_i$$&lt;/div&gt;
&lt;p&gt;若 &lt;span class="math"&gt;\(p_i=0\)&lt;/span&gt;，规定 &lt;span class="math"&gt;\(0\log 0=0\)&lt;/span&gt;，其中的对数也可取 2 为底或取自然对数。熵是衡量随机变量不确定（混乱）程度的度量，熵值越大，则随机变量越不确定，也就是说各事件发生的概率值越接近，概率分布也更分散。&lt;/p&gt;
&lt;p&gt;&lt;img alt="熵与概率的关系" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7526?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;条件熵用于表示在某条件下随机变量的不确定性，条件熵具有条件期望的形式，定义为&lt;/p&gt;
&lt;div class="math"&gt;$$H(X|Y)=\sum_{i=1}^np_iH(Y|X=x_i)$$&lt;/div&gt;
&lt;p&gt;在实际操作中会使用频率估计概率，这时候熵就称为经验熵，条件熵称为经验条件熵。&lt;/p&gt;
&lt;p&gt;特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 对训练集 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 的信息增益就定义为训练集的经验熵与给定特征下的经验条件熵之差：&lt;/p&gt;
&lt;div class="math"&gt;$$g(D,A)=H(D)-H(D|A)$$&lt;/div&gt;
&lt;p&gt;可以直观地理解为，若特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 具有分类能力，在选定的特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 下，数据集表现出更大的确定性或有序性，熵值相应减小，那么熵值变化的大小就可以用来衡量数据集在应用该特征后确定性的增加程度，也就是该特征分类能力的强弱。因此，信息增益大的特征具有更强的分类能力。&lt;/p&gt;
&lt;p&gt;对于训练集 &lt;span class="math"&gt;\(D\)&lt;/span&gt;，用 &lt;span class="math"&gt;\(|D|\)&lt;/span&gt; 表示集合中元素个数，即样本个数。设有 &lt;span class="math"&gt;\(K\)&lt;/span&gt; 个类 &lt;span class="math"&gt;\(C_k\)&lt;/span&gt;，类 &lt;span class="math"&gt;\(C_k\)&lt;/span&gt; 中有 &lt;span class="math"&gt;\(|C_k|\)&lt;/span&gt; 个样本。依据特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 可将 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 划分为 &lt;span class="math"&gt;\(n\)&lt;/span&gt; 个子集 &lt;span class="math"&gt;\(D_i\)&lt;/span&gt;，&lt;span class="math"&gt;\(D_i\)&lt;/span&gt; 中属于类 &lt;span class="math"&gt;\(C_k\)&lt;/span&gt; 的样本的集合记作 &lt;span class="math"&gt;\(D_{ik}\)&lt;/span&gt;。那么就按以下方法计算信息增益。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法 5.1&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：训练集 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 和特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt;&lt;br/&gt;
输出：特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 对训练集 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 的信息增益&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;计算数据集 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 的经验熵
    &lt;div class="math"&gt;$$H(D)=-\sum_{k=1}^Kp_k\log_2p_k=-\sum_{k=1}^K\frac{|C_k|}{|D|}\log_2\frac{|C_k|}{|D|}$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;计算特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 对数据集的经验条件熵
    &lt;div class="math"&gt;$$H(D|A)=\sum_{i=1}^n\frac{|D_i|}{|D|}H(D_i)=-\sum_{i=1}^n\frac{|D_i|}{|D|}\sum_{k=1}^K\frac{|D_{ik}|}{|D_i|}\log_2\frac{|D_{ik}|}{|D_i|}$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;计算信息增益
    &lt;div class="math"&gt;$$g(D,A)=H(D)-H(D|A)$$&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="xin-xi-zeng-yi-bi"&gt;信息增益比&lt;/h3&gt;
&lt;p&gt;若参考信息增益比的大小选择特征，选择结果会偏向取值较多的特征。可以这么理解，特征取值越多，即划分条件越多，例如按年龄将人群分为青年、中年、老年（特征取值为 3）相较于按出生地将人群划分为是否当地居民（特征取值为 2），得到的划分结果会更「有序」。但这并不意味着年龄这一特征具有更好的分类能力，分类结果可能与被调查人的出生地有着更为密切的关系。&lt;/p&gt;
&lt;p&gt;当特征取值过多时，这个特征就像是精心制作的筛子，过筛后的结果总是「显得」更加有序，因此需要使用信息增益比校正这一问题。信息增益比定义为&lt;/p&gt;
&lt;div class="math"&gt;$$g_R(D,A)=\frac{g(D,A)}{H_A(D)}$$&lt;/div&gt;
&lt;div class="math"&gt;$$H_A(D)=-\sum_{i=1}^n\frac{|D_i|}{|D|}\log_2\frac{|D_i|}{|D|}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(n\)&lt;/span&gt; 为特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 的取值个数。&lt;/p&gt;
&lt;h3 id="ping-fang-wu-chai"&gt;平方误差&lt;/h3&gt;
&lt;p&gt;平方误差 &lt;span class="math"&gt;\(\sum(y_i-f(x_i))^2\)&lt;/span&gt; 是十分常用的误差函数，平方误差常用于回归树的构建。&lt;/p&gt;
&lt;p&gt;回归树将输入空间分割为若干单元，并在每个单元 &lt;span class="math"&gt;\(R_m\)&lt;/span&gt; 上有一个固定的输出 &lt;span class="math"&gt;\(c_m\)&lt;/span&gt;，可以表示为&lt;/p&gt;
&lt;div class="math"&gt;$$f(x)=\sum c_mI(x\in R_m)$$&lt;/div&gt;
&lt;p&gt;在每个单元上的最优输出 &lt;span class="math"&gt;\(\hat{c}_m\)&lt;/span&gt; 自然是该单元中所有实例对应的输出 &lt;span class="math"&gt;\(y_i\)&lt;/span&gt; 的均值：&lt;/p&gt;
&lt;div class="math"&gt;$$\hat{c}_m=\mathrm{ave}(y_i|x_i\in R_m)$$&lt;/div&gt;
&lt;p&gt;目的是找到最优的切分特征 &lt;span class="math"&gt;\(j\)&lt;/span&gt; 与最优切分点 &lt;span class="math"&gt;\(s\)&lt;/span&gt;，那么对于切分后得到的某一块区域 &lt;span class="math"&gt;\(R_m\)&lt;/span&gt; 内，&lt;span class="math"&gt;\(c_m\)&lt;/span&gt; 偏离于实例 &lt;span class="math"&gt;\(y_i\)&lt;/span&gt; 的值都应该尽可能小：&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{c_m}\sum_{x_i\in R_m}(y_i-c_m)^2$$&lt;/div&gt;
&lt;p&gt;实际上，这就是利用最小二乘法确定单元中的 &lt;span class="math"&gt;\(\hat{c}_m\)&lt;/span&gt; 并使其平方误差最小，这样回归树又称为最小二乘回归树。&lt;/p&gt;
&lt;p&gt;&lt;img alt="最小二乘回归树" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7547?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;因为回归树是二叉的，每次划分得到两个区域，对于整体而言。最优的划分条件 &lt;span class="math"&gt;\(j\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(s\)&lt;/span&gt; 应使得到两个区域 &lt;span class="math"&gt;\(c_m\)&lt;/span&gt; 的平方误差之和尽可能小，完整求解问题表述为&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{j,s}\left[\min_{c_1}\sum_{x_i\in R_1(j,s)}(y_i-c_1)^2+\min_{c_1}\sum_{x_i\in R_2(j,s)}(y_i-c_2)^2\right]$$&lt;/div&gt;
&lt;h3 id="ji-ni-zhi-shu"&gt;基尼指数&lt;/h3&gt;
&lt;p&gt;基尼指数也是特征分类能力的度量，常用于分类树。样本点属于第 &lt;span class="math"&gt;\(k\)&lt;/span&gt; 类的概率为 &lt;span class="math"&gt;\(p_k\)&lt;/span&gt;，基尼指数定义为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{Gini}(p)=\sum_{k=1}^Kp_k(1-p_k)=1-\sum_{k=1}^Kp_k^2$$&lt;/div&gt;
&lt;p&gt;从基尼指数的定义可以看出，若样本点越分散，基尼指数越大。从下图可以看出，基尼指数与分类误差率、熵有着相似的变化关系，因此基尼指数同样可以用于衡量特征的分类能力。&lt;/p&gt;
&lt;p&gt;&lt;img alt="基尼指数" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7546?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 将样本 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 划分为两个部分，那么在特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 条件下的基尼指数就表示为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathrm{Gini}(D,A)=\frac{|D_1|}{|D|}\mathrm{Gini}(D_1)+\frac{|D_2|}{|D|}\mathrm{Gini}(D_2)$$&lt;/div&gt;
&lt;h2 id="suan-fa_1"&gt;算法&lt;/h2&gt;
&lt;h3 id="jue-ce-shu-de-sheng-cheng"&gt;决策树的生成&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;算法 5.2（ID3 算法）&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：训练集 &lt;span class="math"&gt;\(D\)&lt;/span&gt;，特征集 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 与阈值 &lt;span class="math"&gt;\(\varepsilon\)&lt;/span&gt;&lt;br/&gt;
输出：决策树 &lt;span class="math"&gt;\(T\)&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;若 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 中所有实例属于同一类（分类完成），将该类作为结节的类标记，返回 &lt;span class="math"&gt;\(T\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;若 &lt;span class="math"&gt;\(A=\varnothing\)&lt;/span&gt;（无特征可分），将 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 中实例数量最多的类作为该结点类标记，返回 &lt;span class="math"&gt;\(T\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;否则，计算各特征的信息增益，选择信息增益最大的特征 &lt;span class="math"&gt;\(A_g\)&lt;/span&gt;;&lt;/li&gt;
&lt;li&gt;若 &lt;span class="math"&gt;\(g(D,A_g)&amp;lt;\varepsilon\)&lt;/span&gt;（信息增益小于阈值），将 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 中实例数量最多的类作为该结点类标记，返回 &lt;span class="math"&gt;\(T\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;否则，使用 &lt;span class="math"&gt;\(A_g\)&lt;/span&gt; 的可能值 &lt;span class="math"&gt;\(a_i\)&lt;/span&gt; 将训练集分割为若干 &lt;span class="math"&gt;\(D_i\)&lt;/span&gt;，将 &lt;span class="math"&gt;\(D_i\)&lt;/span&gt; 中实例数量最多的类作为类标记构建子结点，返回 &lt;span class="math"&gt;\(T\)&lt;/span&gt;;&lt;/li&gt;
&lt;li&gt;对于第 &lt;span class="math"&gt;\(i\)&lt;/span&gt; 个结点，以 &lt;span class="math"&gt;\(D_i\)&lt;/span&gt; 为训练集，以 &lt;span class="math"&gt;\(A-\{A_g\}\)&lt;/span&gt; 为特征集，递归 1~5 步，返回子树 &lt;span class="math"&gt;\(T_i\)&lt;/span&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;算法 5.4（C4.5 算法）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用&lt;dot&gt;信息增益比&lt;/dot&gt;代替 ID3 算法中的信息增益，就是 C4.5 算法。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法 5.4（最小二乘回归树生成算法）&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：训练数据集 &lt;span class="math"&gt;\(D\)&lt;/span&gt;&lt;br/&gt;
输出： 回归树 &lt;span class="math"&gt;\(f(x)\)&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;选择最优切分变量 &lt;span class="math"&gt;\(j\)&lt;/span&gt; 与切分点 &lt;span class="math"&gt;\(s\)&lt;/span&gt;，遍历 &lt;span class="math"&gt;\(j\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(s\)&lt;/span&gt;，得到使下式最小的对 &lt;span class="math"&gt;\((j,s)\)&lt;/span&gt;
&lt;div class="math"&gt;$$\min_{j,s}\left[\min_{c_1}\sum_{x_i\in R_1(j,s)}(y_i-c_1)^2+\min_{c_1}\sum_{x_i\in R_2(j,s)}(y_i-c_2)^2\right]$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;用对 &lt;span class="math"&gt;\((j,s)\)&lt;/span&gt; 划分区域并确定 &lt;span class="math"&gt;\(\hat{c}_m\)&lt;/span&gt;
&lt;div class="math"&gt;$$\begin{gather}
        R_1(j,s)=\{x|x^{(j)}\leq s\},\quad R_2(j,s)=\{x|x^{(j)}&amp;gt;s\}\\
        \hat{c}_m=\frac{1}{N_m}\sum_{x_i\in R_m(j,s)}y_i,\quad x\in R_m,\ m=1,2
    \end{gather}$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;对子区域继续调用步骤（1）~（2），直至停止；&lt;/li&gt;
&lt;li&gt;使用划分的区域生成决策树。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;算法 5.6（CART 生成算法）&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：训练数据集 &lt;span class="math"&gt;\(D\)&lt;/span&gt;&lt;br/&gt;
输出：CART 决策树&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;计算所有特征对于数据集 &lt;span class="math"&gt;\(D\)&lt;/span&gt; 的基尼指数，对于所有可能特征 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 的所有可能取值 &lt;span class="math"&gt;\(a\)&lt;/span&gt;，使用是否满足 &lt;span class="math"&gt;\(A=a\)&lt;/span&gt; 作为判断条件将数据集划分为两个部分；&lt;/li&gt;
&lt;li&gt;选择基尼指数最小的特征与切分点，生成两个子结点；&lt;/li&gt;
&lt;li&gt;对于子结点继续调用 1~2 步，直至停止；&lt;/li&gt;
&lt;li&gt;生成 CART 决策树。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;{note begin}算法停止的条件可以参考算法 5.2，可以是样本点数据小于阈值，也可以特征的分类能力小于阈值，也可以是特征数量太少。{note end}&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references_1"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/33437381/"&gt;李航, 2019. 统计学习方法（第2版）. 清华大学出版社.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="统计学习方法"></category><category term="Machine learning"></category><category term="Algorithm"></category></entry><entry><title>为 Pelican 博客设置 Lightbox 效果</title><link href="https://tseing.github.io/sui-sui-nian/2022-08-17-pelican-lightbox.html" rel="alternate"></link><published>2022-08-17T00:00:00+08:00</published><updated>2022-08-17T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-08-17:/sui-sui-nian/2022-08-17-pelican-lightbox.html</id><summary type="html">&lt;p&gt;如何像社交媒体上发布的图片一样，让博客文章中的图片也能点击放大呢？使用 JavaScript 插件，在博客文章中添加这种 Lightbox 效果，再加上配套的 Python-Markdown 的拓展插件，让 Markdown 写作中的图片效果设置变得更加自由。&lt;/p&gt;</summary><content type="html">&lt;p&gt;Markdown 语法简洁而高效，使用 Markdown 撰写博客文章是十分通行的做法。若要在文章中插入图片，需要使用 &lt;code&gt;![标题](URL)&lt;/code&gt; 语法，Pelican 博客引擎将文章中的 &lt;code&gt;[标题](URL)&lt;/code&gt; 转换为 html 标签 &lt;code&gt;&amp;lt;img alt="标题" src="URL"&amp;gt;&lt;/code&gt;，就生成了用于发布的静态网页。&lt;/p&gt;
&lt;p&gt;这样生成的网页中，图片大小由 CSS 文件决定。设定的图片尺寸如果太小，难以看清图片细节，尺寸如果太大就会占据较大版面，也十分影响阅读。&lt;/p&gt;
&lt;p&gt;各类社交网站上的常规做法是，使用 CSS 文件决定合适的缩略图尺寸，点击缩略图后放大图片。点击缩略图放大的效果就像在暗室中使用的放映机，这个效果就被称为 Lightbox。&lt;/p&gt;
&lt;p&gt;Lightbox 功能非常常用，因此在网上有大量现成的插件，具有 Lightbox 功能的 Pelican 插件包括 &lt;a href="https://github.com/pelican-plugins/photos"&gt;photos&lt;/a&gt; 和 &lt;a href="https://github.com/getpelican/pelican-plugins/tree/master/gallery"&gt;Gallery&lt;/a&gt; 等。但是它们并不是纯粹的 Lightbox 插件，还具有图片处理、读取 EXIF 信息等功能，我觉得太「重」。&lt;/p&gt;
&lt;h2 id="qing-liang-de-lightgallery-markdown"&gt;轻量的 lightgallery-markdown&lt;/h2&gt;
&lt;p&gt;兜兜转转之下，我找到了一个实现 Lightbox 功能的 &lt;a href="https://github.com/g-provost/lightgallery-markdown"&gt;Python-Markdown 拓展&lt;/a&gt;。其实原理也很简单，这个拓展能将 &lt;code&gt;![!标题](URL)&lt;/code&gt; 转换为以下代码：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-html"&gt;&amp;lt;div class="lightgallery"&amp;gt;
    &amp;lt;a href="URL" data-sub-html="标题"&amp;gt;
      &amp;lt;img alt="标题" src="URL" /&amp;gt;
    &amp;lt;/a&amp;gt;
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;再在 &lt;a href="https://github.com/sachinchoolur/lightgallery.js"&gt;lightgallery.js&lt;/a&gt; 的作用下就能实现 Lightbox 功能。所以只要是使用 Python-Markdown 作为 html 生成器的博客都可以使个方法设置 Lightbox 效果。&lt;/p&gt;
&lt;h2 id="an-zhuang-python-markdown-tuo-zhan"&gt;安装 Python-Markdown 拓展&lt;/h2&gt;
&lt;p&gt;Pelican 提供了 Python-Markdown 拓展的接口，先使用 &lt;code&gt;pip install lightgallery&lt;/code&gt; 安装 lightgallery-markdown，并在 &lt;code&gt;pelicanconf.py&lt;/code&gt; 中添加&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;MARKDOWN = {
    'extension_configs': {
        'markdown.extensions.codehilite': {'css_class': 'highlight'},
        'markdown.extensions.extra': {},
        'markdown.extensions.meta': {},
        'lightgallery': {},
    },
    'output_format': 'html5',
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="bu-shu-lightgalleryjs"&gt;部署 lightgallery.js&lt;/h2&gt;
&lt;p&gt;在 &lt;a href="https://github.com/sachinchoolur/lightgallery.js"&gt;lightgallery.js 项目仓库&lt;/a&gt;中下载以下文件并放置到相应位置：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;dist/js/lightgallery.min.js&lt;/code&gt;&amp;emsp;&amp;rarr;&amp;emsp;&lt;code&gt;themes/{theme_name}/static/js/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dist/css/lightgallery.min.css&lt;/code&gt;&amp;emsp;&amp;rarr;&amp;emsp;&lt;code&gt;themes/{theme_name}/css/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dist/fonts/lg.*&lt;/code&gt;&amp;emsp;&amp;rarr;&amp;emsp;&lt;code&gt;themes/{theme_name}/font/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dist/img/loading.gif&lt;/code&gt;&amp;emsp;&amp;rarr;&amp;emsp;&lt;code&gt;themes/{theme_name}/images/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;{warn begin}由于文件目录结构不同，需要将 &lt;code&gt;lightgallery.min.css&lt;/code&gt; 中的字体、图片路径修改为相应路径。{warn end}&lt;/p&gt;
&lt;p&gt;修改 &lt;code&gt;themes/{theme_name}/templates/base.html&lt;/code&gt;，在其中添加以下代码&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-html"&gt;&amp;lt;!-- 引入.css与.js文件--&amp;gt;
&amp;lt;link href="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/css/lightgallery.min.css" type="text/css" rel="stylesheet" /&amp;gt;
&amp;lt;script type="text/javascript" src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/js/lightgallery.min.js"&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;!-- 图片计数 --&amp;gt;
&amp;lt;script&amp;gt;
  var elements = document.getElementsByClassName("lightgallery");
  for(var i=0; i&amp;lt;elements.length; i++) {
     lightGallery(elements[i]);
  }
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;到了这里，已经在博客上添加了 Lightbox 功能，但还缺少最重要的放大缩小功能。&lt;/p&gt;
&lt;h2 id="tian-jia-lightgalleryjs-cha-jian"&gt;添加 lightgallery.js 插件&lt;/h2&gt;
&lt;p&gt;下载 &lt;a href="https://github.com/sachinchoolur/lg-zoom.js"&gt;lg-zoom.js&lt;/a&gt;，将 &lt;code&gt;dist/lg_zoom.min.js&lt;/code&gt; 移入 &lt;code&gt;themes/{theme_name}/static/js/&lt;/code&gt;。同样在主题的 &lt;code&gt;base.html&lt;/code&gt; 中引入该 JavaScript 文件即可生效。lightgallery.js 项目还具有许多插件，都可以通过这样简单的方法使其生效。&lt;/p&gt;
&lt;h2 id="yi-xie-xiao-xiu-gai"&gt;一些小修改&lt;/h2&gt;
&lt;p&gt;若将图片标题留空，如 &lt;code&gt;![!](URL)&lt;/code&gt;，lightgallery.js 不会渲染查看图片时下方的图片信息，界面十分清爽舒服。但是这么一来，每次导出网页时Pelican 都会给出 &lt;code&gt;WARNING: Empty alt attribute for image content&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;于是修改 &lt;code&gt;lightgallery.js&lt;/code&gt; 文件，修改以下代码块：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-javascript"&gt;if (typeof subHtml !== 'undefined' &amp;amp;&amp;amp; subHtml !== null) {
            if (subHtml === '') {
                _lgUtils2.default.addClass(this.outer.querySelector(this.s.appendSubHtmlTo), 'lg-empty-html');
            } else {
                _lgUtils2.default.removeClass(this.outer.querySelector(this.s.appendSubHtmlTo), 'lg-empty-html');
            }
        }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;将判断条件修改为：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-javascript"&gt;if (subHtml === '' || subHtml === 'NoCaption')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这时只要是标题设置为 &lt;code&gt;"NoCaption"&lt;/code&gt; 的图片就不会显示下方信息栏，Pelican 也不会因为缺少标题而给出警告。&lt;/p&gt;
&lt;p&gt;{note begin}&lt;code&gt;lightgallery.min.js&lt;/code&gt; 经过压缩，体积较小，加载速度更快，但代码可读性较差，不便于修改，可以先修改 &lt;code&gt;lightgallery.js&lt;/code&gt; 再压缩为 &lt;code&gt;lightgallery.min.js&lt;/code&gt;。{note end}&lt;/p&gt;
&lt;h2 id="demo"&gt;Demo 🥳&lt;/h2&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="{photo}135 mm&amp;emsp;f/5.6&amp;emsp;1/125&amp;emsp;ISO-800&amp;emsp;Photo by Leo" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7545?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="{photo}135 mm&amp;emsp;f/5.6&amp;emsp;1/125&amp;emsp;ISO-800&amp;emsp;Photo by Leo" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7545?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;{warn begin}本文最后更新于 2022 年 08 月 17 日，请确定内容是否过时。{warn end}&lt;/p&gt;</content><category term="碎碎念"></category><category term="Blog"></category><category term="Pelican"></category><category term="Markdown"></category><category term="JavaScript"></category></entry><entry><title>使用 prettymaps 生成精美地图</title><link href="https://tseing.github.io/sui-sui-nian/2022-08-14-prettymaps-generate-maps.html" rel="alternate"></link><published>2022-08-14T00:00:00+08:00</published><updated>2022-08-14T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-08-14:/sui-sui-nian/2022-08-14-prettymaps-generate-maps.html</id><summary type="html">&lt;p&gt;经过&lt;a href="https://tseing.github.io/sui-sui-nian/2022-08-11-prettymaps-install.html"&gt;上次&lt;/a&gt;的屡次踩坑，终于艰难地在 Windows 上安装好了 prettymaps。看着 &lt;code&gt;pip list&lt;/code&gt; 中的 &lt;code&gt;prettymaps&lt;/code&gt;，我迫不及待地想试着用 &lt;code&gt;prettymaps&lt;/code&gt; 生成一些地图，那么就开 …&lt;/p&gt;</summary><content type="html">&lt;p&gt;经过&lt;a href="https://tseing.github.io/sui-sui-nian/2022-08-11-prettymaps-install.html"&gt;上次&lt;/a&gt;的屡次踩坑，终于艰难地在 Windows 上安装好了 prettymaps。看着 &lt;code&gt;pip list&lt;/code&gt; 中的 &lt;code&gt;prettymaps&lt;/code&gt;，我迫不及待地想试着用 &lt;code&gt;prettymaps&lt;/code&gt; 生成一些地图，那么就开始吧。&lt;/p&gt;
&lt;h2 id="attributeerror-cuo-wu"&gt;AttributeError 错误&lt;/h2&gt;
&lt;p&gt;先运行作者给出的示例代码试验一下：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;from prettymaps import *
from matplotlib import pyplot as plt
fig, ax = plt.subplots(figsize = (12, 12), constrained_layout = True)
layers = plot(
    'Pra&amp;ccedil;a Ferreira do Amaral, Macau', radius = 1100,
    ax = ax,
    layers = {
            'perimeter': {},
            'streets': {
                'custom_filter': '["highway"~"motorway|trunk|primary|secondary|tertiary|residential|service|unclassified|pedestrian|footway"]',
                'width': {
                    'motorway': 5,
                    'trunk': 5,
                    'primary': 4.5,
                    'secondary': 4,
                    'tertiary': 3.5,
                    'residential': 3,
                    'service': 2,
                    'unclassified': 2,
                    'pedestrian': 2,
                    'footway': 1,
                }
            },
            'building': {'tags': {'building': True, 'landuse': 'construction'}, 'union': False},
            'water': {'tags': {'natural': ['water', 'bay']}},
            'green': {'tags': {'landuse': 'grass', 'natural': ['island', 'wood'], 'leisure': 'park'}},
            'forest': {'tags': {'landuse': 'forest'}},
            'parking': {'tags': {'amenity': 'parking', 'highway': 'pedestrian', 'man_made': 'pier'}}
        },
        drawing_kwargs = {
            'background': {'fc': '#F2F4CB', 'ec': '#dadbc1', 'hatch': 'ooo...', 'zorder': -1},
            'perimeter': {'fc': '#F2F4CB', 'ec': '#dadbc1', 'lw': 0, 'hatch': 'ooo...',  'zorder': 0},
            'green': {'fc': '#D0F1BF', 'ec': '#2F3737', 'lw': 1, 'zorder': 1},
            'forest': {'fc': '#64B96A', 'ec': '#2F3737', 'lw': 1, 'zorder': 1},
            'water': {'fc': '#a1e3ff', 'ec': '#2F3737', 'hatch': 'ooo...', 'hatch_c': '#85c9e6', 'lw': 1, 'zorder': 2},
            'parking': {'fc': '#F2F4CB', 'ec': '#2F3737', 'lw': 1, 'zorder': 3},
            'streets': {'fc': '#2F3737', 'ec': '#475657', 'alpha': 1, 'lw': 0, 'zorder': 3},
            'building': {'palette': ['#FFC857', '#E9724C', '#C5283D'], 'ec': '#2F3737', 'lw': .5, 'zorder': 4},
        },
        osm_credit = {'color': '#2F3737'}
)
plt.savefig('macao.png')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但是拋出了错误，提示 &lt;code&gt;AttributeError: 'DataFrame' object has no attribute 'crs'&lt;/code&gt;。在 &lt;a href="https://github.com/marceloprates/prettymaps/issues/88"&gt;GitHub&lt;/a&gt; 上有人给出了解决方案，原因是 &lt;code&gt;osmnx&lt;/code&gt; 的版本过低，直接 &lt;code&gt;pip install osmnx==1.2.1&lt;/code&gt; 就可以解决。&lt;/p&gt;
&lt;p&gt;需要注意的是，pip 可能会给出错误信息提示 &lt;code&gt;osmnx==1.2.1&lt;/code&gt; 与 &lt;code&gt;prettymaps&lt;/code&gt; 不兼容。但同样给出了已成功安装 &lt;code&gt;osmnx==1.2.1&lt;/code&gt; 的信息。经过我的尝试，&lt;code&gt;prettymaps&lt;/code&gt; 是可以正常工作的，所以这条错误信息可能没有什么影响。&lt;/p&gt;
&lt;h2 id="chu-kui-prettymapsplot-han-shu"&gt;初窥 prettymaps.plot() 函数&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;prettymaps&lt;/code&gt; 是在 &lt;code&gt;matplotlib&lt;/code&gt; 画布上绘制地图的，所以主要参数与 &lt;code&gt;matplotlib&lt;/code&gt; 的写法相同，用于调整颜色或文本，不甚重要。而用于生成地图的 &lt;code&gt;prettymaps.plot()&lt;/code&gt; 函数就比较关键，比较常用参数的就以下几项：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;plot(
    # 地图的中心点，可以是地名的字符串，也可以经纬度的元组
    'query',
    # 地图半径，单位为米
    radius = 100,
    # 将 x 轴绑定至画布 x 轴
    ax = ax,
    # OpenStreetMap 地图层信息，若不了解复制示例代码即可
    layers = {'perimeter': {}},
    # 图层样式，如颜色等
    drawing_kwargs = {},
    # 版权信息
    osm_credit = {}
)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="yuan-xing-mo-shi"&gt;圆形模式&lt;/h2&gt;
&lt;p&gt;与示例代码相同，只要将 &lt;code&gt;perimeter&lt;/code&gt; 留空，默认的绘图模式就是圆形模式。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7539?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7539?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p class="intro"&gt;{location}外滩  The Bund, Shanghai&lt;/p&gt;
&lt;h2 id="yuan-jiao-ju-xing-mo-shi"&gt;圆角矩形模式&lt;/h2&gt;
&lt;p&gt;圆角矩形模式下，需要新建一个变量 &lt;code&gt;dilate&lt;/code&gt; 用于控制圆角半径，并在每一个图层的参数中添加 &lt;code&gt;'circle': False&lt;/code&gt; 与 &lt;code&gt;'dilate': dilate&lt;/code&gt; 就能生成圆角矩形地图。&lt;/p&gt;
&lt;p&gt;在各个图层中添加键值时要注意括号的嵌套，特别容易出错，可以复制以下代码修改。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;dilate = 100
palette=['#F4A460', '#FA8072']
layers = plot(
    (26.08594,119.29199), radius = 400,
    ax = ax,
    layers = {
            'perimeter': {"circle": False, "dilate": dilate},
            'streets': {
                'custom_filter': '["highway"~"motorway|trunk|primary|secondary|tertiary|residential|service|unclassified|pedestrian|footway"]',
                'width': {
                    'motorway': 5,
                    'trunk': 5,
                    'primary': 4.5,
                    'secondary': 4,
                    'tertiary': 3.5,
                    'residential': 3,
                    'service': 3,
                    'unclassified': 3,
                    'pedestrian': 3,
                    'footway': 3,
                },
                'circle': False,
                'dilate': dilate,
            },
            'building': {
                'tags': {
                    'building': True,
                    'landuse': 'construction'
                },
                'union': False,
                'circle': False,
                'dilate': dilate
            },
            'water': {
                'tags': {
                    'natural': ['water', 'bay']
                },
                'circle': False,
                'dilate': dilate
            },
            'green': {
                'tags': {
                    'landuse': 'grass',
                    'natural': ['island', 'wood'],
                    'leisure': 'park'
                },
                'circle': False,
                'dilate': dilate,
            },
            'forest': {
                'tags': {'landuse': 'forest'},
                'circle': False,
                'dilate': dilate,
            },
            'parking': {
                'tags': {
                    'amenity': 'parking',
                    'highway': 'pedestrian',
                    'man_made': 'pier'},
                'circle': False,
                'dilate': dilate
            },
    },
        drawing_kwargs = {
            'background': {'fc': '#F2F4CB', 'ec': '#dadbc1', 'hatch': 'ooo...', 'zorder': -1},
            'perimeter': {'fc': '#F2F4CB', 'ec': '#dadbc1', 'lw': 0, 'hatch': 'ooo...',  'zorder': 0},
            'green': {'fc': '#D0F1BF', 'ec': '#2F3737', 'lw': 1, 'zorder': 1},
            'forest': {'fc': '#64B96A', 'ec': '#2F3737', 'lw': 1, 'zorder': 1},
            'water': {'fc': '#a1e3ff', 'ec': '#2F3737', 'hatch': 'ooo...', 'hatch_c': '#85c9e6', 'lw': 1, 'zorder': 2},
            'parking': {'fc': '#F2F4CB', 'ec': '#2F3737', 'lw': 1, 'zorder': 3},
            'streets': {'fc': '#2F3737', 'ec': '#475657', 'alpha': 1, 'lw': 0, 'zorder': 3},
            'building': {'palette': palette, 'ec': '#2F3737', 'lw': .5, 'zorder': 4},
        },
        osm_credit = {'color': '#2F3737'}
)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7540?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7540?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p class="intro"&gt;{location}三坊七巷  Sanfang Qixiang, Fuzhou&lt;/p&gt;
&lt;h2 id="fang-xing-mo-shi"&gt;方形模式&lt;/h2&gt;
&lt;p&gt;欲使地图布满整个方形画面，需要使用 &lt;code&gt;matplotlib&lt;/code&gt; 的命令，指定绘制出的 x 与 y 轴范围。只需要在圆角矩形的代码中末插入以下代码：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;xmin, ymin, xmax, ymax = layers['perimeter'].bounds
dx, dy = xmax-xmin, ymax-ymin
a = .2
ax.set_xlim(xmin+a*dx, xmax-a*dx)
ax.set_ylim(ymin+a*dy, ymax-a*dy)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;变量 &lt;code&gt;a&lt;/code&gt; 表示裁去的四周比例。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7541?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7541?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p class="intro"&gt;{location}闽江  Min River, Fuzhou&lt;/p&gt;
&lt;h2 id="jin-jie-cao-zuo"&gt;进阶操作&lt;/h2&gt;
&lt;p&gt;但不止如此，我想讨论一些进阶的操作。&lt;code&gt;layers&lt;/code&gt; 参数指定了绘制的图层，在 &lt;code&gt;drawing_kwargs&lt;/code&gt; 中可以指定图层的样式，由底至上常见以下几个图层：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;background&lt;/code&gt; 画布的背景，可以参考圆形模式视图中四个角落的空白；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;perimeter&lt;/code&gt; 图层的底层，如果没有图层覆盖，就表现为该图层的颜色，可以参考方形模式视图中的浅黄色；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;green&lt;/code&gt; &lt;code&gt;forest&lt;/code&gt; &lt;code&gt;water&lt;/code&gt; 等按字面意思理解即可，若想确定各个图层中 &lt;code&gt;tags&lt;/code&gt; 所代表的具体事物，见 &lt;a href="https://wiki.openstreetmap.org/wiki/Zh-hans:Map_Features"&gt;OpenStreetMap Wiki&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;drawing_kwargs&lt;/code&gt; 中的样式参数包括以下几个：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fc&lt;/code&gt; 图层的填充颜色；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ec&lt;/code&gt; 图层的轮廓颜色；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hatch&lt;/code&gt; 图层的填充纹理，具体设置见 &lt;a href="https://matplotlib.org/stable/gallery/shapes_and_collections/hatch_style_reference.html"&gt;matplolib 文档&lt;/a&gt;；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hatch_c&lt;/code&gt; 图层填充纹理的颜色；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;alpha&lt;/code&gt; 图层的透明度；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lw&lt;/code&gt; 图层轮廓线条的宽度；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;zorder&lt;/code&gt; 层数，决定了图层之间相互掩盖的关系。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有了以上认识之后，我们就能更加随心所欲地绘制想要的地图了。还有一个额外的小技巧，OpenStreetMap 提供了封闭元素，使用地址描述绘制地点，不设置 &lt;code&gt;radius&lt;/code&gt; 参数， &lt;code&gt;prettymaps&lt;/code&gt; 就会自动匹配封闭元素的边界，使用这个方式可以绘制指定场所的示意图、行政区的示意图。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;fig, ax = plt.subplots(figsize = (12, 12), constrained_layout = True)

# 画布颜色
fig.patch.set_facecolor('#eee')

# 边界向外扩张
def postprocessing(layers):
    layers['perimeter'] = layers['perimeter'].buffer(10)
    return layers

layers = plot(
    "北京大学, 5号, 颐和园路, 海淀区, 北京市, 100871, 中国",
    ax = ax,
    postprocessing = postprocessing,
    layers = {
            'perimeter': {},
            'streets': {
                'custom_filter': '["highway"~"residential|service|unclassified|pedestrian|footway"]',
                'width': {
                    'residential': 1.5,
                    'service': 1.5,
                    'unclassified': 1,
                    'pedestrian': 1,
                    'footway': 1,
                }
            },
            'building': {
                'tags': {
                    'building': True,
                    'landuse': 'construction'
                },
                'union': False
            },
            'water': {
                'tags': {
                    'natural': ['water']
                }
            },
            'green': {
                'tags': {
                    'landuse': ['grass'],
                    'natural': ['island', 'wood'],
                    'leisure': ['park', 'garden']
                }
            },
            'leisure': {
                'tags': {
                    'leisure': ['pitch', 'playground']
                }
            },
            'parking': {
                'tags': {
                    'amenity': 'parking',
                    'highway': 'pedestrian',
                    'man_made': 'pier'
                }
            },
        },
        drawing_kwargs = {
            'background': {'fc': '#eee', 'lw': 0 , 'zorder': -1},
            'perimeter': {'fc': '#F2F4CB', 'ec': '#2F3737', 'lw': 2, 'linestyle': 'dashed', 'zorder': 0},
            'green': {'fc': '#D0F1BF', 'ec': '#2F3737', 'lw': 0.5, 'zorder': 1},
            'leisure': {'fc': '#aae0cb', 'ec': '#2F3737', 'lw': 0.5, 'zorder': 1},
            'water': {'fc': '#a1e3ff', 'ec': '#2F3737', 'lw': 0.5, 'zorder': 2},
            'parking': {'fc': '#F2F4CB', 'ec': '#2F3737', 'lw': 0.5, 'zorder': 3},
            'streets': {'fc': '#2F3737', 'alpha': 0.7, 'lw': 0, 'zorder': 3},
            'building': {'palette': ['#FFC857', '#E9724C', '#C5283D'], 'ec': '#2F3737', 'lw': .5, 'zorder': 4},
        },
        osm_credit = {'color': '#2F3737'}
)
plt.savefig('pku.png')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;由于 &lt;code&gt;prettymaps&lt;/code&gt; 的封闭边界太过于靠近建筑，可以使用 &lt;code&gt;buffer()&lt;/code&gt; 将边界向外扩张一部分，能获得更好的视觉效果。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7542?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7542?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p class="intro"&gt;{location}北京大学  Peking University, Beijing&lt;/p&gt;
&lt;p&gt;调用相应的图层标签，还可以绘制铁路、地铁线路。以下代码调用了了铁路、地铁、站台并将这些元素各自组合为图层：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-py"&gt;'railway': {
    'custom_filter': '["railway"~"rail"]',
    'width': 2,
    'circle': False,
    'dilate': dilate,
},
'subway': {
    'tags': {
        "railway": "subway",
    },
    'circle': False,
    'dilate': dilate,
},
'platform': {
    'tags': {
        'railway': 'platform'
    },
    'circle': False,
    'dilate': dilate,
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://storage.live.com/items/4D18B16B8E0B1EDB!7543?authkey=ALYpzW-ZQ_VBXTU"&gt;&lt;img alt="NoCaption" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7543?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p class="intro"&gt;{location}天津站  Tianjin Railway Station, Tianjin&lt;/p&gt;
&lt;h2 id="zi-ji-de-hua"&gt;自己的话&lt;/h2&gt;
&lt;p&gt;不得不说，&lt;code&gt;prettymaps&lt;/code&gt; 是一款十分优秀的 Python 绘图包，它的操作十分简单，足以让我这样不了解 GIS 的用户迅速入门，绘制出十分惊艳的地图。但在实际使用中，&lt;code&gt;prettymaps&lt;/code&gt; 还是存在着这样那样的问题，使得它的定位可能只能止步于一个发挥创意的工具，而不能成为一个合适的创作工具。&lt;/p&gt;
&lt;p&gt;譬如说，各种各样的用户因为各种各样的需求接触到 &lt;code&gt;prettymaps&lt;/code&gt;，其中不乏有些用户想为某些场所、学校绘制导览地图，但 &lt;code&gt;prettymaps&lt;/code&gt; 添加元素的方式不够灵活，这会让这些用户使用起来相当费劲。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;prettymaps&lt;/code&gt; 的数据基于 OpenStreetMap，因为国内这样那样的相关法律法规，注定了 OpenStreetMap 的国内贡献者特别少，这对于开源项目来说几乎是致命的。由于 OpenStreetMap 缺少国内数据，使用 &lt;code&gt;prettymaps&lt;/code&gt; 绘制国内城市的地图是相当力不从心的。&lt;/p&gt;
&lt;p&gt;这方面具体表现为大面积缺失建筑，绘制的地图上十分空旷；缺少海洋、海岸线数据，绘制近海区域时呈现为大片空白等等。&lt;/p&gt;
&lt;p&gt;OpenStreetMap 的封闭边界是非常亮眼的功能，在 &lt;code&gt;prettymaps&lt;/code&gt; 中用字符描述地点就能绘制出行政区、建筑群等等。但从另一个方面考虑，OpenStreetMap 的封闭边界是由用户贡献的，所以在涉边境线、涉敏感地区时务必小心。&lt;/p&gt;
&lt;p&gt;总而言之，&lt;code&gt;prettymaps&lt;/code&gt; 为我们提供了另一个视角，让我们俯瞰日常生活的这座城市，感受建筑布局的美。而 OpenStreetMap 可以说是一个伟大的项目，它借助所有人的力量去描绘我们所生活的这个世界的经纬，这个理念闪耀着国际主义与理想主义的光芒。&lt;/p&gt;</content><category term="碎碎念"></category><category term="prettymaps"></category><category term="Python"></category><category term="matplotlib"></category><category term="OpenStreetMap"></category></entry><entry><title>在 Windows 安装 prettymaps 的踩坑实录</title><link href="https://tseing.github.io/sui-sui-nian/2022-08-11-prettymaps-install.html" rel="alternate"></link><published>2022-08-11T00:00:00+08:00</published><updated>2022-08-11T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-08-11:/sui-sui-nian/2022-08-11-prettymaps-install.html</id><summary type="html">&lt;p&gt;prettymaps 是一个 Python 地图绘图包，在 matplotlib 绘图包的助力下能够绘制出十分精美的地图。但是 prettymaps 在 Windows 下的安装十分恼人，这篇笔记记录下了安装过程中的常见错误。&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;code&gt;prettymaps&lt;/code&gt; 是一个 Python 地图绘图包，能够使用 OpenStreetMap 的地图数据，在 &lt;code&gt;matplotlib&lt;/code&gt; 绘图包的助力下能够绘制出十分精美、极具艺术感的地图。但是 &lt;code&gt;prettymaps&lt;/code&gt; 在 Windows 下的安装十分恼人，这篇笔记记录下了安装过程中的常见错误。&lt;/p&gt;
&lt;h2 id="chang-shi-zhi-jie-shi-yong-pip-an-zhuang"&gt;尝试直接使用 pip 安装&lt;/h2&gt;
&lt;p&gt;在项目的 &lt;a href="https://github.com/marceloprates/prettymaps"&gt;GitHub 仓库&lt;/a&gt;中，作者提供的方法是直接通过 &lt;code&gt;pip install prettymaps&lt;/code&gt; 安装，但是在 Windows 设备上貌似不起作用。命令行信息提示在安装 &lt;code&gt;Fiona&lt;/code&gt; 时发生错误，错误信息如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  Using cached Fiona-1.8.21.tar.gz (1.0 MB)
  Preparing metadata (setup.py) ... error
  error: subprocess-exited-with-error

  &amp;times; python setup.py egg_info did not run successfully.
  &amp;boxv; exit code: 1
  ╰&amp;boxh;&amp;gt; [1 lines of output]
      A GDAL API version must be specified. Provide a path to gdal-config using a GDAL_CONFIG environment variable or use a GDAL_VERSION environment variable.
      [end of output]

  note: This error originates from a subprocess, and is likely not a problem with pip.
error: metadata-generation-failed

&amp;times; Encountered error while generating package metadata.
╰&amp;boxh;&amp;gt; See above for output.

note: This is an issue with the package mentioned above, not pip.
hint: See above for details.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里我们需要先明确一下 &lt;code&gt;prettymaps&lt;/code&gt; 的依赖：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- prettymaps
╰&amp;boxh;&amp;gt; - Fiona
    ╰&amp;boxh;&amp;gt; - GDAL
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;再根据错误信息，也就是在安装 &lt;code&gt;Fiona&lt;/code&gt; 依赖时调用的 &lt;code&gt;GDAL&lt;/code&gt; 未正确配置，我的设备上没有安装 &lt;code&gt;GDAL&lt;/code&gt;，所以需要先安装 &lt;code&gt;GDAL&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id="an-zhuang-gdal-corebu-tui-jian"&gt;安装 GDAL core（不推荐）&lt;/h2&gt;
&lt;p&gt;可以先尝试直接 &lt;code&gt;pip install gdal&lt;/code&gt;，不出意外的话会有以下错误：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;extensions/gdalconst_wrap.c(2703): fatal error C1083: 无法打开包括文件: &amp;ldquo;gdal.h&amp;rdquo;: No such file or directory
extensions/gdal_array_wrap.cpp(2829): fatal error C1083: 无法打开包括文件: &amp;ldquo;gdal.h&amp;rdquo;: No such file or directory
extensions/gnm_wrap.cpp(2820): fatal error C1083: 无法打开包括文件: &amp;ldquo;gdal.h&amp;rdquo;: No such file or directory
extensions/ogr_wrap.cpp(2838): fatal error C1083: 无法打开包括文件: &amp;ldquo;gdal.h&amp;rdquo;: No such file or directory
extensions/osr_wrap.cpp(2879): fatal error C1083: 无法打开包括文件: &amp;ldquo;cpl_string.h&amp;rdquo;: No such file or directory
extensions/gdal_wrap.cpp(2883): fatal error C1083: 无法打开包括文件: &amp;ldquo;cpl_port.h&amp;rdquo;: No such file or directory
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这是因为 Windows 缺少 Linux 自带的 GDAL core，一个解决方法就是在 Windows 上安装 GDAL core。因为这个过程无比繁琐，而且我不是 GIS 从业者，没有使用其他依赖于 GDAL core 软件的需要，所以我最后没有采取这种方法。&lt;/p&gt;
&lt;p&gt;但一开始我并未意识到安装 GDAL core 如此麻烦，以至于我也折腾了半天 GDAL core 的安装，我把这一解决方案的整个流程总结如下：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;安装 GDAL core&lt;/code&gt; ⇨ &lt;code&gt;安装 GDAL bindings&lt;/code&gt; ⇨ &lt;code&gt;设置 GDAL core 环境变量&lt;/code&gt; ⇨ &lt;code&gt;安装 Fiona&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;安装 GDAL core 与 bindings，可以前往 &lt;a href="https://www.gisinternals.com/release.php"&gt;GISInternals&lt;/a&gt; 下载安装文件。因为我的设备上安装了 Visual Studio 2017，我就选择了 MSVC 2017 x64 版本。&lt;/p&gt;
&lt;p&gt;&lt;img alt="GISInternals首页" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7531?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;要下载 GDAL core 和 bindings 两个安装文件，其中 bindings 需要与自己的 Python 版本匹配，下载完成后先安装 core 再安装 bindings。&lt;/p&gt;
&lt;p&gt;&lt;img alt="GISInternals下载文件" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7533?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;安装完成后，使用 pip 可以查询到 &lt;code&gt;GDAL&lt;/code&gt; 的安装信息：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python-repl"&gt;&amp;gt;&amp;gt;&amp;gt; pip list
Package           Version
----------------- -------
GDAL              3.5.1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;此时已经在 Python 中安装了 &lt;code&gt;GDAL&lt;/code&gt;，但还需要配置环境变量后才能安装 &lt;code&gt;Fiona&lt;/code&gt;。详细步骤可以参考&lt;a href="https://zhuanlan.zhihu.com/p/141226948"&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id="shi-yong-whl-wen-jian-an-zhuang-tui-jian"&gt;使用 .whl 文件安装（推荐）&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;GDAL&lt;/code&gt; 与 &lt;code&gt;Fiona&lt;/code&gt; 不能直接通过 pip 安装是因为缺少 GDAL core，在不安装 GDAL core 的情况下，可以使用预编译的 &lt;code&gt;.whl&lt;/code&gt; 安装这两个依赖。UCI 的 &lt;a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#gdal"&gt;Python 拓展包仓库&lt;/a&gt;提供了这两个依赖的 &lt;code&gt;.whl&lt;/code&gt; 文件。&lt;/p&gt;
&lt;p&gt;&lt;img alt="GDAL下载页面" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7530?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;要注意文件名中的两个参数，cp 指 Python 版本，win 字段指 CPU 架构，也就是常说的 32 位或 64 位系统。因此我选择的就是 &lt;code&gt;GDAL‑3.4.3‑cp39‑cp39‑win_amd64.whl&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;将下载文件移入 Python 安装目录下的 &lt;code&gt;Scripts&lt;/code&gt; 文件夹中，在该文件夹中打开终端，能过以下命令尝试安装：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python-repl"&gt;&amp;gt;&amp;gt;&amp;gt; pip install GDAL-3.4.3-cp39-cp39-win_amd64.whl
ERROR: Could not install packages due to an OSError: [Errno 22] Invalid argument
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;出现这个错误时我寻找了大量解决方法，当然，这个错误也没法解决，这纯粹是安装文件的问题。这个隐藏的坑浪费我大量时间，后来我发现将安装文件换成&lt;code&gt;3.3.3&lt;/code&gt;版本，就能成功安装了。&lt;/p&gt;
&lt;p&gt;但这还没结束，同样在 UCI 提供的仓库中下载 &lt;code&gt;Fiona&lt;/code&gt;，用同样的方法安装，这时就会发现 &lt;code&gt;Fiona&lt;/code&gt; 尝试卸载 &lt;code&gt;GDAL&lt;/code&gt; 并使用 pip 直接安装其他版本的 &lt;code&gt;GDAL&lt;/code&gt;。当然，结局就会和上面的情况一样，用 pip 直接安装是安装不上 &lt;code&gt;GDAL&lt;/code&gt; 的。&lt;/p&gt;
&lt;p&gt;这是因为这里还有一个隐藏的大坑，就是 &lt;code&gt;GDAL&lt;/code&gt; 与 &lt;code&gt;Fiona&lt;/code&gt; 的版本必须匹配，否则就会自动重新下载。经过大量尝试，Python 版本为 &lt;code&gt;3.9.10&lt;/code&gt; 的条件下，可以使用 &lt;code&gt;GDAL==3.3.2&lt;/code&gt; 与 &lt;code&gt;Fiona==1.8.20&lt;/code&gt;，这两个版本在 UCI 提供的仓库中都没有，我把下载链接放在后文。&lt;/p&gt;
&lt;p&gt;安装好这两个依赖后，就可以直接使用 &lt;code&gt;pip install prettymaps&lt;/code&gt; 安装 &lt;code&gt;prettymaps&lt;/code&gt; 了。在 Python 交互模式下输入 &lt;code&gt;import prettymaps&lt;/code&gt;，若无错误信息，就成功安装好 &lt;code&gt;prettymaps&lt;/code&gt; 了。&lt;/p&gt;
&lt;h2 id="zong-jie"&gt;总结&lt;/h2&gt;
&lt;p&gt;Windows 下安装 &lt;code&gt;prettymaps&lt;/code&gt; 的错误是 &lt;code&gt;GDAL&lt;/code&gt; 与 &lt;code&gt;Fiona&lt;/code&gt; 两个依赖未能成功安装造成的，本质原因是 Windows 缺少 GDAL core。&lt;/p&gt;
&lt;p&gt;由于以上原因在 Windows 下未能成功安装 &lt;code&gt;prettymaps&lt;/code&gt; 的推荐解决步骤如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;安装 &lt;a href="http://1drv.stdfirm.com/u/s!AtseC45rsRhNunGGuDYayQdVADT3?e=RAJEsi"&gt;GDAL-3.3.2-cp39-cp39-win_amd64.whl&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;安装 &lt;a href="http://1drv.stdfirm.com/u/s!AtseC45rsRhNunAkPiG4AOb9V8yi?e=fAgNhp"&gt;Fiona-1.8.20-cp39-cp39-win_amd64.whl&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pip install prettymaps&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr/&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/32224877"&gt;Python中GDAL的安装 - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/141226948"&gt;windows10 环境中安装GDAL及其python绑定 - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/389235808"&gt;window 操作系统安装python的第三方包Fiona报错时解决方法 - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="碎碎念"></category><category term="prettymaps"></category><category term="Python"></category><category term="Windows"></category></entry><entry><title>《统计学习方法》第四章：朴素贝叶斯法</title><link href="https://tseing.github.io/sui-sui-nian/2022-08-05-statistical-learning-chapter4.html" rel="alternate"></link><published>2022-08-05T00:00:00+08:00</published><updated>2022-08-05T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-08-05:/sui-sui-nian/2022-08-05-statistical-learning-chapter4.html</id><summary type="html">&lt;p&gt;《统计学习方法》第四章介绍的贝叶斯法利用了条件概率原理，通过贝叶斯法可以从事件的统计数据中反推出产生随机事件的概率模型。&lt;/p&gt;</summary><content type="html">&lt;h2 id="mo-xing"&gt;模型&lt;/h2&gt;
&lt;h3 id="tiao-jian-gai-lu"&gt;条件概率&lt;/h3&gt;
&lt;p&gt;引入贝叶斯法模型前，首先回顾一下条件概率的基本公式。所谓条件概率，就是在某事件 &lt;span class="math"&gt;\(B\)&lt;/span&gt; 发生的条件下，求另一事件 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 发生的概率，条件概率可以通过下式计算：&lt;/p&gt;
&lt;div class="math"&gt;$$P(A|B)=\frac{P(AB)}{P(B)}$$&lt;/div&gt;
&lt;h4&gt;乘法公式&lt;/h4&gt;
&lt;p&gt;根据条件概率定义，可以得到&lt;/p&gt;
&lt;div class="math"&gt;$$P(A|B)=\frac{P(AB)}{P(B)}$$&lt;/div&gt;
&lt;div class="math"&gt;$$P(B|A)=\frac{P(AB)}{P(A)}$$&lt;/div&gt;
&lt;p&gt;显然有&lt;/p&gt;
&lt;div class="math"&gt;$$P(AB)=P(A)P(B|A)=P(B)P(A|B)$$&lt;/div&gt;
&lt;p&gt;该式就称为乘法公式。&lt;/p&gt;
&lt;h4&gt;全概率公式&lt;/h4&gt;
&lt;p&gt;若将&lt;dot&gt;样本空间&lt;/dot&gt; &lt;span class="math"&gt;\(\Omega\)&lt;/span&gt; 分割为&lt;dot&gt;互不相容&lt;/dot&gt;的各事件 &lt;span class="math"&gt;\(B_1,B_2,\cdots B_n\)&lt;/span&gt;，那么 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 事件的概率就应当是 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 的&lt;dot&gt;所有&lt;/dot&gt;条件概率与相应条件发生概率乘积之和：&lt;/p&gt;
&lt;div class="math"&gt;$$P(A)=\sum_{i=1}^nP(B_i)P(A|B_i)$$&lt;/div&gt;
&lt;p&gt;考虑 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(B\)&lt;/span&gt; 为两个事件的情况，利用全概系公式可以将事件 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 发生的概率写为&lt;/p&gt;
&lt;div class="math"&gt;$$P(A)=P(B)P(A|B)+P(\bar{B})P(A|\bar{B})$$&lt;/div&gt;
&lt;h4&gt;贝叶斯公式&lt;/h4&gt;
&lt;p&gt;假设 &lt;span class="math"&gt;\(Y_1,Y_2,\cdots Y_n\)&lt;/span&gt; 是对样本空间的划分，&lt;span class="math"&gt;\(X\)&lt;/span&gt; 为样本空间中的一个事件，那么根据条件概率的定义，有&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y_i|X)=\frac{P(XY_i)}{P(X)}$$&lt;/div&gt;
&lt;p&gt;利用乘法公式，该式可以写为&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y_i|X)=\frac{P(X|Y_i)P(Y_i)}{P(X)}$$&lt;/div&gt;
&lt;p&gt;利用全概率公式，得到&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y_i|X)=\frac{P(X|Y_i)P(Y_i)}{\sum_{j=1}^nP(X|Y_j)P(Y_j)}$$&lt;/div&gt;
&lt;p&gt;该式即为贝叶斯公式。&lt;/p&gt;
&lt;h3 id="po-su-bei-xie-si-fa-mo-xing"&gt;朴素贝叶斯法模型&lt;/h3&gt;
&lt;p&gt;假设训练集 &lt;span class="math"&gt;\(T=\{(x_1,y_1),(x_2,y_2),\cdots,(x_N,y_N)\}\)&lt;/span&gt; 是由 &lt;span class="math"&gt;\(P(X,Y)\)&lt;/span&gt; &lt;dot&gt;独立同分布&lt;/dot&gt;产生，其中输入为特征向量，输出为类标记。&lt;/p&gt;
&lt;p&gt;先验概率分布为&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y=c_k),\qquad k=1,2,\cdots,K$$&lt;/div&gt;
&lt;p&gt;条件概率分布为&lt;/p&gt;
&lt;div class="math"&gt;$$P(X=x|Y=c_k)=P(X^{(1)}=x^{(1)},\cdots,X^{(n)}=x^{(n)}|Y=c_k)$$&lt;/div&gt;
&lt;p&gt;对条件概率分布作&lt;dot&gt;条件独立性&lt;/dot&gt;的假设，即认为某特征向量事件的各分量事件相互独立，因此该向量代表事件的发生概率为该向量的各分量概率乘积：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    P(X=x|Y=c_k)&amp;amp;=P(X^{(1)}=x^{(1)},\cdots,X^{(n)}=x^{(n)}|Y=c_k)\\
    &amp;amp;=\prod_{j=1}^nP(X^{j}=x^{(j)}|Y=c_k)
\end{align}$$&lt;/div&gt;
&lt;p&gt;朴素贝叶斯法的目的在于通过模型计算输入 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 后的后验概率分布 &lt;span class="math"&gt;\(P(Y=c_k|X=x)\)&lt;/span&gt; 并输出后验概率最大的 &lt;span class="math"&gt;\(c_k\)&lt;/span&gt; 作为 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 的类。&lt;/p&gt;
&lt;p&gt;类比推导得到的贝叶斯公式&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y_i|X)=\frac{P(X|Y_i)P(Y_i)}{\sum_{j=1}^nP(X|Y_j)P(Y_j)}$$&lt;/div&gt;
&lt;p&gt;后验概率分布可以表示为&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y=c_k|X=x)=\frac{P(X=x|Y=c_k)P(Y=c_k)}{\sum_k P(X=x|Y=c_k)P(Y=c_k)}$$&lt;/div&gt;
&lt;p&gt;代入条件独立性假设，即有&lt;/p&gt;
&lt;div class="math"&gt;$$P(Y=c_k|X=x)=\frac{\color{orangered}{P(Y=c_k)\prod_jP(X^{(j)}=x^{(j)}|Y=c_k)}}{\sum_k P(Y=c_k)\prod_j P(X^{(j)}=x^{(j)}|Y=c_k)}$$&lt;/div&gt;
&lt;p&gt;其中不论 &lt;span class="math"&gt;\(c_k\)&lt;/span&gt; 为何值时，分母部分都是不变的，不影响发生概率大小的比较，因此朴素贝叶斯方法的模型可以表示为&lt;/p&gt;
&lt;div class="math"&gt;$$y=\arg \max_{c_k}\color{orangered}{P(Y=c_k)\prod_jP(X^{(j)}=x^{(j)}|Y=c_k)}$$&lt;/div&gt;
&lt;h2 id="ce-lue_1"&gt;策略&lt;/h2&gt;
&lt;p&gt;损失函数可以表示为&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{equation}
    L(Y,f(X))=
    \begin{cases}
        1, &amp;amp;Y\neq f(X)\\
        0, &amp;amp;Y=f(X)
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;期望风险函数为条件期望&lt;/p&gt;
&lt;div class="math"&gt;$$R_{\mathrm{exp}}(f)=E[L(Y,f(X))]=E_X\sum_{k=1}^K[L(c_k,f(X))]P(c_k|X)$$&lt;/div&gt;
&lt;p&gt;最小化期望风险就需要对 &lt;span class="math"&gt;\(X=x\)&lt;/span&gt; 逐个最小化：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    f(x)&amp;amp;=\arg \min_{y\in\mathcal{Y}}\sum_{k=1}^KL(c_k,y)P(c_k|X=x)\\
    &amp;amp;=\arg \min_{y\in\mathcal{Y}}\sum_{k=1}^KP(y\neq c_k|X=x)\\
    &amp;amp;=\arg \min_{y\in\mathcal{Y}}(1-P(y=c_k|X=x))\\
    &amp;amp;=\arg \max_{y\in\mathcal{Y}}P(y=c_k|X=x)\\
\end{align}$$&lt;/div&gt;
&lt;p&gt;也就是说后验概率最大的情况下期望风险就最小，这正是朴素贝叶斯法决定输出类别的方法。&lt;/p&gt;
&lt;h2 id="suan-fa"&gt;算法&lt;/h2&gt;
&lt;h3 id="ji-da-si-ran-gu-ji"&gt;极大似然估计&lt;/h3&gt;
&lt;p&gt;使用频率估计概率，先验概率为&lt;/p&gt;
&lt;div class="math"&gt;$$\color{teal}{P(Y=c_k)}=\frac{\sum_{i=1}^NI(y_i=c_k)}{N}$$&lt;/div&gt;
&lt;p&gt;特征向量的第 &lt;span class="math"&gt;\(j\)&lt;/span&gt; 个分量 &lt;span class="math"&gt;\(x^{(j)}\)&lt;/span&gt; 可能取的值构成了集合 &lt;span class="math"&gt;\(\{a_{j1},a_{j2},\cdots,a_{jS_j}\}\)&lt;/span&gt;，那么条件概率为&lt;/p&gt;
&lt;div class="math"&gt;$$\color{steelblue}{P(X^{(j)}=a_{jl}|Y=c_k)}=\frac{\sum_{i=1}^NI(x_i^{(j)}=a_{jl},y_i=c_k)}{\sum_{i=1}^NI(y_i=c_k)}$$&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;算法 4.1&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：训练集 &lt;span class="math"&gt;\(T\)&lt;/span&gt; 与实例 &lt;span class="math"&gt;\(x\)&lt;/span&gt;&lt;br/&gt;
输出：&lt;span class="math"&gt;\(x\)&lt;/span&gt; 的类别&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;计算先验概率 &lt;span class="math"&gt;\(\color{teal}{P(Y=c_k)}\)&lt;/span&gt; 与条件概率 &lt;span class="math"&gt;\(\color{steelblue}{P(X^{(j)}=a_{jl}|Y=c_k)}\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;应用条件独立性假设，计算 &lt;span class="math"&gt;\(P(Y=c_k)\prod_jP(X^{(j)}=x^{(j)}|Y=c_k)\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;确定 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 的类别，&lt;span class="math"&gt;\(y=\arg \max_{c_k}P(Y=c_k)\prod_jP(X^{(j)}=x^{(j)}|Y=c_k)\)&lt;/span&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="bei-xie-si-gu-ji"&gt;贝叶斯估计&lt;/h3&gt;
&lt;p&gt;在极大似然估计中可能会出现估计的概率为零，从而导致整个特征向量的估计概率也为零，影响估计结果。贝叶斯估计通过在频数上引入正数 &lt;span class="math"&gt;\(\lambda\)&lt;/span&gt; 从而避免了这种偏差：&lt;/p&gt;
&lt;div class="math"&gt;$$\color{teal}{P(Y=c_k)}=\frac{\sum_{i=1}^NI(y_i=c_k)+\color{orangered}{\lambda}}{N+\color{orangered}{K\lambda}}$$&lt;/div&gt;
&lt;div class="math"&gt;$$\color{steelblue}{P_{\lambda}(X^{j}=a_{jl}|Y=c_k)}=\frac{\sum_{i=1}^NI(x_i^{(j)}=a_{jl},y_i=c_k)+\color{orangered}{\lambda}}{\sum_{i=1}^NI(y_i=c_k)+\color{orangered}{S_j\lambda}}$$&lt;/div&gt;
&lt;p&gt;若取 &lt;span class="math"&gt;\(\lambda=0\)&lt;/span&gt; 时就是极大似然估计，常取 &lt;span class="math"&gt;\(\lambda=1\)&lt;/span&gt;，称为拉普拉斯平滑。&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references_1"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/33437381/"&gt;李航, 2019. 统计学习方法（第2版）. 清华大学出版社.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/5998092/"&gt;茆诗松, 程依明, 濮晓龙, 2011. 概率论与数理统计教程. 高等教育出版社.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="统计学习方法"></category><category term="Machine learning"></category><category term="Algorithm"></category></entry><entry><title>《统计学习方法》第三章：k 近邻法</title><link href="https://tseing.github.io/sui-sui-nian/2022-08-02-statistical-learning-chapter3.html" rel="alternate"></link><published>2022-08-02T00:00:00+08:00</published><updated>2022-08-02T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-08-02:/sui-sui-nian/2022-08-02-statistical-learning-chapter3.html</id><summary type="html">&lt;p&gt;《统计学习方法》第三章介绍了 k 近邻模型，k 近邻模型原理十分简单，如何划分向量空间从而降低算法的时间复杂度就成为了更关键的问题。&lt;/p&gt;</summary><content type="html">&lt;h2 id="k-jin-lin-mo-xing"&gt;k 近邻模型&lt;/h2&gt;
&lt;p&gt;k 近邻法将输入实例的特征空间划分为若干子空间，子空间中的若干实例 &lt;span class="math"&gt;\(x_i\)&lt;/span&gt; 同属于 &lt;span class="math"&gt;\(y_i\)&lt;/span&gt; 类别。具体来说，k 近邻法通过在训练集中找到与新输入实例最邻近的 k 个实例，这 k 个实例大部分属于 &lt;span class="math"&gt;\(y_i\)&lt;/span&gt; 类别，就也将新输入实例归属为 &lt;span class="math"&gt;\(y_i\)&lt;/span&gt; 类别。&lt;/p&gt;
&lt;p&gt;&lt;img alt="k近邻模型" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7519?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;训练集数据为&lt;/p&gt;
&lt;div class="math"&gt;$$
T=\{ (x_1,y_1),(x_2,y_2),\cdots,(x_N,y_N) \}
$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(x_i\in\mathbf{R}^n\)&lt;/span&gt; 为特征向量，&lt;span class="math"&gt;\(y_i\in\{c_1,c_2,\cdots,c_K\}\)&lt;/span&gt; 为实例类别。k 近邻法根据&lt;dot&gt;距离度量&lt;/dot&gt;，在包括最邻近的 &lt;span class="math"&gt;\(k\)&lt;/span&gt; 个点的邻域 &lt;span class="math"&gt;\(N_k(x)\)&lt;/span&gt; 中确定 &lt;span class="math"&gt;\(x\)&lt;/span&gt; 的 类别 &lt;span class="math"&gt;\(y\)&lt;/span&gt;：&lt;/p&gt;
&lt;div class="math"&gt;$$y=\arg \max_{c_j}\sum_{x_i\in N_k(x)}I(y_i=c_i),\qquad i=1,2,\cdots,N;\ j=1,2,3,\cdots,K$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(I\)&lt;/span&gt; 为指示函数，条件为真时为 &lt;span class="math"&gt;\(1\)&lt;/span&gt;，条件为假时为 &lt;span class="math"&gt;\(0\)&lt;/span&gt;。&lt;/p&gt;
&lt;h2 id="ce-lue"&gt;策略&lt;/h2&gt;
&lt;h3 id="ju-chi-du-liang"&gt;距离度量&lt;/h3&gt;
&lt;p&gt;在二维、三维空间中通常使用欧氏距离来衡量两点间的远近关系（相似程度）：&lt;/p&gt;
&lt;div class="math"&gt;$$d=\sqrt{(x_2-x_1)^2+(y_2-y_1)^2}$$&lt;/div&gt;
&lt;div class="math"&gt;$$d=\sqrt{(x_2-x_1)^2+(y_2-y_1)^2+(z_2-z_1)^2}$$&lt;/div&gt;
&lt;p&gt;在 &lt;span class="math"&gt;\(\mathbf{R}^n\)&lt;/span&gt; 空间中，更通常的距离度量是 &lt;span class="math"&gt;\(L_p\)&lt;/span&gt; 距离，&lt;span class="math"&gt;\(L_p\)&lt;/span&gt; 距离是由距离度量的概念通过推广得到的，因此同样具有衡量两点间远近关系（相似程度）的作用。&lt;/p&gt;
&lt;p&gt;设 &lt;span class="math"&gt;\(x_i,x_j\in\mathbf{R}^n\)&lt;/span&gt;，&lt;span class="math"&gt;\(x_i\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(x_j\)&lt;/span&gt; 的 &lt;span class="math"&gt;\(L_p\)&lt;/span&gt; 距离由下式给出：&lt;/p&gt;
&lt;div class="math"&gt;$$L_p(x_i,x_j)=\left(\sum_{l=1}^n|x_i^{(l)}-x_j^{(l)}|^p\right)^{\frac{1}{p}}$$&lt;/div&gt;
&lt;h3 id="fen-lei-ce-lue"&gt;分类策略&lt;/h3&gt;
&lt;p&gt;k 近邻法的分类遵循多数表决规则，即输入实例附近 &lt;span class="math"&gt;\(k\)&lt;/span&gt; 个邻近的训练实例的大多数类决定了预测结果。因此 k 近邻法中的 &lt;span class="math"&gt;\(k\)&lt;/span&gt; 值决定了在一定的距离度量内选取分类「参考点」的数量，可以想知，若选取的 &lt;span class="math"&gt;\(k\)&lt;/span&gt; 值太小，分类结果会对最近邻的几个点敏感，模型就趋于复杂，更容易发生过拟合。&lt;/p&gt;
&lt;h2 id="suan-fa_1"&gt;算法&lt;/h2&gt;
&lt;h3 id="gou-zao-kd-shu"&gt;构造 kd 树&lt;/h3&gt;
&lt;p&gt;kd 树是一种二叉树，kd 树通过对 &lt;span class="math"&gt;\(\mathbf{R}^n\)&lt;/span&gt; 空间中每一个维度&lt;dot&gt;逐次地&lt;/dot&gt;二分，最终将整个特征空间划分为若干超矩形，kd 树的每一个结点（训练实例）对应于一个超矩形。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;算法 3.2&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：数据集 &lt;span class="math"&gt;\(T\)&lt;/span&gt;&lt;br/&gt;
输出：kd 树&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;选择 &lt;span class="math"&gt;\(x^{(1)}\)&lt;/span&gt; 为坐标轴，以所有实例的 &lt;span class="math"&gt;\(x_i^{(1)}\)&lt;/span&gt; 坐标中位数（若中位有两个数则取其中之一）为切分点，将 &lt;span class="math"&gt;\(x^{(1)}\)&lt;/span&gt; 切分为两部分。&lt;/li&gt;
&lt;li&gt;重复切分：深度为 &lt;span class="math"&gt;\(j\)&lt;/span&gt; 的结点，选择 &lt;span class="math"&gt;\(x^{(l)}\)&lt;/span&gt; 为切分坐标轴，&lt;span class="math"&gt;\(l=j\ \mathrm{mod}\ k+1\)&lt;/span&gt;。简单来说，&lt;ul&gt;
&lt;li&gt;对于 &lt;span class="math"&gt;\(\mathbf{R}^2\)&lt;/span&gt; 空间，步骤为 &lt;span class="math"&gt;\(x^{(1)}\rightarrow x^{(2)}\rightarrow x^{(1)}\rightarrow\cdots\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;对于 &lt;span class="math"&gt;\(\mathbf{R}^3\)&lt;/span&gt; 空间，步骤为 &lt;span class="math"&gt;\(x^{(1)}\rightarrow x^{(2)}\rightarrow x^{(3)}\rightarrow x^{(1)}\rightarrow\cdots\)&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;直至将所有实例点切分完成。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img alt="构造kd树" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7523?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;h3 id="sou-suo-kd-shu"&gt;搜索 kd 树&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;算法 3.3&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：kd 树，目标点 &lt;span class="math"&gt;\(S\)&lt;/span&gt;&lt;br/&gt;
输出：&lt;span class="math"&gt;\(S\)&lt;/span&gt; 的最近邻&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;首先在 kd 树中找出目标点 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 所属的区域，具体来说就是从根结点 &lt;span class="math"&gt;\(A\)&lt;/span&gt; 开始逐层向下访问，直到目标点 &lt;span class="math"&gt;\(S\)&lt;/span&gt;。在访问过程的具体算法方面，可以通过判断点 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 的坐标与切分点的大小关系来快速准确地确定访问路径。&lt;/li&gt;
&lt;li&gt;到达点 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 的父结点，以此结点作为 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 的「当前最近点」。&lt;/li&gt;
&lt;li&gt;递归向上层访问，每次访问进行两个操作：&lt;ol&gt;
&lt;li&gt;如果该点距离 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 更近，将其作为新的「当前最近点」。&lt;/li&gt;
&lt;li&gt;因为 kd 为二叉树，该点必然存在另一分支子结点，那么就需要检查分支下是否存在更近的点。具体做法是判断分支子结点的区域是否与以点 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 为圆心、以点 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 与「当前最近点」距离为半径的圆相交。&lt;ul&gt;
&lt;li&gt;若相交，则访问分支子结点并进行 3 步骤；&lt;/li&gt;
&lt;li&gt;若不相交，回退到上一层。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;最终回到根结点时，搜索结束。最后的「当前最近点」即为 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 的最近邻。&lt;/li&gt;
&lt;/ol&gt;
&lt;video controls=""&gt;
&lt;source src="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNumKI-2A9UTX-DXZs/root/content" type="video/mp4"/&gt;
&lt;/video&gt;
&lt;hr/&gt;
&lt;h2 id="references_1"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/33437381/"&gt;李航, 2019. 统计学习方法（第2版）. 清华大学出版社.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.bilibili.com/video/BV1GM4y1c78K?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=a5a1b5dd5c760997f9e16b7806d64651"&gt;向量的【范数】：模长的推广，柯西不等式 - 哔哩哔哩&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="统计学习方法"></category><category term="Machine learning"></category><category term="Algorithm"></category></entry><entry><title>《统计学习方法》第二章：感知机</title><link href="https://tseing.github.io/sui-sui-nian/2022-07-27-statistical-learning-chapter2.html" rel="alternate"></link><published>2022-07-27T00:00:00+08:00</published><updated>2022-07-27T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-07-27:/sui-sui-nian/2022-07-27-statistical-learning-chapter2.html</id><summary type="html">&lt;p&gt;《统计学习方法》第二章介绍了一种二分类模型——感知机，感知机具有直观的几何模型，有助于理解分类原理。感知机采用随机梯度下降策略选择最佳模型，随机梯度下降也是常用的一种最优化方法。&lt;/p&gt;</summary><content type="html">&lt;h2 id="mo-xing"&gt;模型&lt;/h2&gt;
&lt;h3 id="ding-yi"&gt;定义&lt;/h3&gt;
&lt;p&gt;感知机是&lt;dot&gt;二分类&lt;/dot&gt;的&lt;dot&gt;线性&lt;/dot&gt;分类模型，感知机定义为&lt;/p&gt;
&lt;div class="math"&gt;$$f(x)=\mathrm{sign}(w\cdot x+b)$$&lt;/div&gt;
&lt;div class="math"&gt;$$\begin{equation}
    \mathrm{sign}(x)=
    \begin{cases}
        +1, &amp;amp;x\geqslant 0\\
        -1, &amp;amp;x&amp;lt;0
    \end{cases}
\end{equation}$$&lt;/div&gt;
&lt;p&gt;其中输入 &lt;span class="math"&gt;\(x\in \mathbf{R}^n\)&lt;/span&gt; 表示实例的特征向量，输出 &lt;span class="math"&gt;\(y\in \{+1,-1\}\)&lt;/span&gt;表示实例的类别。模型参数 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 称为权值，参数 &lt;span class="math"&gt;\(b\)&lt;/span&gt; 称为偏置。&lt;/p&gt;
&lt;h3 id="ji-he-mo-xing"&gt;几何模型&lt;/h3&gt;
&lt;p&gt;若 &lt;span class="math"&gt;\(x\in \mathbf{R}^2\)&lt;/span&gt;,&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    w\cdot x+b&amp;amp;=0\\
    (w^{(1)},w^{(2)})^\mathrm{T}\cdot (x^{(1)},x^{(2)})^\mathrm{T}+b&amp;amp;=0\\
\end{align}$$&lt;/div&gt;
&lt;p&gt;该形式满足平面中的直线方程：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    (i,j)^\mathrm{T}\cdot (x^{(1)},x^{(2)})^\mathrm{T}+b&amp;amp;=0\\
    ix^{(1)}+jx^{(2)}+b&amp;amp;=0
\end{align}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(w=(i,j)^\mathrm{T}\)&lt;/span&gt; 为直线法向量。&lt;/p&gt;
&lt;p&gt;类似地，当 &lt;span class="math"&gt;\(x\in \mathbf{R}^3\)&lt;/span&gt; 时，感知机模型满足空间中的平面方程：&lt;/p&gt;
&lt;div class="math"&gt;$$ix^{(1)}+jx^{(2)}+kx^{(3)}+b=0$$&lt;/div&gt;
&lt;p&gt;且 &lt;span class="math"&gt;\(w=(i,j,k)^\mathrm{T}\)&lt;/span&gt; 为平面法向量。&lt;/p&gt;
&lt;p&gt;因此，感知机在模型本质上是在特征空间 &lt;span class="math"&gt;\(\mathbf{R}^n\)&lt;/span&gt; 中的一个超平面 &lt;span class="math"&gt;\(S\)&lt;/span&gt;，代表特征向量的点被超平面 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 分隔成两部分，其中参数 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 为超平面法向量。&lt;/p&gt;
&lt;p&gt;&lt;img alt="感知机的几何模型" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7509?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;超平面 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 也应符合 &lt;span class="math"&gt;\(\mathbf{R}^n\)&lt;/span&gt; 空间中的几何关系，所以在 &lt;span class="math"&gt;\(\mathbf{R}^n\)&lt;/span&gt; 空间中的任意一点 &lt;span class="math"&gt;\(x_0\)&lt;/span&gt; 到超平面的距离为&lt;/p&gt;
&lt;div class="math"&gt;$$d=\frac{1}{||w||}|w\cdot x_0+b|$$&lt;/div&gt;
&lt;p&gt;&lt;span class="math"&gt;\(||w||\)&lt;/span&gt; 是 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 的 &lt;span class="math"&gt;\(L_2\)&lt;/span&gt; 范数：&lt;/p&gt;
&lt;div class="math"&gt;$$||w||=\sqrt{\sum(w_i)^2}$$&lt;/div&gt;
&lt;p&gt;即法向量长度。&lt;/p&gt;
&lt;h4&gt;点到超平面距离&lt;/h4&gt;
&lt;p&gt;以 &lt;span class="math"&gt;\(x\in \mathbf{R}^2\)&lt;/span&gt; 为例，将超平面 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 方程转化为截距式：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
     ix^{(1)}+jx^{(2)}+b&amp;amp;=0\\
     \frac{x^{(1)}}{-\frac{b}{i}}+\frac{x^{(2)}}{-\frac{b}{j}}&amp;amp;=1
\end{align}$$&lt;/div&gt;
&lt;p&gt;超平面 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 在 &lt;span class="math"&gt;\(x^{(2)}\)&lt;/span&gt; 轴上的截距就为 &lt;span class="math"&gt;\(-\frac{b}{j}\)&lt;/span&gt;。过点 &lt;span class="math"&gt;\(x_0\)&lt;/span&gt; 作平行于 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 的超平面 &lt;span class="math"&gt;\(S_0\)&lt;/span&gt;，同样得到截距式：&lt;/p&gt;
&lt;div class="math"&gt;$$\frac{x^{(1)}}{-\frac{b_0}{i}}+\frac{x^{(2)}}{-\frac{b_0}{j}}=1$$&lt;/div&gt;
&lt;p&gt;超平面 &lt;span class="math"&gt;\(S_0\)&lt;/span&gt; 在 &lt;span class="math"&gt;\(x^{(2)}\)&lt;/span&gt; 轴上的截距为 &lt;span class="math"&gt;\(-\frac{b_0}{j}\)&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img alt="示意图" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7518?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;将 &lt;span class="math"&gt;\(d\)&lt;/span&gt; 平移至蓝色三角形中，&lt;span class="math"&gt;\(\boldsymbol{w}\)&lt;/span&gt; 是超平面的法向量，&lt;span class="math"&gt;\(\boldsymbol{w}=w=(i,j)^\mathrm{T}\)&lt;/span&gt;，根据向量夹角余弦公式&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \cos\theta&amp;amp;=|\cos(\boldsymbol{w},\boldsymbol{j})|\\
    &amp;amp;=\frac{|\boldsymbol{w}\cdot\boldsymbol{j}|}{|\boldsymbol{w}||\boldsymbol{j}|}
\end{align}$$&lt;/div&gt;
&lt;p&gt;&lt;span class="math"&gt;\(\boldsymbol{j}\)&lt;/span&gt; 为 &lt;span class="math"&gt;\(x^{(2)}\)&lt;/span&gt; 方向的单位向量，因此有&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    \cos\theta&amp;amp;=\frac{|(i,j)^\mathrm{T}\cdot(0,1)^\mathrm{T}|}{|\boldsymbol{w}|}\\
    &amp;amp;=\frac{|j|}{|\boldsymbol{w}|}
\end{align}$$&lt;/div&gt;
&lt;p&gt;在蓝色三角形中，&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    d&amp;amp;=\left|\frac{b}{j}-\frac{b_0}{j}\right|\cos\theta\\
    &amp;amp;=\frac{|b-b_0|}{|j|}\frac{|j|}{|\boldsymbol{w}|}\\
    &amp;amp;=\frac{|b-b_0|}{|\boldsymbol{w}|}\\
\end{align}$$&lt;/div&gt;
&lt;p&gt;由 &lt;span class="math"&gt;\(w\cdot x_0+b_0=0\)&lt;/span&gt; 得到 &lt;span class="math"&gt;\(b_0=-w\cdot x_0\)&lt;/span&gt;，代入就可以证得&lt;/p&gt;
&lt;div class="math"&gt;$$d=\frac{|w\cdot x_0+b|}{||w||}$$&lt;/div&gt;
&lt;h2 id="ce-lue_1"&gt;策略&lt;/h2&gt;
&lt;p&gt;感知机的分类情况可以归为以下几类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class="math"&gt;\(w\cdot x_i+b\geqslant0\)&lt;/span&gt;,&lt;span class="math"&gt;\(\ y_i=+1\)&lt;/span&gt;，分类正确；&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(w\cdot x_i+b\geqslant0\)&lt;/span&gt;,&lt;span class="math"&gt;\(\ y_i=-1\)&lt;/span&gt;，分类错误；&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(w\cdot x_i+b&amp;lt;0\)&lt;/span&gt;,&lt;span class="math"&gt;\(\ y_i=-1\)&lt;/span&gt;，分类正确；&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(w\cdot x_i+b&amp;lt;0\)&lt;/span&gt;,&lt;span class="math"&gt;\(\ y_i=+1\)&lt;/span&gt;，分类错误。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因此分类错误的数据点 &lt;span class="math"&gt;\((x_i,y_i)\)&lt;/span&gt; 满足&lt;/p&gt;
&lt;div class="math"&gt;$$-y_i(w\cdot x_i+b)&amp;gt;0$$&lt;/div&gt;
&lt;p&gt;若超平面 &lt;span class="math"&gt;\(S\)&lt;/span&gt; 误分类的点的集合为 &lt;span class="math"&gt;\(M\)&lt;/span&gt;，那么误分类点到超平面的距离之和为&lt;/p&gt;
&lt;div class="math"&gt;$$\sum_{x_i\in M}\left[-\frac{1}{||w||}y_i(w\cdot x_i+b)\right]$$&lt;/div&gt;
&lt;p&gt;略去 &lt;span class="math"&gt;\(\frac{1}{||w||}\)&lt;/span&gt;（见第七章），得到&lt;dot&gt;经验风险函数&lt;/dot&gt;：&lt;/p&gt;
&lt;div class="math"&gt;$$L(w,b)=-\sum_{x_i\in M}y_i(w\cdot x_i+b)$$&lt;/div&gt;
&lt;p&gt;感知机的学习策略就是在假设空间中选取 &lt;span class="math"&gt;\(L(w,b)\)&lt;/span&gt; 最小的模型参数 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 和 &lt;span class="math"&gt;\(b\)&lt;/span&gt;。&lt;/p&gt;
&lt;h2 id="suan-fa"&gt;算法&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://github.com/Tseing/Statistical_Algorithms/blob/master/perceptron.py"&gt;&lt;i class="fa fa-github-alt"&gt;&lt;/i&gt; Code Here.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;感知机的学习算法就是求解以下最优化问题的算法：&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{w,b}L(w,b)=-\sum_{x_i\in M}y_i(w\cdot x_i+b)$$&lt;/div&gt;
&lt;h3 id="sui-ji-ti-du-xia-jiang-fa"&gt;随机梯度下降法&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;任意选取超平面 &lt;span class="math"&gt;\(w_0\cdot x+b_0=0\)&lt;/span&gt;;&lt;/li&gt;
&lt;li&gt;随机选取误分类点使 &lt;span class="math"&gt;\(L(w,b)\)&lt;/span&gt; 梯度下降；&lt;/li&gt;
&lt;li&gt;不断更新 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt;，直至 &lt;span class="math"&gt;\(L(w,b)=0\)&lt;/span&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;二元函数 &lt;span class="math"&gt;\(f(x,y)\)&lt;/span&gt; 在 &lt;span class="math"&gt;\((x_0,y_0)\)&lt;/span&gt; 处的梯度定义为&lt;/p&gt;
&lt;div class="math"&gt;$$\mathbf{grad}\ f(x_0,y_0)=\nabla f(x_0,y_0)=f_x(x_0,y_0)\boldsymbol{i}+f_y(x_0,y_0)\boldsymbol{j}$$&lt;/div&gt;
&lt;p&gt;因此损失函数 &lt;span class="math"&gt;\(L(w,b)\)&lt;/span&gt; 的梯度为&lt;/p&gt;
&lt;div class="math"&gt;$$\nabla_wL(w,b)=\frac{\partial\left[-\sum_{x_i\in M}\color{orangered}{y_i}(w\cdot \color{orangered}{x_i}+b)\right]}{\partial w}=-\sum_{x_i\in M}\color{orangered}{y_ix_i}$$&lt;/div&gt;
&lt;div class="math"&gt;$$\nabla_bL(w,b)=\frac{\partial\left[-\sum_{x_i\in M}\color{orangered}{y_i}(w\cdot x_i+b)\right]}{\partial b}=-\sum_{x_i\in M}\color{orangered}{y_i}$$&lt;/div&gt;
&lt;p&gt;随机选择误分类点 &lt;span class="math"&gt;\((x_i,y_i)\)&lt;/span&gt; 更新 &lt;span class="math"&gt;\(w\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt;，使 &lt;span class="math"&gt;\(L(w,b)\)&lt;/span&gt; 沿梯度方向下降：&lt;/p&gt;
&lt;div class="math"&gt;$$w\leftarrow w+\eta y_ix_i$$&lt;/div&gt;
&lt;div class="math"&gt;$$b\leftarrow b+\eta y_i$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(\eta\ (0&amp;lt;\eta\leqslant1)\)&lt;/span&gt; 称为步长，不断迭代至 &lt;span class="math"&gt;\(L(w,b)=0\)&lt;/span&gt;。&lt;/p&gt;
&lt;h3 id="yuan-shi-xing-shi-suan-fa"&gt;原始形式算法&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;算法2.1&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：训练集 &lt;span class="math"&gt;\(T\)&lt;/span&gt;，学习率 &lt;span class="math"&gt;\(\eta\)&lt;/span&gt;&lt;br/&gt;
输出：&lt;span class="math"&gt;\(w\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt; ，感知机模型 &lt;span class="math"&gt;\(f(x)=\mathrm{sign}(w\cdot x+b)\)&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;设定步长 &lt;span class="math"&gt;\(\eta\)&lt;/span&gt;，选取初值 &lt;span class="math"&gt;\(w_0\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b_0\)&lt;/span&gt;，一般为 &lt;span class="math"&gt;\(w_0=0\)&lt;/span&gt;，&lt;span class="math"&gt;\(b_0=0\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;选取点 &lt;span class="math"&gt;\((x_i,y_i)\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;若 &lt;span class="math"&gt;\(y_i(w\cdot x_i+b)\leqslant0\)&lt;/span&gt;，&lt;div class="math"&gt;$$w\leftarrow w+\eta y_ix_i$$&lt;/div&gt;
&lt;div class="math"&gt;$$b\leftarrow b+\eta y_i$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;重复步骤（2），直至没有误分类点，即 &lt;span class="math"&gt;\(L(w,b)=0\)&lt;/span&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="dui-ou-xing-shi-suan-fa"&gt;对偶形式算法&lt;/h3&gt;
&lt;p&gt;经过数次以下迭代步骤：&lt;/p&gt;
&lt;div class="math"&gt;$$w\leftarrow w+\eta y_ix_i$$&lt;/div&gt;
&lt;div class="math"&gt;$$b\leftarrow b+\eta y_i$$&lt;/div&gt;
&lt;p&gt;&lt;dot&gt;最终的&lt;/dot&gt; &lt;span class="math"&gt;\(w\)&lt;/span&gt; 和 &lt;span class="math"&gt;\(b\)&lt;/span&gt; 可以表示为&lt;/p&gt;
&lt;div class="math"&gt;$$w=\sum_{i=1}^N \alpha_iy_ix_i$$&lt;/div&gt;
&lt;div class="math"&gt;$$b=\sum_{i=1}^N\alpha_iy_i$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(\alpha_i=n_i\eta\)&lt;/span&gt;，&lt;span class="math"&gt;\(n_i\)&lt;/span&gt; 表示点 &lt;span class="math"&gt;\((x_i,y_i)\)&lt;/span&gt; 被误分类的次数。也就是说，在迭代的每一次过程中，被误分类的点 &lt;span class="math"&gt;\((x_i,y_i)\)&lt;/span&gt; 都不断向超平面靠近，直至位于超平面的另一侧。&lt;/p&gt;
&lt;p&gt;最后得到的感知机模型应为&lt;/p&gt;
&lt;div class="math"&gt;$$f(x)=\mathrm{sign}\left(\sum_{i=1}^N\alpha_iy_ix_i\cdot x+b\right)$$&lt;/div&gt;
&lt;p&gt;为了与 &lt;span class="math"&gt;\(x=x_i\)&lt;/span&gt; 代入后的模型相区别，表示为&lt;/p&gt;
&lt;div class="math"&gt;$$f(x)=\mathrm{sign}\left(\sum_{j=1}^N\alpha_jy_jx_j\cdot x+b\right)$$&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;算法2.2&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;输入：训练集 &lt;span class="math"&gt;\(T\)&lt;/span&gt;，学习率 &lt;span class="math"&gt;\(\eta\)&lt;/span&gt;&lt;br/&gt;
输出：&lt;span class="math"&gt;\(\alpha\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b\)&lt;/span&gt; ，感知机模型 &lt;span class="math"&gt;\(f(x)=\mathrm{sign}\left(\sum_{j=1}^N\alpha_iy_jx_j\cdot x+b\right)\)&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;设定步长 &lt;span class="math"&gt;\(\eta\)&lt;/span&gt;，选取初值 &lt;span class="math"&gt;\(\alpha\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(b_0\)&lt;/span&gt;，一般为 &lt;span class="math"&gt;\(\alpha=(\alpha_1,\alpha_2,\cdots,\alpha_N)^\mathrm{T}=0\)&lt;/span&gt;，&lt;span class="math"&gt;\(b_0=0\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;选取点 &lt;span class="math"&gt;\((x_i,y_i)\)&lt;/span&gt;；&lt;/li&gt;
&lt;li&gt;若&lt;span class="math"&gt;\(y_i\left(\sum_{j=1}^N\alpha_jy_jx_j\cdot x_i+b\right)\leqslant0\)&lt;/span&gt;，&lt;div class="math"&gt;$$\alpha_i\leftarrow\alpha_i+\eta$$&lt;/div&gt;
&lt;div class="math"&gt;$$b\leftarrow b+\eta y_i$$&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;重复步骤 2，直至没有误分类点。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;考虑迭代的判断条件&lt;/p&gt;
&lt;div class="math"&gt;$$y_i\left(\sum_{j=1}^N\alpha_jy_j\vec{x_j}\cdot \vec{x_i}+b\right)\leqslant0$$&lt;/div&gt;
&lt;p&gt;每次判断都需要计算&lt;/p&gt;
&lt;div class="math"&gt;$$\sum_{j=1}^N\alpha_jy_j\color{orangered}{\vec{x_j}\cdot \vec{x_i}}=\alpha_1y_1\color{orangered}{\vec{x_1}\cdot\vec{x_i}}+\alpha_2y_2\color{orangered}{\vec{x_2}\cdot\vec{x_i}}+\cdots+\alpha_Ny_N\color{orangered}{\vec{x_N}\cdot\vec{x_i}}$$&lt;/div&gt;
&lt;p&gt;因此可以将内积以矩阵形式存放，即 Gram 矩阵：&lt;/p&gt;
&lt;div class="math"&gt;$$\boldsymbol{G}=[x_i\cdot x_j]_{N\times N}=\begin{bmatrix}
    x_1\cdot x_1 &amp;amp;\cdots &amp;amp;x_1\cdot x_N\\
    \vdots       &amp;amp;\ddots &amp;amp;\vdots\\
    x_N\cdot x_1 &amp;amp;\cdots &amp;amp;x_N\cdot x_N
\end{bmatrix}$$&lt;/div&gt;
&lt;p&gt;由于内积的性质，Gram 矩阵实际上是一个对称矩阵。&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references_1"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/33437381/"&gt;李航, 2019. 统计学习方法（第2版）. 清华大学出版社.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="统计学习方法"></category><category term="Machine learning"></category><category term="Algorithm"></category></entry><entry><title>《统计学习方法》第一章：概论</title><link href="https://tseing.github.io/sui-sui-nian/2022-07-21-statistical-learning-chapter1.html" rel="alternate"></link><published>2022-07-21T00:00:00+08:00</published><updated>2022-07-21T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-07-21:/sui-sui-nian/2022-07-21-statistical-learning-chapter1.html</id><summary type="html">&lt;p&gt;《统计学习方法》的第一章主要介绍了统计学习的基本概念与监督学习的分类。&lt;/p&gt;</summary><content type="html">&lt;h2 id="ji-ben-gai-nian"&gt;基本概念&lt;/h2&gt;
&lt;h3 id="tong-ji-xue-xi-guo-cheng"&gt;统计学习过程&lt;/h3&gt;
&lt;p&gt;统计学习主要基于数据概率构建概率统计模型并运用模型分析和预测数据，统计学习的主要过程可以归纳为：&lt;/p&gt;
&lt;div class="math"&gt;$$\boxed{\frac{训练数据集}{T=\{(x_i,y_i)\}}}\stackrel{学习}{\Longrightarrow}\boxed{\frac{模型}{P(Y|X)\ \mathrm{or}\ Y=f(X)}}\stackrel{预测}{\Longrightarrow}y_{N+1}$$&lt;/div&gt;
&lt;p&gt;其中，训练集表示为：&lt;/p&gt;
&lt;div class="math"&gt;$$
T=\{ (x_1,y_1),(x_2,y_2),\cdots,(x_N,y_N) \}
$$&lt;/div&gt;
&lt;p&gt;其中输入变量 &lt;span class="math"&gt;\(X\)&lt;/span&gt; 的取值 &lt;span class="math"&gt;\(x_i\)&lt;/span&gt; 为特征向量：&lt;/p&gt;
&lt;div class="math"&gt;$$
x_i=(x^{(1)}_i,x^{(2)}_i,\cdots,x^{(n)}_i)^\mathrm{T}
$$&lt;/div&gt;
&lt;p&gt;输入变量 &lt;span class="math"&gt;\(X\)&lt;/span&gt; 与输出变量 &lt;span class="math"&gt;\(Y\)&lt;/span&gt; 遵循联合概率分布 &lt;span class="math"&gt;\(P(X,Y)\)&lt;/span&gt;，经过学习得到的模型可以是概率模型 &lt;span class="math"&gt;\(P(Y|X)\)&lt;/span&gt;，也可以是非概率模型 &lt;span class="math"&gt;\(Y=f(X)\)&lt;/span&gt;。&lt;/p&gt;
&lt;h3 id="gai-lu-mo-xing-yu-fei-gai-lu-mo-xing"&gt;概率模型与非概率模型&lt;/h3&gt;
&lt;p&gt;在监督学习中，概率模型为条件概率分布形式 &lt;span class="math"&gt;\(P(y|x)\)&lt;/span&gt;，非概率模型为决策函数形式 &lt;span class="math"&gt;\(y=f(x)\)&lt;/span&gt;；在无监督学习中，概率模型为 &lt;span class="math"&gt;\(P(z|x)\)&lt;/span&gt; 或 &lt;span class="math"&gt;\(P(x|z)\)&lt;/span&gt;，非概率模型为隐函数形式 &lt;span class="math"&gt;\(z=g(x)\)&lt;/span&gt;。&lt;/p&gt;
&lt;div class="math"&gt;$$P(y|x)\underset{归一化}{\overset{最大化}{\rightleftharpoons}} y=f(x)$$&lt;/div&gt;
&lt;p&gt;由于 &lt;span class="math"&gt;\(P(y|x)\)&lt;/span&gt; 与 &lt;span class="math"&gt;\(y=f(x)\)&lt;/span&gt; 可以按照上述过程转化，所以概率模型与非概率模型不仅仅是在表现形式存在差异，更为重要的是在内部结构上，概率模型的变量、参数符合一定的联合概率分布，这也决定了概率模型符合以下基本概率公式：&lt;/p&gt;
&lt;div class="math"&gt;$$P(x)=\sum_y P(x,y)$$&lt;/div&gt;
&lt;div class="math"&gt;$$P(x,y)=P(x)P(y|x)$$&lt;/div&gt;
&lt;h2 id="tong-ji-xue-xi-fang-fa-san-yao-su_1"&gt;统计学习方法三要素&lt;/h2&gt;
&lt;h3 id="mo-xing"&gt;模型&lt;/h3&gt;
&lt;p&gt;模型就是需要学习的条件分布概率或决策函数，由假设模型构成的集合称为假设空间，可以表示为：&lt;/p&gt;
&lt;div class="math"&gt;$$\mathcal{F}=\{f|Y=f_\theta(X),\theta\in\mathbf{R}^n\}$$&lt;/div&gt;
&lt;p&gt;或&lt;/p&gt;
&lt;div class="math"&gt;$$\mathcal{F}=\{P|P_\theta(Y|X),\theta\in\mathbf{R}^n\}$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(\theta\)&lt;/span&gt; 为模型的参数向量，&lt;span class="math"&gt;\(\mathbf{R}^n\)&lt;/span&gt; 称为参数空间。&lt;/p&gt;
&lt;h3 id="ce-lue"&gt;策略&lt;/h3&gt;
&lt;p&gt;在假设空间中选择最优模型的方法称之为策略。&lt;/p&gt;
&lt;h4&gt;损失函数和风险函数&lt;/h4&gt;
&lt;p&gt;用损失函数能够衡量模型预测值 &lt;span class="math"&gt;\(f(X)\)&lt;/span&gt; 与真实值 &lt;span class="math"&gt;\(Y\)&lt;/span&gt; 的差距，从而评估模型的优劣。损失函数记作 &lt;span class="math"&gt;\(L(Y,f(X))\)&lt;/span&gt;，例如常见的平方损失函数定义为：&lt;/p&gt;
&lt;div class="math"&gt;$$L(Y,f(X))=(Y-f(X))^2$$&lt;/div&gt;
&lt;p&gt;输入变量 &lt;span class="math"&gt;\(X\)&lt;/span&gt; 与输出变量 &lt;span class="math"&gt;\(Y\)&lt;/span&gt; 遵循联合概率分布 &lt;span class="math"&gt;\(P(X,Y)\)&lt;/span&gt;，损失函数的期望为：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    R_{\mathrm{exp}}(f)&amp;amp;=E_P[L(Y,f(X))]\\
    &amp;amp;= \int_{\mathcal{X}\times\mathcal{Y}}L(y,f(x))P(x,y)\mathrm{d}x\mathrm{d}y\\
\end{align}$$&lt;/div&gt;
&lt;p&gt;该期望就是模型 &lt;span class="math"&gt;\(f(X)\)&lt;/span&gt; 在联合分布 &lt;span class="math"&gt;\(P(X,Y)\)&lt;/span&gt; 平均意义下的损失，称为风险函数。但由于 &lt;span class="math"&gt;\(P(X,Y)\)&lt;/span&gt; 无法确定，风险函数也无法计算，因此定义了能够确定的经验风险。经验风险是模型 &lt;span class="math"&gt;\(f(X)\)&lt;/span&gt; 在训练集 &lt;span class="math"&gt;\(T\)&lt;/span&gt; 中的平均损失：&lt;/p&gt;
&lt;div class="math"&gt;$$R_{\mathrm{rmp}}(f)=\frac{1}{N}\sum_{i=1}^NL(y_i,f(x_i))$$&lt;/div&gt;
&lt;p&gt;当样本容量 &lt;span class="math"&gt;\(N\)&lt;/span&gt; 趋向于无穷时，经验风险 &lt;span class="math"&gt;\(R_{\mathrm{rmp}}\)&lt;/span&gt; 趋于期望风险 &lt;span class="math"&gt;\(R_{\mathrm{exp}}\)&lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;经验风险最小化与结构风险最小化&lt;/h4&gt;
&lt;p&gt;经验风险最小化策略通过寻找经验风险最小的模型作为最优模型，经验风险最小化策略需要足够大的样本容量，否则容易出现过拟合。经验风险最小化策本质为求解最优化问题：&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{f\in\mathcal{F}}\frac{1}{N}L(y_i,f(x_i))$$&lt;/div&gt;
&lt;p&gt;结构风险最小化策略是防止过拟合的策略，其本质为求解最优化问题：&lt;/p&gt;
&lt;div class="math"&gt;$$\min_{f\in\mathcal{F}}\frac{1}{N}L(y_i,f(x_i))+\lambda J(f)$$&lt;/div&gt;
&lt;p&gt;其中 &lt;span class="math"&gt;\(J(f)\)&lt;/span&gt; 是模型的复杂度，表示对复杂模型的惩罚，&lt;span class="math"&gt;\(\lambda\)&lt;/span&gt; 为系数。&lt;/p&gt;
&lt;h3 id="suan-fa"&gt;算法&lt;/h3&gt;
&lt;p&gt;算法是学习模型的具体计算方法。&lt;/p&gt;
&lt;h2 id="fan-hua_1"&gt;泛化&lt;/h2&gt;
&lt;h3 id="fan-hua-wu-chai"&gt;泛化误差&lt;/h3&gt;
&lt;p&gt;泛化能力是学习得到的模型对未知数据的预测能力，学习得到的模型对未知项进行预测的误差称为泛化误差，泛化误差等同于模型 &lt;span class="math"&gt;\(\hat{f}\)&lt;/span&gt; 的期望风险：&lt;/p&gt;
&lt;div class="math"&gt;$$\begin{align}
    R_{\mathrm{exp}}(\hat{f})&amp;amp;=E_P[L(Y,\hat{f}(X))]\\
    &amp;amp;= \int_{\mathcal{X}\times\mathcal{Y}}L(y,\hat{f}(x))P(x,y)\mathrm{d}x\mathrm{d}y\\
\end{align}$$&lt;/div&gt;
&lt;h3 id="er-fen-lei-wen-ti-de-fan-hua-wu-chai-shang-jie"&gt;二分类问题的泛化误差上界&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;定理 1.1&lt;/strong&gt; 对于二分类问题，当假设空间是有限个函数的集合
 &lt;span class="math"&gt;\(\mathcal{F}=\{ f_1,f_2,\cdots,f_d\}\)&lt;/span&gt; 时，对任意一个函数 &lt;span class="math"&gt;\(f\in \mathcal{F}\)&lt;/span&gt;，至少以概率 &lt;span class="math"&gt;\(1-\delta\)&lt;/span&gt;，&lt;span class="math"&gt;\(0&amp;lt;\delta&amp;lt;1\)&lt;/span&gt;，以下不等式成立（证明见参考）：&lt;/p&gt;
&lt;div class="math"&gt;$$R(f)\leq\hat{R}(f)+\varepsilon(d,N,\delta)$$&lt;/div&gt;
&lt;div class="math"&gt;$$\varepsilon(d,N\delta)=\sqrt{\frac{1}{2N}(\log d+\log\frac{1}{\delta})}$$&lt;/div&gt;
&lt;p&gt;&lt;span class="math"&gt;\(R(f)\)&lt;/span&gt; 为泛化误差，&lt;span class="math"&gt;\(\hat{R}(f)\)&lt;/span&gt; 为训练误差。&lt;/p&gt;
&lt;p&gt;泛化误差上界的性质：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;样本容量增加，泛化上界趋于0；&lt;/li&gt;
&lt;li&gt;假设空间越大，泛化上界越大。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="jian-du-xue-xi-de-ying-yong_1"&gt;监督学习的应用&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;输入变量 X&lt;/th&gt;
&lt;th&gt;输出变量 Y&lt;/th&gt;
&lt;th&gt;问题&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;离散变量&lt;/td&gt;
&lt;td&gt;分类&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;变量序列&lt;/td&gt;
&lt;td&gt;变量序列&lt;/td&gt;
&lt;td&gt;标注&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;连续变量&lt;/td&gt;
&lt;td&gt;连续变量&lt;/td&gt;
&lt;td&gt;回归&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr/&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://book.douban.com/subject/33437381/"&gt;李航, 2019. 统计学习方法（第2版）. 清华大学出版社.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.cnblogs.com/pastispast/p/12589078.html"&gt;二分类问题泛化误差上界的详细证明 - p_is_p - 博客园&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="碎碎念"></category><category term="统计学习方法"></category><category term="Machine learning"></category></entry><entry><title>在 Linux 上使用 OneDrive 作为博客图床</title><link href="https://tseing.github.io/sui-sui-nian/2022-07-14-onedrive-as-image-host.html" rel="alternate"></link><published>2022-07-14T00:00:00+08:00</published><updated>2022-07-14T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-07-14:/sui-sui-nian/2022-07-14-onedrive-as-image-host.html</id><summary type="html">&lt;p&gt;在博客中插入图片一直是一件头疼事，互联网上的各类图床工具都难令人完全满意。使用 OneDrive 作为图床或是一个很好的选择，这在 Windows 上已经有了成熟的方案，而在 Linux 上就有些麻烦，需要借助些额外的工具。&lt;/p&gt;</summary><content type="html">&lt;p&gt;在个人博客中，图片是不可或缺的，而在 &lt;code&gt;.md&lt;/code&gt; 文件中插入图片必须使用图片的直链，因此通常又需要图床等额外工具。由于国内市场的图床工具良莠不齐，没有精力仔细挑选，再就是把数据交付给第三方手中多少有些不放心。想&lt;/p&gt;
&lt;p&gt;到订阅 Microsoft Office 时附赠了 1 TB 的 OneDrive 容量，正好可以利用起来。使用 OneDrive 作为图床的好处就在于数据在自己的手中，不用担心某天突然挂掉，同时在多平台（Windows、iPad 和 Android）都有 OneDrive 应用，很方便同步数据。但是很遗憾，由于国内的环境，OneDrive 的网页版是打不开的，这就不能通过网页版直接生成图片链接，必须采用「绕道通行」的方法生成直链。&lt;/p&gt;
&lt;p&gt;Windows 系统自带 OneDrive 应用，可以直接使用桌面应用进行文件同步，借助 &lt;a href="https://github.com/Richasy/Img-Share"&gt;Img Share&lt;/a&gt; 生成图片链接。Img Share 后来被 &lt;a href="https://apps.microsoft.com/store/detail/picture-share/9PHWZ3QL0HN3?hl=en-us&amp;amp;gl=US"&gt;Picture Share&lt;/a&gt; 代替，在 Microsoft Store 中就可以直接下载到。Picture Share 十分容易上手，界面简洁且功能齐全，具体的设置方法可以参考&lt;a href="https://wzblog.fun/posts/b036879a/"&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我撰写博客文章的工作环境是 Linux 系统，Linux 系统中没有 OneDrive 应用和上述 UWP 应用，也就不能使用上面的方法。本文就将介绍如何在 Linux 系统下使用 OneDrive 作为个人博客的图床并使用 ZFile 管理云盘文件。&lt;/p&gt;
&lt;h2 id="onedrive-wen-jian-lian-jie-de-sheng-cheng-fang-shi"&gt;OneDrive 文件链接的生成方式&lt;/h2&gt;
&lt;p&gt;OneDrive 的网页应用直接提供了嵌入代码，可以直接贴在文章中。但因为科学上网时上传速度相当感人，使用起来还是太过麻烦。虽然无法访问 OneDrive 网页，但 OneDrive 在国内的其他功能都是正常的，包括生成的分享链接，所以直接借用官方 API 生成链接的方案是可行的。发现有人已经写好了&lt;a href="https://github.com/harrisoff/onedrive-image-hosting"&gt;相关项目&lt;/a&gt;，点开项目右侧的链接登录自己的 OneDrive 账号后将生成的链接直接插入到 Markdown 文档就可以啦。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-markdown"&gt;![图片名称](https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUZNJKuT3c_gI4Jh/root/content)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="an-zhuang-zfile"&gt;安装 ZFile&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://github.com/zhaojun1998/zfile"&gt;ZFile&lt;/a&gt; 是一款在线网盘程序，支持包括 OneDrive 在内的多种存储源。ZFile 可以代替其他平台的 OneDrive 应用来管理云盘中的文件，实现同步、上传、下载等功能。ZFile 也能生成文件直链插入文章，但是这个功能需要云服务器，抱着能省则省的态度，就等以后再折腾，这里仅使用 ZFile 来管理 OneDrive。&lt;/p&gt;
&lt;p&gt;在 Linux 系统使用 ZFile 首先需要安装依赖：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-shell"&gt;# Debian 10
$ apt update &amp;amp;&amp;amp; apt install -y apt-transport-https software-properties-common ca-certificates dirmngr gnupg
$ wget -qO - https://adoptopenjdk.jfrog.io/adoptopenjdk/api/gpg/key/public | apt-key add -
$ add-apt-repository --yes https://adoptopenjdk.jfrog.io/adoptopenjdk/deb/
$ apt update &amp;amp;&amp;amp; apt install -y adoptopenjdk-8-hotspot-jre
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;下载 ZFile：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-shell"&gt;$ export ZFILE_INSTALL_PATH=~/zfile
$ mkdir -p $ZFILE_INSTALL_PATH &amp;amp;&amp;amp; cd $ZFILE_INSTALL_PATH
$ wget https://c.jun6.net/ZFILE/zfile-release.war
$ unzip zfile-release.war &amp;amp;&amp;amp; rm -rf zfile-release.war
$ chmod +x $ZFILE_INSTALL_PATH/bin/*.sh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;ZFILE_INSTALL_PATH&lt;/code&gt; 指定了安装路径，可以自行修改。&lt;/p&gt;
&lt;h2 id="qi-dong-bing-pei-zhi-zfile"&gt;启动并配置 ZFile&lt;/h2&gt;
&lt;p&gt;通过以下命令启动 ZFile：&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-shell"&gt;$ ~/zfile/bin/start.sh       # 启动项目
$ ~/zfile/bin/stop.sh        # 停止项目
$ ~/zfile/bin/restart.sh     # 重启项目
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;启动项目后，默认开放在 8080 端口，使用 &lt;code&gt;localhost:8080&lt;/code&gt; 进入 ZFile：&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUeZko02sAbyr5jh/root/content"&gt;&lt;img alt="NoCaption" src="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUeZko02sAbyr5jh/root/content"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;首次开启时需要注册管理员账号，登录进入系统后，首先配置存储源，选择存储策略为 &lt;code&gt;OneDrive&lt;/code&gt;，启用文件操作。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUUBsSGYxpEV6Frp/root/content"&gt;&lt;img alt="NoCaption" src="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUUBsSGYxpEV6Frp/root/content"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;点击链接登录 OneDrive 账号获取令牌，填写完成后即可保存设置。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUPS4i5g5F_-nR4T/root/content"&gt;&lt;img alt="NoCaption" src="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUPS4i5g5F_-nR4T/root/content"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;设置成功后在存储源中就可以看见 OneDrive 标志，并且显示刷新成功，这样 ZFile 就已经正常工作了。&lt;/p&gt;
&lt;p&gt;&lt;div class="lightgallery"&gt;&lt;a data-sub-html="NoCaption" href="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUSMlwPi40T-1Um4/root/content"&gt;&lt;img alt="NoCaption" src="https://api.onedrive.com/v1.0/shares/s!AtseC45rsRhNuUSMlwPi40T-1Um4/root/content"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;/p&gt;
&lt;h2 id="shi-yong-zfile-guan-li-onedrive"&gt;使用 ZFile 管理 OneDrive&lt;/h2&gt;
&lt;p&gt;在地址栏中输入 &lt;code&gt;localhost:8080&lt;/code&gt; 进入存储界面，在这里就理应能够看到 OneDrive 中存储的文件了，可以使用其他设备辅助测试是否能够正常上传或删除文件。&lt;/p&gt;
&lt;p&gt;如果有一台 VPS，在 VPS 上启动 ZFile 后，通过 &lt;code&gt;vps-ip:[port]&lt;/code&gt; 也能进入同样的管理界面。只需要将图片文件上传至 OneDrive，使用ZFile就可以得到文件的直链，不止是图片，这种方法还可以在 &lt;code&gt;.md&lt;/code&gt; 中插入音频或是视频文件，甚至搭建个人下载站，而且完全不占用服务器存储。值得注意的是，ZFile获得的文件「直链」并不是真正的直链，而是经过一次转发，可能会影响访问速度。&lt;/p&gt;
&lt;p&gt;&lt;img alt="ZFile获取直链流程" src="https://storage.live.com/items/4D18B16B8E0B1EDB!7369?authkey=ALYpzW-ZQ_VBXTU"/&gt;&lt;/p&gt;
&lt;p&gt;因为 ZFile 向 OneDrive 请求得到是预览链接或临时下载链接 &lt;code&gt;1drv.com/...&lt;/code&gt;，该链接在一段时间后就会失效，也不能直接用作图床。当用户每次访问 ZFile 直链 &lt;code&gt;vps-ip:[port]/...&lt;/code&gt; 时，实际得到的都是 ZFile 转发得到的 OneDrive 临时链接。&lt;/p&gt;</content><category term="碎碎念"></category><category term="Blog"></category><category term="OneDrive"></category><category term="Linux"></category></entry><entry><title>使用 Pelican 发布文章的流程</title><link href="https://tseing.github.io/sui-sui-nian/2022-07-12-pelican-to-publish.html" rel="alternate"></link><published>2022-07-12T00:00:00+08:00</published><updated>2022-07-12T00:00:00+08:00</updated><author><name>Leo</name></author><id>tag:tseing.github.io,2022-07-12:/sui-sui-nian/2022-07-12-pelican-to-publish.html</id><summary type="html">&lt;p&gt;经过一番折腾，我的博客终于可以工作啦。但也所谓的「工作」也只是能显示罢了，后续的美化和插件部署免不了又是一通的麻烦事。暂且不论这些，先记录下使用 Pelican 在 GitHub Pages 上发布博客文章的流程。&lt;/p&gt;</summary><content type="html">&lt;h2 id="articles-or-pages"&gt;Articles or Pages?&lt;/h2&gt;
&lt;p&gt;Pelican 中有 articles 与 pages 的概念，在创建页面时应当首先区分二者。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;articles&lt;/strong&gt; 指具有时间戳的内容，例如博客文章等，直接创建在&lt;code&gt;content&lt;/code&gt;文件夹中。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pages&lt;/strong&gt; 指与时间无关、展示固定内容的页面，需要创建在&lt;code&gt;content/pages&lt;/code&gt;文件夹下。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="zhuan-xie-wen-zhang"&gt;撰写文章&lt;/h2&gt;
&lt;h3 id="jupyter-notebook-fang-shi"&gt;Jupyter Notebook 方式&lt;/h3&gt;
&lt;p&gt;Jupyter Notebook 能够保存下代码的输入与输出信息，特别适合用于展示程序输出的图形。首先在&lt;code&gt;content&lt;/code&gt;目录中创建&lt;code&gt;.nbdata&lt;/code&gt;与&lt;code&gt;.ipynb&lt;/code&gt;的同名文件。&lt;code&gt;.nbdata&lt;/code&gt;文件中保存了文章的结构信息，而&lt;code&gt;.ipynb&lt;/code&gt;使用 Jupyter Notebook 保存了文章的具体内容。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;title: # 文章标题
slug: # 文章地址
date: # 时间
category: # 类别
tags: # 标签
author: # 作者
summary: # 概要

# 其他不常用信息
modified: # 修改时间
keywords: # 仅用于html内容
authors: # 多作者
lang: # 语言
translation: # 是否属于译文
status: # draft, hidden, or published
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="markdown-fang-shi"&gt;Markdown 方式&lt;/h3&gt;
&lt;p&gt;使用 Markdown 语言是写博客最为简单普遍的方式，在&lt;code&gt;content&lt;/code&gt;文件夹中创建&lt;code&gt;.md&lt;/code&gt;文件，在开始部分首先输入与&lt;code&gt;.nbdata&lt;/code&gt;相同的文章信息后，就可以直接开始撰写正文。&lt;/p&gt;
&lt;h2 id="sheng-cheng-jing-tai-wang-ye_1"&gt;生成静态网页&lt;/h2&gt;
&lt;p&gt;在撰写文章后，进入虚拟环境，在 &lt;code&gt;blog&lt;/code&gt; 文件夹中使用 &lt;code&gt;Pelican&lt;/code&gt; 生成 &lt;code&gt;.html&lt;/code&gt; 文件。&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-shell"&gt;$ source ./venv/bin/activate
$ pelican content -s publishconf.py
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;最后将 &lt;code&gt;output&lt;/code&gt; 文件夹同步至 GitHub 中 &lt;code&gt;&amp;lt;username&amp;gt;.github.io&lt;/code&gt; 仓库即完成文章的发布。&lt;/p&gt;
&lt;h2 id="fa-bu"&gt;发布&lt;/h2&gt;
&lt;p&gt;使用终端在 &lt;code&gt;blog&lt;/code&gt; 文件夹中输入 &lt;code&gt;pelican -lr&lt;/code&gt; 即可自动部署到本地服务器，默认端口为 8000，通过 &lt;code&gt;localhost:8000&lt;/code&gt; 访问。&lt;/p&gt;
&lt;p&gt;测试完成后将内容推送至 GitHub:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-shell"&gt;$ git add .
$ git commit
$ git push
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="ke-long-yu-tong-bu"&gt;克隆与同步&lt;/h2&gt;
&lt;p&gt;由于我有 Windows 与 Linux 两个平台的设备，所以需要在两个平台上同步博客的内容，方便我在任意设备上都可以写文章。&lt;/p&gt;
&lt;p&gt;在终端中使用 &lt;code&gt;git clone --recursive&lt;/code&gt; 命令克隆仓库，&lt;code&gt;git clone&lt;/code&gt; 命令只会克隆主仓库，导致子模块失效，&lt;code&gt;--recursive&lt;/code&gt; 能递归地克隆包括子模块在内的整个仓库。使用 &lt;code&gt;git pull --recurse-submodules&lt;/code&gt; 命令能够拉取包含子模块在内的全部更新，即可完成同步。&lt;/p&gt;
&lt;hr/&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.getpelican.com/en/latest/settings.html"&gt;Pelican Settings Document&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zodiac911.github.io/blog/static-blog.html#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82"&gt;Pelican + GitHubPages 搭建个人博客 &amp;middot; Zodiac Wang&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="碎碎念"></category><category term="Blog"></category><category term="Pelican"></category></entry></feed>